<Alter AllowCreate="true" ObjectExpansion="ExpandFull" xmlns="http://schemas.microsoft.com/analysisservices/2003/engine">
  <Object>
    <DatabaseID>SemanticModel</DatabaseID>
  </Object>
  <ObjectDefinition>
    <Database xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ddl2="http://schemas.microsoft.com/analysisservices/2003/engine/2" xmlns:ddl2_2="http://schemas.microsoft.com/analysisservices/2003/engine/2/2" xmlns:ddl100_100="http://schemas.microsoft.com/analysisservices/2008/engine/100/100" xmlns:ddl200="http://schemas.microsoft.com/analysisservices/2010/engine/200" xmlns:ddl200_200="http://schemas.microsoft.com/analysisservices/2010/engine/200/200" xmlns:ddl300="http://schemas.microsoft.com/analysisservices/2011/engine/300" xmlns:ddl300_300="http://schemas.microsoft.com/analysisservices/2011/engine/300/300" xmlns:ddl400="http://schemas.microsoft.com/analysisservices/2012/engine/400" xmlns:ddl400_400="http://schemas.microsoft.com/analysisservices/2012/engine/400/400" xmlns:ddl500="http://schemas.microsoft.com/analysisservices/2013/engine/500" xmlns:ddl500_500="http://schemas.microsoft.com/analysisservices/2013/engine/500/500">
      <ID>SemanticModel</ID>
      <Name>SemanticModel</Name>
      <Annotations>
        <Annotation>
          <Name>ClientCompatibilityLevel</Name>
          <Value>300</Value>
        </Annotation>
      </Annotations>
      <ddl200:CompatibilityLevel>1103</ddl200:CompatibilityLevel>
      <ddl200_200:StorageEngineUsed>InMemory</ddl200_200:StorageEngineUsed>
      <Language>2058</Language>
      <DataSourceImpersonationInfo>
        <ImpersonationMode>Default</ImpersonationMode>
      </DataSourceImpersonationInfo>
      <Dimensions>
        <Dimension>
          <ID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</ID>
          <Name>HojaPosicion</Name>
          <Annotations>
            <Annotation>
              <Name>TableWidgetSerialization</Name>
            </Annotation>
            <Annotation>
              <Name>QueryEditorSerialization</Name>
              <Value>&lt;?xml version="1.0" encoding="UTF-16"?&gt;&lt;Gemini xmlns="QueryEditorSerialization"&gt;&lt;AnnotationContent&gt;&lt;![CDATA[&lt;RSQueryCommandText&gt;SET NOCOUNT ON

declare @FechAct int, @FechaAyer int, @FechaMesAnt int, @FechaAnioAnt int, @Nivel1 varchar(100),
@OrdenCaptacionConcetracion int, @OrdenCaptacionCanal int, @OrdenCaptacionSegmentacion int,
@DescripcionCartera varchar(50),@OrdenCarteraCanal int ,@OrdenCarteraSegmentacion int,
@OrdenContingenteCanal int, @OrdenContingenteSegmentacion int,
@OrdenCaptacionConcetracionN2 int, @OrdenCarteraNivel1 int,@OrdenCarteraNivel2 int,
@CanalAgrTit varchar(50), @OrdenCanalTit int, @CanalTit varchar(50),
@TitularizadaN1 int, @TitularizadaN2 int


select @FechAct=max(feIdFecha) from DWDFecha where fediaactual = 1

select
@FechaAyer=fecIdAnterior,
@FechaMesAnt=feMesAntCierr,
@FechaAnioAnt=feAnioAntCierr
from  DWDFecha
where feIdFecha=@FechAct


/* ----------------------- */
/*    DESENCRIPTACION      */
/* ----------------------- */

OPEN SYMMETRIC KEY ClaveMIS02
DECRYPTION BY CERTIFICATE Certi01


if object_id('[tempdb]..#DWDCuentaContable') is not null
begin
drop table #DWDCuentaContable
end

select
ccIdCuentaContable,
ccCodigoMoneda,
case 
when ccOrdenAgrupacionN2=4 then case 
								when CpEstadoProducto = 'VEN' then 'Vencida'
								when CpEstadoProducto = 'NDE' then 'QnDevInter'
								else 'Vigente' end 
else ccSubGrupo 
end ccSubGrupo,
ccGrupo,
ccFamiliaProducto,
ccCodigoIndicador,
ccClasificacionEstado,
ccOrdenAgrupacion,
ccOrdenAgrupacionN2,
ccOrdenAgrupacionN3 = case when indicadorNivel2=124 and ccOrdenAgrupacionN3 is null then 11 else ccOrdenAgrupacionN3 end ,
ccCodigoNivel6=CONVERT(varchar(15), DecryptByKey(ccCodigoNivel6)),
ccCovid,
AgrupacionCovid=case when ccCovid=1  then ccFamiliaProducto + ccSubGrupo  else ccFamiliaProducto end 
into #DWDCuentaContable 
from DWDCuentaContable
left outer join [vuClasificacionProductos] on indicadorNivel3 = cccodigoIndicador



if object_id('[tempdb]..#DWDTitularizadaOperacion') is not null
begin
drop table #DWDTitularizadaOperacion
end


select top 0
toNombre,
toCedula=CONVERT(varchar(15), DecryptByKey(toCedula)),
toOperacion=CONVERT(varchar(9), DecryptByKey(toOperacion))

into #DWDTitularizadaOperacion --0
from DWDTitularizadaOperacion


if object_id('[tempdb]..#DWHCuotaOperacion') is not null
begin
drop table #DWHCuotaOperacion
end


select
coIdFecha,
coIdAgencia,
coIdAsesorPrincipal,
coIdAsesorSecundario,
coIdCliente,
coIdCuentaContable,
coIdProducto,
coIdMoneda,
coCuotaCapital,
coNumeroOperacion=CONVERT(varchar(15), DecryptByKey(coNumeroOperacion))

into #DWHCuotaOperacion --944581
from DWHCuotaOperacion
where coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and isnull(coCuotaCapital,0)&lt;&gt;0



if object_id('[tempdb]..#DWHActivoOperacion') is not null
begin
drop table #DWHActivoOperacion
end


select
aoIdFecha,
aoIdAgencia,
aoIdAsesorPrincipal,
aoIdAsesorSecundario,
aoIdCliente,
aoIdCuentaContable,
aoIdProducto,
aoIdMoneda,
aoMontoSaldoDolar,
aoPlazoOperacion,
aoNumeroOperacion=CONVERT(varchar(15), DecryptByKey(aoNumeroOperacion)),
aoNumeroOperacion2

into #DWHActivoOperacion
from DWHActivoOperacion --60973
where aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and isnull(aoMontoSaldoDolar,0)&lt;&gt;0

CLOSE SYMMETRIC KEY ClaveMIS02

/* ---------------- */
/* PASIVO OPERACION */
/* ---------------- */

if object_id('[tempdb]..#DWHPasivoOperacion') is not null
begin
drop table #DWHPasivoOperacion
end

select
 poIdFecha
,poIdProducto
,poIdMoneda
,poIdAgencia
,poIdAsesor
,poIdCliente
,poSaldoOperacionUSD
,poIdCuentaContable
into  #DWHPasivoOperacion
from DWHPasivoOperacion --1727655
where poIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and isnull(poSaldoOperacionUSD,0)&lt;&gt;0

/* ----------------- */
/* TARJETA OPERACION */
/* ----------------- */

if object_id('[tempdb]..#DWHTarjetaCreditoOperacion') is not null
begin
drop table #DWHTarjetaCreditoOperacion
end

select
 tcoIdFecha
,tcoIdAgencia
,tcoIdCuentaContable
,tcoIdMoneda
,tcoIdProducto
,tcoIdCliente
,tcoSaldo
into #DWHTarjetaCreditoOperacion
from DWHTarjetaCreditoOperacion
where tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and isnull(tcoSaldo,0)&lt;&gt;0


--------------------------------------------------------
-- Actualizacion de titularizada a Cartera Titularizada
--------------------------------------------------------

update #DWDCuentaContable
set
ccFamiliaProducto='Cartera',
ccGrupo='C. Titularizada',
ccSubGrupo=null
where cccodigoindicador in (136,137,138)


/* -------------------------------------------- */
/* OBTENCION DE NUMERO DE ORDEN Y DESCRIPCIONES */
/* -------------------------------------------- */

--&gt;&gt; CAPTACIONES

select distinct @Nivel1=ccFamiliaProducto
from #DWDCuentaContable
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (2)
and p1.CpCodigoIndicador in (140)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3

select
@OrdenCaptacionConcetracion=max(ccOrdenAgrupacion),
@OrdenCaptacionConcetracionN2=max(ccOrdenAgrupacionN2)
from #DWDCuentaContable cc
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (2)
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3

select
@OrdenCaptacionCanal=max(ccOrdenAgrupacion)+1,
@OrdenCaptacionSegmentacion=max(ccOrdenAgrupacion)+2
from #DWDCuentaContable
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (2)
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3


--&gt;&gt; CARTERA

select
@OrdenCarteraNivel1=max(ccOrdenAgrupacion),
@OrdenCarteraNivel2=max(ccOrdenAgrupacionN2),
@OrdenCarteraCanal=max(ccOrdenAgrupacion)+1,
@OrdenCarteraSegmentacion=max(ccOrdenAgrupacion)+2
from #DWDCuentaContable
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (1)
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3


select @DescripcionCartera=max(ccFamiliaProducto)
from #DWDCuentaContable
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (1)
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3


--&gt;&gt; CONTINGENTES

select @OrdenContingenteCanal=max(ccOrdenAgrupacion)+1,
@OrdenContingenteSegmentacion=max(ccOrdenAgrupacion)+2
from #DWDCuentaContable
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (3)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3


--&gt;&gt; TITULARIZADA

select
@TitularizadaN1=max(prOrdenN1),
@TitularizadaN2=max(prOrdenN2)+1
from DWDProducto where prGrupo='Vehiculos'

select
@CanalTit=caDescripcionAgrupacionCanal,
@CanalAgrTit=caAgrupacion,
@OrdenCanalTit=caOrdenCanal
from DWDCanal
where caCodigoCanal='TIT'



if object_id('[tempdb]..#Cartera')  is not null
begin
drop table #Cartera
end

--- Identificacion vehiculos

if object_id('[tempdb]..#Vehiculos') is not null
begin
drop table #Vehiculos
end

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
pr.prOrdenN1,
pr.prOrdenN2,
pr.prOrdenN3,
ca.caOrdenCanal,
cc.ccOrdenAgrupacionN3,
--Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
--Division='NO',
cc.ccFamiliaProducto,
pr.prVehiculo,
ca.caAgrupacion,
cc.AgrupacionCovid,
pr.prSubGrupo,
pr.prCodigoIndicador,
cc.ccSubGrupo,
cc.ccCovid,

RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end

into #Vehiculos

from #DWHCuotaOperacion co
inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador =1
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and pr.prVehiculo='Vehiculos'
and ccCodigoMoneda=moCodigoMoneda
and clFechaFin is null
and ca.caEstado=1
--and cc.ccCodigoMoneda='USD'
group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
ca.caOrdenCanal,
mo.moCodigoMoneda,
ca.caDescripcionAgrupacionCanal,
pr.prOrdenN1,
pr.prOrdenN2,
cc.ccFamiliaProducto,
ccOrdenAgrupacion,
ccOrdenAgrupacionN2,
ccOrdenAgrupacionN3,
ca.caAgrupacion,
pr.prVehiculo,
co.coIdFecha, --202815
cc.AgrupacionCovid,
pr.prOrdenN3,
pr.prSubGrupo,
pr.prCodigoIndicador,
cc.ccSubGrupo,
cc.ccCovid,
cc.ccOrdenAgrupacionN3


/* ---------------------------------------------------------------------- */
/*                           CARTERA                                      */
/* ---------------------------------------------------------------------- */

-- Comer. + Micro. (525,526,524,501,504,506,505,509,507)
-- Consumo (510,511,512,513,514,515)
-- Vivienda (519,520,521,522,523)
-- Titularizada (136,137,138)

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=ca.caOrdenCanal,
Jerarquia=4,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='     '+ca.caAgrupacion,
Nivel4='     '+cc.AgrupacionCovid,
Nivel5='     '+cc.AgrupacionCovid,
RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0

into #Cartera

from #DWHCuotaOperacion co
inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
left outer join #DWDTitularizadaOperacion ti on  isnull(co.coNumeroOperacion,'')=ti.toOperacion
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end/**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and pr.prVehiculo is null
and cl.clFechaFin is null
and ca.caEstado=1
and ti.toOperacion is null -- Filtro Titularizada
--and cc.ccCodigoMoneda='USD'

group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
co.coIdFecha,
cl.clCodigoCliente,
ca.caAgrupacion,
ca.caOrdenCanal,
ca.caDescripcionAgrupacionCanal,
cl.clNombreCompleto,
mo.moCodigoMoneda,
cc.ccOrdenAgrupacionN2,
cc.ccFamiliaProducto,
prCodigoProducto,
ccCodigoNivel6,
cc.ccGrupo,
cc.ccOrdenAgrupacion,
cc.ccCodigoIndicador, --20303
cc.AgrupacionCovid

Union All

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
--  Agrupaciones
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=cc.ccOrdenAgrupacionN3,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3=cc.ccSubGrupo,
Nivel4=cc.ccSubGrupo,
Nivel5=cc.ccSubGrupo,
RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHCuotaOperacion co
inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
left outer join #DWDTitularizadaOperacion ti on  isnull(co.coNumeroOperacion,'')=ti.toOperacion
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha  in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and pr.prVehiculo is null
and cl.clFechaFin is null
and ccCodigoMoneda=moCodigoMoneda
and ca.caEstado=1
and ti.toOperacion is null -- Filtro titularizada
--and cc.ccCodigoMoneda='USD'
group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
cc.ccFamiliaProducto,
cc.ccGrupo,
cc.ccOrdenAgrupacion,
ca.caDescripcionAgrupacionCanal,
cc.ccOrdenAgrupacionN2,
cc.ccOrdenAgrupacionN3,
cc.ccSubGrupo,
co.coIdFecha--20354

Union All

--&gt;&gt;  Agrupaciones Valor Deduccion

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=cc.ccOrdenAgrupacionN3,
Jerarquia=2,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
RealHoy=case co.coIdFecha when @FechAct then (sum(isnull(co.coCuotaCapital,0))/1000)*-1 else 0 end,
DenominadorHoy=0,
RealAyer=case co.coIdFecha when @FechaAyer then (sum(isnull(co.coCuotaCapital,0))/1000)*-1 else 0 end,
DenominadorAyer=0,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then (sum(isnull(co.coCuotaCapital,0))/1000)*-1 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then (sum(isnull(co.coCuotaCapital,0))/1000)*-1 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHCuotaOperacion co
inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
left outer join #DWDTitularizadaOperacion ti on  isnull(co.coNumeroOperacion,'')=ti.toOperacion
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha  in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and pr.prVehiculo is null
and cl.clFechaFin is null
and ca.caEstado=1
and ccCodigoMoneda=moCodigoMoneda
and ti.toOperacion is null -- Filtro titularizada
--and cc.ccCodigoMoneda='USD'
group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
cc.ccFamiliaProducto,
cc.ccGrupo,
cc.ccOrdenAgrupacion,
ca.caDescripcionAgrupacionCanal,
cc.ccOrdenAgrupacionN2,
cc.ccOrdenAgrupacionN3,
co.coIdFecha --20405

Union All

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- T. Credito
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=ca.caOrdenCanal,
Jerarquia=4,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='     '+ca.caAgrupacion,
Nivel4='     '+cc.AgrupacionCovid,
Nivel5='     '+cc.AgrupacionCovid,
RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHTarjetaCreditoOperacion tco
inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto
inner join DWDMoneda on moIdMoneda=tcoIdMoneda
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador = 124
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and cl.clFechaFin is null
and ca.caEstado=1
--and cc.ccCodigoMoneda='USD'
group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
cc.ccOrdenAgrupacion,
cl.clCodigoCliente,
ca.caOrdenCanal,
cc.ccOrdenAgrupacionN2,
ca.caDescripcionAgrupacionCanal,
cc.ccFamiliaProducto,
caAgrupacion,
cc.ccGrupo,
tco.tcoIdFecha, --202793
cc.AgrupacionCovid

union all

-- Agrupacion Covid Tarjeta de credito

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=cc.ccOrdenAgrupacionN3,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='     '+cc.ccSubGrupo,
Nivel4='     '+cc.ccSubGrupo,
Nivel5='     '+cc.ccSubGrupo,
RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHTarjetaCreditoOperacion tco
inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto
inner join DWDMoneda on moIdMoneda=tcoIdMoneda
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador = 124
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and cl.clFechaFin is null
and ca.caEstado=1
and cc.ccCovid=1
--and cc.ccCodigoMoneda='USD'
group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
cc.ccOrdenAgrupacion,
cl.clCodigoCliente,
ca.caOrdenCanal,
cc.ccOrdenAgrupacionN2,
ca.caDescripcionAgrupacionCanal,
cc.ccFamiliaProducto,
cc.ccGrupo,
tco.tcoIdFecha, --202793
cc.ccSubGrupo,
cc.ccOrdenAgrupacionN3

union all

-- valor deduccion covid de tarjeta 

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=cc.ccOrdenAgrupacionN3,
Jerarquia=2,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
RealHoy=case tco.tcoIdFecha when @FechAct then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
DenominadorHoy=0,
RealAyer=case tco.tcoIdFecha when @FechaAyer then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
DenominadorAyer=0,
RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHTarjetaCreditoOperacion tco
inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto
inner join DWDMoneda on moIdMoneda=tcoIdMoneda
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador = 124
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and cl.clFechaFin is null
and ca.caEstado=1
and cc.ccCovid=1
--and cc.ccCodigoMoneda='USD'
group by
cp.CpEstadoProducto,
cc.ccOrdenAgrupacion,
cl.clCodigoCliente,
ca.caOrdenCanal,
cc.ccOrdenAgrupacionN2,
ca.caDescripcionAgrupacionCanal,
cc.ccFamiliaProducto,
cc.ccGrupo,
tco.tcoIdFecha, --202793
cc.ccOrdenAgrupacionN3

Union All

-- Agrupacion Tarjeta de credito Dificultades 

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=cc.ccOrdenAgrupacionN3,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='     '+cc.ccSubGrupo,
Nivel4='     '+cc.ccSubGrupo,
Nivel5='     '+cc.ccSubGrupo,
RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHTarjetaCreditoOperacion tco
inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto
inner join DWDMoneda on moIdMoneda=tcoIdMoneda
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and cl.clFechaFin is null
and ca.caEstado=1
group by
cp.CpEstadoProducto, 
cc.ccOrdenAgrupacion,
cl.clCodigoCliente,
ca.caOrdenCanal,
cc.ccOrdenAgrupacionN2,
ca.caDescripcionAgrupacionCanal,
cc.ccFamiliaProducto,
cc.ccGrupo,
tco.tcoIdFecha, --202793
cc.ccSubGrupo,
cc.ccOrdenAgrupacionN3

union all

-- valor deduccion de tarjeta Dificultades

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=cc.ccOrdenAgrupacionN3,
Jerarquia=2,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
RealHoy=case tco.tcoIdFecha when @FechAct then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
DenominadorHoy=0,
RealAyer=case tco.tcoIdFecha when @FechaAyer then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
DenominadorAyer=0,
RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHTarjetaCreditoOperacion tco
inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto
inner join DWDMoneda on moIdMoneda=tcoIdMoneda
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and cl.clFechaFin is null
and ca.caEstado=1
group by
cp.CpEstadoProducto,
cc.ccOrdenAgrupacion,
cl.clCodigoCliente,
ca.caOrdenCanal,
cc.ccOrdenAgrupacionN2,
ca.caDescripcionAgrupacionCanal,
cc.ccFamiliaProducto,
cc.ccGrupo,
tco.tcoIdFecha, 
cc.ccOrdenAgrupacionN3

Union All

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- Vehiculos
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
Estado,--ccClasificacionEstado, /**/
OrdenN1=prOrdenN1,
OrdenN2=prOrdenN2,
OrdenN3=caOrdenCanal,
Jerarquia=4,
Canal,
Division='NO',
Nivel1=ccFamiliaProducto,
Nivel2=prVehiculo,
Nivel3='     '+caAgrupacion,
Nivel4='     '+AgrupacionCovid,
Nivel5='     '+AgrupacionCovid,
RealHoy,
DenominadorHoy=0,
RealAyer,
DenominadorAyer=0,
RealMesAnt,
DenominadorMesAnt=0,
RealAnioAnt,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #Vehiculos co

Union All

--&gt;&gt; Vehiculos Credimetrica y Originarsa

select
Estado,--ccClasificacionEstado, /**/
OrdenN1=prOrdenN1,
OrdenN2=prOrdenN2,
OrdenN3=prOrdenN3,
Jerarquia=4,
Canal,
Division='NO',
Nivel1=ccFamiliaProducto,
Nivel2=prVehiculo,
Nivel3=prSubGrupo,
Nivel4=AgrupacionCovid,
Nivel5=AgrupacionCovid,
RealHoy,
DenominadorHoy=0,
RealAyer,
DenominadorAyer=0,
RealMesAnt,
DenominadorMesAnt=0,
RealAnioAnt,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #Vehiculos
where prCodigoIndicador in (527,528,529,530)


Union All

--&gt;&gt; Valor deduccion Credimetrica y Originarsa

select
Estado,--ccClasificacionEstado, /**/
OrdenN1=prOrdenN1,
OrdenN2=prOrdenN2,
OrdenN3=prOrdenN3,
Jerarquia=2,
Canal,
Division='NO',
Nivel1=ccFamiliaProducto,
Nivel2=prVehiculo,
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
RealHoy=RealHoy*-1,
DenominadorHoy=0,
RealAyer=RealAyer*-1,
DenominadorAyer=0,
RealMesAnt=RealMesAnt*-1,
DenominadorMesAnt=0,
RealAnioAnt=RealAnioAnt*-1,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #Vehiculos
where prCodigoIndicador in (527,528,529,530)

union all

-- agrupacion covid vehiculos
select
Estado,--ccClasificacionEstado, /**/
OrdenN1=prOrdenN1,
OrdenN2=prOrdenN2,
OrdenN3=ccOrdenAgrupacionN3,
Jerarquia=3,
Canal,
Division='NO',
Nivel1=ccFamiliaProducto,
Nivel2=prVehiculo,
Nivel3=ccSubGrupo,
Nivel4=ccSubGrupo,
Nivel5=ccSubGrupo,
RealHoy,
DenominadorHoy=0,
RealAyer,
DenominadorAyer=0,
RealMesAnt,
DenominadorMesAnt=0,
RealAnioAnt,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #Vehiculos
where ccCovid=1


union all

-- agrupacion covid vehiculos
select
Estado,--ccClasificacionEstado, /**/
OrdenN1=prOrdenN1,
OrdenN2=prOrdenN2,
OrdenN3=ccOrdenAgrupacionN3,
Jerarquia=2,
Canal,
Division='NO',
Nivel1=ccFamiliaProducto,
Nivel2=prVehiculo,
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
RealHoy=RealHoy*-1,
DenominadorHoy=0,
RealAyer=RealAyer*-1,
DenominadorAyer=0,
RealMesAnt=RealMesAnt*-1,
DenominadorMesAnt=0,
RealAnioAnt=RealAnioAnt*-1,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #Vehiculos
where ccCovid=1

Union all

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- Titularizada
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

--&gt; Identificacion de C.Titularizada por número de operación

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=@TitularizadaN1,
OrdenN2=@TitularizadaN2,
OrdenN3=@TitularizadaN2,
Jerarquia=2,
Canal=@CanalTit,
Division='NO',
Nivel1=@DescripcionCartera,
Nivel2='C. '+@CanalTit,
Nivel3=space(5)+ @CanalAgrTit,
Nivel4=space(5)+ @CanalAgrTit,
Nivel5=space(5)+ @CanalAgrTit,
RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHCuotaOperacion co
inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
inner join #DWDTitularizadaOperacion ti on isnull(co.coNumeroOperacion,'')=ti.toOperacion -- Titularizada
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and ccCodigoMoneda=moCodigoMoneda
and clFechaFin is null
and ca.caEstado=1
--and cc.ccCodigoMoneda='USD'
group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
ca.caOrdenCanal,
pr.prGrupo,
mo.moCodigoMoneda,
pr.prVehiculo,
co.coIdFecha--202839
/*
Union All

-- Cambio de asignación de Titularizada a Cartera Titularizada

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=@TitularizadaN1,
OrdenN2=@TitularizadaN2,
OrdenN3=@TitularizadaN2,
Jerarquia=2,
Canal=@CanalTit,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3=space(5)+ @CanalAgrTit,
Nivel4=space(5)+ @CanalAgrTit,
Nivel5=space(5)+ @CanalAgrTit,
RealHoy=case ao.aoIdFecha when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case ao.aoIdFecha when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case ao.aoIdFecha when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case ao.aoIdFecha when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHActivoOperacion ao
inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on ao.aoIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on mo.moIdMoneda=ao.aoIdMoneda
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador = 125
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where ao.aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and cl.clfechafin is null
and ca.caEstado=1
group by
ca.caOrdenCanal,
ao.aoIdFecha,
ccFamiliaProducto,
ccGrupo,
cp.CpEstadoProducto --ccClasificacionEstado, /**/ -- 202839
*/
Union All

/* PRESUPUESTO NEGOCIO */

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- Comer. + Micro. (525,526,524,501,504,506,505,509,507)
-- Consumo (510,511,512,515)
-- Vivienda (519,520,521,522,523)
-- Vehiculos (513,514)
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=case when ccFamiliaProducto like '%Titularizada%' then @TitularizadaN1 else cc.ccOrdenAgrupacion end,   -- Control para obtener el orden de Titularizada y Situarlo dentro de Cartera Titularizada
OrdenN2=case when ccFamiliaProducto like '%Titularizada%' then @TitularizadaN2 else cc.ccOrdenAgrupacionN2 end,
OrdenN3=ca.caOrdenCanal,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='     '+ca.caAgrupacion,
Nivel4='     '+ca.caAgrupacion,--no debe ir covid para presupuesto
Nivel5='     '+ca.caAgrupacion,--no debe ir covid para presupuesto
RealHoy=0,
DenominadorHoy=0,
RealAyer=0,
DenominadorAyer=0,
RealMesAnt=0,
DenominadorMesAnt=0,
RealAnioAnt=0,
DenominadorAnioAnt=0,
ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,
DenominadorPresupuesto=0
from DWHPresupuestoNegocio pn
inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,126)
and p2.CpCodigoIndicador not in (513,514)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where pn.pnIdFecha in (@FechAct)
and ca.caEstado=1
group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
cc.ccOrdenAgrupacion,
ca.caOrdenCanal,
cc.ccOrdenAgrupacionN2,
ca.caDescripcionAgrupacionCanal,
cc.ccFamiliaProducto,
cc.ccGrupo,
ca.caAgrupacion --202842

Union All

-----------------
-- Agrupaciones
-----------------

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=cc.ccOrdenAgrupacionN3,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3=cc.ccSubGrupo,
Nivel4=cc.ccSubGrupo,
Nivel5=cc.ccSubGrupo,
RealHoy=0,
DenominadorHoy=0,
RealAyer=0,
DenominadorAyer=0,
RealMesAnt=0,
DenominadorMesAnt=0,
RealAnioAnt=0,
DenominadorAnioAnt=0,
ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,
DenominadorPresupuesto=0
from DWHPresupuestoNegocio pn
inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,126)
and p2.CpCodigoIndicador not in (513,514)
and p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where pn.pnIdFecha in (@FechAct)
and ca.caEstado=1
group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
cc.ccOrdenAgrupacion,
cc.ccOrdenAgrupacionN2,
cc.ccOrdenAgrupacionN3,
ca.caDescripcionAgrupacionCanal,
cc.ccFamiliaProducto,
cc.ccGrupo,
cc.ccSubGrupo --202848

Union All

--- Valor deduccion agrupaciones

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=cc.ccOrdenAgrupacionN3,
Jerarquia=2,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
RealHoy=0,
DenominadorHoy=0,
RealAyer=0,
DenominadorAyer=0,
RealMesAnt=0,
DenominadorMesAnt=0,
RealAnioAnt=0,
DenominadorAnioAnt=0,
ValorPresupuesto=(sum(isnull(pn.pnValorPresupuesto,0))/1000)*-1,
DenominadorPresupuesto=0
from DWHPresupuestoNegocio pn
inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,126)
and p2.CpCodigoIndicador not in (513,514)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where pn.pnIdFecha in (@FechAct)
and ca.caEstado=1
group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
cc.ccOrdenAgrupacion,
cc.ccOrdenAgrupacionN2,
cc.ccOrdenAgrupacionN3,
ca.caDescripcionAgrupacionCanal,
cc.ccFamiliaProducto,
cc.ccGrupo --202854

Union All

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- T. Credito
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=ca.caOrdenCanal,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='     '+ca.caAgrupacion,
Nivel4='     '+ca.caAgrupacion,-- no debe ir covid
Nivel5='     '+ca.caAgrupacion,-- no debe ir covid
RealHoy=0,
DenominadorHoy=0,
RealAyer=0,
DenominadorAyer=0,
RealMesAnt=0,
DenominadorMesAnt=0,
RealAnioAnt=0,
DenominadorAnioAnt=0,
ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,
DenominadorPresupuesto=0
from DWHPresupuestoNegocio pn
inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (124)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where pn.pnIdFecha in (@FechAct)
and ca.caEstado=1
group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
ca.caOrdenCanal,
cc.ccOrdenAgrupacion,
cc.ccOrdenAgrupacionN2,
cc.ccOrdenAgrupacionN3,
cc.ccFamiliaProducto,
ca.caDescripcionAgrupacionCanal,
cc.ccGrupo,
ca.caAgrupacion

Union All

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- Vehiculos
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=8,
OrdenN3=ca.caOrdenCanal,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2= 'Vehiculos',
Nivel3='     '+ca.caAgrupacion,
Nivel4='     '+ca.caAgrupacion,-- no debe ir covid
Nivel5='     '+ca.caAgrupacion,-- no debe ir covid
RealHoy=0,
DenominadorHoy=0,
RealAyer=0,
DenominadorAyer=0,
RealMesAnt=0,
DenominadorMesAnt=0,
RealAnioAnt=0,
DenominadorAnioAnt=0,
ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,
DenominadorPresupuesto=0
from DWHPresupuestoNegocio pn
inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable -- where ccgrupo like '%veh%' --ccCodigoNivel6 in (140280206011,141280202011)
inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal
inner join DWDProducto p on pn.pnIdProducto=p.prIdProducto
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador = 121
and p2.CpCodigoIndicador in (513,514)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where pn.pnIdFecha in (@FechAct)
and ca.caEstado=1
group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
cc.ccOrdenAgrupacion,
cc.ccOrdenAgrupacionN2,
ca.caOrdenCanal,
ccOrdenAgrupacion,
cc.ccFamiliaProducto,
ca.caDescripcionAgrupacionCanal,
p.prVehiculo,
ca.caAgrupacion --202857 OK


if OBJECT_ID('[tempdb]..#hoja') is not null
begin
drop table #hoja
end


/* ------------------------------------------------------------------------ */
/*                       CAPTACIONES                                        */
/* ------------------------------------------------------------------------ */

-- Monetarios (98, 100,55,54,99)
-- Ahorros (247,600,601)
-- Plazo (602, 603, 604, 605, 606, 607)

select
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=caOrdenCanal,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='SI',
Nivel1=cc.ccFamiliaProducto,
Nivel2=left(cc.ccGrupo+SPACE(70),70)+'X'+right('0'+cast(cc.ccOrdenAgrupacion as varchar(10)),2)+right('0'+ cast(cc.ccOrdenAgrupacionN2 as varchar(10)),2)+'X',
Nivel3='     '+ca.caAgrupacion,
Nivel4='     '+ca.caAgrupacion,
Nivel5='     '+ca.caAgrupacion,
FechaHoy=@FechAct,
RealHoy=case po.poIdFecha when @FechAct then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case po.poIdFecha when @FechaAyer then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case po.poIdFecha when @FechaMesAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case po.poIdFecha when @FechaAnioAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
into #hoja
from #DWHPasivoOperacion po
inner join #DWDCuentaContable cc on po.poIdCuentaContable=ccIdCuentaContable
inner join DWDCliente cl on po.poIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 2
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where po.poIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)
and ca.caEstado=1
and cl.clFechaFin is null
group by
cc.ccOrdenAgrupacion,
cc.ccOrdenAgrupacionN2,
ca.caOrdenCanal,
ca.caAgrupacion,
cc.ccFamiliaProducto,
ca.caDescripcionAgrupacionCanal,
cc.ccGrupo,
po.poIdFecha

Union all

-- Platinum(99); Ctas.Rentables(98) ; Ints.Financieras(54)
-- Depósitos QGI(55) ; Depósitos QNGI(100); Ahorro Tradicional(600)
-- Ahorro Programado(247); Inversion Empresarial(601); De 1 a 30 Dias (602)
-- De 31 a 90 Dias(603);  De 91 a 180 Dias(604)
-- De 181 a 360 Dias (605); Mas de 360 Dias (606)
-- Restringidos (607)

select
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=cc.ccOrdenAgrupacionN3,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='SI',
Nivel1=cc.ccFamiliaProducto,
Nivel2=left(cc.ccGrupo+space(70),70)+'X'+right('0'+cast(cc.ccOrdenAgrupacion as varchar(10)),2)+right('0'+ cast(cc.ccOrdenAgrupacionN2 as varchar(10)),2)+'X',
Nivel3=cc.ccSubGrupo,
Nivel4=cc.ccSubGrupo,
Nivel5=cc.ccSubGrupo,
FechaHoy=@FechAct,
RealHoy=case po.poIdFecha when @FechAct then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case po.poIdFecha when @FechaAyer then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case po.poIdFecha when @FechaMesAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case po.poIdFecha when @FechaAnioAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHPasivoOperacion po
inner join #DWDCuentaContable cc on po.poIdCuentaContable=ccIdCuentaContable
inner join DWDCliente cl on po.poIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 2
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where po.poIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)
and ca.caEstado=1
and cl.clFechaFin is null
group by
cc.ccFamiliaProducto,
cc.ccGrupo,
cc.ccSubGrupo,
cc.ccOrdenAgrupacion,
cc.ccOrdenAgrupacionN2,
cc.ccOrdenAgrupacionN3,
ca.caDescripcionAgrupacionCanal,
ca.caAgrupacion,
po.poIdFecha

Union all

--------&gt;&gt; Valor Deduccion

select
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=cc.ccOrdenAgrupacionN3,
Jerarquia=2,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='SI',
Nivel1=cc.ccFamiliaProducto,
Nivel2=left(cc.ccGrupo+space(70),70)+'X'+right('0'+cast(cc.ccOrdenAgrupacion as varchar(10)),2)+right('0'+ cast(cc.ccOrdenAgrupacionN2 as varchar(10)),2)+'X',
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
FechaHoy=@FechAct,
RealHoy=case po.poIdFecha when @FechAct then (sum(isnull(po.poSaldoOperacionUSD,0))/1000)*-1 else 0 end,
DenominadorHoy=0,
RealAyer=case po.poIdFecha when @FechaAyer then (sum(isnull(po.poSaldoOperacionUSD,0))/1000)*-1 else 0 end,
DenominadorAyer=0,
RealMesAnt=case po.poIdFecha when @FechaMesAnt then (sum(isnull(po.poSaldoOperacionUSD,0))/1000)*-1 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case po.poIdFecha when @FechaAnioAnt then (sum(isnull(po.poSaldoOperacionUSD,0))/1000)*-1 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHPasivoOperacion po
inner join #DWDCuentaContable cc on po.poIdCuentaContable=ccIdCuentaContable
inner join DWDCliente cl on po.poIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 2
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where po.poIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)
and ca.caEstado=1
and cl.clFechaFin is null
group by
cc.ccFamiliaProducto,
cc.ccGrupo,
cc.ccSubGrupo,
cc.ccOrdenAgrupacion,
cc.ccOrdenAgrupacionN2,
cc.ccOrdenAgrupacionN3,
ca.caDescripcionAgrupacionCanal,
ca.caAgrupacion,
po.poIdFecha

Union all

/* Presupuesto Negocio */

-- Monetarios (98, 100,55,54,99)
-- Ahorros (247,600,601)
-- Plazo (602, 603, 604, 605, 606, 607)

select
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=ca.caOrdenCanal,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='SI',
Nivel1=cc.ccFamiliaProducto,
Nivel2=left(cc.ccGrupo+space(70),70)+'X'+right('0'+cast(cc.ccOrdenAgrupacion as varchar(10)),2)+right('0'+ cast(cc.ccOrdenAgrupacionN2 as varchar(10)),2)+'X',
Nivel3='     '+ca.caAgrupacion,
Nivel4='     '+ca.caAgrupacion,
Nivel5='     '+ca.caAgrupacion,
FechaHoy=@FechAct,
RealHoy=0,
DenominadorHoy=0,
RealAyer=0,
DenominadorAyer=0,
RealMesAnt=0,
DenominadorMesAnt=0,
RealAnioAnt=0,
DenominadorAnioAnt=0,
ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,
DenominadorPresupuesto=0
from DWHPresupuestoNegocio pn
inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 2
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where pn.pnIdFecha in (@FechAct)
and ca.caEstado=1
and pn.pnIdIndicadorMedidaFinanciera=-10
group by
cc.ccOrdenAgrupacion,
cc.ccOrdenAgrupacionN2,
cc.ccOrdenAgrupacionN3,
cc.ccFamiliaProducto,
cc.ccGrupo,
ca.caDescripcionAgrupacionCanal,
ca.caOrdenCanal,
ca.caAgrupacion

Union all

-- Platinum(99); Ctas.Rentables(98) ; Ints.Financieras(54)
-- Depósitos QGI(55) ; Depósitos QNGI(100); Ahorro Tradicional(600)
-- Ahorro Programado(247); Inversion Empresarial(601); De 1 a 30 Dias (602)
-- De 31 a 90 Dias(603);  De 91 a 180 Dias(604)
-- De 181 a 360 Dias (605); Mas de 360 Dias (606)
-- Restringidos (607)

select
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=cc.ccOrdenAgrupacionN3,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='SI',
Nivel1=cc.ccFamiliaProducto,
Nivel2=left(cc.ccGrupo+space(70),70)+'X'+right('0'+cast(cc.ccOrdenAgrupacion as varchar(10)),2)+right('0'+ cast(cc.ccOrdenAgrupacionN2 as varchar(10)),2)+'X',
Nivel3=cc.ccSubGrupo,
Nivel4=cc.ccSubGrupo,
Nivel5=cc.ccSubGrupo,
FechaHoy=@FechAct,
RealHoy=0,
DenominadorHoy=0,
RealAyer=0,
DenominadorAyer=0,
RealMesAnt=0,
DenominadorMesAnt=0,
RealAnioAnt=0,
DenominadorAnioAnt=0,
ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,
DenominadorPresupuesto=0
from DWHPresupuestoNegocio pn
inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 2
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where pn.pnIdFecha in (@FechAct)
and ca.caEstado=1
and pn.pnIdIndicadorMedidaFinanciera=-10
group by
cc.ccOrdenAgrupacion,
cc.ccOrdenAgrupacionN2,
cc.ccOrdenAgrupacionN3,
cc.ccFamiliaProducto,
cc.ccCodigoIndicador,
ca.caDescripcionAgrupacionCanal,
cc.ccGrupo,
cc.ccSubGrupo

Union all

----- &gt;&gt; Valor Deduccion Presupuesto Productos

select
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=cc.ccOrdenAgrupacionN3,
Jerarquia=2,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='SI',
Nivel1=cc.ccFamiliaProducto,
Nivel2=left(cc.ccGrupo+space(70),70)+'X'+right('0'+cast(cc.ccOrdenAgrupacion as varchar(10)),2)+right('0'+ cast(cc.ccOrdenAgrupacionN2 as varchar(10)),2)+'X',
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
FechaHoy=@FechAct,
RealHoy=0,
DenominadorHoy=0,
RealAyer=0,
DenominadorAyer=0,
RealMesAnt=0,
DenominadorMesAnt=0,
RealAnioAnt=0,
DenominadorAnioAnt=0,
ValorPresupuesto=(sum(isnull(pn.pnValorPresupuesto,0))/1000)*-1,
DenominadorPresupuesto=0
from DWHPresupuestoNegocio pn
inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 2
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where pn.pnIdFecha in (@FechAct)
and ca.caEstado=1
and pn.pnIdIndicadorMedidaFinanciera=-10
group by
cc.ccOrdenAgrupacion,
cc.ccOrdenAgrupacionN2,
cc.ccOrdenAgrupacionN3,
cc.ccFamiliaProducto,
cc.ccCodigoIndicador,
ca.caDescripcionAgrupacionCanal,
cc.ccGrupo,
cc.ccSubGrupo

Union all

-------------------------------------
--        Concentracion            --
-------------------------------------

select
OrdenN1=@OrdenCaptacionConcetracion,
OrdenN2=Orden,
OrdenN3=Orden,
Jerarquia=2,
Canal='Otr.Dep y Obl.Fin',
Division='NO',
Consolidado='NO',
Nivel1=@Nivel1,
Nivel2=Nivel,
Nivel3=Nivel,
Nivel4=Nivel,
Nivel5=Nivel,
FechaHoy=@FechAct,
RealHoy=sum(RealHoy),
DenominadorHoy=0,
RealAyer=sum(RealAyer),
DenominadorAyer=0,
RealMesAnt=sum(RealMesAnt),
DenominadorMesAnt=0,
RealAnioAnt=sum(RealAnioAnt),
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from
(
select
Orden=
case ppCodigoProducto
when 39 then @OrdenCaptacionConcetracionN2+1
when 40 then @OrdenCaptacionConcetracionN2+2
when 41 then @OrdenCaptacionConcetracionN2+3 end,
Nivel=
case ppCodigoProducto
when 39 then 'Concentración 100'
when 40 then 'Concentración 50'
when 41 then 'Concentración 25' end,
RealHoy=case ppFecha when @FechAct then sum(isnull(ppPronostico,0)) else 0 end,
RealAyer=case ppFecha when @FechaAyer then sum(isnull(ppPronostico,0)) else 0 end,
RealMesAnt=case ppFecha when @FechaMesAnt then sum(isnull(ppPronostico,0)) else 0 end,
RealAnioAnt=case ppFecha when @FechaAnioAnt then sum(isnull(ppPronostico,0)) else 0 end
from DWDPronosticoProducto
where ppCodigoProducto in (39,40,41)
group by ppFecha,
ppCodigoProducto
) Concentracion
group by Orden,
Nivel


Union all

------&gt;&gt;&gt; Valor Deduccion

select
OrdenN1=@OrdenCaptacionConcetracion,
OrdenN2=Orden,
OrdenN3=Orden,
Jerarquia=1,
Canal='Otr.Dep y Obl.Fin',
Division='NO',
Consolidado='NO',
Nivel1=@Nivel1,
Nivel2='Deducción',
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
FechaHoy=@FechAct,
RealHoy=sum(RealHoy)*-1,
DenominadorHoy=0,
RealAyer=sum(RealAyer)*-1,
DenominadorAyer=0,
RealMesAnt=sum(RealMesAnt)*-1,
DenominadorMesAnt=0,
RealAnioAnt=sum(RealAnioAnt)*-1,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from
(
select
Orden=
case ppCodigoProducto
when 39 then @OrdenCaptacionConcetracionN2+1
when 40 then @OrdenCaptacionConcetracionN2+2
when 41 then @OrdenCaptacionConcetracionN2+3 end,
Nivel=
case ppCodigoProducto
when 39 then 'Concentración 100'
when 40 then 'Concentración 50'
when 41 then 'Concentración 25' end,
RealHoy=case ppFecha when @FechAct then sum(isnull(ppPronostico,0)) else 0 end,
RealAyer=case ppFecha when @FechaAyer then sum(isnull(ppPronostico,0)) else 0 end,
RealMesAnt=case ppFecha when @FechaMesAnt then sum(isnull(ppPronostico,0)) else 0 end,
RealAnioAnt=case ppFecha when @FechaAnioAnt then sum(isnull(ppPronostico,0)) else 0 end
from DWDPronosticoProducto
where ppCodigoProducto in (39,40,41)
group by ppFecha,
ppCodigoProducto
) Concentracion
group by Orden,
Nivel

Union all

/* //////////////////////////////////////// */
/*      CAPTACIONES - CANAL                 */
/* //////////////////////////////////////// */

-- Canal Comercial por Region Agencia (1,8,5,9,12,13)
-- Canal Corporativo por Asesor (10)
-- Canal Especializada por Subcanal (7,15,17,11)
-- Canal Tesoreria por Region Agencia (14)

select
OrdenN1=@OrdenCaptacionCanal,
OrdenN2=ca.caOrdenCanal,
OrdenN3=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4) then
case when ag.agNombreRegion like '%SIN%REGION%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 1000 else ag.agOrdenRegionAsesor end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then
case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 1000 else asOrdenAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then caOrdenDescripcionCanal
else 1000
end,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Canal',
Nivel2=ca.caAgrupacion,
Nivel3=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4) then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then
case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,
Nivel4=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then
case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,
Nivel5=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then
case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,
FechaHoy=@FechAct,
RealHoy=case po.poIdFecha when @FechAct then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case po.poIdFecha when @FechaAyer then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case po.poIdFecha when @FechaMesAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case po.poIdFecha when @FechaAnioAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHPasivoOperacion po
inner join #DWDCuentaContable cc on po.poIdCuentaContable=ccIdCuentaContable
inner join DWDCliente cl on po.poIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia
inner join DWDAsesorOperacion ao on cl.clIdAsesorPrincipal=ao.asIdAsesor
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 2
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where po.poIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)
and ca.caEstado=1
group by
ag.agOrdenRegionAsesor,
ao.asOrdenAsesor,
ca.caOrdenDescripcionCanal,
ca.caOrdenCanal,
cc.ccFamiliaProducto,
ca.caAgrupacion,
ca.caDescripcionAgrupacionCanal,
ag.agNombreRegion,
ao.asNombreAsesor,
ca.caDescripcionCanal,
ao.asAsesorPrincipal,
ca.caCodDescripcionAgrupacionCanal,
po.poIdFecha,
cl.clCodigoCliente

Union all

/* Presupuesto Operacion */

select
OrdenN1=@OrdenCaptacionCanal,
OrdenN2=ca.caOrdenCanal,
OrdenN3=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%REGION%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 1000 else ag.agOrdenRegionAsesor end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then
case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 1000 else asOrdenAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then caOrdenDescripcionCanal
else 1000
end,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Canal',
Nivel2=ca.caAgrupacion,
Nivel3=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then
case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,
Nivel4=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then
case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,
Nivel5=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then
case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,
FechaHoy=@FechAct,
RealHoy=0,
DenominadorHoy=0,
RealAyer=0,
DenominadorAyer=0,
RealMesAnt=0,
DenominadorMesAnt=0,
RealAnioAnt=0,
DenominadorAnioAnt=0,
ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,
DenominadorPresupuesto=0
from DWHPresupuestoNegocio pn
inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal
inner join DWDAgenciaOperacion ag on pn.pnIdAgencia=ag.agIdAgencia
inner join DWDAsesorOperacion ao on pn.pnIdAsesor=ao.asIdAsesor
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 2
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where pn.pnIdFecha in (@FechAct)
and ca.caEstado=1
and pn.pnIdIndicadorMedidaFinanciera=-10
group by cc.ccFamiliaProducto,
ca.caOrdenCanal,
agOrdenRegionAsesor,
caOrdenDescripcionCanal,
asOrdenAsesor,
ca.caDescripcionCanal,
ca.caCodDescripcionAgrupacionCanal,
ca.caAgrupacion,
ag.agNombreRegion,
ao.asAsesorPrincipal,
ca.caDescripcionAgrupacionCanal,
ao.asNombreAsesor,
ca.caDescripcionCanal

Union all

/* //////////////////////////////////////// */
/*     CAPTACIONES - SEGMENTACION           */
/* //////////////////////////////////////// */

-- NATURALES (4,5,6,7,8,9,10)
-- JURIDICOS (11,12,13,14,15,16,17,18,19)
-- SIN PERFIL (1,2,3)

select
OrdenN1=@OrdenCaptacionSegmentacion,
OrdenN2=sc.scSegmentacionOrdenN2,
OrdenN3=scSegmentacionOrdenN3,
Jerarquia=
case
when sc.scIdCodigo in (11,12,13,14,15,16,17,18,19) then 3
when sc.scIdCodigo in (4,5,6,7,8,9,10) then 5
else 2
end,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Segm',
Nivel2=sc.scSegmentacionTipo,
Nivel3=
case
when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo
else sc.scSegmentacion
end,
Nivel4=
case
when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo
else sc.scDetalleNombre
end,
Nivel5=
case
when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo
when sc.scIdCodigo in (11,12,13,14,15,16,17,18,19) then sc.scDetalleNombre
else v.vcVinculacionAgrupacion
end,
FechaHoy=@FechAct,
RealHoy=case po.poIdFecha when @FechAct then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case po.poIdFecha when @FechaAyer then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case po.poIdFecha when @FechaMesAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case po.poIdFecha when @FechaAnioAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHPasivoOperacion po
inner join #DWDCuentaContable cc on po.poIdCuentaContable=ccIdCuentaContable
inner join DWDCliente cl on po.poIdCliente=clIdCliente
inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente
inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 2
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where po.poIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)
and cl.clfechafin is null
and ca.caEstado=1
group by cc.ccFamiliaProducto,
sc.scSegmentacionOrdenN2,
sc.scSegmentacionOrdenN3,
sc.scIdCodigo,
ca.caDescripcionAgrupacionCanal,
cl.clIdSegmentacionCliente,
clCodigoCliente,
po.poIdFecha,
sc.scSegmentacionTipo,
sc.scSegmentacion,
sc.scDetalleNombre,
v.vcVinculacionAgrupacion

Union all

---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- Alta y Baja Vinculacion
-- para Natural y Juridico
---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
OrdenN1=@OrdenCaptacionSegmentacion,
OrdenN2=sc.scSegmentacionOrdenN2,
OrdenN3=v.vcOrdenVinculacion,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Segm',
Nivel2=sc.scSegmentacionTipo,
Nivel3=v.vcVinculacionAgrupacion,
Nivel4=v.vcVinculacionAgrupacion,
Nivel5=v.vcVinculacionAgrupacion,
FechaHoy=@FechAct,
RealHoy=case po.poIdFecha when @FechAct then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case po.poIdFecha when @FechaAyer then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case po.poIdFecha when @FechaMesAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case po.poIdFecha when @FechaAnioAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHPasivoOperacion po
inner join #DWDCuentaContable cc on po.poIdCuentaContable=ccIdCuentaContable
inner join DWDCliente cl on po.poIdCliente=clIdCliente
inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente
inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 2
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where po.poIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)
and cl.clFechaFin is null
and ca.caEstado=1
and sc.scIdCodigo not in (1,2,3)
group by cc.ccFamiliaProducto,
sc.scIdCodigo,
ca.caDescripcionAgrupacionCanal,
sc.scSegmentacionOrdenN2,
sc.scSegmentacionTipo,
v.vcOrdenVinculacion,
v.vcVinculacionAgrupacion,
po.poIdFecha

Union all

-- Valor Deduccion Alta y Baja Vinculacion para Natural y Juridico

select
OrdenN1=@OrdenCaptacionSegmentacion,
OrdenN2=sc.scSegmentacionOrdenN2,
OrdenN3=v.vcOrdenVinculacion,
Jerarquia=2,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Segm',
Nivel2=sc.scSegmentacionTipo,
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
FechaHoy=@FechAct,
RealHoy=case po.poIdFecha when @FechAct then (sum(isnull(po.poSaldoOperacionUSD,0))/1000)*-1 else 0 end,
DenominadorHoy=0,
RealAyer=case po.poIdFecha when @FechaAyer then (sum(isnull(po.poSaldoOperacionUSD,0))/1000)*-1 else 0 end,
DenominadorAyer=0,
RealMesAnt=case po.poIdFecha when @FechaMesAnt then (sum(isnull(po.poSaldoOperacionUSD,0))/1000)*-1 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case po.poIdFecha when @FechaAnioAnt then (sum(isnull(po.poSaldoOperacionUSD,0))/1000)*-1 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHPasivoOperacion po
inner join #DWDCuentaContable cc on po.poIdCuentaContable=ccIdCuentaContable
inner join DWDCliente cl on po.poIdCliente=clIdCliente
inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente
inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 2
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where po.poIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)
and cl.clFechaFin is null
and ca.caEstado=1
and sc.scIdCodigo not in (1,2,3)
group by cc.ccFamiliaProducto,
ca.caDescripcionAgrupacionCanal,
sc.scSegmentacionOrdenN2,
sc.scSegmentacionTipo,
v.vcOrdenVinculacion,
po.poIdFecha

Union all

/* Presupuesto Negocio*/

select
OrdenN1=@OrdenCaptacionSegmentacion,
OrdenN2=1,
OrdenN3=1,
Jerarquia=1,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Segm',
Nivel2=cc.ccFamiliaProducto+'-Segm',
Nivel3=cc.ccFamiliaProducto+'-Segm',
Nivel4=cc.ccFamiliaProducto+'-Segm',
Nivel5=cc.ccFamiliaProducto+'-Segm',
FechaHoy=@FechAct,
RealHoy=0,
DenominadorHoy=0,
RealAyer=0,
DenominadorAyer=0,
RealMesAnt=0,
DenominadorMesAnt=0,
RealAnioAnt=0,
DenominadorAnioAnt=0,
ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,
DenominadorPresupuesto=0
from DWHPresupuestoNegocio pn
inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal
inner join DWDAgenciaOperacion ag on pn.pnIdAgencia=ag.agIdAgencia
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 2
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where pn.pnIdFecha in (@FechAct)
and ca.caEstado=1
and pn.pnIdIndicadorMedidaFinanciera=-10
group by cc.ccFamiliaProducto,
ca.caDescripcionAgrupacionCanal

Union all

/* //////////////////////////////////////// */
/*           OTROS DEPOSITOS               */
/*           OBLIGACIONES FINANCIERAS       */
/* //////////////////////////////////////// */

select
OrdenN1=ccOrdenAgrupacion,
OrdenN2=ccOrdenAgrupacionN2,
OrdenN3=ccOrdenAgrupacionN2,
Jerarquia=1,
Canal='Otr.Dep y Obl.Fin',
Division='NO',
Consolidado='NO',
Nivel1=ccFamiliaProducto,
Nivel2=ccFamiliaProducto,
Nivel3=ccFamiliaProducto,
Nivel4=ccFamiliaProducto,
Nivel5=ccFamiliaProducto,
FechaHoy=@FechAct,
RealHoy=case bs.bsIdFecha when @FechAct then sum(bs.bsSaldoDolarizado)/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case bs.bsIdFecha when @FechaAyer then sum(bs.bsSaldoDolarizado)/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case bs.bsIdFecha when @FechaMesAnt then sum(bs.bsSaldoDolarizado)/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case bs.bsIdFecha when @FechaAnioAnt then sum(bs.bsSaldoDolarizado)/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,-- el presupuesto va a ser igual a hoy
DenominadorPresupuesto=0
from DWHBalanceSaldo bs
inner join #DWDCuentaContable cc on bs.bsIdCuentaContable=cc.ccIdCuentaContable
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 2
and p1.CpCodigoIndicador in (143,144)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where bs.bsIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
group by bs.bsIdFecha,
ccOrdenAgrupacion,
ccOrdenAgrupacionN2,
ccFamiliaProducto

Union all

/*Prespuesto Negocio*/

select
OrdenN1=ccOrdenAgrupacion,
OrdenN2=ccOrdenAgrupacionN2,
OrdenN3=ccOrdenAgrupacionN2,
Jerarquia=1,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccFamiliaProducto,
Nivel3=cc.ccFamiliaProducto,
Nivel4=cc.ccFamiliaProducto,
Nivel5=cc.ccFamiliaProducto,
FechaHoy=@FechAct,
RealHoy=0,
DenominadorHoy=0,
RealAyer=0,
DenominadorAyer=0,
RealMesAnt=0,
DenominadorMesAnt=0,
RealAnioAnt=0,
DenominadorAnioAnt=0,
ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,
DenominadorPresupuesto=0
from DWHPresupuestoNegocio pn
inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 2
and p1.CpCodigoIndicador in (143,144)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where pn.pnIdFecha in (@FechAct)
and cc.ccCodigoMoneda='USD'
and pn.pnIdIndicadorMedidaFinanciera=-10
group by cc.ccFamiliaProducto,
ccOrdenAgrupacion,
ccOrdenAgrupacionN2,
ca.caDescripcionAgrupacionCanal,
cccodigonivel6 --2746514

Union  all

/* ----------------------------------------------------------------------------------------------- */
/*                                      CARTERA                                                    */
/* ----------------------------------------------------------------------------------------------- */

select
OrdenN1,
OrdenN2,
OrdenN3,
Jerarquia,
Canal,
Division,
Consolidado=case when Nivel2 like '%C.%Titularizada%' then 'NO' else 'SI' end,
Nivel1,
Nivel2=
case
when Nivel2 like '%C.%Titularizada%' then Nivel2
else left(Nivel2+space(70),70)+'X'+right('0'+cast(isnull(OrdenN1,'') as varchar(10)),2)+right('0'+ cast(isnull(OrdenN2,'') as varchar(10)),2)+'X'
end,
Nivel3,
Nivel4,
Nivel5,
FechaHoy=@FechAct,
RealHoy=sum(RealHoy),
DenominadorHoy=sum(DenominadorHoy),
RealAyer=sum(RealAyer),
DenominadorAyer=sum(DenominadorAyer),
RealMesAnt=sum(RealMesAnt),
DenominadorMesAnt=sum(DenominadorMesAnt),
RealAnioAnt=sum(RealAnioAnt),
DenominadorAnioAnt=sum(DenominadorAnioAnt),
ValorPresupuesto=sum(ValorPresupuesto),
DenominadorPresupuesto=sum(DenominadorPresupuesto)
from #Cartera
group by OrdenN1,
OrdenN2,
OrdenN3,
Estado,
Jerarquia,
Canal,
Division,
Nivel1,
Nivel2,
Nivel3,
Nivel4,
Nivel5

Union All


---&gt;&gt;&gt;&gt;&gt;&gt;&gt;     CARTERA X VENCER
---&gt;&gt;&gt;&gt;&gt;&gt;&gt;     CARTERA EN DIFICULTADES
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
OrdenN1,
OrdenN2=
case when Estado='Vig' then 10
else 30 end,
OrdenN3,
Jerarquia, --Jerarquia=4 comente EA
Canal,
Division='NO',
Consolidado='SI',
Nivel1,
Nivel2=
case when Estado='Vig' then 'Cartera x Vencer'
else
left('Cartera en Dificultades'+space(70),70)+'X'+right('0'+cast(isnull(OrdenN1,'') as varchar(10)),2)+'13X'
end,
Nivel3,
Nivel4,
Nivel5,
FechaHoy=@FechAct,
RealHoy=sum(RealHoy),
DenominadorHoy=sum(DenominadorHoy),
RealAyer=sum(RealAyer),
DenominadorAyer=sum(DenominadorAyer),
RealMesAnt=sum(RealMesAnt),
DenominadorMesAnt=sum(DenominadorMesAnt),
RealAnioAnt=sum(RealAnioAnt),
DenominadorAnioAnt=sum(DenominadorAnioAnt),
ValorPresupuesto=sum(ValorPresupuesto),
DenominadorPresupuesto=sum(DenominadorPresupuesto)
from #Cartera
where Estado in ('Vig','Dif')
and Nivel3 like '%Canal%'
group by OrdenN1,
OrdenN3,
Estado,
Jerarquia,
Canal,
Nivel1,
Nivel3,
Nivel4,
Nivel5

----&gt;&gt; Valor Deduccion

Union all

select
OrdenN1,
OrdenN2=9,
OrdenN3,
Jerarquia=1,
Canal,
Division='NO',
Consolidado='NO',
Nivel1,
Nivel2='Deducción',
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
FechaHoy=@FechAct,
RealHoy=sum(RealHoy)*-1,
DenominadorHoy=sum(DenominadorHoy)*-1,
RealAyer=sum(RealAyer)*-1,
DenominadorAyer=sum(DenominadorAyer)*-1,
RealMesAnt=sum(RealMesAnt)*-1,
DenominadorMesAnt=sum(DenominadorMesAnt)*-1,
RealAnioAnt=sum(RealAnioAnt)*-1,
DenominadorAnioAnt=sum(DenominadorAnioAnt)*-1,
ValorPresupuesto=sum(ValorPresupuesto)*-1,
DenominadorPresupuesto=sum(DenominadorPresupuesto)*-1
from #Cartera
where Estado in ('Vig','Dif')
and Nivel3 like '%Canal%'
group by OrdenN1,
OrdenN3,
Estado,
Nivel1,
Canal

Union all


---&gt;&gt;&gt;&gt;&gt;&gt;      VIGENTE
--&gt;&gt;&gt;&gt;&gt;&gt;      DIFICULTADES
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

-- Los Valores de deduccion por producto se encuentran en el query que obtiene la tabla #Cartera

select
OrdenN1,
OrdenN2=
case when Estado='Vig' then OrdenN2+20
else  OrdenN2+40 end,
OrdenN3,
Jerarquia,
Canal,
Division,
Consolidado=case when (Nivel2 like '%C%Titularizada%')  then  'NO' else 'SI' end,---when (Nivel2 like '%T.%Credito%') or
Nivel1,
Nivel2=
case
when Estado='Vig' then  left((Estado+'. '+Nivel2+SPACE(70)),70)+'X'+right('0'+cast(OrdenN1 as varchar(10)),2)+right('0'+ cast(OrdenN2+20 as varchar(10)),2)+'X'
else left((Estado+'. '+Nivel2+SPACE(70)),70)+'X'+right('0'+cast(OrdenN1 as varchar(10)),2)+right('0'+ cast(OrdenN2+40 as varchar(10)),2)+'X'
end,
Nivel3,
Nivel4,
Nivel5,
FechaHoy=@FechAct,
RealHoy=sum(RealHoy),
DenominadorHoy=sum(DenominadorHoy),
RealAyer=sum(RealAyer),
DenominadorAyer=sum(DenominadorAyer),
RealMesAnt=sum(RealMesAnt),
DenominadorMesAnt=sum(DenominadorMesAnt),
RealAnioAnt=sum(RealAnioAnt),
DenominadorAnioAnt=sum(DenominadorAnioAnt),
ValorPresupuesto=sum(ValorPresupuesto),
DenominadorPresupuesto=sum(DenominadorPresupuesto)
from #Cartera
where Estado in ('Vig','Dif')
group by OrdenN1,
OrdenN2,
OrdenN3,
Estado,
Jerarquia,
Canal,
Division,
Nivel1,
Nivel2,
Nivel3,
Nivel4,
Nivel5

Union all

----&gt;&gt; Valor Deduccion

select
OrdenN1,
OrdenN2=
case when Estado='Vig' then OrdenN2+20
else  OrdenN2+40 end,
OrdenN3,
Jerarquia=1,
Canal,
Division,
Consolidado='NO',
Nivel1,
Nivel2='Deducción',
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
FechaHoy=@FechAct,
RealHoy=sum(RealHoy)*-1,
DenominadorHoy=sum(DenominadorHoy)*-1,
RealAyer=sum(RealAyer)*-1,
DenominadorAyer=sum(DenominadorAyer)*-1,
RealMesAnt=sum(RealMesAnt)*-1,
DenominadorMesAnt=sum(DenominadorMesAnt)*-1,
RealAnioAnt=sum(RealAnioAnt)*-1,
DenominadorAnioAnt=sum(DenominadorAnioAnt)*-1,
ValorPresupuesto=sum(ValorPresupuesto)*-1,
DenominadorPresupuesto=sum(DenominadorPresupuesto)*-1
from #Cartera
where Estado in ('Vig','Dif')
group by OrdenN1,
OrdenN2,
OrdenN3,
Estado,
Canal,
Division,
Nivel1

Union all

/* ///////////////////////////////////////////////////// */
/*                                                       */
/*      Morosidad Ampliada Titularizada                  */
/*                                                       */
/* ///////////////////////////////////////////////////// */

-----------------
-- Numerador Dif
-----------------

select
OrdenN1,
OrdenN2=70,
OrdenN3,
Jerarquia=4,
Canal,
Division='SI',
Consolidado='NO',
Nivel1,
Nivel2='Morosidad Ampl. (-Tit.)',
Nivel3,
Nivel4,
Nivel5,
FechaHoy=@FechAct,
RealHoy=sum(RealHoy),
DenominadorHoy=0,
RealAyer=sum(RealAyer),
DenominadorAyer=0,
RealMesAnt=sum(RealMesAnt),
DenominadorMesAnt=0,
RealAnioAnt=sum(RealAnioAnt),
DenominadorAnioAnt=0,
ValorPresupuesto=sum(ValorPresupuesto),
DenominadorPresupuesto=0
from #Cartera
where Estado in ('Dif')
and Nivel3 like '%Canal%'
group by OrdenN1,
OrdenN3,
Canal,
Division,
Nivel1,
--Nivel2,
Nivel3,
Nivel4,
Nivel5

union all

--Valor Deduccion

select
OrdenN1,
OrdenN2=70,
OrdenN3,
Jerarquia=1,
Canal,
Division='SI',
Consolidado='NO',
Nivel1,
Nivel2='Deducción',
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
FechaHoy=@FechAct,
RealHoy=sum(RealHoy)*-1,
DenominadorHoy=0,
RealAyer=sum(RealAyer)*-1,
DenominadorAyer=0,
RealMesAnt=sum(RealMesAnt)*-1,
DenominadorMesAnt=0,
RealAnioAnt=sum(RealAnioAnt)*-1,
DenominadorAnioAnt=0,
ValorPresupuesto=sum(ValorPresupuesto)*-1,
DenominadorPresupuesto=0
from #Cartera
where Estado in ('Dif')
and Nivel3 like '%Canal%'
group by OrdenN1,
OrdenN3,
Canal,
Division,
Nivel1,
Nivel2,
Nivel3,
Nivel4,
Nivel5

union all

--------------------
-- Denominador Total
--------------------

select
OrdenN1,
OrdenN2=70,
OrdenN3,
Jerarquia=4,
Canal,
Division='SI',
Consolidado='NO',
Nivel1,
Nivel2='Morosidad Ampl. (-Tit.)',
Nivel3,
Nivel4,
Nivel5,
FechaHoy=@FechAct,
RealHoy=0,
DenominadorHoy=sum(RealHoy),
RealAyer=0,
DenominadorAyer=sum(RealAyer),
RealMesAnt=0,
DenominadorMesAnt=sum(RealMesAnt),
RealAnioAnt=0,
DenominadorAnioAnt=sum(RealAnioAnt),
ValorPresupuesto=0,
DenominadorPresupuesto=sum(ValorPresupuesto)
from #Cartera
where Nivel3 like '%Canal%'
group by OrdenN1,
OrdenN3,
Canal,
Division,
Nivel1,
--Nivel2,
Nivel3,
Nivel4,
Nivel5

Union all

-- Valor deduccion (NO se le multiplica por -1 por la division)

select
OrdenN1,
OrdenN2=70,
OrdenN3,
Jerarquia=1,
Canal,
Division='SI',
Consolidado='NO',
Nivel1,
Nivel2='Deducción',
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
FechaHoy=@FechAct,
RealHoy=0,
DenominadorHoy=sum(RealHoy),
RealAyer=0,
DenominadorAyer=sum(RealAyer),
RealMesAnt=0,
DenominadorMesAnt=sum(RealMesAnt),
RealAnioAnt=0,
DenominadorAnioAnt=sum(RealAnioAnt),
ValorPresupuesto=0,
DenominadorPresupuesto=sum(ValorPresupuesto)
from #Cartera
where Nivel3 like '%Canal%'
group by OrdenN1,
OrdenN3,
Canal,
Division,
Nivel1,
Nivel3,
Nivel4,
Nivel5

Union all

/* /////////////////////////////////////////////// */
/*                                                 */
/*  MOROSIDAD AMPLIADA - AGRUPACION POR CANALES    */
/*                                                 */
/* /////////////////////////////////////////////// */

-----------------
-- Numerador Dif
-----------------
select
OrdenN1,
OrdenN2=
case when nivel2 like '%Comer%Micro%' then 80
when nivel2 like '%Consumo%' then 81
when nivel2 like '%Vivienda%' then 82
when nivel2 like '%Credito%' then 83
when nivel2 like '%Vehiculos%' then 84
when nivel2 like '%Titularizada%' then 85 end,
OrdenN3,
Jerarquia,
Canal,
Division='SI',
Consolidado='NO',
Nivel1,
Nivel2='.'+Nivel2,
Nivel3,
Nivel4,
Nivel5,
FechaHoy=@FechAct,
RealHoy=sum(RealHoy),
DenominadorHoy=0,
RealAyer=sum(RealAyer),
DenominadorAyer=0,
RealMesAnt=sum(RealMesAnt),
DenominadorMesAnt=0,
RealAnioAnt=sum(RealAnioAnt),
DenominadorAnioAnt=0,
ValorPresupuesto=sum(ValorPresupuesto),
DenominadorPresupuesto=0
from #Cartera
where Estado in ('Dif')
group by OrdenN1,
OrdenN3,
Canal,
Jerarquia,
Nivel1,
Nivel2,
Nivel3,
Nivel4,
Nivel5

Union all

-- Valor Deduccion

select
OrdenN1,
OrdenN2=
case when nivel2 like '%Comer%Micro%' then 80
when nivel2 like '%Consumo%' then 81
when nivel2 like '%Vivienda%' then 82
when nivel2 like '%Credito%' then 83
when nivel2 like '%Vehiculos' then 84
when nivel2 like '%Titularizada%' then 85 end,
OrdenN3,
Jerarquia=1,
Canal,
Division='SI',
Consolidado='NO',
Nivel1,
Nivel2='Deducción',
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
FechaHoy=@FechAct,
RealHoy=sum(RealHoy)*-1,
DenominadorHoy=0,
RealAyer=sum(RealAyer)*-1,
DenominadorAyer=0,
RealMesAnt=sum(RealMesAnt)*-1,
DenominadorMesAnt=0,
RealAnioAnt=sum(RealAnioAnt)*-1,
DenominadorAnioAnt=0,
ValorPresupuesto=sum(ValorPresupuesto)*-1,
DenominadorPresupuesto=0
from #Cartera
where Estado in ('Dif')
group by OrdenN1,
OrdenN3,
Canal,
Jerarquia,
Nivel1,
Nivel2,
Nivel3,
Nivel4,
Nivel5

Union all

--------------------
-- Denominador Total
--------------------

select
OrdenN1,
OrdenN2=
case when nivel2 like '%Comer%Micro%' then 80
when nivel2 like '%Consumo%' then 81
when nivel2 like '%Vivienda%' then 82
when nivel2 like '%Credito%' then 83
when nivel2 like '%Vehiculos%' then 84
when nivel2 like '%Titularizada%' then 85 end,
OrdenN3,
Jerarquia,
Canal,
Division='SI',
Consolidado='NO',
Nivel1,
Nivel2='.'+Nivel2,
Nivel3,
Nivel4,
Nivel5,
FechaHoy=@FechAct,
RealHoy=0,
DenominadorHoy=sum(RealHoy),
RealAyer=0,
DenominadorAyer=sum(RealAyer),
RealMesAnt=0,
DenominadorMesAnt=sum(RealMesAnt),
RealAnioAnt=0,
DenominadorAnioAnt=sum(RealAnioAnt),
ValorPresupuesto=0,
DenominadorPresupuesto=sum(ValorPresupuesto)
from #Cartera
group by OrdenN1,
OrdenN3,
Canal,
Jerarquia,
Nivel1,
Nivel2,
Nivel3,
Nivel4,
Nivel5

Union all

-- Valor deduccion (NO se le multiplica para cero por la division)

select
OrdenN1,
OrdenN2=
case when nivel2 like '%Comer%Micro%' then 80
when nivel2 like '%Consumo%' then 81
when nivel2 like '%Vivienda%' then 82
when nivel2 like '%Credito%' then 83
when nivel2 like '%Vehiculos%' then 84
when nivel2 like '%Titularizada%' then 85 end,
OrdenN3,
Jerarquia=1,
Canal,
Division='SI',
Consolidado='NO',
Nivel1,
Nivel2='Deducción',
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
FechaHoy=@FechAct,
RealHoy=0,
DenominadorHoy=sum(RealHoy),
RealAyer=0,
DenominadorAyer=sum(RealAyer),
RealMesAnt=0,
DenominadorMesAnt=sum(RealMesAnt),
RealAnioAnt=0,
DenominadorAnioAnt=sum(RealAnioAnt),
ValorPresupuesto=0,
DenominadorPresupuesto=sum(ValorPresupuesto)
from #Cartera
group by OrdenN1,
OrdenN3,
Canal,
Jerarquia,
Nivel1,
Nivel2,
Nivel3,
Nivel4,
Nivel5

Union all

/* ///////////////////////////////////////////// */
/*       CONCENTRACION  100; 50; 25              */
/* ///////////////////////////////////////////// */


select
OrdenN1=@OrdenCarteraNivel1,
OrdenN2=90+Orden,
OrdenN3=90+Orden,
Jerarquia=2,
Canal='Otr.Dep y Obl.Fin',
Division='NO',
Consolidado='NO',
Nivel1=@DescripcionCartera,
Nivel2=Nivel,
Nivel3=Nivel,
Nivel4=Nivel,
Nivel5=Nivel,
FechaHoy=@FechAct,
RealHoy=sum(RealHoy),
DenominadorHoy=0,
RealAyer=sum(RealAyer),
DenominadorAyer=0,
RealMesAnt=sum(RealMesAnt),
DenominadorMesAnt=0,
RealAnioAnt=sum(RealAnioAnt),
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from
(
select
Orden=
case ppCodigoProducto
when 36 then @OrdenCarteraNivel2+24
when 37 then @OrdenCarteraNivel2+25
when 38 then @OrdenCarteraNivel2+26 end,
Nivel=
case ppCodigoProducto
when 36 then 'Concentración 100'
when 37 then 'Concentración 50'
when 38 then 'Concentración 25' end,
RealHoy=case ppFecha when @FechAct then sum(isnull(ppPronostico,0)) else 0 end,
RealAyer=case ppFecha when @FechaAyer then sum(isnull(ppPronostico,0)) else 0 end,
RealMesAnt=case ppFecha when @FechaMesAnt then sum(isnull(ppPronostico,0)) else 0 end,
RealAnioAnt=case ppFecha when @FechaAnioAnt then sum(isnull(ppPronostico,0)) else 0 end
from  DWDPronosticoProducto
where ppCodigoProducto in (36,37,38)
group by ppFecha,
ppCodigoProducto
) Concentracion
group by Orden,
Nivel

Union all

-- Valor Deduccion

select
OrdenN1=@OrdenCarteraNivel1,
OrdenN2=90+Orden,
OrdenN3=90+Orden,
Jerarquia=1,
Canal='Otr.Dep y Obl.Fin',
Division='NO',
Consolidado='NO',
Nivel1=@DescripcionCartera,
Nivel2=Nivel,
Nivel3=Nivel,
Nivel4=Nivel,
Nivel5=Nivel,
FechaHoy=@FechAct,
RealHoy=sum(RealHoy)*-1,
DenominadorHoy=0,
RealAyer=sum(RealAyer)*-1,
DenominadorAyer=0,
RealMesAnt=sum(RealMesAnt)*-1,
DenominadorMesAnt=0,
RealAnioAnt=sum(RealAnioAnt)*-1,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from
(
select
Orden=
case ppCodigoProducto
when 36 then @OrdenCarteraNivel2+24
when 37 then @OrdenCarteraNivel2+25
when 38 then @OrdenCarteraNivel2+26 end,
Nivel=
case ppCodigoProducto
when 36 then 'Deducción'
when 37 then 'Deducción'
when 38 then 'Deducción' end,
RealHoy=case ppFecha when @FechAct then sum(isnull(ppPronostico,0)) else 0 end,
RealAyer=case ppFecha when @FechaAyer then sum(isnull(ppPronostico,0)) else 0 end,
RealMesAnt=case ppFecha when @FechaMesAnt then sum(isnull(ppPronostico,0)) else 0 end,
RealAnioAnt=case ppFecha when @FechaAnioAnt then sum(isnull(ppPronostico,0)) else 0 end
from  DWDPronosticoProducto
where ppCodigoProducto in (36,37,38)
group by ppFecha,
ppCodigoProducto
) Concentracion
group by Orden,
Nivel --550

Union all


/* ///////////////////////////////////////////// */
/*                CARTERA CANAL                  */
/* ///////////////////////////////////////////// */

-- Canal Comercial por Region Agencia (1,8,5,9,12,13)
-- Canal Corporativo por Asesor (10)
-- Canal Especializada por Subcanal (7,15,17,11)
-- Canal Tesoreria por Region Agencia (14)

select
OrdenN1=@OrdenCarteraCanal,
OrdenN2=ca.caOrdenCanal,
OrdenN3=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%REGION%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 1000 else ag.agOrdenRegionAsesor end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ase.asAsesorPrincipal=1))  then
case when ase.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 1000 else asOrdenAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then caOrdenDescripcionCanal
else 1000
end,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Canal',
Nivel2=ca.caAgrupacion,
Nivel3=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ase.asAsesorPrincipal=1))  then
case when ase.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ase.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,
Nivel4=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ase.asAsesorPrincipal=1))  then
case when ase.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ase.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,
Nivel5=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ase.asAsesorPrincipal=1))  then
case when ase.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ase.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,
FechaHoy=@FechAct,
RealHoy=case ao.aoIdFecha  when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case ao.aoIdFecha  when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case ao.aoIdFecha  when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case ao.aoIdFecha  when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHActivoOperacion ao
inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on ao.aoIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDProducto pr on pr.prIdProducto=ao.aoIdProducto
inner join DWDAsesorOperacion ase on cl.clIdAsesorPrincipal=ase.asIdAsesor
inner join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia
inner join DWDMoneda mo on mo.moIdMoneda=ao.aoIdMoneda
left outer join #DWDTitularizadaOperacion ti on isnull(ao.aoNumeroOperacion,'')=ti.toOperacion
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where ao.aoIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)
and cc.ccCodigoMoneda=mo.moCodigoMoneda
and cl.clFechaFin is null
and ca.caEstado=1
and ti.toOperacion is null -- Filtro Titularizada
group by cc.ccFamiliaProducto,
clCodigoCliente,
ccCodigoNivel6,
asCodigoAsesor,
ca.caCodDescripcionAgrupacionCanal,
ase.asAsesorPrincipal,
asOrdenAsesor,
asNombreAsesor,
ao.aoIdFecha,
ca.caEstado,
ca.caOrdenCanal,
agOrdenRegionAsesor,
caOrdenDescripcionCanal,
ca.caDescripcionAgrupacionCanal,
ca.caAgrupacion,
ag.agNombreRegion,
asNombreAsesor,
ca.caDescripcionCanal

Union all

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- T. Credito
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
OrdenN1=@OrdenCarteraCanal,
OrdenN2=ca.caOrdenCanal,
OrdenN3=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%REGION%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 1000 else ag.agOrdenRegionAsesor end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (aso.asAsesorPrincipal=1))  then
case when aso.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 1000 else asOrdenAsesor  end
when ca.caCodDescripcionAgrupacionCanal = 3 then caOrdenDescripcionCanal
else 1000
end,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Canal',
Nivel2=ca.caAgrupacion,
Nivel3=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (aso.asAsesorPrincipal=1))  then
case when aso.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else aso.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,
Nivel4=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (aso.asAsesorPrincipal=1))  then
case when aso.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else aso.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,
Nivel5=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (aso.asAsesorPrincipal=1))  then
case when aso.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else aso.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,
FechaHoy=@FechAct,
RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end  ,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHTarjetaCreditoOperacion tco
inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
inner join DWDMoneda mo on mo.moIdMoneda=tco.tcoIdMoneda
inner join DWDProducto pr on tco.tcoIdProducto=pr.prIdProducto
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDAsesorOperacion aso on cl.clIdAsesorPrincipal=aso.asIdAsesor
inner join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador = 124
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and prVehiculo is null
and ccCodigoMoneda=moCodigoMoneda
and clFechaFin is null
and ca.caEstado=1
--and cc.ccCodigoMoneda='USD'
group by
cc.ccOrdenAgrupacion,
ag.agOrdenRegionAsesor,
aso.asOrdenAsesor,
ca.caOrdenDescripcionCanal,
clCodigoCliente,
ca.caOrdenCanal,
aso.asAsesorPrincipal,
ca.caDescripcionAgrupacionCanal,
aso.asNombreAsesor,
cc.ccFamiliaProducto,
ca.caDescripcionCanal,
ag.agNombreRegion,
ca.caCodDescripcionAgrupacionCanal,
cc.ccGrupo,
ca.caAgrupacion,
tco.tcoIdFecha

Union all

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- Titularizada
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

--&gt; Cambio de titularizada a Cartera Titularizada

select
OrdenN1=@OrdenCarteraCanal,
OrdenN2=@OrdenCanalTit,
OrdenN3=@OrdenCanalTit,
Jerarquia=2,
Canal=@CanalTit,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Canal',
Nivel2=@CanalAgrTit,
Nivel3=@CanalAgrTit,
Nivel4=@CanalAgrTit,
Nivel5=@CanalAgrTit,
FechaHoy=@FechAct,
RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHCuotaOperacion co
inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
inner join #DWDTitularizadaOperacion ti on isnull(co.coNumeroOperacion,'')=ti.toOperacion -- Titularizada
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and ccCodigoMoneda=moCodigoMoneda
and clFechaFin is null
and ca.caEstado=1
--and cc.ccCodigoMoneda='USD'
group by
ca.caOrdenCanal,
pr.prGrupo,
mo.moCodigoMoneda,
cc.ccFamiliaProducto,
co.coIdFecha
/*
Union all

-- Cambio de asignación de Titularizada a Cartera Titularizada

select
OrdenN1=@OrdenCarteraCanal,
OrdenN2=@OrdenCanalTit,
OrdenN3=@OrdenCanalTit,
Jerarquia=2,
Canal=@CanalTit,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Canal',
Nivel2=@CanalAgrTit,
Nivel3=@CanalAgrTit,
Nivel4=@CanalAgrTit,
Nivel5=@CanalAgrTit,
FechaHoy=@FechAct,
RealHoy=case ao.aoIdFecha when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case ao.aoIdFecha when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case ao.aoIdFecha when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case ao.aoIdFecha when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHActivoOperacion ao
inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on ao.aoIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador = 125
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where ao.aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and cl.clfechafin is null
and ca.caEstado=1
group by
ca.caOrdenCanal,
ao.aoIdFecha,
ccFamiliaProducto,
ccGrupo,
cc.ccClasificacionEstado
*/
union all

/* Presupuesto Operacion */

select
OrdenN1=@OrdenCarteraCanal,
OrdenN2=case when cc.ccFamiliaProducto like '%Titularizada%' then @OrdenCanalTit else ca.caOrdenCanal end,
OrdenN3=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%REGION%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 1000 else ag.agOrdenRegionAsesor end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then
case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 1000 else asOrdenAsesor  end
when ca.caCodDescripcionAgrupacionCanal = 3 then caOrdenDescripcionCanal
else 1000
end,

Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Canal',
Nivel2=ca.caAgrupacion,
Nivel3=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then
case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,

Nivel4=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then
case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,
Nivel5=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then
case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,
FechaHoy=@FechAct,
RealHoy=0,
DenominadorHoy=0,
RealAyer=0,
DenominadorAyer=0,
RealMesAnt=0,
DenominadorMesAnt=0,
RealAnioAnt=0,
DenominadorAnioAnt=0,
ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,
DenominadorPresupuesto=0
from DWHPresupuestoNegocio pn
inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal
inner join DWDAgenciaOperacion ag on pn.pnIdAgencia=ag.agIdAgencia
inner join DWDAsesorOperacion ao on pn.pnIdAsesor=ao.asIdAsesor
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where pn.pnIdFecha in (@FechAct)
and ca.caEstado=1
and pn.pnIdIndicadorMedidaFinanciera=-10
group by cc.ccFamiliaProducto,
ca.caOrdenCanal,
agOrdenRegionAsesor,
caOrdenDescripcionCanal,
asOrdenAsesor,
ca.caDescripcionCanal,
ca.caCodDescripcionAgrupacionCanal,
ca.caAgrupacion,
ag.agNombreRegion,
ao.asAsesorPrincipal,
ca.caDescripcionAgrupacionCanal,
ao.asNombreAsesor,
ca.caDescripcionCanal

Union all

/* //////////////////////////////////////// */
/*         CARTERA - SEGMENTACION           */
/* //////////////////////////////////////// */

-- NATURALES (4,5,6,7,8,9,10)
-- JURIDICOS (11,12,13,14,15,16,17,18,19)
-- SIN PERFIL (1,2,3)

select
OrdenN1=@OrdenCarteraSegmentacion,
OrdenN2=sc.scSegmentacionOrdenN2,
OrdenN3=sc.scSegmentacionOrdenN3,
Jerarquia=
case
when sc.scIdCodigo in (11,12,13,14,15,16,17,18,19) then 3
when sc.scIdCodigo in (4,5,6,7,8,9,10) then 5
else 2
end,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Segm',
Nivel2=sc.scSegmentacionTipo,
Nivel3=
case
when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo
else sc.scSegmentacion
end,
Nivel4=
case
when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo
else sc.scDetalleNombre
end,
Nivel5=
case
when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo
when sc.scIdCodigo in (11,12,13,14,15,16,17,18,19) then sc.scDetalleNombre
else v.vcVinculacionAgrupacion
end,
FechaHoy=@FechAct,
RealHoy=case ao.aoIdFecha when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case ao.aoIdFecha  when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case ao.aoIdFecha  when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case ao.aoIdFecha  when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHActivoOperacion ao
inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=ccIdCuentaContable
inner join DWDCliente cl on ao.aoIdCliente=clIdCliente
inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente -- revisar los left outer
inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where ao.aoIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)
and cl.clfechafin is null
and ca.caEstado=1
group by
sc.scSegmentacionOrdenN2,
sc.scSegmentacionOrdenN3,
cc.ccFamiliaProducto,
ca.caDescripcionAgrupacionCanal,
cl.clIdSegmentacionCliente,
ao.aoIdFecha,
sc.scSegmentacionTipo,
sc.scIdCodigo,
sc.scSegmentacion,
sc.scDetalleNombre,
v.vcVinculacionAgrupacion

Union all

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- T. Credito
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
OrdenN1=@OrdenCarteraSegmentacion,
OrdenN2=scSegmentacionOrdenN2,
OrdenN3=scSegmentacionOrdenN3,
Jerarquia=
case
when sc.scIdCodigo in (11,12,13,14,15,16,17,18,19) then 3
when sc.scIdCodigo in (4,5,6,7,8,9,10) then 5
else 2
end,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Segm',
Nivel2=sc.scSegmentacionTipo,
Nivel3=
case
when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo
else sc.scSegmentacion
end,
Nivel4=
case
when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo
else sc.scDetalleNombre
end,
Nivel5=
case
when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo
when sc.scIdCodigo in (11,12,13,14,15,16,17,18,19) then sc.scDetalleNombre
else v.vcVinculacionAgrupacion
end,
FechaHoy=@FechAct,
RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHTarjetaCreditoOperacion tco
inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente
inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador = 124
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and cl.clFechaFin is null
and ca.caEstado=1
group by cc.ccFamiliaProducto,
cl.clIdSegmentacionCliente,
ca.caDescripcionAgrupacionCanal,
sc.scSegmentacionTipo,
sc.scSegmentacion,
sc.scDetalleNombre,
sc.scIdCodigo,
v.vcVinculacionAgrupacion,
sc.scSegmentacionOrden,
tco.tcoIdFecha,
cc.ccOrdenAgrupacion,
sc.scSegmentacionOrdenN2,
sc.scSegmentacionOrdenN3

Union all

---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- Alta y Baja Vinculacion
-- para Natural y Juridico
---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
OrdenN1=@OrdenCarteraSegmentacion,
OrdenN2=sc.scSegmentacionOrdenN2,
OrdenN3=v.vcOrdenVinculacion,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Segm',
Nivel2=sc.scSegmentacionTipo,
Nivel3=v.vcVinculacionAgrupacion,
Nivel4=v.vcVinculacionAgrupacion,
Nivel5=v.vcVinculacionAgrupacion,
FechaHoy=@FechAct,
RealHoy=case ao.aoIdFecha when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case ao.aoIdFecha when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case ao.aoIdFecha when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case ao.aoIdFecha when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHActivoOperacion ao
inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=ccIdCuentaContable
inner join DWDCliente cl on ao.aoIdCliente=clIdCliente
inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente
inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,124,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where ao.aoIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)
and sc.scIdCodigo not in (1,2,3)
and cl.clFechaFin is null
group by cc.ccFamiliaProducto,
ca.caDescripcionAgrupacionCanal,
sc.scSegmentacionOrdenN2,
sc.scSegmentacionOrdenN3,
sc.scSegmentacionTipo,
v.vcOrdenVinculacion,
v.vcVinculacionAgrupacion,
ao.aoIdFecha

Union all

--&gt;&gt; Tarjeta Credito

select
OrdenN1=@OrdenCarteraSegmentacion,
OrdenN2=scSegmentacionOrdenN2,
OrdenN3=v.vcOrdenVinculacion,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Segm',
Nivel2=sc.scSegmentacionTipo,
Nivel3=v.vcVinculacionAgrupacion,
Nivel4=v.vcVinculacionAgrupacion,
Nivel5=v.vcVinculacionAgrupacion,
FechaHoy=@FechAct,
RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHTarjetaCreditoOperacion tco
inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente
inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
--and p1.CpCodigoIndicador = 124
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and cl.clFechaFin is null
and sc.scIdCodigo not in (1,2,3)
group by cc.ccFamiliaProducto,
cl.clIdSegmentacionCliente,
ca.caDescripcionAgrupacionCanal,
sc.scSegmentacionOrdenN2,
sc.scSegmentacionTipo,
v.vcOrdenVinculacion,
v.vcVinculacionAgrupacion,
tco.tcoIdFecha,
ccOrdenAgrupacion,
clCodigoCliente

Union All

---&gt;&gt; Valor Deduccion

select
OrdenN1=@OrdenCarteraSegmentacion,
OrdenN2=sc.scSegmentacionOrdenN2,
OrdenN3=v.vcOrdenVinculacion,
Jerarquia=2,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Segm',
Nivel2=sc.scSegmentacionTipo,
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
FechaHoy=@FechAct,
RealHoy=case ao.aoIdFecha when @FechAct then (sum(isnull(ao.aoMontoSaldoDolar,0))/1000)*-1 else 0 end,
DenominadorHoy=0,
RealAyer=case ao.aoIdFecha when @FechaAyer then (sum(isnull(ao.aoMontoSaldoDolar,0))/1000)*-1 else 0 end,
DenominadorAyer=0,
RealMesAnt=case ao.aoIdFecha when @FechaMesAnt then (sum(isnull(ao.aoMontoSaldoDolar,0))/1000)*-1 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case ao.aoIdFecha when @FechaAnioAnt then (sum(isnull(ao.aoMontoSaldoDolar,0))/1000)*-1 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHActivoOperacion ao
inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=ccIdCuentaContable
inner join DWDCliente cl on ao.aoIdCliente=clIdCliente
inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente
inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where ao.aoIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)
and sc.scIdCodigo not in (1,2,3)
group by cc.ccFamiliaProducto,
ca.caDescripcionAgrupacionCanal,
sc.scSegmentacionOrdenN2,
sc.scSegmentacionOrdenN3,
sc.scSegmentacionTipo,
v.vcOrdenVinculacion,
ao.aoIdFecha

Union all

--&gt;&gt; Tarjeta Credito

select
OrdenN1=@OrdenCarteraSegmentacion,
OrdenN2=scSegmentacionOrdenN2,
OrdenN3=v.vcOrdenVinculacion,
Jerarquia=2,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Segm',
Nivel2=sc.scSegmentacionTipo,
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
FechaHoy=@FechAct,
RealHoy=case tco.tcoIdFecha when @FechAct then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
DenominadorHoy=0,
RealAyer=case tco.tcoIdFecha when @FechaAyer then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
DenominadorAyer=0,
RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHTarjetaCreditoOperacion tco
inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente
inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador = 124
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and cl.clFechaFin is null
and sc.scIdCodigo not in (1,2,3)
group by cc.ccFamiliaProducto,
cl.clIdSegmentacionCliente,
ca.caDescripcionAgrupacionCanal,
sc.scSegmentacionOrdenN2,
sc.scSegmentacionTipo,
v.vcOrdenVinculacion,
tco.tcoIdFecha,
ccOrdenAgrupacion,
clCodigoCliente

Union all

/* Presupuesto Negocio*/

select
OrdenN1=@OrdenCarteraSegmentacion,
OrdenN2=@OrdenCarteraSegmentacion,
OrdenN3=@OrdenCarteraSegmentacion,
Jerarquia=1,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Segm',
Nivel2=cc.ccFamiliaProducto+'-Segm',
Nivel3=cc.ccFamiliaProducto+'-Segm',
Nivel4=cc.ccFamiliaProducto+'-Segm',
Nivel5=cc.ccFamiliaProducto+'-Segm',
FechaHoy=@FechAct,
RealHoy=0,
DenominadorHoy=0,
RealAyer=0,
DenominadorAyer=0,
RealMesAnt=0,
DenominadorMesAnt=0,
RealAnioAnt=0,
DenominadorAnioAnt=0,
ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,
DenominadorPresupuesto=0
from DWHPresupuestoNegocio pn
inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal
inner join DWDAgenciaOperacion ag on pn.pnIdAgencia=ag.agIdAgencia
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where pn.pnIdFecha = @FechAct
and ca.caEstado=1
and cc.ccCodigoMoneda='USD'
and pn.pnIdIndicadorMedidaFinanciera=-10
group by cc.ccFamiliaProducto,
ca.caDescripcionAgrupacionCanal --575879

Union all

/* ----------------------------------------------------------------------------------------------- */
/*                                  CONTINGENTES                                                    */
/* ----------------------------------------------------------------------------------------------- */

select
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=cc.ccOrdenAgrupacionN3,
Jerarquia=3,
Canal=
case when cc.ccCodigoNivel6 in (630281802003,640215802003)
then
(
case when asCodigoAsesor in ('IBS','-1') then isnull(--clCanal
(select caDescripcionAgrupacionCanal from dwdcanal where caIdCanal=cl.clIdCanal),
(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG')
)--'NNG')

else isnull(--asCodigoCanal
(select caDescripcionAgrupacionCanal from dwdcanal where rtrim(ltrim(caCodigoCanal))= case when ltrim(rtrim(ase.asCodigoCanal)) in ('N/A','-1') then 'NDI' else ltrim(rtrim(ase.asCodigoCanal))  end )
--(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal=  ase.asCodigoCanal )
,isnull(caDescripcionAgrupacionCanal,(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'))--'NNG')
)
end
)
else isnull(
--clCanal
(select caDescripcionAgrupacionCanal from dwdcanal where caIdCanal=cl.clIdCanal),
(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'))--'NNG')
end,

Division='NO',
Consolidado='NO',
Nivel1=ccFamiliaProducto,
Nivel2=ccGrupo,
Nivel3=ccSubGrupo,
Nivel4=ccSubGrupo,
Nivel5=ccSubGrupo,
FechaHoy=@FechAct,
RealHoy=case ao.aoIdFecha when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case ao.aoIdFecha when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case ao.aoIdFecha when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case ao.aoIdFecha when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHActivoOperacion ao
inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on ao.aoIdCliente=cl.clIdCliente
inner join DWDProducto pr on pr.prIdProducto=ao.aoIdProducto
inner join DWDCanal ca on cl.clCodigoCanal=ca.caCodigoCanal --cl.clIdCanal=ca.caIdCanal
left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 3
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where ao.aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and cl.clFechaFin is null
and ca.caEstado=1
group by
ao.aoIdFecha,
ca.caDescripcionAgrupacionCanal,
cc.ccOrdenAgrupacionN2,
cc.ccOrdenAgrupacionN3,
cc.ccOrdenAgrupacion,
ccFamiliaProducto,
ccGrupo,
clIdCanal,
asCodigoCanal,
ccSubGrupo,
ccCodigoNivel6,
asCodigoAsesor

Union all

---Creditos no desembolsados

select
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN2=cc.ccOrdenAgrupacionN3,
Jerarquia=3,
Canal=(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'),
Division='NO',
Consolidado='NO',
Nivel1=ccFamiliaProducto,
Nivel2=ccGrupo,
Nivel3=ccSubGrupo,
Nivel4=ccSubGrupo,
Nivel5=ccSubGrupo,
FechaHoy=@FechAct,
RealHoy=case bs.bsIdFecha when @FechAct then sum(bs.bsSaldoDolarizado)/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case bs.bsIdFecha when @FechaAyer then sum(bs.bsSaldoDolarizado)/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case bs.bsIdFecha when @FechaMesAnt then sum(bs.bsSaldoDolarizado)/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case bs.bsIdFecha when @FechaAnioAnt then sum(bs.bsSaldoDolarizado)/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=case bs.bsIdFecha when @FechAct then sum(bs.bsSaldoDolarizado)/1000 else 0 end,-- el presupuesto va a ser igual a hoy
DenominadorPresupuesto=0
from DWHBalanceSaldo bs
inner join #DWDCuentaContable cc on bs.bsIdCuentaContable=cc.ccIdCuentaContable
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 3
and p1.CpCodigoIndicador = 162
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where bs.bsIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
group by bs.bsIdFecha,
cc.ccOrdenAgrupacion,
cc.ccOrdenAgrupacionN2,
cc.ccOrdenAgrupacionN3,
ccFamiliaProducto,
ccGrupo,
ccSubGrupo

Union all

/* PRESUPUESTO NEGOCIO */

select
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN2=cc.ccOrdenAgrupacionN3,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,

Division='NO',
Consolidado='NO',
Nivel1=ccFamiliaProducto,
Nivel2=ccGrupo,
Nivel3=ccSubGrupo,
Nivel4=ccSubGrupo,
Nivel5=ccSubGrupo,
FechaHoy=@FechAct,
RealHoy=0,
DenominadorHoy=0,
RealAyer=0,
DenominadorAyer=0,
RealMesAnt=0,
DenominadorMesAnt=0,
RealAnioAnt=0,
DenominadorAnioAnt=0,
ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,
DenominadorPresupuesto=0
from DWHPresupuestoNegocio pn
inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable
left outer join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 3
and p1.CpCodigoIndicador in (160,161)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where pn.pnIdFecha in (@FechAct)
and ca.caEstado=1
--and ca.caIdCanal in (1,5,7,8,9,10,11,14,15,17,12,13)
--and cc.ccCodigoMoneda='USD'
and pn.pnIdIndicadorMedidaFinanciera=-10
group by
ca.caOrdenCanal,
cc.ccFamiliaProducto,
ca.caDescripcionAgrupacionCanal,
cc.ccOrdenAgrupacion,
ccOrdenAgrupacionN2,
cc.ccOrdenAgrupacionN3,
cc.ccGrupo,
ccSubGrupo,
ca.caAgrupacion

Union All

/* /////////////////////////////// */
/*      CONTINGENTES CANAL         */
/* /////////////////////////////// */

select
OrdenN1=@OrdenContingenteCanal,
OrdenN2=ca.caOrdenCanal,
OrdenN3=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)   then --ContCanal.agOrdenRegionAsesor
case when ContCanal.nombreRegion like '%SIN NOMBRE%' or ContCanal.nombreRegion like '%SIN REGION%' then 1000 else ContCanal.agOrdenRegionAsesor  end
when ca.caCodDescripcionAgrupacionCanal = 2  then --ContCanal.asOrdenAsesor
case when ContCanal.nombreAsesor LIKE '%SIN%ASESOR%' THEN 1000 else ContCanal.asOrdenAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caOrdenDescripcionCanal --cl.clCanal
else 1000
end,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1,
Nivel2=ca.caAgrupacion,
Nivel3=
case
when ca.caCodDescripcionAgrupacionCanal = 2 then --nombreAsesor
case when ContCanal.nombreAsesor LIKE '%SIN ASESOR%' THEN 'NDI' else ContCanal.nombreAsesor end
when  ca.caCodDescripcionAgrupacionCanal = 3 then caDescripcionCanal
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then --nombreRegion
case when ContCanal.nombreRegion like '%SIN%NOMBRE%' then 'SIN REGION' else ContCanal.nombreRegion end
else 'NDI'
end,
Nivel4=
case
when ca.caCodDescripcionAgrupacionCanal = 2 then --nombreAsesor
case when ContCanal.nombreAsesor LIKE '%SIN ASESOR%' THEN 'NDI' else ContCanal.nombreAsesor end
when  ca.caCodDescripcionAgrupacionCanal = 3 then caDescripcionCanal
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then --nombreRegion
case when ContCanal.nombreRegion like '%SIN%NOMBRE%' then 'SIN REGION' else ContCanal.nombreRegion end
else 'NDI'
end,
Nivel5=
case
when ca.caCodDescripcionAgrupacionCanal = 2 then --nombreAsesor
case when ContCanal.nombreAsesor LIKE '%SIN ASESOR%' THEN 'NDI' else ContCanal.nombreAsesor end
when  ca.caCodDescripcionAgrupacionCanal = 3 then caDescripcionCanal
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then --nombreRegion
case when ContCanal.nombreRegion like '%SIN%NOMBRE%' then 'SIN REGION' else ContCanal.nombreRegion end
else 'NDI'
end,
FechaHoy=@FechAct,
RealHoy=sum(RealHoy)/1000,
DenominadorHoy=0,
RealAyer=sum(RealAyer)/1000,
DenominadorAyer=0,
RealMesAnt=sum(RealMesAnt)/1000,
DenominadorMesAnt=0,
RealAnioAnt=sum(RealAnioAnt)/1000,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from
(
select
CodCliente=clCodigoCliente,
Nivel1=cc.ccFamiliaProducto+'-Canal',

clIdCanal=
case when ccCodigoNivel6 in (630281802003,640215802003) then
(case when asCodigoAsesor in ('IBS','-1') then
isnull(--clCanal
(select caIdCanal from dwdcanal where caIdCanal=clIdCanal),
(select caIdCanal from dwdcanal where caCodigoCanal='NNG')
)--'NNG')
else isnull(--asCodigoCanal
(select caIdCanal from dwdcanal where caCodigoCanal=asCodigoCanal),
isnull(clIdCanal,(select caIdCanal from dwdcanal where caCodigoCanal='NNG'))--'NNG')
)
end
)
else isnull(--clCanal
(select caIdCanal from dwdcanal where caIdCanal=clIdCanal),
(select caIdCanal from dwdcanal where caCodigoCanal='NNG')
)--'NNG')
end,

-- Aumente
--&gt;
asOrdenAsesor=
case when ccCodigoNivel6 in (630281802003,640215802003)
then
(
case when asCodigoAsesor in ('IBS','-1') then (select asOrdenAsesor from DWDAsesorOperacion where clCodigoAsesorPrincipal=asCodigoAsesor and asAsesorPrincipal=1)
else asOrdenAsesor
end
)
else (select asOrdenAsesor from DWDAsesorOperacion where clCodigoAsesorPrincipal=asCodigoAsesor and asAsesorPrincipal=1 )--clCodigoAsesorPrincipal
end,
--&gt;

NombreAsesor=
case when ccCodigoNivel6 in (630281802003,640215802003) then
(
case when asCodigoAsesor in ('IBS','-1') then (select asNombreAsesor from DWDAsesorOperacion where clCodigoAsesorPrincipal=asCodigoAsesor and asAsesorPrincipal=1)
else asNombreAsesor
end
)
else (select asNombreAsesor from DWDAsesorOperacion where clCodigoAsesorPrincipal=asCodigoAsesor and asAsesorPrincipal=1 )--clCodigoAsesorPrincipal
end ,

--&gt;Aumente
--&gt;
agOrdenRegionAsesor=
case when ccCodigoNivel6 in (630281802003,640215802003) then agOrdenRegionAsesor
else
(case isnull(clIdAgencia,-1) when -1 then agOrdenRegionAsesor
else --clCodigoAgencia
(select agOrdenRegionAsesor from DWDAgenciaOperacion where clCodigoAgencia=agCodigoAgencia)
end
)
end,
--&gt;

NombreRegion=
case when ccCodigoNivel6 in (630281802003,640215802003) then agNombreRegion
else (case isnull(clIdAgencia,-1) when -1 then agNombreRegion
else --clCodigoAgencia
(select agNombreRegion from DWDAgenciaOperacion where clCodigoAgencia=agCodigoAgencia)
end
)
end,

RealHoy=case ao.aoIdFecha  when @FechAct then sum(ao.aoMontoSaldoDolar) else 0 end,
RealAyer=case ao.aoIdFecha  when @FechaAyer then sum(ao.aoMontoSaldoDolar) else 0 end,
RealMesAnt=case ao.aoIdFecha  when @FechaMesAnt then sum(ao.aoMontoSaldoDolar) else 0 end,
RealAnioAnt=case ao.aoIdFecha  when @FechaAnioAnt then sum(ao.aoMontoSaldoDolar) else 0 end

from #DWHActivoOperacion ao
inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on ao.aoIdCliente=clIdCliente
inner join DWDAgenciaOperacion on agIdAgencia=aoIdAgencia
left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal
and asEstado=1
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 3
and p1.CpCodigoIndicador in (160,161)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where ao.aoIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)
and clFechaFin is null
group by
clCodigoCliente,
cc.ccFamiliaProducto,
ccCodigoNivel6,
asCodigoAsesor,
aoIdFecha,
asOrdenAsesor,
agOrdenRegionAsesor,
asCodigoCanal,
clCodigoAsesorPrincipal,
clCodigoAgencia,
agNombreRegion,
asNombreAsesor,
clIdAgencia,
clIdCanal

)  as ContCanal

join dwdcanal ca on caIdCanal=ContCanal.clIdCanal
--join dwdagenciaoperacion ag on ContCanal.IdAgencia=ag.agIdAgencia
--join DWDAsesorOperacion ase on ContCanal.IdAsesor=ase.asIdAsesor

group by
caOrdenDescripcionCanal,
ca.caDescripcionAgrupacionCanal,
Nivel1,
caOrdenCanal,
ca.caCodDescripcionAgrupacionCanal,
nombreAsesor,
caDescripcionCanal,
ca.caAgrupacion,
nombreRegion,
ContCanal.agOrdenRegionAsesor,
ContCanal.asOrdenAsesor

Union all

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- Creditos No Desembolsados
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
OrdenN1=@OrdenContingenteCanal,
OrdenN2=100,
OrdenN3=100,

Jerarquia=2,
Canal=(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'),
Division='NO',
Consolidado='NO',
Nivel1=ccFamiliaProducto+'-Canal',
Nivel2=ccGrupo,
Nivel3=ccGrupo,
Nivel4=ccGrupo,
Nivel5=ccGrupo,
FechaHoy=@FechAct,
RealHoy=case bs.bsIdFecha when @FechAct then sum(bs.bsSaldoDolarizado)/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case bs.bsIdFecha when @FechaAyer then sum(bs.bsSaldoDolarizado)/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case bs.bsIdFecha when @FechaMesAnt then sum(bs.bsSaldoDolarizado)/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case bs.bsIdFecha when @FechaAnioAnt then sum(bs.bsSaldoDolarizado)/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=case bs.bsIdFecha when @FechAct then sum(bs.bsSaldoDolarizado)/1000 else 0 end, -- el presupuesto va a ser igual al valor de Hoy
DenominadorPresupuesto=0
from DWHBalanceSaldo bs
inner join #DWDCuentaContable cc on bs.bsIdCuentaContable=cc.ccIdCuentaContable
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 3
and p1.CpCodigoIndicador = 162
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where bs.bsIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
group by bs.bsIdFecha,
cc.ccOrdenAgrupacion,
ccFamiliaProducto,
ccGrupo

Union all

--Valor Deduccion Credito No desembolsado

select
OrdenN1=@OrdenContingenteCanal,
OrdenN2=100,
OrdenN3=100,
Jerarquia=1,
Canal=(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'),
Division='NO',
Consolidado='NO',
Nivel1=ccFamiliaProducto+'-Canal',
Nivel2='Deducción',
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
FechaHoy=@FechAct,
RealHoy=case bs.bsIdFecha when @FechAct then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,
DenominadorHoy=0,
RealAyer=case bs.bsIdFecha when @FechaAyer then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,
DenominadorAyer=0,
RealMesAnt=case bs.bsIdFecha when @FechaMesAnt then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case bs.bsIdFecha when @FechaAnioAnt then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=case bs.bsIdFecha when @FechAct then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end, -- el presupuesto va a ser igual al valor de Hoy
DenominadorPresupuesto=0
from DWHBalanceSaldo bs
inner join #DWDCuentaContable cc on bs.bsIdCuentaContable=cc.ccIdCuentaContable
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 3
and p1.CpCodigoIndicador = 162
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where bs.bsIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
group by bs.bsIdFecha,
cc.ccOrdenAgrupacion,
ccFamiliaProducto,
ccGrupo

Union all

/* Presupuesto Operacion */

select
OrdenN1=@OrdenContingenteCanal,
OrdenN2=ca.caOrdenCanal,
OrdenN3=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%REGION%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 1000 else ag.agOrdenRegionAsesor end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then
case when ao.asNombreAsesor LIKE '%SIN ASESOR%' THEN 1000 else asOrdenAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then caOrdenDescripcionCanal --cl.clCanal
else 1000
end,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Canal',
Nivel2=ca.caAgrupacion,
Nivel3=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then
case when ao.asNombreAsesor LIKE '%SIN ASESOR%' THEN 'NDI' else ao.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,
Nivel4=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then
case when ao.asNombreAsesor LIKE '%SIN ASESOR%' THEN 'NDI' else ao.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,
Nivel5=
case
when ca.caCodDescripcionAgrupacionCanal in (1,4)  then
case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end
when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then
case when ao.asNombreAsesor LIKE '%SIN ASESOR%' THEN 'NDI' else ao.asNombreAsesor end
when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal
else 'NDI'
end,
FechaHoy=@FechAct,
RealHoy=0,
DenominadorHoy=0,
RealAyer=0,
DenominadorAyer=0,
RealMesAnt=0,
DenominadorMesAnt=0,
RealAnioAnt=0,
DenominadorAnioAnt=0,
ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,
DenominadorPresupuesto=0
from DWHPresupuestoNegocio pn
inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal
inner join DWDAgenciaOperacion ag on pn.pnIdAgencia=ag.agIdAgencia
inner join DWDAsesorOperacion ao on pn.pnIdAsesor=ao.asIdAsesor
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 3
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where pn.pnIdFecha = @FechAct
and ca.caEstado=1
and pn.pnIdIndicadorMedidaFinanciera=-10
group by cc.ccFamiliaProducto,
ca.caOrdenCanal,
agOrdenRegionAsesor,
caOrdenDescripcionCanal,
asOrdenAsesor,
ca.caDescripcionCanal,
ca.caCodDescripcionAgrupacionCanal,
ca.caAgrupacion,
ag.agNombreRegion,
ao.asAsesorPrincipal,
ca.caDescripcionAgrupacionCanal,
ao.asNombreAsesor,
ca.caDescripcionCanal

Union all

/* //////////////////////////////////// */
/*    CONTINGENTES - SEGMENTACION       */
/* //////////////////////////////////// */

-- NATURALES (4,5,6,7,8,9,10)
-- JURIDICOS (11,12,13,14,15,16,17,18,19)
-- SIN PERFIL (1,2,3)

select
OrdenN1=@OrdenContingenteSegmentacion,
OrdenN2=sc.scSegmentacionOrdenN2,
OrdenN3=sc.scSegmentacionOrdenN3,
Jerarquia=
case
when sc.scIdCodigo in (11,12,13,14,15,16,17,18,19) then 3
when sc.scIdCodigo in (4,5,6,7,8,9,10) then 5
else 2
end,
Canal=
case when cc.ccCodigoNivel6 in (630281802003,640215802003)
then
(
case when asCodigoAsesor in ('IBS','-1') then isnull(--clCanal
(select caDescripcionAgrupacionCanal from dwdcanal where caIdCanal=cl.clIdCanal),
(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG')
)--'NNG')
else isnull(--asCodigoCanal
(select caDescripcionAgrupacionCanal from dwdcanal where rtrim(ltrim(caCodigoCanal))= case when ltrim(rtrim(ase.asCodigoCanal)) in ('N/A','-1') then 'NDI' else ltrim(rtrim(ase.asCodigoCanal))  end  )
--(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal=  ase.asCodigoCanal )
,isnull(caDescripcionAgrupacionCanal,(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'))--'NNG')
)
end
)
else isnull(--clCanal
(select caDescripcionAgrupacionCanal from dwdcanal where caIdCanal=cl.clIdCanal),
(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG')
)--'NNG')
end,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Segm',
Nivel2=sc.scSegmentacionTipo,
Nivel3=
case
when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo
else sc.scSegmentacion
end,
Nivel4=
case
when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo
else sc.scDetalleNombre
end,
Nivel5=
case
when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo
when sc.scIdCodigo in (11,12,13,14,15,16,17,18,19) then sc.scDetalleNombre
else v.vcVinculacionAgrupacion
end,
FechaHoy=@FechAct,
RealHoy=case ao.aoIdFecha when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case ao.aoIdFecha  when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case ao.aoIdFecha  when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case ao.aoIdFecha  when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0

from #DWHActivoOperacion ao
inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on ao.aoIdCliente=cl.clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente
inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente
left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal --validacion para las cuentas (630281802003,640215802003)
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 3
and p1.CpCodigoIndicador in (160,161)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where ao.aoIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)
and cl.clfechafin is null
and ca.caEstado=1
group by
ase.asCodigoCanal,
cc.ccCodigoNivel6,
asCodigoAsesor,
cl.clIdCanal,
sc.scSegmentacionOrdenN2,
sc.scSegmentacionOrdenN3,
sc.scIdCodigo,
cc.ccFamiliaProducto,
ca.caDescripcionAgrupacionCanal,
cl.clIdSegmentacionCliente,
ao.aoIdFecha,
sc.scSegmentacionTipo,
sc.scSegmentacion,
sc.scDetalleNombre,
v.vcVinculacionAgrupacion

Union all

---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- Alta y Baja Vinculacion
-- para Natural y Juridico
---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
OrdenN1=@OrdenContingenteSegmentacion,
OrdenN2=sc.scSegmentacionOrdenN2,
OrdenN3=v.vcOrdenVinculacion,

Jerarquia=3,
Canal=--ca.caDescripcionAgrupacionCanal,
case when cc.ccCodigoNivel6 in (630281802003,640215802003)
then
(
case when asCodigoAsesor in ('IBS','-1') then isnull(--clCanal
(select caDescripcionAgrupacionCanal from dwdcanal where caIdCanal=cl.clIdCanal),
(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG')
)--'NNG')

else isnull(--asCodigoCanal
(select caDescripcionAgrupacionCanal from dwdcanal where rtrim(ltrim(caCodigoCanal))= case when ltrim(rtrim(ase.asCodigoCanal)) in ('N/A','-1') then 'NDI' else ltrim(rtrim(ase.asCodigoCanal))  end  )
--(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal=  ase.asCodigoCanal )
,isnull(caDescripcionAgrupacionCanal,(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'))--'NNG')
)
end
)
else isnull(--clCanal
(select caDescripcionAgrupacionCanal from dwdcanal where caIdCanal=cl.clIdCanal),
(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG')
)--'NNG')
end,

Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Segm',
Nivel2=sc.scSegmentacionTipo,
Nivel3=v.vcVinculacionAgrupacion,
Nivel4=v.vcVinculacionAgrupacion,
Nivel5=v.vcVinculacionAgrupacion,
FechaHoy=@FechAct,
RealHoy=case ao.aoIdFecha when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case ao.aoIdFecha when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case ao.aoIdFecha when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case ao.aoIdFecha when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHActivoOperacion ao
inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=ccIdCuentaContable
inner join DWDCliente cl on ao.aoIdCliente=clIdCliente
inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente
inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal  --validacion para las cuentas (630281802003,640215802003)
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 3
and p1.CpCodigoIndicador in (160,161)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where ao.aoIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)
and sc.scIdCodigo not in (1,2,3)
group by
cl.clIdCanal,
cc.ccCodigoNivel6,
asCodigoAsesor,
ase.asCodigoCanal,
cc.ccFamiliaProducto,
ca.caDescripcionAgrupacionCanal,
sc.scSegmentacionOrdenN2,
sc.scSegmentacionOrdenN3,
sc.scSegmentacionTipo,
v.vcOrdenVinculacion,
v.vcVinculacionAgrupacion,
ao.aoIdFecha

Union all

--&gt;&gt; Valor Deducccion

select
OrdenN1=@OrdenContingenteSegmentacion,
OrdenN2=sc.scSegmentacionOrdenN2,
OrdenN3=v.vcOrdenVinculacion,

Jerarquia=2,
Canal=--ca.caDescripcionAgrupacionCanal,
case when cc.ccCodigoNivel6 in (630281802003,640215802003)
then
(
case when asCodigoAsesor in ('IBS','-1') then isnull(--clCanal
(select caDescripcionAgrupacionCanal from dwdcanal where caIdCanal=cl.clIdCanal),
(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG')
)--'NNG')

else isnull(--asCodigoCanal
(select caDescripcionAgrupacionCanal from dwdcanal where rtrim(ltrim(caCodigoCanal))= case when ltrim(rtrim(ase.asCodigoCanal)) in ('N/A','-1') then 'NDI' else ltrim(rtrim(ase.asCodigoCanal))  end  )
--(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal=  ase.asCodigoCanal )
,isnull(caDescripcionAgrupacionCanal,(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'))--'NNG')
)
end
)
else isnull(
--clCanal
(select caDescripcionAgrupacionCanal from dwdcanal where caIdCanal=cl.clIdCanal),
(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG')
)--'NNG')
end,

Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Segm',
Nivel2=sc.scSegmentacionTipo,
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
FechaHoy=@FechAct,
RealHoy=case ao.aoIdFecha when @FechAct then (sum(isnull(ao.aoMontoSaldoDolar,0))/1000)*-1 else 0 end,
DenominadorHoy=0,
RealAyer=case ao.aoIdFecha when @FechaAyer then (sum(isnull(ao.aoMontoSaldoDolar,0))/1000)*-1 else 0 end,
DenominadorAyer=0,
RealMesAnt=case ao.aoIdFecha when @FechaMesAnt then (sum(isnull(ao.aoMontoSaldoDolar,0))/1000)*-1 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case ao.aoIdFecha when @FechaAnioAnt then (sum(isnull(ao.aoMontoSaldoDolar,0))/1000)*-1 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0

from #DWHActivoOperacion ao
inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=ccIdCuentaContable
inner join DWDCliente cl on ao.aoIdCliente=clIdCliente
inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente  -- verificar los left
inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente -- verificar los left
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 3
and p1.CpCodigoIndicador in (160,161)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where ao.aoIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)
and sc.scIdCodigo not in (1,2,3)
group by cc.ccFamiliaProducto,
cl.clIdCanal,
cc.ccCodigoNivel6,
ase.asCodigoCanal,
ca.caDescripcionAgrupacionCanal,
sc.scSegmentacionOrdenN2,
sc.scSegmentacionOrdenN3,
sc.scSegmentacionTipo,
v.vcOrdenVinculacion,
v.vcVinculacionAgrupacion,
asCodigoAsesor,
ao.aoIdFecha

union all

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
---- Creditos no desembolsados
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
OrderN1=@OrdenContingenteSegmentacion,
OrderN2=100,
OrderN2=1,
Jerarquia=2,
Canal=(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'),
Division='NO',
Consolidado='NO',
Nivel1=ccFamiliaProducto+'-Segm',
Nivel2=ccGrupo,
Nivel3=ccGrupo,
Nivel4=ccGrupo,
Nivel5=ccGrupo,
FechaHoy=@FechAct,
RealHoy=case bs.bsIdFecha when @FechAct then sum(bs.bsSaldoDolarizado)/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case bs.bsIdFecha when @FechaAyer then sum(bs.bsSaldoDolarizado)/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case bs.bsIdFecha when @FechaMesAnt then sum(bs.bsSaldoDolarizado)/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case bs.bsIdFecha when @FechaAnioAnt then sum(bs.bsSaldoDolarizado)/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=case bs.bsIdFecha when @FechAct then sum(bs.bsSaldoDolarizado)/1000 else 0 end,-- el presupuesto es igual al real hoy
DenominadorPresupuesto=0
from DWHBalanceSaldo bs
inner join #DWDCuentaContable cc on bs.bsIdCuentaContable=cc.ccIdCuentaContable
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 3
and p1.CpCodigoIndicador = 162
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where bs.bsIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
group by bs.bsIdFecha,
cc.ccOrdenAgrupacion,
ccFamiliaProducto,
ccGrupo,
ccSubGrupo


union all

-- Valor Deduccion Creditos No desembolsados

select
OrderN1=@OrdenContingenteSegmentacion,
OrderN2=100,
OrderN3=100,
Jerarquia=1,
Canal=(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'),
Division='NO',
Consolidado='NO',
Nivel1=ccFamiliaProducto+'-Segm',
Nivel2='Deducción',
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
FechaHoy=@FechAct,
RealHoy=case bs.bsIdFecha when @FechAct then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,
DenominadorHoy=0,
RealAyer=case bs.bsIdFecha when @FechaAyer then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,
DenominadorAyer=0,
RealMesAnt=case bs.bsIdFecha when @FechaMesAnt then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case bs.bsIdFecha when @FechaAnioAnt then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=case bs.bsIdFecha when @FechAct then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,
DenominadorPresupuesto=0
from DWHBalanceSaldo bs
inner join #DWDCuentaContable cc on bs.bsIdCuentaContable=cc.ccIdCuentaContable
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 3
and p1.CpCodigoIndicador = 162
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where bs.bsIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
group by bs.bsIdFecha,
cc.ccOrdenAgrupacion,
ccFamiliaProducto,
ccGrupo,
ccSubGrupo

Union all

/* Presupuesto Negocio*/

select
OrdenN1=@OrdenContingenteSegmentacion,
OrdenN2=@OrdenContingenteSegmentacion,
OrdenN3=@OrdenContingenteSegmentacion,
Jerarquia=1,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Consolidado='NO',
Nivel1=cc.ccFamiliaProducto+'-Segm',
Nivel2=cc.ccFamiliaProducto+'-Segm',
Nivel3=cc.ccFamiliaProducto+'-Segm',
Nivel4=cc.ccFamiliaProducto+'-Segm',
Nivel5=cc.ccFamiliaProducto+'-Segm',
FechaHoy=@FechAct,
RealHoy=0,
DenominadorHoy=0,
RealAyer=0,
DenominadorAyer=0,
RealMesAnt=0,
DenominadorMesAnt=0,
RealAnioAnt=0,
DenominadorAnioAnt=0,
ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,
DenominadorPresupuesto=0
from DWHPresupuestoNegocio pn
inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal
inner join DWDAgenciaOperacion ag on pn.pnIdAgencia=ag.agIdAgencia
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 3
and p1.CpCodigoIndicador in (160,161)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where pn.pnIdFecha in (@FechAct)
and ca.caEstado=1
and pn.pnIdIndicadorMedidaFinanciera=-10
group by cc.ccFamiliaProducto,
ca.caDescripcionAgrupacionCanal


-------------------
-- Hoja Posicion
-------------------


select
OrdenN1,
OrdenN2,
OrdenN3,
Jerarquia,
Canal,
Division,
Consolidado,
Nivel1,
Nivel2,
Nivel3,
Nivel4,
Nivel5,
FechaHoy,
RealHoy=sum(RealHoy),
DenominadorHoy=sum(DenominadorHoy),
RealAyer=sum(RealAyer),
DenominadorAyer=sum(DenominadorAyer),
RealMesAnt=sum(RealMesAnt),
DenominadorMesAnt=sum(DenominadorMesAnt),
RealAnioAnt=sum(RealAnioAnt),
DenominadorAnioAnt=sum(DenominadorAnioAnt),
ValorPresupuesto=sum(ValorPresupuesto),
DenominadorPresupuesto=sum(DenominadorPresupuesto)
from #hoja
group by
OrdenN1,
OrdenN2,
OrdenN3,
Jerarquia,
Canal,
Division,
Consolidado,
Nivel1,
Nivel2,
Nivel3,
Nivel4,
Nivel5,
FechaHoy
having
abs(sum(RealHoy))+abs(sum(DenominadorHoy))+abs(sum(RealAyer))+abs(sum(DenominadorAyer))
+abs(sum(RealMesAnt))+abs(sum(DenominadorMesAnt))+abs(sum(RealAnioAnt))+abs(sum(DenominadorAnioAnt))+abs(sum(ValorPresupuesto))
+abs(sum(DenominadorPresupuesto))&gt;0
order by 1,2,3&lt;/RSQueryCommandText&gt;&lt;RSQueryCommandType&gt;Text&lt;/RSQueryCommandType&gt;&lt;RSQueryDesignState&gt;&lt;/RSQueryDesignState&gt;]]&gt;&lt;/AnnotationContent&gt;&lt;/Gemini&gt;</Value>
            </Annotation>
            <Annotation>
              <Name>IsQueryEditorUsed</Name>
              <Value>True</Value>
            </Annotation>
          </Annotations>
          <Source xsi:type="DataSourceViewBinding">
            <DataSourceViewID>Sandbox</DataSourceViewID>
          </Source>
          <UnknownMember valuens="ddl200_200">AutomaticNull</UnknownMember>
          <ErrorConfiguration>
            <KeyNotFound>IgnoreError</KeyNotFound>
            <KeyDuplicate>ReportAndStop</KeyDuplicate>
            <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
          </ErrorConfiguration>
          <StorageMode valuens="ddl200_200">InMemory</StorageMode>
          <Language>2058</Language>
          <UnknownMemberName>Unknown</UnknownMemberName>
          <Attributes>
            <Attribute>
              <ID>RowNumber</ID>
              <Name>RowNumber</Name>
              <Type valuens="ddl200_200">RowNumber</Type>
              <Usage>Key</Usage>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>4</DataSize>
                  <NullProcessing>Error</NullProcessing>
                  <Source xsi:type="ddl200_200:RowNumberBinding" />
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>4</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <Source xsi:type="ddl200_200:RowNumberBinding" />
              </NameColumn>
              <AttributeRelationships>
                <AttributeRelationship>
                  <AttributeID>OrdenN1</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>OrdenN1</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>OrdenN2</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>OrdenN2</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>OrdenN3</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>OrdenN3</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Jerarquia</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Jerarquia</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Canal</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Canal</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Division</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Division</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Nivel1</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Nivel1</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Nivel2</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Nivel2</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Nivel3</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Nivel3</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Nivel4</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Nivel4</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Nivel5</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Nivel5</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>RealHoy</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>RealHoy</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>DenominadorHoy</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>DenominadorHoy</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>RealAyer</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>RealAyer</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>DenominadorAyer</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>DenominadorAyer</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>RealMesAnt</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>RealMesAnt</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>DenominadorMesAnt</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>DenominadorMesAnt</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>RealAnioAnt</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>RealAnioAnt</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>DenominadorAnioAnt</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>DenominadorAnioAnt</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>ValorPresupuesto</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>ValorPresupuesto</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>DenominadorPresupuesto</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>DenominadorPresupuesto</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>TipoBandera</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>TipoBandera</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>ConcentracionMorosidad</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>ConcentracionMorosidad</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>FechaHoy</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>FechaHoy</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Consolidado</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Consolidado</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Calculated Column 1</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Nivel2_2</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>hpCalSeccion</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodigoSeccion</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Nivel3_2</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Nivel3_2</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>CodigoConsolidado</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodigoProducto</Name>
                </AttributeRelationship>
              </AttributeRelationships>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>OrdenN1</ID>
              <Name>OrdenN1</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>OrdenN1</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>OrdenN1</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>OrdenN2</ID>
              <Name>OrdenN2</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>OrdenN2</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>OrdenN2</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>OrdenN3</ID>
              <Name>OrdenN3</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>OrdenN3</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>OrdenN3</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Jerarquia</ID>
              <Name>Jerarquia</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>Jerarquia</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>Jerarquia</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Canal</ID>
              <Name>Canal</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32768</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>Canal</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32768</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>Canal</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Division</ID>
              <Name>Division</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32768</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>Division</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32768</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>Division</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Nivel1</ID>
              <Name>Nivel1</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32768</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>Nivel1</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32768</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>Nivel1</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Nivel2</ID>
              <Name>Nivel2</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32768</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>Nivel2</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32768</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>Nivel2</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Nivel3</ID>
              <Name>Nivel3</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32768</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>Nivel3</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32768</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>Nivel3</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Nivel4</ID>
              <Name>Nivel4</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32768</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>Nivel4</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32768</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>Nivel4</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Nivel5</ID>
              <Name>Nivel5</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32768</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>Nivel5</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32768</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>Nivel5</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>RealHoy</ID>
              <Name>RealHoy</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>RealHoy</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>RealHoy</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>DenominadorHoy</ID>
              <Name>DenominadorHoy</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>DenominadorHoy</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>DenominadorHoy</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>RealAyer</ID>
              <Name>RealAyer</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>RealAyer</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>RealAyer</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>DenominadorAyer</ID>
              <Name>DenominadorAyer</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>DenominadorAyer</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>DenominadorAyer</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>RealMesAnt</ID>
              <Name>RealMesAnt</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>RealMesAnt</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>RealMesAnt</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>DenominadorMesAnt</ID>
              <Name>DenominadorMesAnt</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>DenominadorMesAnt</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>DenominadorMesAnt</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>RealAnioAnt</ID>
              <Name>RealAnioAnt</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>RealAnioAnt</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>RealAnioAnt</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>DenominadorAnioAnt</ID>
              <Name>DenominadorAnioAnt</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>DenominadorAnioAnt</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>DenominadorAnioAnt</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>ValorPresupuesto</ID>
              <Name>ValorPresupuesto</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>ValorPresupuesto</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>ValorPresupuesto</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>DenominadorPresupuesto</ID>
              <Name>DenominadorPresupuesto</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>DenominadorPresupuesto</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>DenominadorPresupuesto</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>TipoBandera</ID>
              <Name>TipoBandera</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>IF(HojaPosicion[Nivel2]="Cartera en Dificultades" || left(HojaPosicion[Nivel2],4)="Dif." ,"Dif", IF(HojaPosicion[Nivel2]="Morosidad Ampl. (-Tit.)" ||  left(HojaPosicion[Nivel2],1)=".","Mo","Tot"))</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>IF(HojaPosicion[Nivel2]="Cartera en Dificultades" || left(HojaPosicion[Nivel2],4)="Dif." ,"Dif", IF(HojaPosicion[Nivel2]="Morosidad Ampl. (-Tit.)" ||  left(HojaPosicion[Nivel2],1)=".","Mo","Tot"))</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>ConcentracionMorosidad</ID>
              <Name>ConcentracionMorosidad</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression> SWITCH(HojaPosicion[Nivel2],"Concentración 100","SI", "Concentración 50","SI","Concentración 25","SI","Morosidad Ampl. (-Tit.)","SI","Titularizada Mora","SI", ".Comer. + Micro.","SI",".Consumo","SI",".T. Credito","SI",".Vehiculos","SI",    ".Vivienda","SI",".C. Titularizada","SI","NO")</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression> SWITCH(HojaPosicion[Nivel2],"Concentración 100","SI", "Concentración 50","SI","Concentración 25","SI","Morosidad Ampl. (-Tit.)","SI","Titularizada Mora","SI", ".Comer. + Micro.","SI",".Consumo","SI",".T. Credito","SI",".Vehiculos","SI",    ".Vivienda","SI",".C. Titularizada","SI","NO")</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <ID>FechaHoy</ID>
              <Name>FechaHoy</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>FechaHoy</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>FechaHoy</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <ID>Consolidado</ID>
              <Name>Consolidado</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    <ColumnID>Consolidado</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                  <ColumnID>Consolidado</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Calculated Column 1</ID>
              <Name>Nivel2_2</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>trim(LEFT(HojaPosicion[Nivel2],35))</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>trim(LEFT(HojaPosicion[Nivel2],35))</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>hpCalSeccion</ID>
              <Name>CodigoSeccion</Name>
              <Description>Columna creada para identificar cada seccion del reporte de hoja de posicion atravez e un numero; estocodigo se lo utilizara en el reporte de reproitng services </Description>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>IF(HojaPosicion[Nivel1]="Captaciones",1,  
   IF(HojaPosicion[Nivel1]="Captaciones-Canal",2,
    IF(HojaPosicion[Nivel1]="Captaciones-Segm",3,
      IF(HojaPosicion[Nivel1]="Otros Dep." ||  HojaPosicion[Nivel1]="Obl. Finan." ,4,
        IF(HojaPosicion[Nivel1]="Cartera",5,
          IF(HojaPosicion[Nivel1]="Cartera-Canal",6,
             IF(HojaPosicion[Nivel1]="Cartera-Segm",7,
               IF(HojaPosicion[Nivel1]="Contingentes",8,
                 IF(HojaPosicion[Nivel1]="Contingentes-Canal",9,
                   IF(HojaPosicion[Nivel1]="Contingentes-Segm",10,99))))))))))</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>IF(HojaPosicion[Nivel1]="Captaciones",1,  
   IF(HojaPosicion[Nivel1]="Captaciones-Canal",2,
    IF(HojaPosicion[Nivel1]="Captaciones-Segm",3,
      IF(HojaPosicion[Nivel1]="Otros Dep." ||  HojaPosicion[Nivel1]="Obl. Finan." ,4,
        IF(HojaPosicion[Nivel1]="Cartera",5,
          IF(HojaPosicion[Nivel1]="Cartera-Canal",6,
             IF(HojaPosicion[Nivel1]="Cartera-Segm",7,
               IF(HojaPosicion[Nivel1]="Contingentes",8,
                 IF(HojaPosicion[Nivel1]="Contingentes-Canal",9,
                   IF(HojaPosicion[Nivel1]="Contingentes-Segm",10,99))))))))))</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Nivel3_2</ID>
              <Name>Nivel3_2</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>trim(HojaPosicion[Nivel3])</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>trim(HojaPosicion[Nivel3])</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>CodigoConsolidado</ID>
              <Name>CodigoProducto</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>TRIM(RIGHT(IF(RIGHT(HojaPosicion[Nivel2],1)="X" &amp;&amp; trim(HojaPosicion[Nivel2_2])&lt;&gt;"Monetarios",RIGHT(HojaPosicion[Nivel2],6),"X0000X"),6))</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>TRIM(RIGHT(IF(RIGHT(HojaPosicion[Nivel2],1)="X" &amp;&amp; trim(HojaPosicion[Nivel2_2])&lt;&gt;"Monetarios",RIGHT(HojaPosicion[Nivel2],6),"X0000X"),6))</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
          </Attributes>
          <Hierarchies>
            <Hierarchy>
              <ID>Niveles2</ID>
              <Name>Niveles2</Name>
              <Levels>
                <Level>
                  <ID>OrdenN1</ID>
                  <Name>OrdenN1</Name>
                  <SourceAttributeID>OrdenN1</SourceAttributeID>
                </Level>
                <Level>
                  <ID>Nivel1</ID>
                  <Name>Nivel1</Name>
                  <SourceAttributeID>Nivel1</SourceAttributeID>
                </Level>
                <Level>
                  <ID>OrdenN2</ID>
                  <Name>OrdenN2</Name>
                  <SourceAttributeID>OrdenN2</SourceAttributeID>
                </Level>
                <Level>
                  <ID>Nivel2_2</ID>
                  <Name>Nivel2_2</Name>
                  <SourceAttributeID>Calculated Column 1</SourceAttributeID>
                </Level>
                <Level>
                  <ID>OrdenN3</ID>
                  <Name>OrdenN3</Name>
                  <SourceAttributeID>OrdenN3</SourceAttributeID>
                </Level>
                <Level>
                  <ID>Nivel3</ID>
                  <Name>Nivel3</Name>
                  <SourceAttributeID>Nivel3</SourceAttributeID>
                </Level>
                <Level>
                  <ID>Nivel4</ID>
                  <Name>Nivel4</Name>
                  <SourceAttributeID>Nivel4</SourceAttributeID>
                </Level>
                <Level>
                  <ID>Nivel5</ID>
                  <Name>Nivel5</Name>
                  <SourceAttributeID>Nivel5</SourceAttributeID>
                </Level>
              </Levels>
            </Hierarchy>
          </Hierarchies>
          <ProactiveCaching>
            <SilenceInterval>-PT1S</SilenceInterval>
            <Latency>-PT1S</Latency>
            <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
            <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
            <Source xsi:type="ProactiveCachingInheritedBinding" />
          </ProactiveCaching>
          <ddl300_300:Relationships>
            <ddl300_300:Relationship>
              <ID>b140766c-8d26-461d-9edc-b65b4e43a4a2</ID>
              <ddl300_300:FromRelationshipEnd>
                <ddl300_300:Multiplicity>Many</ddl300_300:Multiplicity>
                <ddl300:VisualizationProperties />
                <DimensionID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</DimensionID>
                <Attributes>
                  <Attribute>
                    <AttributeID>Canal</AttributeID>
                  </Attribute>
                </Attributes>
              </ddl300_300:FromRelationshipEnd>
              <ddl300_300:ToRelationshipEnd>
                <ddl300_300:Multiplicity>One</ddl300_300:Multiplicity>
                <ddl300:VisualizationProperties />
                <DimensionID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</DimensionID>
                <Attributes>
                  <Attribute>
                    <AttributeID>caDescripcionAgrupacionCanal</AttributeID>
                  </Attribute>
                </Attributes>
              </ddl300_300:ToRelationshipEnd>
            </ddl300_300:Relationship>
            <ddl300_300:Relationship>
              <ID>9aedbd06-610b-4de5-bd74-2178a3bc798f</ID>
              <ddl300_300:FromRelationshipEnd>
                <ddl300_300:Multiplicity>Many</ddl300_300:Multiplicity>
                <ddl300:VisualizationProperties />
                <DimensionID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</DimensionID>
                <Attributes>
                  <Attribute>
                    <AttributeID>FechaHoy</AttributeID>
                  </Attribute>
                </Attributes>
              </ddl300_300:FromRelationshipEnd>
              <ddl300_300:ToRelationshipEnd>
                <ddl300_300:Multiplicity>One</ddl300_300:Multiplicity>
                <ddl300:VisualizationProperties />
                <DimensionID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</DimensionID>
                <Attributes>
                  <Attribute>
                    <AttributeID>feIdFecha</AttributeID>
                  </Attribute>
                </Attributes>
              </ddl300_300:ToRelationshipEnd>
            </ddl300_300:Relationship>
          </ddl300_300:Relationships>
        </Dimension>
        <Dimension>
          <ID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</ID>
          <Name>MargenFinanciero</Name>
          <Annotations>
            <Annotation>
              <Name>TableWidgetSerialization</Name>
            </Annotation>
            <Annotation>
              <Name>QueryEditorSerialization</Name>
              <Value>&lt;?xml version="1.0" encoding="UTF-16"?&gt;&lt;Gemini xmlns="QueryEditorSerialization"&gt;&lt;AnnotationContent&gt;&lt;![CDATA[&lt;RSQueryCommandText&gt;set nocount on 

if OBJECT_ID('[tempdb]..#DWHMonitorConsolidadoMargenV2')	is not null
begin
drop table #DWHMonitorConsolidadoMargenV2
end


select * 
into #DWHMonitorConsolidadoMargenV2
from DWHMonitorConsolidadoMargenV2
where nombre is not null

update  #DWHMonitorConsolidadoMargenV2 
set CodigoPadre=null
where CodigoPadre in 
(
select 
codigo
from DWHMonitorConsolidadoMargenV2
where nivel=1
)


select 
Jerarquia,
Agrupacion= 
       case 
       when CodigoN1 between 101000000 and 200000000 then  'Captaciones' else 'Cartera' end,
CodigoN1,
DescripcionN1=NombreN1,
CodigoN2,
DescripcionN2=NombreN2,
CodigoN3,
DescripcionN3=NombreN3,
CodigoN4,
DescripcionN4=NombreN4,
CodigoN5,
DescripcionN5=CAST(NombreN5  as varchar(100)),
diaPart,
diaSaldo,
diaTPP,
diaPYG,
mesPart,
mesSaldo,
mesTPP,
mesPYG,
anioPart,
anioSaldo,
anioTPP,
anioPYG,
mesPres,
anioPres

from 

(

-------------------------
--- Tinen solo 1 nivel
-------------------------

select distinct
Jerarquia=1,

CodigoN1=n1.codigo,
NombreN1=n1.nombre,
Codigon2=null,
Nombren2=null,

CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,

CodigoN5=null,
NombreN5=null,

n1.diaPart,
n1.diaSaldo,
n1.diaTPP,
n1.diaPYG,
n1.mesPart,
n1.mesSaldo,
n1.mesTPP,
n1.mesPYG,
n1.anioPart,
n1.anioSaldo,
n1.anioTPP,
n1.anioPYG,
n1.mesPres,
n1.anioPres

from #DWHMonitorConsolidadoMargenV2 n1
where nivel in (1,2)
and n1.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)


union all

------------------------
-- Tinen solo 2 niveles
------------------------

-- nivel2

select distinct
Jerarquia=2,

CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,

CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,

CodigoN5=null,
NombreN5=null,

n2.diaPart,
n2.diaSaldo,
n2.diaTPP,
n2.diaPYG,
n2.mesPart,
n2.mesSaldo,
n2.mesTPP,
n2.mesPYG,
n2.anioPart,
n2.anioSaldo,
n2.anioTPP,
n2.anioPYG,
n2.mesPres,
n2.anioPres

from #DWHMonitorConsolidadoMargenV2  n2 inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n2.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3

union all

-- valor deduccion nivel2

select distinct
Jerarquia=1,

CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=null,
NombreN2='Deducción',

CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,

CodigoN5=null,
NombreN5=null,

n2.diaPart*-1,
n2.diaSaldo*-1,
n2.diaTPP*-1,
n2.diaPYG*-1,
n2.mesPart*-1,
n2.mesSaldo*-1,
n2.mesTPP*-1,
n2.mesPYG*-1,
n2.anioPart*-1,
n2.anioSaldo*-1,
n2.anioTPP*-1,
n2.anioPYG*-1,
n2.mesPres*-1,
n2.anioPres*-1

from #DWHMonitorConsolidadoMargenV2  n2 inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n2.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3

union all

-- nivel 1

select distinct
Jerarquia=1,

CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=null,
NombreN2=null,
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,

n1.diaPart,
n1.diaSaldo,
n1.diaTPP,
n1.diaPYG,
n1.mesPart,
n1.mesSaldo,
n1.mesTPP,
n1.mesPYG,
n1.anioPart,
n1.anioSaldo,
n1.anioTPP,
n1.anioPYG,
n1.mesPres,
n1.anioPres

from #DWHMonitorConsolidadoMargenV2  n2 inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n2.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3


union all
------------------------
-- Tinen solo 3 niveles
------------------------

-- nivel3

select distinct
Jerarquia=3,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n3.diaPart,
n3.diaSaldo,
n3.diaTPP,
n3.diaPYG,
n3.mesPart,
n3.mesSaldo,
n3.mesTPP,
n3.mesPYG,
n3.anioPart,
n3.anioSaldo,
n3.anioTPP,
n3.anioPYG,
n3.mesPres,
n3.anioPres
from #DWHMonitorConsolidadoMargenV2  n3 
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n3.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4

union all

-- valor deduccion nivel 3

select distinct
Jerarquia=2,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=null,
NombreN3='Deducción',
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n3.diaPart*-1,
n3.diaSaldo*-1,
n3.diaTPP*-1,
n3.diaPYG*-1,
n3.mesPart*-1,
n3.mesSaldo*-1,
n3.mesTPP*-1,
n3.mesPYG*-1,
n3.anioPart*-1,
n3.anioSaldo*-1,
n3.anioTPP*-1,
n3.anioPYG*-1,
n3.mesPres*-1,
n3.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n3 
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n3.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3 
and n3.nivel=4

union all

-- Valor Nivel 2

select distinct
Jerarquia=2,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n2.diaPart,
n2.diaSaldo,
n2.diaTPP,
n2.diaPYG,
n2.mesPart,
n2.mesSaldo,
n2.mesTPP,
n2.mesPYG,
n2.anioPart,
n2.anioSaldo,
n2.anioTPP,
n2.anioPYG,
n2.mesPres,
n2.anioPres
from #DWHMonitorConsolidadoMargenV2  n3 
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n3.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3 
and n3.nivel=4

union all

-- Valor Deduccion Nivel 2

select distinct
Jerarquia=1,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=null,
NombreN2='Deducción',
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n2.diaPart*-1,
n2.diaSaldo*-1,
n2.diaTPP*-1,
n2.diaPYG*-1,
n2.mesPart*-1,
n2.mesSaldo*-1,
n2.mesTPP*-1,
n2.mesPYG*-1,
n2.anioPart*-1,
n2.anioSaldo*-1,
n2.anioTPP*-1,
n2.anioPYG*-1,
n2.mesPres*-1,
n2.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n3 
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n3.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3 
and n3.nivel=4

union all

-- Valor Nivel 1

select distinct
Jerarquia=1,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=null,
NombreN2=null,
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n1.diaPart,
n1.diaSaldo,
n1.diaTPP,
n1.diaPYG,
n1.mesPart,
n1.mesSaldo,
n1.mesTPP,
n1.mesPYG,
n1.anioPart,
n1.anioSaldo,
n1.anioTPP,
n1.anioPYG,
n1.mesPres,
n1.anioPres
from #DWHMonitorConsolidadoMargenV2  n3 
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n3.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3 
and n3.nivel=4

union all

------------------------
-- Tinen solo 4 niveles
------------------------

-- nivel4

select distinct
Jerarquia=4,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=n4.codigo,
NombreN4=n4.nombre,
CodigoN5=null,
NombreN5=null,
n4.diaPart,
n4.diaSaldo,
n4.diaTPP,
n4.diaPYG,
n4.mesPart,
n4.mesSaldo,
n4.mesTPP,
n4.mesPYG,
n4.anioPart,
n4.anioSaldo,
n4.anioTPP,
n4.anioPYG,
n4.mesPres,
n4.anioPres
from #DWHMonitorConsolidadoMargenV2  n4 
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3
and n3.nivel=4 and n4.nivel=5

union all
-- valor deduccion nivel4

select distinct
Jerarquia=3,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=null,
NombreN4='Deducción',
CodigoN5=null,
NombreN5=null,
n4.diaPart*-1,
n4.diaSaldo*-1,
n4.diaTPP*-1,
n4.diaPYG*-1,
n4.mesPart*-1,
n4.mesSaldo*-1,
n4.mesTPP*-1,
n4.mesPYG*-1,
n4.anioPart*-1,
n4.anioSaldo*-1,
n4.anioTPP*-1,
n4.anioPYG*-1,
n4.mesPres*-1,
n4.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n4 
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3
and n3.nivel=4 and n4.nivel=5

union all

-- Valor Nivel 3

select distinct
Jerarquia=3,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n3.diaPart,
n3.diaSaldo,
n3.diaTPP,
n3.diaPYG,
n3.mesPart,
n3.mesSaldo,
n3.mesTPP,
n3.mesPYG,
n3.anioPart,
n3.anioSaldo,
n3.anioTPP,
n3.anioPYG,
n3.mesPres,
n3.anioPres
from #DWHMonitorConsolidadoMargenV2  n4 
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3
and n3.nivel=4 and n4.nivel=5

union all

-- Valor Deduccion Nivel 3

select distinct
Jerarquia=2,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=null,
NombreN3='Deducción',
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n3.diaPart*-1,
n3.diaSaldo*-1,
n3.diaTPP*-1,
n3.diaPYG*-1,
n3.mesPart*-1,
n3.mesSaldo*-1,
n3.mesTPP*-1,
n3.mesPYG*-1,
n3.anioPart*-1,
n3.anioSaldo*-1,
n3.anioTPP*-1,
n3.anioPYG*-1,
n3.mesPres*-1,
n3.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n4 
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3
and n3.nivel=4 and n4.nivel=5

union all
-- Valor Nivel 2

select distinct
Jerarquia=2,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n2.diaPart,
n2.diaSaldo,
n2.diaTPP,
n2.diaPYG,
n2.mesPart,
n2.mesSaldo,
n2.mesTPP,
n2.mesPYG,
n2.anioPart,
n2.anioSaldo,
n2.anioTPP,
n2.anioPYG,
n2.mesPres,
n2.anioPres
from #DWHMonitorConsolidadoMargenV2  n4 
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3
and n3.nivel=4 and n4.nivel=5

union all

-- Valor Deduccion Nivel 2

select distinct
Jerarquia=1,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=null,
NombreN2='Deducción',
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n2.diaPart*-1,
n2.diaSaldo*-1,
n2.diaTPP*-1,
n2.diaPYG*-1,
n2.mesPart*-1,
n2.mesSaldo*-1,
n2.mesTPP*-1,
n2.mesPYG*-1,
n2.anioPart*-1,
n2.anioSaldo*-1,
n2.anioTPP*-1,
n2.anioPYG*-1,
n2.mesPres*-1,
n2.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n4 
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3
and n3.nivel=4 and n4.nivel=5

union all

-- Valor Nivel 1

select distinct
Jerarquia=1,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=null,
NombreN2=null,
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n1.diaPart,
n1.diaSaldo,
n1.diaTPP,
n1.diaPYG,
n1.mesPart,
n1.mesSaldo,
n1.mesTPP,
n1.mesPYG,
n1.anioPart,
n1.anioSaldo,
n1.anioTPP,
n1.anioPYG,
n1.mesPres,
n1.anioPres
from #DWHMonitorConsolidadoMargenV2  n4 
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3
and n3.nivel=4 and n4.nivel=5

Union all


------------------------
-- Tinen solo 5 niveles
------------------------

select distinct
Jerarquia=5,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=n4.codigo,
NombreN4=n4.nombre,
CodigoN5=n5.codigo,
NombreN5=n5.nombre,
n5.diaPart,
n5.diaSaldo,
n5.diaTPP,
n5.diaPYG,
n5.mesPart,
n5.mesSaldo,
n5.mesTPP,
n5.mesPYG,
n5.anioPart,
n5.anioSaldo,
n5.anioTPP,
n5.anioPYG,
n5.mesPres,
n5.anioPres
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6


union all

-- valor deduccion nivel5


select distinct
Jerarquia=4,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=n4.codigo,
NombreN4=n4.nombre,
CodigoN5=null,
NombreN5='Deducción',
n5.diaPart*-1,
n5.diaSaldo*-1,
n5.diaTPP*-1,
n5.diaPYG*-1,
n5.mesPart*-1,
n5.mesSaldo*-1,
n5.mesTPP*-1,
n5.mesPYG*-1,
n5.anioPart*-1,
n5.anioSaldo*-1,
n5.anioTPP*-1,
n5.anioPYG*-1,
n5.mesPres*-1,
n5.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6

union all

-- nivel4


select distinct
Jerarquia=4,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=n4.codigo,
NombreN4=n4.nombre,
CodigoN5=null,
NombreN5=null,
n4.diaPart,
n4.diaSaldo,
n4.diaTPP,
n4.diaPYG,
n4.mesPart,
n4.mesSaldo,
n4.mesTPP,
n4.mesPYG,
n4.anioPart,
n4.anioSaldo,
n4.anioTPP,
n4.anioPYG,
n4.mesPres,
n4.anioPres
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6




union all
-- valor deduccion nivel4


select distinct
Jerarquia=3,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=null,
NombreN4='Deducción',
CodigoN5=null,
NombreN5=null,
n4.diaPart*-1,
n4.diaSaldo*-1,
n4.diaTPP*-1,
n4.diaPYG*-1,
n4.mesPart*-1,
n4.mesSaldo*-1,
n4.mesTPP*-1,
n4.mesPYG*-1,
n4.anioPart*-1,
n4.anioSaldo*-1,
n4.anioTPP*-1,
n4.anioPYG*-1,
n4.mesPres*-1,
n4.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6


union all

-- Valor Nivel 3

select distinct
Jerarquia=3,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n3.diaPart,
n3.diaSaldo,
n3.diaTPP,
n3.diaPYG,
n3.mesPart,
n3.mesSaldo,
n3.mesTPP,
n3.mesPYG,
n3.anioPart,
n3.anioSaldo,
n3.anioTPP,
n3.anioPYG,
n3.mesPres,
n3.anioPres
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6

union all

-- Valor Deduccion Nivel 3

select distinct
Jerarquia=2,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=null,
NombreN3='Deducción',
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n3.diaPart*-1,
n3.diaSaldo*-1,
n3.diaTPP*-1,
n3.diaPYG*-1,
n3.mesPart*-1,
n3.mesSaldo*-1,
n3.mesTPP*-1,
n3.mesPYG*-1,
n3.anioPart*-1,
n3.anioSaldo*-1,
n3.anioTPP*-1,
n3.anioPYG*-1,
n3.mesPres*-1,
n3.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6


union all
-- Valor Nivel 2

select distinct
Jerarquia=2,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n2.diaPart,
n2.diaSaldo,
n2.diaTPP,
n2.diaPYG,
n2.mesPart,
n2.mesSaldo,
n2.mesTPP,
n2.mesPYG,
n2.anioPart,
n2.anioSaldo,
n2.anioTPP,
n2.anioPYG,
n2.mesPres,
n2.anioPres
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6


union all

-- Valor Deduccion Nivel 2

select distinct
Jerarquia=1,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=null,
NombreN2='Deducción',
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n2.diaPart*-1,
n2.diaSaldo*-1,
n2.diaTPP*-1,
n2.diaPYG*-1,
n2.mesPart*-1,
n2.mesSaldo*-1,
n2.mesTPP*-1,
n2.mesPYG*-1,
n2.anioPart*-1,
n2.anioSaldo*-1,
n2.anioTPP*-1,
n2.anioPYG*-1,
n2.mesPres*-1,
n2.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6


union all

-- Valor Nivel 1

select distinct
Jerarquia=1,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=null,
NombreN2=null,
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n1.diaPart,
n1.diaSaldo,
n1.diaTPP,
n1.diaPYG,
n1.mesPart,
n1.mesSaldo,
n1.mesTPP,
n1.mesPYG,
n1.anioPart,
n1.anioSaldo,
n1.anioTPP,
n1.anioPYG,
n1.mesPres,
n1.anioPres
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6



) as Margen 

order by 
CodigoN1,
CodigoN2,
CodigoN3,
CodigoN4,
CodigoN5&lt;/RSQueryCommandText&gt;&lt;RSQueryCommandType&gt;Text&lt;/RSQueryCommandType&gt;&lt;RSQueryDesignState&gt;&lt;/RSQueryDesignState&gt;]]&gt;&lt;/AnnotationContent&gt;&lt;/Gemini&gt;</Value>
            </Annotation>
            <Annotation>
              <Name>IsQueryEditorUsed</Name>
              <Value>True</Value>
            </Annotation>
          </Annotations>
          <Source xsi:type="DataSourceViewBinding">
            <DataSourceViewID>Sandbox</DataSourceViewID>
          </Source>
          <UnknownMember valuens="ddl200_200">AutomaticNull</UnknownMember>
          <ErrorConfiguration>
            <KeyNotFound>IgnoreError</KeyNotFound>
            <KeyDuplicate>ReportAndStop</KeyDuplicate>
            <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
          </ErrorConfiguration>
          <StorageMode valuens="ddl200_200">InMemory</StorageMode>
          <Language>2058</Language>
          <UnknownMemberName>Unknown</UnknownMemberName>
          <Attributes>
            <Attribute>
              <ID>__XL_RowNumber</ID>
              <Name>__XL_RowNumber</Name>
              <Type valuens="ddl200_200">RowNumber</Type>
              <Usage>Key</Usage>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>4</DataSize>
                  <NullProcessing>Error</NullProcessing>
                  <Source xsi:type="ddl200_200:RowNumberBinding" />
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>4</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <Source xsi:type="ddl200_200:RowNumberBinding" />
              </NameColumn>
              <AttributeRelationships>
                <AttributeRelationship>
                  <AttributeID>Jerarquia</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Jerarquia</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Agrupacion</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Agrupacion</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>CodigoN1</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodigoN1</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>DescripcionN1</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>DescripcionN1</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>CodigoN2</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodigoN2</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>DescripcionN2</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>DescripcionN2</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>CodigoN3</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodigoN3</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>DescripcionN3</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>DescripcionN3</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>CodigoN4</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodigoN4</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>DescripcionN4</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>DescripcionN4</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>CodigoN5</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodigoN5</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>diaPart</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>diaPart</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>diaSaldo</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>diaSaldo</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>diaTPP</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>diaTPP</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>diaPYG</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>diaPYG</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>mesPart</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>mesPart</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>mesSaldo</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>mesSaldo</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>mesTPP</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>mesTPP</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>mesPYG</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>mesPYG</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>anioPart</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>anioPart</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>anioSaldo</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>anioSaldo</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>anioTPP</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>anioTPP</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>anioPYG</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>anioPYG</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>mesPres</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>mesPres</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>anioPres</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>anioPres</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>DescripcionN5</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>DescripcionN5</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>CodigoSeccion</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodigoSeccion</Name>
                </AttributeRelationship>
              </AttributeRelationships>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Jerarquia</ID>
              <Name>Jerarquia</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>Jerarquia</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>Jerarquia</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Agrupacion</ID>
              <Name>Agrupacion</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>Agrupacion</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>Agrupacion</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>CodigoN1</ID>
              <Name>CodigoN1</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>CodigoN1</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>CodigoN1</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>DescripcionN1</ID>
              <Name>DescripcionN1</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>DescripcionN1</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>DescripcionN1</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>CodigoN2</ID>
              <Name>CodigoN2</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>CodigoN2</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>CodigoN2</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>DescripcionN2</ID>
              <Name>DescripcionN2</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>DescripcionN2</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>DescripcionN2</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>CodigoN3</ID>
              <Name>CodigoN3</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>CodigoN3</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>CodigoN3</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>DescripcionN3</ID>
              <Name>DescripcionN3</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>DescripcionN3</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>DescripcionN3</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>CodigoN4</ID>
              <Name>CodigoN4</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>CodigoN4</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>CodigoN4</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>DescripcionN4</ID>
              <Name>DescripcionN4</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>DescripcionN4</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>DescripcionN4</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>CodigoN5</ID>
              <Name>CodigoN5</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>CodigoN5</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>CodigoN5</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>diaPart</ID>
              <Name>diaPart</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>diaPart</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>diaPart</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>diaSaldo</ID>
              <Name>diaSaldo</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>diaSaldo</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>diaSaldo</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>diaTPP</ID>
              <Name>diaTPP</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>diaTPP</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>diaTPP</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>diaPYG</ID>
              <Name>diaPYG</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>diaPYG</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>diaPYG</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>mesPart</ID>
              <Name>mesPart</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>mesPart</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>mesPart</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>mesSaldo</ID>
              <Name>mesSaldo</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>mesSaldo</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>mesSaldo</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>mesTPP</ID>
              <Name>mesTPP</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>mesTPP</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>mesTPP</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>mesPYG</ID>
              <Name>mesPYG</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>mesPYG</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>mesPYG</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>anioPart</ID>
              <Name>anioPart</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>anioPart</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>anioPart</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>anioSaldo</ID>
              <Name>anioSaldo</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>anioSaldo</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>anioSaldo</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>anioTPP</ID>
              <Name>anioTPP</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>anioTPP</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>anioTPP</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>anioPYG</ID>
              <Name>anioPYG</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>anioPYG</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>anioPYG</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>mesPres</ID>
              <Name>mesPres</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>mesPres</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>mesPres</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>anioPres</ID>
              <Name>anioPres</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>anioPres</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>anioPres</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <ID>DescripcionN5</ID>
              <Name>DescripcionN5</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    <ColumnID>DescripcionN5</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                  <ColumnID>DescripcionN5</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>CodigoSeccion</ID>
              <Name>CodigoSeccion</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>IF(MargenFinanciero[CodigoN1]=101000000,1,
    IF(MargenFinanciero[CodigoN1]=102000000,2,
      IF(MargenFinanciero[CodigoN1]=103000000,3,
         IF(MargenFinanciero[CodigoN1]=104000000,4,
             IF(MargenFinanciero[CodigoN1]=105000000,5,
                 IF(MargenFinanciero[CodigoN1]=200000000,6,
                     IF(MargenFinanciero[CodigoN1]=201000000,7,
                         IF(MargenFinanciero[CodigoN1]=202000000 ||  MargenFinanciero[CodigoN1]=203000000 ,8,
                             IF(MargenFinanciero[CodigoN1]=204000000 ||  MargenFinanciero[CodigoN1]=205000000 ||  MargenFinanciero[CodigoN1]=206000000 ,9,
                                   IF(MargenFinanciero[CodigoN1]=300000000 ||  MargenFinanciero[CodigoN1]=300000001 ||  MargenFinanciero[CodigoN1]=300000003 ,10,99))))))))))
</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>IF(MargenFinanciero[CodigoN1]=101000000,1,
    IF(MargenFinanciero[CodigoN1]=102000000,2,
      IF(MargenFinanciero[CodigoN1]=103000000,3,
         IF(MargenFinanciero[CodigoN1]=104000000,4,
             IF(MargenFinanciero[CodigoN1]=105000000,5,
                 IF(MargenFinanciero[CodigoN1]=200000000,6,
                     IF(MargenFinanciero[CodigoN1]=201000000,7,
                         IF(MargenFinanciero[CodigoN1]=202000000 ||  MargenFinanciero[CodigoN1]=203000000 ,8,
                             IF(MargenFinanciero[CodigoN1]=204000000 ||  MargenFinanciero[CodigoN1]=205000000 ||  MargenFinanciero[CodigoN1]=206000000 ,9,
                                   IF(MargenFinanciero[CodigoN1]=300000000 ||  MargenFinanciero[CodigoN1]=300000001 ||  MargenFinanciero[CodigoN1]=300000003 ,10,99))))))))))
</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
          </Attributes>
          <Hierarchies>
            <Hierarchy>
              <ID>Niveles</ID>
              <Name>Niveles</Name>
              <Levels>
                <Level>
                  <ID>CodigoN1</ID>
                  <Name>CodigoN1</Name>
                  <SourceAttributeID>CodigoN1</SourceAttributeID>
                </Level>
                <Level>
                  <ID>DescripcionN1</ID>
                  <Name>DescripcionN1</Name>
                  <SourceAttributeID>DescripcionN1</SourceAttributeID>
                </Level>
                <Level>
                  <ID>CodigoN2</ID>
                  <Name>CodigoN2</Name>
                  <SourceAttributeID>CodigoN2</SourceAttributeID>
                </Level>
                <Level>
                  <ID>DescripcionN2</ID>
                  <Name>DescripcionN2</Name>
                  <SourceAttributeID>DescripcionN2</SourceAttributeID>
                </Level>
                <Level>
                  <ID>DescripcionN3</ID>
                  <Name>DescripcionN3</Name>
                  <SourceAttributeID>DescripcionN3</SourceAttributeID>
                </Level>
                <Level>
                  <ID>DescripcionN4</ID>
                  <Name>DescripcionN4</Name>
                  <SourceAttributeID>DescripcionN4</SourceAttributeID>
                </Level>
                <Level>
                  <ID>DescripcionN5</ID>
                  <Name>DescripcionN5</Name>
                  <SourceAttributeID>DescripcionN5</SourceAttributeID>
                </Level>
              </Levels>
            </Hierarchy>
          </Hierarchies>
          <ProactiveCaching>
            <SilenceInterval>-PT1S</SilenceInterval>
            <Latency>-PT1S</Latency>
            <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
            <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
            <Source xsi:type="ProactiveCachingInheritedBinding" />
          </ProactiveCaching>
        </Dimension>
        <Dimension>
          <ID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</ID>
          <Name>IndicadoresTasaMargen</Name>
          <Annotations>
            <Annotation>
              <Name>TableWidgetSerialization</Name>
            </Annotation>
            <Annotation>
              <Name>QueryEditorSerialization</Name>
              <Value>&lt;?xml version="1.0" encoding="UTF-16"?&gt;&lt;Gemini xmlns="QueryEditorSerialization"&gt;&lt;AnnotationContent&gt;&lt;![CDATA[&lt;RSQueryCommandText&gt;declare @fechaActual int
select @fechaActual = feidfecha from DWDFecha where feDiaActual = 1

if object_id('[tempdb]..#tmFecha') is not null
begin
drop table #tmFecha
end

select  ROW_NUMBER() OVER(ORDER BY tmFecha DESC) AS Row#,
tmFecha,
tmbandera=0
into #tmFecha
from (
select 
distinct top 90 tmFecha from DWHIndicadorTasaMargen
where tmFecha &lt;= @fechaActual
order by tmFecha desc ) a
update x
set
tmbandera = 1
 from #tmFecha x
inner join DWDFecha on tmFecha = feIdFecha
where feCierreMesTodosAnios = 1
update x
set
tmbandera = 1
 from #tmFecha x
inner join DWDFecha on tmFecha = feIdFechaHaceUnMesLab
where fediaactual = 1
update x
set
tmbandera = 2
 from #tmFecha x
where 
Row# = 1
update x
set
tmbandera = 3
 from #tmFecha x
where 
Row# = 2
update x
set
tmbandera = 4
 from #tmFecha x
where 
Row# = 3
--select * from #tmFecha

declare @fechaAtrasAño int

select @fechaAtrasAño= tmFecha from #tmFecha where Row# = 90

select 

Agrupacion,
MargenIndicadores.tmFecha,
tmCodigoIndicador,
tmDescripcion,
tmTPPdia,
TotalTPPdia,
tmTPPmes,
TotalTPPmes,
tmTPPtrimestre,
TotalTPPtrimestre,
tmTPPanio,
TotalTPPanio,
tmSaldoDiario,
TotalSaldoDiario,
a.tmbandera
from 
(
-------------------
-- Captaciones 
-------------------
select 
Agrupacion='Captaciones',

pr.tmFecha,
pr.tmCodigoIndicador,
tmDescripcion=
case pr.tmCodigoIndicador when 6 then 'Monetarios'
        when 7 then 'Ahorros'
        when 29 then 'Plazo' end,

pr.tmTPPdia,
t.tmTPPdia as TotalTPPdia,

pr.tmTPPmes,
t.tmTPPmes as TotalTPPmes,

pr.tmTPPtrimestre,
t.tmTPPtrimestre as TotalTPPtrimestre,

pr.tmTPPanio,
t.tmTPPanio as TotalTPPanio,

pr.tmSaldoDiario,
t.tmSaldoDiario as TotalSaldoDiario

from DWHIndicadorTasaMargen pr , DWHIndicadorTasaMargen t
where pr.tmCodigoIndicador in (6,7,29)
and t.tmCodigoIndicador=2
and pr.tmFecha=t.tmFecha
and pr.tmFecha&gt;=@fechaAtrasAño


Union

--Total

select 
Agrupacion='Captaciones',
tmFecha,
tmCodigoIndicador,
tmDescripcion='Total',

tmTPPdia,
TotalTPPdia=0,

tmTPPmes,
TotalTPPmes=0,

tmTPPtrimestre,
TotalTPPtrimestre=0,

tmTPPanio,
TotalTPPanio=0,

tmSaldoDiario,
TotalSaldoDiario=0

from DWHIndicadorTasaMargen
where tmCodigoIndicador in (2)
and tmFecha&gt;=@fechaAtrasAño


Union

-------------------
-- Cartera  
-------------------

select 

Agrupacion='Cartera',

pr.tmFecha,
pr.tmCodigoIndicador,
pr.tmDescripcion,

pr.tmTPPdia,
t.tmTPPdia as TotalTPPdia,

pr.tmTPPmes,
t.tmTPPmes as TotalTPPmes,

pr.tmTPPtrimestre,
t.tmTPPtrimestre as TotalTPPtrimestre,

pr.tmTPPanio,
t.tmTPPanio as TotalTPPanio,

pr.tmSaldoDiario,
t.tmSaldoDiario as TotalSaldoDiario

from DWHIndicadorTasaMargen pr , DWHIndicadorTasaMargen t
where pr.tmCodigoIndicador in (94,95,96)
and t.tmCodigoIndicador=1
and pr.tmFecha=t.tmFecha
and pr.tmFecha&gt;=@fechaAtrasAño


Union

--Total

select 

Agrupacion='Cartera',

tmFecha,
tmCodigoIndicador,
tmDescripcion='Total',

tmTPPdia,
TotalTPPdia=0,

tmTPPmes,
TotalTPPmes=0,

tmTPPtrimestre,
TotalTPPtrimestre=0,

tmTPPanio,
TotalTPPanio=0,

tmSaldoDiario,
TotalSaldoDiario=0

from DWHIndicadorTasaMargen
where tmCodigoIndicador in (1)
and tmFecha&gt;=@fechaAtrasAño

) as MargenIndicadores 
inner join #tmFecha a on a.tmFecha = MargenIndicadores.tmFecha
order by tmFecha&lt;/RSQueryCommandText&gt;&lt;RSQueryCommandType&gt;Text&lt;/RSQueryCommandType&gt;&lt;RSQueryDesignState&gt;&lt;/RSQueryDesignState&gt;]]&gt;&lt;/AnnotationContent&gt;&lt;/Gemini&gt;</Value>
            </Annotation>
            <Annotation>
              <Name>IsQueryEditorUsed</Name>
              <Value>True</Value>
            </Annotation>
          </Annotations>
          <Source xsi:type="DataSourceViewBinding">
            <DataSourceViewID>Sandbox</DataSourceViewID>
          </Source>
          <UnknownMember valuens="ddl200_200">AutomaticNull</UnknownMember>
          <ErrorConfiguration>
            <KeyNotFound>IgnoreError</KeyNotFound>
            <KeyDuplicate>ReportAndStop</KeyDuplicate>
            <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
          </ErrorConfiguration>
          <StorageMode valuens="ddl200_200">InMemory</StorageMode>
          <Language>2058</Language>
          <UnknownMemberName>Unknown</UnknownMemberName>
          <Attributes>
            <Attribute>
              <ID>__XL_RowNumber</ID>
              <Name>__XL_RowNumber</Name>
              <Type valuens="ddl200_200">RowNumber</Type>
              <Usage>Key</Usage>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>4</DataSize>
                  <NullProcessing>Error</NullProcessing>
                  <Source xsi:type="ddl200_200:RowNumberBinding" />
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>4</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <Source xsi:type="ddl200_200:RowNumberBinding" />
              </NameColumn>
              <AttributeRelationships>
                <AttributeRelationship>
                  <AttributeID>Agrupacion</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Agrupacion</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>tmFecha</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>tmFecha</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>tmCodigoIndicador</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>tmCodigoIndicador</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>tmDescripcion</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>tmDescripcion</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>tmTPPdia</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>tmTPPdia</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>TotalTPPdia</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>TotalTPPdia</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>tmTPPmes</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>tmTPPmes</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>TotalTPPmes</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>TotalTPPmes</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>tmTPPtrimestre</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>tmTPPtrimestre</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>TotalTPPtrimestre</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>TotalTPPtrimestre</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>tmTPPanio</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>tmTPPanio</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>TotalTPPanio</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>TotalTPPanio</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>tmSaldoDiario</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>tmSaldoDiario</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>TotalSaldoDiario</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>TotalSaldoDiario</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Orden</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Orden</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Calculated Column 1</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Slicer</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Slicer_Agrupacion</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Slicer_Agrupacion</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>DescripcionCabecera</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>DescripcionCabecera</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>tmbandera</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>tmbandera</Name>
                </AttributeRelationship>
              </AttributeRelationships>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Agrupacion</ID>
              <Name>Agrupacion</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                    <ColumnID>Agrupacion</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                  <ColumnID>Agrupacion</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>tmFecha</ID>
              <Name>tmFecha</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                    <ColumnID>tmFecha</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                  <ColumnID>tmFecha</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>tmCodigoIndicador</ID>
              <Name>tmCodigoIndicador</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                    <ColumnID>tmCodigoIndicador</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                  <ColumnID>tmCodigoIndicador</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>tmDescripcion</ID>
              <Name>tmDescripcion</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                    <ColumnID>tmDescripcion</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                  <ColumnID>tmDescripcion</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>tmTPPdia</ID>
              <Name>tmTPPdia</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                    <ColumnID>tmTPPdia</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                  <ColumnID>tmTPPdia</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>TotalTPPdia</ID>
              <Name>TotalTPPdia</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                    <ColumnID>TotalTPPdia</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                  <ColumnID>TotalTPPdia</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>tmTPPmes</ID>
              <Name>tmTPPmes</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                    <ColumnID>tmTPPmes</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                  <ColumnID>tmTPPmes</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>TotalTPPmes</ID>
              <Name>TotalTPPmes</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                    <ColumnID>TotalTPPmes</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                  <ColumnID>TotalTPPmes</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>tmTPPtrimestre</ID>
              <Name>tmTPPtrimestre</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                    <ColumnID>tmTPPtrimestre</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                  <ColumnID>tmTPPtrimestre</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>TotalTPPtrimestre</ID>
              <Name>TotalTPPtrimestre</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                    <ColumnID>TotalTPPtrimestre</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                  <ColumnID>TotalTPPtrimestre</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>tmTPPanio</ID>
              <Name>tmTPPanio</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                    <ColumnID>tmTPPanio</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                  <ColumnID>tmTPPanio</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>TotalTPPanio</ID>
              <Name>TotalTPPanio</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                    <ColumnID>TotalTPPanio</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                  <ColumnID>TotalTPPanio</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>tmSaldoDiario</ID>
              <Name>tmSaldoDiario</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                    <ColumnID>tmSaldoDiario</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                  <ColumnID>tmSaldoDiario</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>TotalSaldoDiario</ID>
              <Name>TotalSaldoDiario</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                    <ColumnID>TotalSaldoDiario</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                  <ColumnID>TotalSaldoDiario</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Orden</ID>
              <Name>Orden</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>SWITCH([tmDescripcion],"Total",1,"Comercial + Micro",2,"Consumo",3,"Vivienda",4,"Monetarios",5,"Ahorros",6,7)</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>SWITCH([tmDescripcion],"Total",1,"Comercial + Micro",2,"Consumo",3,"Vivienda",4,"Monetarios",5,"Ahorros",6,7)</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Calculated Column 1</ID>
              <Name>Slicer</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>SWITCH([tmDescripcion],"Total","HTOTALH","Comercial + Micro","HCOMMICROH","Consumo","HCONSUMOH","Vivienda","HVIVIENDAH","Monetarios","HMONETARIOSH","Ahorros","HAHORROSH","HPLAZOSH")</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>SWITCH([tmDescripcion],"Total","HTOTALH","Comercial + Micro","HCOMMICROH","Consumo","HCONSUMOH","Vivienda","HVIVIENDAH","Monetarios","HMONETARIOSH","Ahorros","HAHORROSH","HPLAZOSH")</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Slicer_Agrupacion</ID>
              <Name>Slicer_Agrupacion</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>IF(IndicadoresTasaMargen[Agrupacion]="Captaciones","XCAPTACIONESX","XCARTERAX")</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>IF(IndicadoresTasaMargen[Agrupacion]="Captaciones","XCAPTACIONESX","XCARTERAX")</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>DescripcionCabecera</ID>
              <Name>DescripcionCabecera</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>if(IndicadoresTasaMargen[Agrupacion]="Cartera" &amp;&amp; IndicadoresTasaMargen[tmDescripcion]="Total","CARTERA DE CREDITOS X VENCER",
  if(IndicadoresTasaMargen[tmDescripcion]="Comercial + Micro" || IndicadoresTasaMargen[tmDescripcion]="Consumo" || IndicadoresTasaMargen[tmDescripcion]="Vivienda",IndicadoresTasaMargen[tmDescripcion]&amp; " x Vencer",
  if(IndicadoresTasaMargen[Agrupacion]="Captaciones" &amp;&amp; IndicadoresTasaMargen[tmDescripcion]="Total","CAPTACIONES TOTAL",IndicadoresTasaMargen[tmDescripcion])))</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>if(IndicadoresTasaMargen[Agrupacion]="Cartera" &amp;&amp; IndicadoresTasaMargen[tmDescripcion]="Total","CARTERA DE CREDITOS X VENCER",
  if(IndicadoresTasaMargen[tmDescripcion]="Comercial + Micro" || IndicadoresTasaMargen[tmDescripcion]="Consumo" || IndicadoresTasaMargen[tmDescripcion]="Vivienda",IndicadoresTasaMargen[tmDescripcion]&amp; " x Vencer",
  if(IndicadoresTasaMargen[Agrupacion]="Captaciones" &amp;&amp; IndicadoresTasaMargen[tmDescripcion]="Total","CAPTACIONES TOTAL",IndicadoresTasaMargen[tmDescripcion])))</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <ID>tmbandera</ID>
              <Name>tmbandera</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                    <ColumnID>tmbandera</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                  <ColumnID>tmbandera</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
          </Attributes>
          <ProactiveCaching>
            <SilenceInterval>-PT1S</SilenceInterval>
            <Latency>-PT1S</Latency>
            <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
            <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
            <Source xsi:type="ProactiveCachingInheritedBinding" />
          </ProactiveCaching>
          <ddl300_300:Relationships>
            <ddl300_300:Relationship>
              <ID>ceac72eb-4a3c-4b6d-9e74-8b41dfd49fb8</ID>
              <ddl300_300:FromRelationshipEnd>
                <ddl300_300:Multiplicity>Many</ddl300_300:Multiplicity>
                <ddl300:VisualizationProperties />
                <DimensionID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</DimensionID>
                <Attributes>
                  <Attribute>
                    <AttributeID>tmFecha</AttributeID>
                  </Attribute>
                </Attributes>
              </ddl300_300:FromRelationshipEnd>
              <ddl300_300:ToRelationshipEnd>
                <ddl300_300:Multiplicity>One</ddl300_300:Multiplicity>
                <ddl300:VisualizationProperties />
                <DimensionID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</DimensionID>
                <Attributes>
                  <Attribute>
                    <AttributeID>feIdFecha</AttributeID>
                  </Attribute>
                </Attributes>
              </ddl300_300:ToRelationshipEnd>
            </ddl300_300:Relationship>
          </ddl300_300:Relationships>
        </Dimension>
        <Dimension>
          <ID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</ID>
          <Name>Fecha</Name>
          <Annotations>
            <Annotation>
              <Name>TableWidgetSerialization</Name>
              <Value>&lt;?xml version="1.0" encoding="UTF-16"?&gt;&lt;Gemini xmlns="TableWidgetSerialization"&gt;&lt;AnnotationContent&gt;&lt;![CDATA[&lt;?xml version="1.0"?&gt;
&lt;TableWidgetGridSerialization xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;ColumnSuggestedType /&gt;
  &lt;ColumnFormat /&gt;
  &lt;ColumnAccuracy /&gt;
  &lt;ColumnCurrencySymbol /&gt;
  &lt;ColumnPositivePattern /&gt;
  &lt;ColumnNegativePattern /&gt;
  &lt;ColumnWidths&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feIdFecha&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;79&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFechaCodigoAlt&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;115&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFecha&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;69&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feDescripcionFecha&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;123&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCalAnio&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;76&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCalMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;74&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCalDia&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;70&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCalDiaAnio&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;91&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feTrimNumero&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;97&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feTrimMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;79&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feTrimDia&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;75&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCopaCodigo&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;98&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCopaMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;84&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCopaDia&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;80&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFeriado&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;76&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFeriadoNombre&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;113&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feTemporada&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;94&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCierreMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;88&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFinMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;73&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFinSemana&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;92&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFutura&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;72&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feDiasReplicarProximos&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;141&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feDiasReplicarAnteriores&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;148&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;EsDiaAnterior&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;95&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;fecIdAnterior&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;94&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;EsCierreAño&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;89&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feMesAntCierr&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;99&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feAnioAntCierr&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;101&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feIdFechaAnioAnt&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;117&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feIdFechaCierreAnioAnt&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;146&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFechaCierreAnio&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;119&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
  &lt;/ColumnWidths&gt;
  &lt;ColumnDisplayIndex&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feIdFecha&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;0&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFechaCodigoAlt&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;1&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFecha&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;2&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feDescripcionFecha&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;3&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCalAnio&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;4&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCalMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;5&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCalDia&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;6&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCalDiaAnio&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;7&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feTrimNumero&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;8&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feTrimMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;9&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feTrimDia&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;10&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCopaCodigo&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;11&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCopaMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;12&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCopaDia&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;13&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFeriado&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;14&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFeriadoNombre&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;15&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feTemporada&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;16&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCierreMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;17&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFinMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;18&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFinSemana&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;19&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFutura&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;20&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feDiasReplicarProximos&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;21&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feDiasReplicarAnteriores&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;22&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;EsDiaAnterior&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;23&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;fecIdAnterior&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;24&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;EsCierreAño&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;25&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feMesAntCierr&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;26&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feAnioAntCierr&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;27&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feIdFechaAnioAnt&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;28&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feIdFechaCierreAnioAnt&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;29&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFechaCierreAnio&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;30&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
  &lt;/ColumnDisplayIndex&gt;
  &lt;ColumnFrozen /&gt;
  &lt;ColumnChecked /&gt;
  &lt;ColumnFilter /&gt;
  &lt;SelectionFilter /&gt;
  &lt;FilterParameters /&gt;
  &lt;IsSortDescending&gt;false&lt;/IsSortDescending&gt;
&lt;/TableWidgetGridSerialization&gt;]]&gt;&lt;/AnnotationContent&gt;&lt;/Gemini&gt;</Value>
            </Annotation>
            <Annotation>
              <Name>QueryEditorSerialization</Name>
            </Annotation>
            <Annotation>
              <Name>IsQueryEditorUsed</Name>
              <Value>False</Value>
            </Annotation>
          </Annotations>
          <Source xsi:type="DataSourceViewBinding">
            <DataSourceViewID>Sandbox</DataSourceViewID>
          </Source>
          <UnknownMember valuens="ddl200_200">AutomaticNull</UnknownMember>
          <ErrorConfiguration>
            <KeyNotFound>IgnoreError</KeyNotFound>
            <KeyDuplicate>ReportAndStop</KeyDuplicate>
            <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
          </ErrorConfiguration>
          <StorageMode valuens="ddl200_200">InMemory</StorageMode>
          <Language>2058</Language>
          <UnknownMemberName>Unknown</UnknownMemberName>
          <Attributes>
            <Attribute>
              <ID>__XL_RowNumber</ID>
              <Name>__XL_RowNumber</Name>
              <Type valuens="ddl200_200">RowNumber</Type>
              <Usage>Key</Usage>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>4</DataSize>
                  <NullProcessing>Error</NullProcessing>
                  <Source xsi:type="ddl200_200:RowNumberBinding" />
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>4</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <Source xsi:type="ddl200_200:RowNumberBinding" />
              </NameColumn>
              <AttributeRelationships>
                <AttributeRelationship>
                  <AttributeID>feIdFecha</AttributeID>
                  <Cardinality>One</Cardinality>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feIdFecha</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feFechaCodigoAlt</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feFechaCodigoAlt</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feFecha</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feFecha</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feDescripcionFecha</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feDescripcionFecha</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feCalAnio</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feCalAnio</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feCalMes</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feCalMes</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feCalDia</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feCalDia</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feCalDiaAnio</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feCalDiaAnio</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feTrimNumero</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feTrimNumero</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feTrimMes</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feTrimMes</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feTrimDia</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feTrimDia</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feCopaCodigo</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feCopaCodigo</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feCopaMes</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feCopaMes</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feCopaDia</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feCopaDia</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feFeriado</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feFeriado</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feFeriadoNombre</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feFeriadoNombre</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feTemporada</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feTemporada</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feCierreMes</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feCierreMes</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feFinMes</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feFinMes</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feFinSemana</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feFinSemana</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feFutura</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feFutura</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feDiasReplicarProximos</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feDiasReplicarProximos</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feDiasReplicarAnteriores</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feDiasReplicarAnteriores</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>EsDiaAnterior</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>EsDiaAnterior</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>fecIdAnterior</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>fecIdAnterior</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>EsCierreAño</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>EsCierreAño</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feMesAntCierr</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feMesAntCierr</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feAnioAntCierr</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feAnioAntCierr</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feIdFechaAnioAnt</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feIdFechaAnioAnt</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feIdFechaCierreAnioAnt</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feIdFechaCierreAnioAnt</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>feFechaCierreAnio</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>feFechaCierreAnio</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>FechaFormato</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>FormatoFecha</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>FormatoFechaMesAnio</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>FechaNombreMesAnio</Name>
                </AttributeRelationship>
              </AttributeRelationships>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feIdFecha</ID>
              <Name>feIdFecha</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Error</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feIdFecha</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feIdFecha</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feFechaCodigoAlt</ID>
              <Name>feFechaCodigoAlt</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feFechaCodigoAlt</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feFechaCodigoAlt</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="DateTimeGeneral" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feFecha</ID>
              <Name>feFecha</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Date</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feFecha</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feFecha</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <ddl300_300:FormatString>General Date</ddl300_300:FormatString>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feDescripcionFecha</ID>
              <Name>feDescripcionFecha</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feDescripcionFecha</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feDescripcionFecha</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feCalAnio</ID>
              <Name>feCalAnio</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feCalAnio</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feCalAnio</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="NumberWhole" ThousandSeparator="True" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feCalMes</ID>
              <Name>feCalMes</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Currency</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feCalMes</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feCalMes</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <ddl300_300:FormatString>#,0</ddl300_300:FormatString>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feCalDia</ID>
              <Name>feCalDia</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feCalDia</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feCalDia</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feCalDiaAnio</ID>
              <Name>feCalDiaAnio</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feCalDiaAnio</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feCalDiaAnio</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feTrimNumero</ID>
              <Name>feTrimNumero</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feTrimNumero</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feTrimNumero</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feTrimMes</ID>
              <Name>feTrimMes</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feTrimMes</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feTrimMes</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feTrimDia</ID>
              <Name>feTrimDia</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feTrimDia</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feTrimDia</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feCopaCodigo</ID>
              <Name>feCopaCodigo</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feCopaCodigo</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feCopaCodigo</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feCopaMes</ID>
              <Name>feCopaMes</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feCopaMes</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feCopaMes</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feCopaDia</ID>
              <Name>feCopaDia</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feCopaDia</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feCopaDia</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Boolean" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feFeriado</ID>
              <Name>feFeriado</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Boolean</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feFeriado</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feFeriado</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
              <ddl300_300:FormatString>"TRUE";"TRUE";"FALSE"</ddl300_300:FormatString>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feFeriadoNombre</ID>
              <Name>feFeriadoNombre</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feFeriadoNombre</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feFeriadoNombre</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feTemporada</ID>
              <Name>feTemporada</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feTemporada</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feTemporada</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Boolean" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feCierreMes</ID>
              <Name>feCierreMes</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Boolean</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feCierreMes</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feCierreMes</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <ddl300_300:FormatString>"TRUE";"TRUE";"FALSE"</ddl300_300:FormatString>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Boolean" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feFinMes</ID>
              <Name>feFinMes</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Boolean</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feFinMes</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feFinMes</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
              <ddl300_300:FormatString>"TRUE";"TRUE";"FALSE"</ddl300_300:FormatString>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Boolean" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feFinSemana</ID>
              <Name>feFinSemana</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Boolean</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feFinSemana</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feFinSemana</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
              <ddl300_300:FormatString>"TRUE";"TRUE";"FALSE"</ddl300_300:FormatString>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Boolean" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feFutura</ID>
              <Name>feFutura</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Boolean</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feFutura</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feFutura</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
              <ddl300_300:FormatString>"TRUE";"TRUE";"FALSE"</ddl300_300:FormatString>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feDiasReplicarProximos</ID>
              <Name>feDiasReplicarProximos</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feDiasReplicarProximos</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feDiasReplicarProximos</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feDiasReplicarAnteriores</ID>
              <Name>feDiasReplicarAnteriores</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feDiasReplicarAnteriores</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feDiasReplicarAnteriores</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Boolean" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>EsDiaAnterior</ID>
              <Name>EsDiaAnterior</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Boolean</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>EsDiaAnterior</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>EsDiaAnterior</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
              <ddl300_300:FormatString>"TRUE";"TRUE";"FALSE"</ddl300_300:FormatString>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>fecIdAnterior</ID>
              <Name>fecIdAnterior</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>fecIdAnterior</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>fecIdAnterior</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Boolean" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>EsCierreAño</ID>
              <Name>EsCierreAño</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Boolean</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>EsCierreAño</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>EsCierreAño</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
              <ddl300_300:FormatString>"TRUE";"TRUE";"FALSE"</ddl300_300:FormatString>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feMesAntCierr</ID>
              <Name>feMesAntCierr</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feMesAntCierr</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feMesAntCierr</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feAnioAntCierr</ID>
              <Name>feAnioAntCierr</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feAnioAntCierr</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feAnioAntCierr</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feIdFechaAnioAnt</ID>
              <Name>feIdFechaAnioAnt</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feIdFechaAnioAnt</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feIdFechaAnioAnt</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feIdFechaCierreAnioAnt</ID>
              <Name>feIdFechaCierreAnioAnt</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feIdFechaCierreAnioAnt</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feIdFechaCierreAnioAnt</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="DateTimeGeneral" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>feFechaCierreAnio</ID>
              <Name>feFechaCierreAnio</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Date</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    <ColumnID>feFechaCierreAnio</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                  <ColumnID>feFechaCierreAnio</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
              <ddl300_300:FormatString>General Date</ddl300_300:FormatString>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>FechaFormato</ID>
              <Name>FormatoFecha</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>FORMAT(Fecha[feFecha],"Long Date")</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>FORMAT(Fecha[feFecha],"Long Date")</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>FormatoFechaMesAnio</ID>
              <Name>FechaNombreMesAnio</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>FORMAT(Fecha[feFecha],"dd/MMM/yyyy")</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>FORMAT(Fecha[feFecha],"dd/MMM/yyyy")</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
          </Attributes>
          <ProactiveCaching>
            <SilenceInterval>-PT1S</SilenceInterval>
            <Latency>-PT1S</Latency>
            <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
            <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
            <Source xsi:type="ProactiveCachingInheritedBinding" />
          </ProactiveCaching>
        </Dimension>
        <Dimension>
          <ID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</ID>
          <Name>ConsolidadoHojaPosicion</Name>
          <Annotations>
            <Annotation>
              <Name>TableWidgetSerialization</Name>
            </Annotation>
            <Annotation>
              <Name>QueryEditorSerialization</Name>
              <Value>&lt;?xml version="1.0" encoding="UTF-16"?&gt;&lt;Gemini xmlns="QueryEditorSerialization"&gt;&lt;AnnotationContent&gt;&lt;![CDATA[&lt;RSQueryCommandText&gt;SET NOCOUNT ON

declare @FechAct int, @FechaAyer int, @FechaMesAnt int, @FechaAnioAnt int,
 @CanalTit varchar(50),  @CanalAgrTit varchar(50), @DescripcionCartera varchar(50)

  
select @FechAct=max(feIdFecha) from DWDFecha
where feDiaActual=1--feCierreMes=1 and feIdFecha&lt;=cast(convert(varchar(10),getdate(),112) as int)

select
@FechAct=max(feIdFecha)  
from  DWDFecha
where feIdFecha&lt;=@FechAct
and feFinSemana&lt;&gt;1
and feFeriado&lt;&gt;1

-- quitar esto comentarios
select
@FechaAyer=fecIdAnterior,
@FechaMesAnt=feMesAntCierr,
@FechaAnioAnt=feAnioAntCierr
from  DWDFecha
where feIdFecha=@FechAct


/* ----------------- */
/* Desencriptacion   */
/* ----------------- */


OPEN SYMMETRIC KEY ClaveMIS02
DECRYPTION BY CERTIFICATE Certi01

-- ActivoOperacion

if object_id('[tempdb]..#DWHActivoOperacion') is not null
begin
 drop table #DWHActivoOperacion
end

select 
aoIdFecha,
aoIdAgencia,
aoIdAsesorPrincipal,
aoIdAsesorSecundario,
aoIdCliente,
aoIdCuentaContable,
aoIdProducto,
aoIdMoneda,
aoIdEstadoOperacion,
aoIdEstadoCredito,
aoIdFechaCarga,
aoIdFechaConcesion,
aoIdFechaVencimiento,
aoIdCalificacionOperacionCliente,
aoIdLegalOperacionCliente,
aoRangoMontoUVC,
aoRangoTasaInteres,
aoRangoMorosidad,
aoRangoOperacion,
aoCotizaUVC,
aoOperaciones,
aoDiasOperacion,
aoDiasVencidoPorVencer,
aoTasaEfectiva,
aoTasaInteres,
aoTasaNominal,
aoTasaComision,
aoTasaPonderada,
aoMontoCapitalDolares,
aoMontoSaldoDolar,
aoMontoInteresDolares,
aoMontoTotalDolar,
aoMontoInteresNoDevengaDolar,
aoMontoInteresMoraDolar,
aoPlazoOperacion,
aoNumeroOperacion=cast(CONVERT(varchar(20), DecryptByKey(aoNumeroOperacion)) as float)--,
--aoNumeroOperacion2=cast(CONVERT(varchar(20), DecryptByKey(aoNumeroOperacion2)) as float)
into #DWHActivoOperacion
from DWHActivoOperacion
where aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
--and aoIdCliente in (182219,319128)



-- PasivoOperacion

if object_id('[tempdb]..#DWHPasivoOperacion') is not null
begin
 drop table #DWHPasivoOperacion
end

select 
poIdFecha,
poIdProducto,
poIdMoneda,
poIdAgencia,
poIdAsesor,
poIdCliente,
poIdCuentaContable,
poIdEstadoDeposito,
poIdEstadoOperacion,
poNumeroDeOperaciones,
poPlazoOperacion,
poSaldoOperacion,
poSaldoOperacionUSD,
poSaldoDisponible,
poSaldoDisponibleUSD,
poSaldoPromedioDisponible,
poSaldoTotal,
poTasaEfectiva,
poTasaNominal,
poFechaVencimiento,
poIdCalificacionOperacionCliente,
poIdLegalOperacionCliente,
poNoOperacion=cast(CONVERT(varchar(20), DecryptByKey(poNoOperacion)) as float)
into #DWHPasivoOperacion
from DWHPasivoOperacion
where poIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
--and poIdCliente in (182219,319128)


-- DWHCuotaOperacion

if object_id('[tempdb]..#DWHCuotaOperacion') is not null
begin
 drop table #DWHCuotaOperacion
end

select 
coIdFecha,
coIdAgencia,
coIdAsesorPrincipal,
coIdAsesorSecundario,
coIdCliente,
coIdCuentaContable,
coIdProducto,
coIdMoneda,
coIdEstadoOperacion,
coIdFechaCarga,
coIdFechaConcesion,
coIdFechaVencimiento,
coIdCalificacionOperacionCliente,
coIdLegalOperacionCliente,
coRangoMontoUVC,
coRangoTasaInteres,
coRangoMorosidad,
coRangoOperacion,
coCotizaUVC,
coOperaciones,
coDiasOperacion,
coDiasVencidoPorVencer,
coTasaInteres,
coCuotaCapital,
coValorInteresCuota,
coCuotaCapitalPagado,
coValorInteresCuotaPagado,
coMontoInteresNoDevengaDolares,
coInteresMoraPagado,
coInteresAcruadoMora,
coNumeroOperacion=cast(CONVERT(varchar(20), DecryptByKey(coNumeroOperacion)) as float)
into #DWHCuotaOperacion
from DWHCuotaOperacion
where coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
--and coIdCliente in (182219,319128)

-- DWDTitularizadaOperacion

if object_id('[tempdb]..#DWDTitularizadaOperacion') is not null
begin
 drop table #DWDTitularizadaOperacion
end
 
select top 0
toNombre,
toCedula=CONVERT(varchar(15), DecryptByKey(toCedula)),
toOperacion=CONVERT(varchar(9), DecryptByKey(toOperacion))
into #DWDTitularizadaOperacion
from DWDTitularizadaOperacion


CLOSE SYMMETRIC KEY ClaveMIS02


--&gt;&gt; CARTERA &lt;&lt;--

select @DescripcionCartera=max(ccFamiliaProducto)
from DWDCuentaContable
inner join (  
    SELECT DISTINCT 
    p2.CpCodigoIndicador indicadorNivel3
    FROM DWDClasificacionProductos p
    join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
    join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
    WHERE p.CpCodigoIndicador in (1)
 and p1.CpCodigoIndicador in (120,121,122,126)
    and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
     ) cp ON ccCodigoIndicador=cp.indicadorNivel3


--&gt;&gt; TITULARIZADA &lt;&lt;--

select 
@CanalTit=caDescripcionAgrupacionCanal,
@CanalAgrTit=caAgrupacion
from DWDCanal 
where caCodigoCanal='TIT'




-- Eliminar Temporal

if object_id('[tempdb]..#ConsCart') is not null
begin
 drop table #ConsCart
end



/* ---------------------------------------------------------------------- */
/*                           CARTERA                                      */
/* ---------------------------------------------------------------------- */


-- Comer. + Micro. (525,526,524,501,504,506,505,509,507)
-- Consumo (510,511,512,513,514,515)
-- Vivienda (519,520,521,522,523)

select  
CodCliente= cl.clCodigoCliente,
NombreCliente=cl.clNombreCompleto,
CodigoMoneda=case co.coIdFecha when @FechAct then  mo.moCodigoMoneda else null end,
CodigoAgenciaOper=case co.coIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion 
CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Cliente
CodProducto=case co.coIdFecha when @FechAct then  pr.prCodigoProducto else null end, 
FechaVencimiento=case co.coIdFecha when @FechAct then  co.coIdFechaVencimiento else null end,
FechaApertura=case co.coIdFecha when @FechAct then  co.coIdFechaConcesion else null end,
NumeroOperacion=case co.coIdFecha when @FechAct then  co.coNumeroOperacion   else null end, 
Plazo='', 
OperacionCliente=case co.coIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,  
CodCanal=ca.caCodigoCanal,   
Estado=CpEstadoProducto, --ccClasificacionEstado,  
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=ca.caOrdenCanal,  
Canal=ca.caDescripcionAgrupacionCanal,
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='     '+ca.caAgrupacion,
RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end
into #ConsCart
--drop table #ConsCart
from #DWHCuotaOperacion co 
inner join DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda  
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
left outer join DWDAgenciaOperacion ago on ago.agIdAgencia=co.coIdAgencia -- Agencia de Operacion
left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente
left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=co.coIdCalificacionOperacionCliente
left outer join #DWDTitularizadaOperacion ti on  isnull(co.coNumeroOperacion,'')=ti.toOperacion 
--left outer join DWDFecha fv on fv.feIdFecha=co.coIdFechaVencimiento
--left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal
inner join 
(
  SELECT DISTINCT 
   p2.CpCodigoIndicador indicadorNivel3
  ,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end 
  FROM DWDClasificacionProductos p
  join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
  join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
  WHERE p.CpCodigoIndicador in (1)
  and p1.CpCodigoIndicador in (120,121,122,126)
  and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)  
and pr.prVehiculo is null
and cl.clFechaFin is null
and ca.caEstado=1
and ti.toOperacion is null -- Filtro Titularizada
group by 
--cc.ccClasificacionEstado,
CpEstadoProducto,
co.coIdFecha,
pr.prCodigoProducto,
co.coIdFechaVencimiento,
co.coIdFechaConcesion,
coc.cocCodigoCalificacionOperacionCliente,
ca.caCodigoCanal,
cl.clCodigoCliente,
co.coNumeroOperacion,
ago.agCodigoAgencia,
ag.agCodigoAgencia,
ca.caAgrupacion,
ca.caOrdenCanal,
ca.caDescripcionAgrupacionCanal,
cl.clNombreCompleto,  
mo.moCodigoMoneda,    
cc.ccOrdenAgrupacionN2,
cc.ccFamiliaProducto,
prCodigoProducto,
ccCodigoNivel6,
cc.ccGrupo,    
cc.ccOrdenAgrupacion,
cc.ccCodigoIndicador

Union All

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- T. Credito
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select 
CodCliente= cl.clCodigoCliente,
NombreCliente=cl.clNombreCompleto,
CodigoMoneda=case tco.tcoIdFecha when @FechAct then  mo.moCodigoMoneda else null end,
CodigoAgenciaOper=case tco.tcoIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion 
CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Cliente
CodProducto=case tco.tcoIdFecha when @FechAct then  pr.prCodigoProducto else null end, 
FechaVencimiento=null,
FechaApertura=null,
NumeroOperacion=null, 
Plazo='', 
OperacionCliente=case tco.tcoIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,  
CodCanal=ca.caCodigoCanal, 
Estado=CpEstadoProducto, --cc.ccClasificacionEstado,
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=ca.caOrdenCanal,
Canal=ca.caDescripcionAgrupacionCanal,
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='     '+ca.caAgrupacion, 
RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end
from DWHTarjetaCreditoOperacion tco 
inner join DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto
inner join DWDMoneda mo on moIdMoneda=tcoIdMoneda
left outer join DWDAgenciaOperacion ago on ago.agIdAgencia=tco.tcoIdAgencia -- Agencia de Operacion
left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente
left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=tco.tcoIdCalificacionOperacionCliente
inner join 
(  
    SELECT DISTINCT 
     p2.CpCodigoIndicador indicadorNivel3
	,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end
    FROM DWDClasificacionProductos p
    join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
    join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
    WHERE p.CpCodigoIndicador = 1
    and p1.CpCodigoIndicador = 124
    and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3
where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and cl.clFechaFin is null
and ca.caEstado=1
--and tcoIdCliente in (182219,319128)
--and cc.ccCodigoMoneda='USD'
group by 
cl.clCodigoCliente,
cl.clNombreCompleto,
coc.cocCodigoCalificacionOperacionCliente,
CpEstadoProducto, --
ca.caCodigoCanal,
 mo.moCodigoMoneda,
cc.ccOrdenAgrupacion,
ca.caOrdenCanal,
cc.ccOrdenAgrupacionN2,
ca.caDescripcionAgrupacionCanal,
cc.ccFamiliaProducto,
caAgrupacion,
cc.ccGrupo,
ago.agCodigoAgencia,
pr.prCodigoProducto,
ag.agCodigoAgencia,
tco.tcoIdFecha


Union all


--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- Vehiculos
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select  
CodCliente= cl.clCodigoCliente,
NombreCliente=cl.clNombreCompleto,
CodigoMoneda=case co.coIdFecha when @FechAct then  mo.moCodigoMoneda else null end,
CodigoAgenciaOper=case co.coIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion 
CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Cliente
CodProducto=case co.coIdFecha when @FechAct then  pr.prCodigoProducto else null end, 
FechaVencimiento=case co.coIdFecha when @FechAct then  co.coIdFechaVencimiento else null end,
FechaApertura=case co.coIdFecha when @FechAct then  co.coIdFechaConcesion else null end,
NumeroOperacion=case co.coIdFecha when @FechAct then  co.coNumeroOperacion   else null end, 
Plazo='', 
OperacionCliente=case co.coIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,  
CodCanal=ca.caCodigoCanal,   
Estado=CpEstadoProducto, --ccClasificacionEstado,  
OrdenN1=pr.prOrdenN1,
OrdenN2=pr.prOrdenN2,
OrdenN3=ca.caOrdenCanal,  
Canal=ca.caDescripcionAgrupacionCanal,
Nivel1=cc.ccFamiliaProducto,
Nivel2=pr.prVehiculo,
Nivel3='     '+ca.caAgrupacion,
RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end
from #DWHCuotaOperacion co 
inner join DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda  
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
left outer join DWDAgenciaOperacion ago on ago.agIdAgencia=co.coIdAgencia -- Agencia de Operacion
left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente
left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=co.coIdCalificacionOperacionCliente
--left outer join DWDFecha fv on fv.feIdFecha=co.coIdFechaVencimiento
--left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal
inner join 
(  
   SELECT DISTINCT 
    p2.CpCodigoIndicador indicadorNivel3
  ,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end
   FROM DWDClasificacionProductos p
   join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
   join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
   WHERE p.CpCodigoIndicador in (1)
   and p1.CpCodigoIndicador in (120,121,122,126)
   and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and pr.prVehiculo='Vehiculos'   
and cl.clFechaFin is null
and ca.caEstado=1
--and ccCodigoMoneda=moCodigoMoneda
--and cc.ccCodigoMoneda='USD'
group by 
CpEstadoProducto,
co.coIdFecha,
pr.prCodigoProducto,
co.coIdFechaVencimiento,
co.coIdFechaConcesion,
coc.cocCodigoCalificacionOperacionCliente,
ca.caCodigoCanal,
cl.clCodigoCliente,
co.coNumeroOperacion,
ago.agCodigoAgencia,
ag.agCodigoAgencia,
ca.caAgrupacion,
ca.caOrdenCanal,
pr.prVehiculo,
ca.caDescripcionAgrupacionCanal,
cl.clNombreCompleto,  
mo.moCodigoMoneda,    
pr.prOrdenN1,
pr.prOrdenN2,
cc.ccFamiliaProducto,
prCodigoProducto,
ccCodigoNivel6,
--cc.ccGrupo,    
cc.ccCodigoIndicador

Union All

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- Titularizada
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

--&gt; Identificacion de C.Titularizada por número de operación

			select
			CodCliente= cl.clCodigoCliente,
			NombreCliente=cl.clNombreCompleto,
			CodigoMoneda=case co.coIdFecha when @FechAct then  mo.moCodigoMoneda else null end,
			CodigoAgenciaOper=case co.coIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion
			CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Cliente
			CodProducto=case co.coIdFecha when @FechAct then  pr.prCodigoProducto else null end,
			FechaVencimiento=case co.coIdFecha when @FechAct then  co.coIdFechaVencimiento else null end,
			FechaApertura=case co.coIdFecha when @FechAct then  co.coIdFechaConcesion else null end,
			NumeroOperacion=case co.coIdFecha when @FechAct then  co.coNumeroOperacion   else null end,
			Plazo='',
			OperacionCliente=case co.coIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,
			CodCanal=ca.caCodigoCanal,

			Estado=ccClasificacionEstado,
			OrdenN1=cc.ccOrdenAgrupacion,
			OrdenN2=cc.ccOrdenAgrupacionN2,
			OrdenN3=ca.caOrdenCanal,
			Canal=@CanalTit,
			Nivel1=@DescripcionCartera,
			Nivel2='C. '+@CanalTit,
			Nivel3=space(5)+ @CanalAgrTit,
			RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
			RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
			RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
			RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end
			from #DWHCuotaOperacion co
			inner join DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on co.coIdCliente=clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda
			inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
			left outer join DWDAgenciaOperacion ago on ago.agIdAgencia=co.coIdAgencia -- Agencia de Operacion
			left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente
			left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=co.coIdCalificacionOperacionCliente
			inner join #DWDTitularizadaOperacion ti on isnull(co.coNumeroOperacion,'')=ti.toOperacion -- Titularizada
			--left outer join DWDFecha fv on fv.feIdFecha=co.coIdFechaVencimiento
			--left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal
			inner join (
			SELECT DISTINCT
			p2.CpCodigoIndicador indicadorNivel3
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador in (1)
			and p1.CpCodigoIndicador in (120,121,122,126)
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON ccCodigoIndicador=cp.indicadorNivel3
			where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and ccCodigoMoneda=moCodigoMoneda
			and cl.clFechaFin is null
			and ca.caEstado=1
			group by
			cc.ccClasificacionEstado,
			co.coIdFecha,
			pr.prCodigoProducto,
			co.coIdFechaVencimiento,
			co.coIdFechaConcesion,
			coc.cocCodigoCalificacionOperacionCliente,
			ca.caCodigoCanal,
			cl.clCodigoCliente,
			co.coNumeroOperacion,
			ago.agCodigoAgencia,
			ag.agCodigoAgencia,
			ca.caAgrupacion,
			ca.caOrdenCanal,
			ca.caDescripcionAgrupacionCanal,
			cl.clNombreCompleto,
			mo.moCodigoMoneda,
			cc.ccOrdenAgrupacionN2,
			cc.ccFamiliaProducto,
			prCodigoProducto,
			ccCodigoNivel6,
			cc.ccGrupo,
			cc.ccOrdenAgrupacion,
			cc.ccCodigoIndicador

			Union All


			-- Cambio de asignación de Titularizada a Cartera Titularizada

			select
			CodCliente= cl.clCodigoCliente,
			NombreCliente=cl.clNombreCompleto,
			CodigoMoneda=case ao.aoIdFecha when @FechAct then  mo.moCodigoMoneda else null end,
			CodigoAgenciaOper=case ao.aoIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion
			CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Cliente
			CodProducto=case ao.aoIdFecha when @FechAct then  pr.prCodigoProducto else null end,
			FechaVencimiento=case ao.aoIdFecha when @FechAct then  ao.aoIdFechaVencimiento else null end,
			FechaApertura=case ao.aoIdFecha when @FechAct then  ao.aoIdFechaConcesion else null end,
			NumeroOperacion=case ao.aoIdFecha when @FechAct then  ao.aoNumeroOperacion   else null end,
			Plazo='',
			OperacionCliente=case ao.aoIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,
			CodCanal=ca.caCodigoCanal,
			Estado=ccClasificacionEstado,
			OrdenN1=cc.ccOrdenAgrupacion,
			OrdenN2=cc.ccOrdenAgrupacionN2,
			OrdenN3=ca.caOrdenCanal,
			Canal=@CanalTit,
			Nivel1=@DescripcionCartera,
			Nivel2='C. '+@CanalTit,
			Nivel3=space(5)+ @CanalAgrTit,
			RealHoy=case ao.aoIdFecha when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
			RealAyer=case ao.aoIdFecha when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
			RealMesAnt=case ao.aoIdFecha when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
			RealAnioAnt=case ao.aoIdFecha when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end
			from #DWHActivoOperacion ao
			inner join DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on ao.aoIdCliente=cl.clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDProducto pr on pr.prIdProducto=ao.aoIdProducto
			inner join DWDMoneda mo on mo.moIdMoneda=ao.aoIdMoneda
			left outer join DWDAgenciaOperacion ago on ago.agIdAgencia=ao.aoIdAgencia
			left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente
			left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=ao.aoIdCalificacionOperacionCliente
			inner join (
			SELECT DISTINCT
			p2.CpCodigoIndicador indicadorNivel3
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador = 1
			and p1.CpCodigoIndicador = 125
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON ccCodigoIndicador=cp.indicadorNivel3
			where ao.aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and pr.prVehiculo is null
			and cl.clFechaFin is null
			and ca.caEstado=1
			group by
			cc.ccOrdenAgrupacion,
			cc.ccOrdenAgrupacionN2,
			ca.caOrdenCanal,
			clCodigoCliente,
			ago.agCodigoAgencia,
			cc.ccClasificacionEstado,
			cc.ccGrupo,
			mo.moCodigoMoneda,
			ao.aoIdFecha,
			ao.aoNumeroOperacion,
			ca.caCodigoCanal,
			ag.agCodigoAgencia,
			cl.clNombreCompleto,
			pr.prCodigoProducto,
			ao.aoIdFechaVencimiento,
			ao.aoIdFechaConcesion,
			coc.cocCodigoCalificacionOperacionCliente

			-- Eliminar Temporal

			if object_id('[tempdb]..#Tasas') is not null
			begin
			drop table #Tasas
			end


			---------------------
			-- Obtener Tasas
			---------------------


			select
			clCodigoCliente,
			NumeroOperacion=case ao.aoIdFecha when @FechAct then ao.aoNumeroOperacion else null end,
			FechaVencimiento=case ao.aoIdFecha when @FechAct then ao.aoIdFechaVencimiento else null end, --co.coIdFechaVencimiento,
			FechaApertura=case ao.aoIdFecha when @FechAct then ao.aoIdFechaConcesion else null end,--co.coIdFechaConcesion,
			CodCanal=ca.caCodigoCanal,
			CodMoneda=case ao.aoIdFecha when @FechAct then  mo.moCodigoMoneda  else null end,
			CodProducto=case ao.aoIdFecha when @FechAct then  pr.prCodigoProducto  else null end,
			--OperCodigoAgencia=case ao.aoIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion
			CodigoAgenciaCli=ag.agCodigoAgencia,
			Estado=cc.ccClasificacionEstado,
			Nivel2=cc.ccGrupo,
			TasaHoy=case ao.aoIdFecha  when @FechAct then avg(isnull(ao.aoTasaNominal,0)) else 0 end,
			TasaAyer=case ao.aoIdFecha  when @FechaAyer then avg(isnull(ao.aoTasaNominal,0)) else 0 end,
			TasaMesAnt=case ao.aoIdFecha  when @FechaMesAnt then avg(isnull(ao.aoTasaNominal,0)) else 0 end,
			TasaAnioAnt=case ao.aoIdFecha  when @FechaAnioAnt then avg(isnull(ao.aoTasaNominal,0)) else 0 end
			into #Tasas
			--drop table #Tasas
			from #DWHActivoOperacion ao
			inner join DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on ao.aoIdCliente=cl.clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDProducto pr on pr.prIdProducto=ao.aoIdProducto
			inner join DWDMoneda mo on mo.moIdMoneda=ao.aoIdMoneda
			--inner join DWDAgenciaOperacion ag on ago.agIdAgencia=ao.aoIdAgencia
			left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente
			inner join (
			SELECT DISTINCT
			p2.CpCodigoIndicador indicadorNivel3
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador in (1)
			and p1.CpCodigoIndicador in (120,121,122,126)
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON ccCodigoIndicador=cp.indicadorNivel3
			where ao.aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and pr.prVehiculo is null
			and cl.clFechaFin is null
			and ca.caEstado=1
			and isnull(ao.aoTasaNominal,0) &gt; 0
			group by
			clCodigoCliente,
			--ca.caAgrupacion,
			cc.ccClasificacionEstado,
			cc.ccGrupo,
			mo.moCodigoMoneda,
			ao.aoIdFecha,
			ao.aoNumeroOperacion,
			ca.caCodigoCanal,
			ag.agCodigoAgencia,
			pr.prCodigoProducto,
			ao.aoIdFechaVencimiento,
			ao.aoIdFechaConcesion

			union all


			select
			clCodigoCliente,
			NumeroOperacion=case ao.aoIdFecha when @FechAct then ao.aoNumeroOperacion else null end,
			FechaVencimiento=case ao.aoIdFecha when @FechAct then ao.aoIdFechaVencimiento else null end, --co.coIdFechaVencimiento,
			FechaApertura=case ao.aoIdFecha when @FechAct then ao.aoIdFechaConcesion else null end,--co.coIdFechaConcesion,
			CodCanal=ca.caCodigoCanal,
			CodMoneda=case ao.aoIdFecha when @FechAct then  mo.moCodigoMoneda  else null end,
			CodProducto=case ao.aoIdFecha when @FechAct then  pr.prCodigoProducto  else null end,
			--OperCodigoAgencia=case ao.aoIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion
			CodigoAgenciaCli=ag.agCodigoAgencia,
			Estado=cc.ccClasificacionEstado,
			Nivel2=pr.prVehiculo,
			TasaHoy=case ao.aoIdFecha  when @FechAct then avg(isnull(ao.aoTasaNominal,0)) else 0 end,
			TasaAyer=case ao.aoIdFecha  when @FechaAyer then avg(isnull(ao.aoTasaNominal,0)) else 0 end,
			TasaMesAnt=case ao.aoIdFecha  when @FechaMesAnt then avg(isnull(ao.aoTasaNominal,0)) else 0 end,
			TasaAnioAnt=case ao.aoIdFecha  when @FechaAnioAnt then avg(isnull(ao.aoTasaNominal,0)) else 0 end
			from #DWHActivoOperacion ao
			inner join DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on ao.aoIdCliente=cl.clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDProducto pr on pr.prIdProducto=ao.aoIdProducto
			inner join DWDMoneda mo on mo.moIdMoneda=ao.aoIdMoneda
			--inner join DWDAgenciaOperacion ag on ago.agIdAgencia=ao.aoIdAgencia
			left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente
			inner join (
			SELECT DISTINCT
			p2.CpCodigoIndicador indicadorNivel3
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador in (1)
			and p1.CpCodigoIndicador in (120,121,122,126)
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON ccCodigoIndicador=cp.indicadorNivel3
			where ao.aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and pr.prVehiculo='Vehiculos'
			and cl.clFechaFin is null
			and ca.caEstado=1
			and isnull(ao.aoTasaNominal,0)&gt;0
			group by
			clCodigoCliente,
			--ca.caAgrupacion,
			cc.ccClasificacionEstado,
			pr.prVehiculo,
			mo.moCodigoMoneda,
			ao.aoIdFecha,
			ao.aoNumeroOperacion,
			ca.caCodigoCanal,
			ag.agCodigoAgencia,
			pr.prCodigoProducto,
			ao.aoIdFechaVencimiento,
			ao.aoIdFechaConcesion


			-- Eliminar Temporal

			if object_id('[tempdb]..#Cartera') is not null
			begin
			drop table #Cartera
			end

			---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
--&gt;&gt;&gt;        AGRUPACION CARTERA           &lt;&lt;&lt;
---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;


			select
			CodCliente,
			NombreCliente,
			CodigoMoneda,
			CodigoAgenciaOper,
			CodigoAgenciaCli,
			CodProducto,
			FechaVencimiento,
			FechaApertura,
			NumeroOperacion,
			Plazo,
			OperacionCliente,
			CodCanal,
			Estado,
			OrdenN1,
			OrdenN2,
			OrdenN3,
			Canal,
			Nivel1,
			Nivel2,
			Nivel3,
			TasaHoy=cast(null as float),
			TasaAyer=cast(null as float),
			TasaMesAnt=cast(null as float),
			TasaAnioAnt=cast(null as float),
			RealHoy=sum(RealHoy),
			RealAyer=sum(RealAyer),
			RealMesAnt=sum(RealMesAnt),
			RealAnioAnt=sum(RealAnioAnt)

			into #Cartera

			from #ConsCart
			group by CodCliente,
			NombreCliente,
			CodigoMoneda,
			CodigoAgenciaOper,
			CodigoAgenciaCli,
			CodProducto,
			FechaVencimiento,
			FechaApertura,
			NumeroOperacion,
			Plazo,
			OperacionCliente,
			CodCanal,
			Estado,
			OrdenN1,
			OrdenN2,
			OrdenN3,
			Canal,
			Nivel1,
			Nivel2,
			Nivel3


			---------------------------
			-- Actualiza Tasas Cartera
			---------------------------

			update ca
			set ca.TasaHoy=ts.TasaHoy,
			ca.TasaAyer=ts.TasaAyer,
			ca.TasaMesAnt=ts.TasaMesAnt,
			ca.TasaAnioAnt=ts.TasaAnioAnt

			from #Cartera  ca
			inner join
			(

			select
			clCodigoCliente,
			NumeroOperacion,
			CodProducto,
			CodCanal,
			Nivel2,
			Estado,
			FechaVencimiento,
			TasaHoy=avg(TasaHoy),
			TasaAyer=avg(TasaAyer),
			TasaMesAnt=avg(TasaMesAnt),
			TasaAnioAnt=avg(TasaAnioAnt)
			from #Tasas
			group by clCodigoCliente,
			Estado,
			Nivel2,
			NumeroOperacion,
			CodigoAgenciaCli,
			CodProducto,
			FechaVencimiento,
			CodCanal

			) as ts  on ca.CodCliente=ts.clCodigoCliente
			and isnull(ca.NumeroOperacion,'')=isnull(ts.NumeroOperacion,'')
			and rtrim(ltrim(isnull(ca.CodProducto,'')))=rtrim(ltrim(isnull(ts.CodProducto,'')))
			and isnull(ca.FechaVencimiento,'')=isnull(ts.FechaVencimiento,'')
			and isnull(rtrim(ltrim(ca.Nivel2)),'')=isnull(rtrim(ltrim(ts.Nivel2)),'')
			and isnull(ca.Estado,'')=isnull(ts.Estado,'')



			-- Eliminar Temporal

			if object_id('[tempdb]..#Consolidados') is not null
			begin
			drop table #Consolidados
			end


			/* ------------------------------------------------------------------------ */
			/*                       CAPTACIONES                                        */
			/* ------------------------------------------------------------------------ */

			--  Monetarios(98, 100,55,54,99)
			--  Ahorros(247,600,601)
			--  Plazo(602, 603, 604, 605, 606, 607)

			select
			CodCliente= cl.clCodigoCliente,
			NombreCliente=cl.clNombreCompleto,
			CodigoMoneda=case po.poIdFecha when @FechAct then  mo.moCodigoMoneda else null end,
			CodigoAgenciaOper=case po.poIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion
			CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Operacion
			CodProducto=case po.poIdFecha when @FechAct then  prCodigoProducto else null end,
			FechaVencimiento=case po.poIdFecha when @FechAct then  po.poFechaVencimiento else null end,
			FechaApertura=null,
			NumeroOperacion=case po.poIdFecha when @FechAct then  po.poNoOperacion  else null end,
			Plazo=case po.poIdFecha when @FechAct then  po.poPlazoOperacion  else null end,
			OperacionCliente=case po.poIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,
			CodCanal=ca.caCodigoCanal,

			OrdenN1=cc.ccOrdenAgrupacion,
			OrdenN2=cc.ccOrdenAgrupacionN2,
			OrdenN3=caOrdenCanal,
			Canal=ca.caDescripcionAgrupacionCanal,
			Nivel1=cc.ccFamiliaProducto,
			Nivel2=left(cc.ccGrupo+SPACE(70),70)+'X'+right('0'+cast(cc.ccOrdenAgrupacion as varchar(10)),2)+right('0'+ cast(cc.ccOrdenAgrupacionN2 as varchar(10)),2)+'X',
			Nivel3='     '+ca.caAgrupacion,
			TasaHoy=case  when po.poIdFecha=@FechAct and isnull(po.poTasaNominal,0) &gt; 0 then avg(isnull(po.poTasaNominal,0)) else 0 end,
			TasaAyer=case when po.poIdFecha=@FechaAyer and isnull(po.poTasaNominal,0) &gt; 0  then avg(isnull(po.poTasaNominal,0))  else 0 end,
			TasaMesAnt=case  when po.poIdFecha=@FechaMesAnt and isnull(po.poTasaNominal,0) &gt; 0  then avg(isnull(po.poTasaNominal,0))  else 0 end,
			TasaAnioAnt=case  when po.poIdFecha=@FechaAnioAnt and isnull(po.poTasaNominal,0) &gt; 0  then avg(isnull(po.poTasaNominal,0))  else 0 end,
			--FechaHoy=@FechAct,
			RealHoy=case po.poIdFecha when @FechAct then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
			RealAyer=case po.poIdFecha when @FechaAyer then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
			RealMesAnt=case po.poIdFecha when @FechaMesAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
			RealAnioAnt=case po.poIdFecha when @FechaAnioAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end

			into #Consolidados
			--drop table #Consolidados

			from #DWHPasivoOperacion po
			inner join DWDCuentaContable cc on po.poIdCuentaContable=ccIdCuentaContable
			inner join DWDCliente cl on po.poIdCliente=clIdCliente
			inner join DWDMoneda mo on po.poIdMoneda=moIdMoneda
			inner join DWDProducto pr on pr.prIdProducto=po.poIdProducto
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDAgenciaOperacion ago on ago.agIdAgencia=po.poIdAgencia
			left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia
			left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=po.poIdCalificacionOperacionCliente
			inner join (
			SELECT DISTINCT
			p2.CpCodigoIndicador indicadorNivel3
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador = 2
			and p1.CpCodigoIndicador in (141,142)
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON ccCodigoIndicador=cp.indicadorNivel3
			where po.poIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)
			and ca.caEstado=1
			and cl.clFechaFin is null
			--and cc.ccCodigoMoneda='USD'
			group by isnull(po.poTasaNominal,0),
			ca.caCodigoCanal,
			cl.clCodigoCliente,
			cl.clNombreCompleto,
			mo.moCodigoMoneda,
			ago.agCodigoAgencia,
			ag.agCodigoAgencia,
			coc.cocCodigoCalificacionOperacionCliente,
			po.poFechaVencimiento,
			prCodigoProducto,
			po.poNoOperacion,
			po.poPlazoOperacion,
			cc.ccOrdenAgrupacion,
			cc.ccOrdenAgrupacionN2,
			ca.caOrdenCanal,
			ca.caAgrupacion,
			cc.ccFamiliaProducto,
			ca.caDescripcionAgrupacionCanal,
			cc.ccGrupo,
			po.poIdFecha


			union all

			/* ------------------------------------------------------------------------ */
			/*                          CARTERA                                         */
			/* ------------------------------------------------------------------------ */


			select
			CodCliente,
			NombreCliente,
			CodigoMoneda,
			CodigoAgenciaOper,
			CodigoAgenciaCli,
			CodProducto,
			FechaVencimiento,
			FechaApertura,
			NumeroOperacion,
			Plazo,
			OperacionCliente,
			CodCanal,
			OrdenN1,
			OrdenN2,
			OrdenN3,
			Canal,
			Nivel1,
			Nivel2=left(Nivel2+space(70),70)+'X'+right('0'+cast(OrdenN1 as varchar(10)),2)+right('0'+ cast(OrdenN2 as varchar(10)),2)+'X',
			Nivel3,
			TasaHoy,
			TasaAyer,
			TasaMesAnt,
			TasaAnioAnt,
			RealHoy,
			RealAyer,
			RealMesAnt,
			RealAnioAnt
			from #Cartera

			Union all

			--&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
---&gt;&gt;&gt;&gt;&gt;&gt;&gt;     CARTERA EN DIFICULTADES       &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select 
CodCliente,
NombreCliente,
CodigoMoneda,
CodigoAgenciaOper,
CodigoAgenciaCli,
CodProducto,
FechaVencimiento,
FechaApertura,
NumeroOperacion,
Plazo,
OperacionCliente,
CodCanal,
OrdenN1,
OrdenN2,
OrdenN3,
Canal,
Nivel1,
Nivel2=left('Cartera en Dificultades'+space(70),70)+'X'+right('0'+cast(OrdenN1 as varchar(10)),2)+'13X',
Nivel3,
TasaHoy,
TasaAyer,
TasaMesAnt,
TasaAnioAnt,
RealHoy,
RealAyer,
RealMesAnt,
RealAnioAnt
from #Cartera
where Estado='Dif'

union all

--&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
---&gt;&gt;&gt;&gt;&gt;&gt;      VIGENTE      &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
--&gt;&gt;&gt;&gt;&gt;&gt;      DIFICULTADES  &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;


			select
			CodCliente,
			NombreCliente,
			CodigoMoneda,
			CodigoAgenciaOper,
			CodigoAgenciaCli,
			CodProducto,
			FechaVencimiento,
			FechaApertura,
			NumeroOperacion,
			Plazo,
			OperacionCliente,
			CodCanal,
			OrdenN1,
			OrdenN2,
			OrdenN3,
			Canal,
			Nivel1,
			Nivel2=
			case
			when Estado='Vig' then  left((Estado+'. '+Nivel2+SPACE(70)),70)+'X'+right('0'+cast(OrdenN1 as varchar(10)),2)+right('0'+ cast(OrdenN2+20 as varchar(10)),2)+'X'
			else left((Estado+'. '+Nivel2+SPACE(70)),70)+'X'+right('0'+cast(OrdenN1 as varchar(10)),2)+right('0'+ cast(OrdenN2+40 as varchar(10)),2)+'X'
			end,
			Nivel3,
			TasaHoy,
			TasaAyer,
			TasaMesAnt,
			TasaAnioAnt,
			RealHoy,
			RealAyer,
			RealMesAnt,
			RealAnioAnt
			from #Cartera
			where Estado in ('Dif','Vig')


			----------------------
			-- Consolidado final
			----------------------

			if object_id('[tempdb]..#Consolidado_final') is not null
			begin
			drop table #Consolidado_final
			end

			select
			CodCliente,
			NombreCliente,
			CodigoMoneda,
			CodigoAgenciaOper,
			CodigoAgenciaCli,
			CodProducto,
			FechaVencimiento,
			FechaApertura,
			NumeroOperacion,
			Plazo,
			OperacionCliente,
			CodCanal,
			OrdenN1,
			OrdenN2,
			Canal,
			Nivel1,
			Nivel2,
			Nivel3,
			TasaHoy=max(isnull(TasaHoy,0)),
			TasaAyer=max(isnull(TasaAyer,0)),
			TasaMesAnt=max(isnull(TasaMesAnt,0)),
			TasaAnioAnt=max(isnull(TasaAnioAnt,0)),
			RealHoy=sum(RealHoy),
			RealAyer=sum(RealAyer),
			RealMesAnt=sum(RealMesAnt),
			RealAnioAnt=sum(RealAnioAnt)

			--select *
			into #Consolidado_final

			from #Consolidados
			group by
			CodCliente,
			NombreCliente,
			CodigoMoneda,
			CodigoAgenciaOper,
			CodigoAgenciaCli,
			CodProducto,
			FechaVencimiento,
			FechaApertura,
			NumeroOperacion,
			Plazo,
			OperacionCliente,
			CodCanal,
			OrdenN1,
			OrdenN2,
			Canal,
			Nivel1,
			Nivel2,
			Nivel3


			---------------------------------
			-- Asignar clientes a menor 5000
			---------------------------------

			update a
			set
			CodCliente=-5000,
			CodigoAgenciaOper=-1,
			NumeroOperacion=-1,
			NombreCliente='Menor a 5000',
			CodCanal=-1,
			CodigoMoneda=-1,
			CodProducto=-1,
			FechaVencimiento=null,
			Plazo=-1,
			CodigoAgenciaCli=-1,
			OperacionCliente=-1,
			FechaApertura=null

			--select a.*

			from #Consolidado_final a inner join
			(
			select
			CodCliente,
			NumeroOperacion,
			Nivel1,
			Nivel2,
			Realhoy=sum(RealHoy),
			RealAyer=sum(RealAyer),
			RealMesAnt=sum(RealMesAnt),
			RealAnioAnt=sum(RealAnioAnt)
			from #Consolidado_final
			group by CodCliente,
			Nivel1,
			Nivel2,
			NumeroOperacion
			having  sum(RealHoy)&lt;5
 and abs(sum(RealHoy)-sum(RealAyer))&lt;5
 and abs(sum(RealHoy)-sum(RealMesAnt))&lt;5
 and abs(sum(RealHoy)-sum(RealAnioAnt))&lt;5

) b on
a.CodCliente=b.CodCliente
and isnull(a.NumeroOperacion,'')=isnull(b.NumeroOperacion,'')
and a.Nivel1=b.Nivel1
and a.Nivel2=b.Nivel2




--------------------------------------
--&gt;&gt;&gt;  Actualiza Operacion Cliente
			--------------------------------------

			update a
			set a.OperacionCliente=b.OperacionCliente
			from #Consolidado_final a inner join
			(
			select distinct
			CodCliente,
			OperacionCliente=max(OperacionCliente)
			from #Consolidado_final
			where OperacionCliente  is not null
			group by CodCliente
			) as b
			on a.CodCliente=b.CodCliente
			where a.OperacionCliente is null


			update #Consolidado_final
			set OperacionCliente=-1
			where OperacionCliente  is null



			------------------------------------
			---      CONSOLIDADO
			------------------------------------

			select
			CodCliente,
			NombreCliente,
			CodigoMoneda,
			CodigoAgenciaOper,
			CodigoAgenciaCli,
			CodProducto,
			FechaVencimiento=max(FechaVencimiento),
			FechaApertura,
			NumeroOperacion,
			Plazo,
			OperacionCliente,
			CodCanal,
			OrdenN1,
			OrdenN2,
			Canal,
			Nivel1,
			Nivel2,
			Nivel3,
			TasaHoy=max(TasaHoy),
			TasaAyer=max(TasaAyer),
			TasaMesAnt=max(TasaMesAnt),
			TasaAnioAnt=max(TasaAnioAnt),
			RealHoy=sum(RealHoy),
			RealAyer=sum(RealAyer),
			RealMesAnt=sum(RealMesAnt),
			RealAnioAnt=sum(RealAnioAnt)

			from #Consolidado_final
			group by CodCliente,
			NombreCliente,
			CodigoMoneda,
			CodigoAgenciaOper,
			CodigoAgenciaCli,
			CodProducto,
			--FechaVencimiento,
			FechaApertura,
			NumeroOperacion,
			Plazo,
			OperacionCliente,
			CodCanal,
			OrdenN1,
			OrdenN2,
			Canal,
			Nivel1,
			Nivel2,
			Nivel3
			having sum(abs(TasaHoy))+sum(abs(TasaAyer))+sum(abs(TasaMesAnt))+sum(abs(TasaAnioAnt))+
			sum(abs(RealHoy))+sum(abs(RealAyer))+sum(abs(RealMesAnt))+sum(abs(RealAnioAnt))&gt;0&lt;/RSQueryCommandText&gt;&lt;RSQueryCommandType&gt;Text&lt;/RSQueryCommandType&gt;&lt;RSQueryDesignState&gt;&lt;/RSQueryDesignState&gt;]]&gt;&lt;/AnnotationContent&gt;&lt;/Gemini&gt;</Value>
            </Annotation>
            <Annotation>
              <Name>IsQueryEditorUsed</Name>
              <Value>True</Value>
            </Annotation>
          </Annotations>
          <Source xsi:type="DataSourceViewBinding">
            <DataSourceViewID>Sandbox</DataSourceViewID>
          </Source>
          <UnknownMember valuens="ddl200_200">AutomaticNull</UnknownMember>
          <ErrorConfiguration>
            <KeyNotFound>IgnoreError</KeyNotFound>
            <KeyDuplicate>ReportAndStop</KeyDuplicate>
            <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
          </ErrorConfiguration>
          <StorageMode valuens="ddl200_200">InMemory</StorageMode>
          <Language>2058</Language>
          <UnknownMemberName>Unknown</UnknownMemberName>
          <Attributes>
            <Attribute>
              <ID>__XL_RowNumber</ID>
              <Name>__XL_RowNumber</Name>
              <Type valuens="ddl200_200">RowNumber</Type>
              <Usage>Key</Usage>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>4</DataSize>
                  <NullProcessing>Error</NullProcessing>
                  <Source xsi:type="ddl200_200:RowNumberBinding" />
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>4</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <Source xsi:type="ddl200_200:RowNumberBinding" />
              </NameColumn>
              <AttributeRelationships>
                <AttributeRelationship>
                  <AttributeID>CodCliente</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodCliente</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>NombreCliente</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>NombreCliente</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>CodigoMoneda</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodigoMoneda</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>CodigoAgenciaOper</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodigoAgenciaOper</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>CodigoAgenciaCli</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodigoAgenciaCli</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>CodProducto</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodProducto</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>FechaVencimiento</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>FechaVencimiento</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>FechaApertura</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>FechaApertura</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>NumeroOperacion</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>NumeroOperacion</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Plazo</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Plazo</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>OperacionCliente</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>OperacionCliente</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>CodCanal</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodCanal</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>OrdenN1</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>OrdenN1</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>OrdenN2</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>OrdenN2</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Canal</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Canal</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Nivel1</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Nivel1</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Nivel2</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Nivel2</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Nivel3</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Nivel3</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>TasaHoy</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>TasaHoy</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>TasaAyer</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>TasaAyer</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>TasaMesAnt</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>TasaMesAnt</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>TasaAnioAnt</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>TasaAnioAnt</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>RealHoy</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>RealHoy</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>RealAyer</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>RealAyer</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>RealMesAnt</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>RealMesAnt</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>RealAnioAnt</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>RealAnioAnt</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>CodCliente2</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodCliente2</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Add Column2</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodigoConsolidado</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Nivel2Descrip</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>DescripConsolidado</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>CodigoProducto</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodigoProducto</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>DescripcionCabecera</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>DescripcionCabecera</Name>
                </AttributeRelationship>
              </AttributeRelationships>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>CodCliente</ID>
              <Name>CodCliente</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>CodCliente</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>CodCliente</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>NombreCliente</ID>
              <Name>NombreCliente</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>NombreCliente</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>NombreCliente</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>CodigoMoneda</ID>
              <Name>CodigoMoneda</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>CodigoMoneda</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>CodigoMoneda</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>CodigoAgenciaOper</ID>
              <Name>CodigoAgenciaOper</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>CodigoAgenciaOper</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>CodigoAgenciaOper</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>CodigoAgenciaCli</ID>
              <Name>CodigoAgenciaCli</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>CodigoAgenciaCli</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>CodigoAgenciaCli</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>CodProducto</ID>
              <Name>CodProducto</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>CodProducto</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>CodProducto</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>FechaVencimiento</ID>
              <Name>FechaVencimiento</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>FechaVencimiento</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>FechaVencimiento</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>FechaApertura</ID>
              <Name>FechaApertura</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>FechaApertura</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>FechaApertura</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>NumeroOperacion</ID>
              <Name>NumeroOperacion</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>NumeroOperacion</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>NumeroOperacion</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Plazo</ID>
              <Name>Plazo</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>Plazo</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>Plazo</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>OperacionCliente</ID>
              <Name>OperacionCliente</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>OperacionCliente</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>OperacionCliente</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>CodCanal</ID>
              <Name>CodCanal</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>CodCanal</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>CodCanal</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>OrdenN1</ID>
              <Name>OrdenN1</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>OrdenN1</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>OrdenN1</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>OrdenN2</ID>
              <Name>OrdenN2</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>OrdenN2</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>OrdenN2</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Canal</ID>
              <Name>Canal</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>Canal</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>Canal</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Nivel1</ID>
              <Name>Nivel1</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>Nivel1</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>Nivel1</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Nivel2</ID>
              <Name>Nivel2</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>Nivel2</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>Nivel2</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Nivel3</ID>
              <Name>Nivel3</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>Nivel3</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>Nivel3</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>TasaHoy</ID>
              <Name>TasaHoy</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>TasaHoy</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>TasaHoy</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>TasaAyer</ID>
              <Name>TasaAyer</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>TasaAyer</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>TasaAyer</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>TasaMesAnt</ID>
              <Name>TasaMesAnt</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>TasaMesAnt</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>TasaMesAnt</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>TasaAnioAnt</ID>
              <Name>TasaAnioAnt</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>TasaAnioAnt</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>TasaAnioAnt</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>RealHoy</ID>
              <Name>RealHoy</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>RealHoy</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>RealHoy</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>RealAyer</ID>
              <Name>RealAyer</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>RealAyer</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>RealAyer</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>RealMesAnt</ID>
              <Name>RealMesAnt</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>RealMesAnt</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>RealMesAnt</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>RealAnioAnt</ID>
              <Name>RealAnioAnt</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Double</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    <ColumnID>RealAnioAnt</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                  <ColumnID>RealAnioAnt</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>CodCliente2</ID>
              <Name>CodCliente2</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>ConsolidadoHojaPosicion[CodCliente]</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>ConsolidadoHojaPosicion[CodCliente]</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Add Column2</ID>
              <Name>CodigoConsolidado</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>TRIM(RIGHT(IF(RIGHT(ConsolidadoHojaPosicion[Nivel2],1)="X",RIGHT(ConsolidadoHojaPosicion[Nivel2],6),"X0000X"),6))
</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>TRIM(RIGHT(IF(RIGHT(ConsolidadoHojaPosicion[Nivel2],1)="X",RIGHT(ConsolidadoHojaPosicion[Nivel2],6),"X0000X"),6))
</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Nivel2Descrip</ID>
              <Name>DescripConsolidado</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>MID(ConsolidadoHojaPosicion[Nivel2],1,50)</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>MID(ConsolidadoHojaPosicion[Nivel2],1,50)</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>CodigoProducto</ID>
              <Name>CodigoProducto</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>TRIM(RIGHT(IF(RIGHT(ConsolidadoHojaPosicion[Nivel2],1)="X",RIGHT(ConsolidadoHojaPosicion[Nivel2],6),"X0000X"),6))</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>TRIM(RIGHT(IF(RIGHT(ConsolidadoHojaPosicion[Nivel2],1)="X",RIGHT(ConsolidadoHojaPosicion[Nivel2],6),"X0000X"),6))</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>DescripcionCabecera</ID>
              <Name>DescripcionCabecera</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>"Consolidado - " &amp; ConsolidadoHojaPosicion[DescripConsolidado]</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>"Consolidado - " &amp; ConsolidadoHojaPosicion[DescripConsolidado]</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
          </Attributes>
          <ProactiveCaching>
            <SilenceInterval>-PT1S</SilenceInterval>
            <Latency>-PT1S</Latency>
            <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
            <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
            <Source xsi:type="ProactiveCachingInheritedBinding" />
          </ProactiveCaching>
          <ddl300_300:Relationships>
            <ddl300_300:Relationship>
              <ID>25d1047b-5184-46fd-b7ae-a17fa67ae3c0</ID>
              <ddl300_300:FromRelationshipEnd>
                <ddl300_300:Multiplicity>Many</ddl300_300:Multiplicity>
                <ddl300:VisualizationProperties />
                <DimensionID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</DimensionID>
                <Attributes>
                  <Attribute>
                    <AttributeID>Canal</AttributeID>
                  </Attribute>
                </Attributes>
              </ddl300_300:FromRelationshipEnd>
              <ddl300_300:ToRelationshipEnd>
                <ddl300_300:Multiplicity>One</ddl300_300:Multiplicity>
                <ddl300:VisualizationProperties />
                <DimensionID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</DimensionID>
                <Attributes>
                  <Attribute>
                    <AttributeID>caDescripcionAgrupacionCanal</AttributeID>
                  </Attribute>
                </Attributes>
              </ddl300_300:ToRelationshipEnd>
            </ddl300_300:Relationship>
          </ddl300_300:Relationships>
        </Dimension>
        <Dimension>
          <ID>DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f</ID>
          <Name>Rangos</Name>
          <Annotations>
            <Annotation>
              <Name>TableWidgetSerialization</Name>
              <Value>&lt;?xml version="1.0" encoding="UTF-16"?&gt;&lt;Gemini xmlns="TableWidgetSerialization"&gt;&lt;AnnotationContent&gt;&lt;![CDATA[&lt;?xml version="1.0"?&gt;
&lt;TableWidgetGridSerialization xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;ColumnSuggestedType /&gt;
  &lt;ColumnFormat /&gt;
  &lt;ColumnAccuracy /&gt;
  &lt;ColumnCurrencySymbol /&gt;
  &lt;ColumnPositivePattern /&gt;
  &lt;ColumnNegativePattern /&gt;
  &lt;ColumnWidths&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;Valor&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;54&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;Descripcion&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;84&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;Orden&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;60&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
  &lt;/ColumnWidths&gt;
  &lt;ColumnDisplayIndex&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;Valor&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;0&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;Descripcion&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;1&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;Orden&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;2&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
  &lt;/ColumnDisplayIndex&gt;
  &lt;ColumnFrozen /&gt;
  &lt;ColumnChecked /&gt;
  &lt;ColumnFilter /&gt;
  &lt;SelectionFilter /&gt;
  &lt;FilterParameters /&gt;
  &lt;IsSortDescending&gt;false&lt;/IsSortDescending&gt;
&lt;/TableWidgetGridSerialization&gt;]]&gt;&lt;/AnnotationContent&gt;&lt;/Gemini&gt;</Value>
            </Annotation>
            <Annotation>
              <Name>QueryEditorSerialization</Name>
            </Annotation>
            <Annotation>
              <Name>IsQueryEditorUsed</Name>
              <Value>False</Value>
            </Annotation>
          </Annotations>
          <Source xsi:type="DataSourceViewBinding">
            <DataSourceViewID>Sandbox</DataSourceViewID>
          </Source>
          <UnknownMember valuens="ddl200_200">AutomaticNull</UnknownMember>
          <ErrorConfiguration>
            <KeyNotFound>IgnoreError</KeyNotFound>
            <KeyDuplicate>ReportAndStop</KeyDuplicate>
            <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
          </ErrorConfiguration>
          <StorageMode valuens="ddl200_200">InMemory</StorageMode>
          <Language>2058</Language>
          <UnknownMemberName>Unknown</UnknownMemberName>
          <Attributes>
            <Attribute>
              <ID>__XL_RowNumber</ID>
              <Name>__XL_RowNumber</Name>
              <Type valuens="ddl200_200">RowNumber</Type>
              <Usage>Key</Usage>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>4</DataSize>
                  <NullProcessing>Error</NullProcessing>
                  <Source xsi:type="ddl200_200:RowNumberBinding" />
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>4</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <Source xsi:type="ddl200_200:RowNumberBinding" />
              </NameColumn>
              <AttributeRelationships>
                <AttributeRelationship>
                  <AttributeID>Valor</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Valor</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Descripcion</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Descripcion</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>Orden</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Orden</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>CodigoRango</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodigoRango</Name>
                </AttributeRelationship>
              </AttributeRelationships>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Valor</ID>
              <Name>Valor</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f</TableID>
                    <ColumnID>Valor</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f</TableID>
                  <ColumnID>Valor</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Descripcion</ID>
              <Name>Descripcion</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f</TableID>
                    <ColumnID>Descripcion</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f</TableID>
                  <ColumnID>Descripcion</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Orden</ID>
              <Name>Orden</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f</TableID>
                    <ColumnID>Orden</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f</TableID>
                  <ColumnID>Orden</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>CodigoRango</ID>
              <Name>CodigoRango</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>"X"&amp;[Valor]&amp;"X"</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>"X"&amp;[Valor]&amp;"X"</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
          </Attributes>
          <Hierarchies>
            <Hierarchy>
              <ID>Rango</ID>
              <Name>Rango</Name>
              <Levels>
                <Level>
                  <ID>Orden</ID>
                  <Name>Orden</Name>
                  <SourceAttributeID>Orden</SourceAttributeID>
                </Level>
                <Level>
                  <ID>Descripcion</ID>
                  <Name>Descripcion</Name>
                  <SourceAttributeID>Descripcion</SourceAttributeID>
                </Level>
              </Levels>
            </Hierarchy>
          </Hierarchies>
          <ProactiveCaching>
            <SilenceInterval>-PT1S</SilenceInterval>
            <Latency>-PT1S</Latency>
            <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
            <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
            <Source xsi:type="ProactiveCachingInheritedBinding" />
          </ProactiveCaching>
        </Dimension>
        <Dimension>
          <ID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</ID>
          <Name>Canal</Name>
          <Annotations>
            <Annotation>
              <Name>TableWidgetSerialization</Name>
            </Annotation>
            <Annotation>
              <Name>QueryEditorSerialization</Name>
              <Value>&lt;?xml version="1.0" encoding="UTF-16"?&gt;&lt;Gemini xmlns="QueryEditorSerialization"&gt;&lt;AnnotationContent&gt;&lt;![CDATA[&lt;RSQueryCommandText&gt;set nocount on

declare @id int

if object_id('tempdb..#DWDCanal') is not null
begin 
 drop table #DWDCanal
end

select distinct
 caCodigoAgrupacionCanal
,Orden=caOrdenCanal
,caDescripcionAgrupacionCanal
into #DWDCanal
from DWDCanal
where caEstado=1
order by caOrdenCanal
,caCodigoAgrupacionCanal
,caDescripcionAgrupacionCanal

select @id=max(Orden) from #DWDCanal

select 
 caCodigoAgrupacionCanal
,Orden
,caDescripcionAgrupacionCanal

from #DWDCanal

union all

select
caCodigoAgrupacionCanal='NA',
Orden=@id+1,
'Otr.Dep y Obl.Fin'

union all

select 
caCodigoAgrupacionCanal,
Orden=@id+2,
caDescripcionAgrupacionCanal
from dwdcanal
where caCodigoCanal='TIT'&lt;/RSQueryCommandText&gt;&lt;RSQueryCommandType&gt;Text&lt;/RSQueryCommandType&gt;&lt;RSQueryDesignState&gt;&lt;/RSQueryDesignState&gt;]]&gt;&lt;/AnnotationContent&gt;&lt;/Gemini&gt;</Value>
            </Annotation>
            <Annotation>
              <Name>IsQueryEditorUsed</Name>
              <Value>True</Value>
            </Annotation>
          </Annotations>
          <Source xsi:type="DataSourceViewBinding">
            <DataSourceViewID>Sandbox</DataSourceViewID>
          </Source>
          <UnknownMember valuens="ddl200_200">AutomaticNull</UnknownMember>
          <ErrorConfiguration>
            <KeyNotFound>IgnoreError</KeyNotFound>
            <KeyDuplicate>ReportAndStop</KeyDuplicate>
            <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
          </ErrorConfiguration>
          <StorageMode valuens="ddl200_200">InMemory</StorageMode>
          <Language>2058</Language>
          <UnknownMemberName>Unknown</UnknownMemberName>
          <Attributes>
            <Attribute>
              <ID>__XL_RowNumber</ID>
              <Name>__XL_RowNumber</Name>
              <Type valuens="ddl200_200">RowNumber</Type>
              <Usage>Key</Usage>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Integer</DataType>
                  <DataSize>4</DataSize>
                  <NullProcessing>Error</NullProcessing>
                  <Source xsi:type="ddl200_200:RowNumberBinding" />
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>4</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <Source xsi:type="ddl200_200:RowNumberBinding" />
              </NameColumn>
              <AttributeRelationships>
                <AttributeRelationship>
                  <AttributeID>Orden</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>Orden</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>caDescripcionAgrupacionCanal</AttributeID>
                  <Cardinality>One</Cardinality>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>caDescripcionAgrupacionCanal</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>caNegTes</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>caNeg</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>OrdenNegTes</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>OrdenNeg</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>CodigoCanalOrden</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>CodigoCanal</Name>
                </AttributeRelationship>
                <AttributeRelationship>
                  <AttributeID>caCodigoAgrupacionCanal</AttributeID>
                  <OverrideBehavior>None</OverrideBehavior>
                  <Name>caCodigoAgrupacionCanal</Name>
                </AttributeRelationship>
              </AttributeRelationships>
              <OrderBy>Key</OrderBy>
              <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>Orden</ID>
              <Name>Orden</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>BigInt</DataType>
                  <DataSize>-1</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</TableID>
                    <ColumnID>Orden</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>-1</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</TableID>
                  <ColumnID>Orden</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>caDescripcionAgrupacionCanal</ID>
              <Name>caDescripcionAgrupacionCanal</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Error</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</TableID>
                    <ColumnID>caDescripcionAgrupacionCanal</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</TableID>
                  <ColumnID>caDescripcionAgrupacionCanal</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>caNegTes</ID>
              <Name>caNeg</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>IF(Canal[caCodigoAgrupacionCanal]="RED" || Canal[caCodigoAgrupacionCanal]="COR" || Canal[caCodigoAgrupacionCanal]="ESP","Negocios","Otros Canales")</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>IF(Canal[caCodigoAgrupacionCanal]="RED" || Canal[caCodigoAgrupacionCanal]="COR" || Canal[caCodigoAgrupacionCanal]="ESP","Negocios","Otros Canales")</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="General" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>OrdenNegTes</ID>
              <Name>OrdenNeg</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>IF([caNeg]="Negocios",1,2)</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>IF([caNeg]="Negocios",1,2)</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <Annotations>
                <Annotation>
                  <Name>Format</Name>
                  <Value>
                    <Format Format="Text" xmlns="" />
                  </Value>
                </Annotation>
              </Annotations>
              <ID>CodigoCanalOrden</ID>
              <Name>CodigoCanal</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>Empty</DataType>
                  <Source xsi:type="ddl200_200:ExpressionBinding">
                    <Expression>"X"&amp;Canal[Orden]&amp;"X"</Expression>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <Source xsi:type="ddl200_200:ExpressionBinding">
                  <Expression>"X"&amp;Canal[Orden]&amp;"X"</Expression>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
            <Attribute>
              <ID>caCodigoAgrupacionCanal</ID>
              <Name>caCodigoAgrupacionCanal</Name>
              <KeyColumns>
                <KeyColumn>
                  <DataType>WChar</DataType>
                  <DataSize>32766</DataSize>
                  <NullProcessing>Preserve</NullProcessing>
                  <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                  <Source xsi:type="ColumnBinding">
                    <TableID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</TableID>
                    <ColumnID>caCodigoAgrupacionCanal</ColumnID>
                  </Source>
                </KeyColumn>
              </KeyColumns>
              <NameColumn>
                <DataType>WChar</DataType>
                <DataSize>32766</DataSize>
                <NullProcessing>ZeroOrBlank</NullProcessing>
                <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                <Source xsi:type="ColumnBinding">
                  <TableID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</TableID>
                  <ColumnID>caCodigoAgrupacionCanal</ColumnID>
                </Source>
              </NameColumn>
              <OrderBy>Key</OrderBy>
            </Attribute>
          </Attributes>
          <Hierarchies>
            <Hierarchy>
              <ID>Canal_N1</ID>
              <Name>Canal_N1</Name>
              <Levels>
                <Level>
                  <ID>Orden</ID>
                  <Name>Orden</Name>
                  <SourceAttributeID>Orden</SourceAttributeID>
                </Level>
                <Level>
                  <ID>caDescripcionAgrupacionCanal</ID>
                  <Name>caDescripcionAgrupacionCanal</Name>
                  <SourceAttributeID>caDescripcionAgrupacionCanal</SourceAttributeID>
                </Level>
              </Levels>
            </Hierarchy>
            <Hierarchy>
              <ID>Canal_N2</ID>
              <Name>Canal_N2</Name>
              <Levels>
                <Level>
                  <ID>OrdenNegTes</ID>
                  <Name>OrdenNegTes</Name>
                  <SourceAttributeID>OrdenNegTes</SourceAttributeID>
                </Level>
                <Level>
                  <ID>caNegTes</ID>
                  <Name>caNegTes</Name>
                  <SourceAttributeID>caNegTes</SourceAttributeID>
                </Level>
              </Levels>
            </Hierarchy>
          </Hierarchies>
          <ProactiveCaching>
            <SilenceInterval>-PT1S</SilenceInterval>
            <Latency>-PT1S</Latency>
            <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
            <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
            <Source xsi:type="ProactiveCachingInheritedBinding" />
          </ProactiveCaching>
        </Dimension>
      </Dimensions>
      <Cubes>
        <Cube>
          <ID>Model</ID>
          <Name>Model</Name>
          <Annotations>
            <Annotation>
              <Name>DefaultMeasure</Name>
              <Value>__No measures defined</Value>
            </Annotation>
          </Annotations>
          <Language>2058</Language>
          <Dimensions>
            <Dimension>
              <ID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</ID>
              <Name>HojaPosicion</Name>
              <DimensionID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</DimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>RowNumber</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>OrdenN1</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>OrdenN2</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>OrdenN3</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>Jerarquia</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>Canal</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>Division</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>Nivel1</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>Nivel2</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>Nivel3</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>Nivel4</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>Nivel5</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>RealHoy</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>DenominadorHoy</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>RealAyer</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>DenominadorAyer</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>RealMesAnt</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>DenominadorMesAnt</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>RealAnioAnt</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>DenominadorAnioAnt</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>ValorPresupuesto</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>DenominadorPresupuesto</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>TipoBandera</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>ConcentracionMorosidad</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>FechaHoy</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>Consolidado</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>Calculated Column 1</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>hpCalSeccion</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>Nivel3_2</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>CodigoConsolidado</AttributeID>
                </Attribute>
              </Attributes>
              <Hierarchies>
                <Hierarchy>
                  <HierarchyID>Niveles2</HierarchyID>
                </Hierarchy>
              </Hierarchies>
            </Dimension>
            <Dimension>
              <ID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</ID>
              <Name>MargenFinanciero</Name>
              <DimensionID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</DimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>__XL_RowNumber</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>Jerarquia</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>Agrupacion</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>CodigoN1</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>DescripcionN1</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>CodigoN2</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>DescripcionN2</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>CodigoN3</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>DescripcionN3</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>CodigoN4</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>DescripcionN4</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>CodigoN5</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>diaPart</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>diaSaldo</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>diaTPP</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>diaPYG</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>mesPart</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>mesSaldo</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>mesTPP</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>mesPYG</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>anioPart</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>anioSaldo</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>anioTPP</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>anioPYG</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>mesPres</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>anioPres</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>DescripcionN5</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>CodigoSeccion</AttributeID>
                </Attribute>
              </Attributes>
              <Hierarchies>
                <Hierarchy>
                  <HierarchyID>Niveles</HierarchyID>
                </Hierarchy>
              </Hierarchies>
            </Dimension>
            <Dimension>
              <ID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</ID>
              <Name>IndicadoresTasaMargen</Name>
              <DimensionID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</DimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>__XL_RowNumber</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>Agrupacion</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>tmFecha</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>tmCodigoIndicador</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>tmDescripcion</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>tmTPPdia</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>TotalTPPdia</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>tmTPPmes</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>TotalTPPmes</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>tmTPPtrimestre</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>TotalTPPtrimestre</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>tmTPPanio</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>TotalTPPanio</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>tmSaldoDiario</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>TotalSaldoDiario</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>Orden</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>Calculated Column 1</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>Slicer_Agrupacion</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>DescripcionCabecera</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>tmbandera</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <ID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</ID>
              <Name>Fecha</Name>
              <DimensionID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</DimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>__XL_RowNumber</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feIdFecha</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feFechaCodigoAlt</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>feFecha</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>feDescripcionFecha</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feCalAnio</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>feCalMes</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>feCalDia</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>feCalDiaAnio</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feTrimNumero</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>feTrimMes</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feTrimDia</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feCopaCodigo</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feCopaMes</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feCopaDia</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feFeriado</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feFeriadoNombre</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feTemporada</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feCierreMes</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>feFinMes</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feFinSemana</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feFutura</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feDiasReplicarProximos</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feDiasReplicarAnteriores</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>EsDiaAnterior</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>fecIdAnterior</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>EsCierreAño</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feMesAntCierr</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feAnioAntCierr</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feIdFechaAnioAnt</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feIdFechaCierreAnioAnt</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>feFechaCierreAnio</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>FechaFormato</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>FormatoFechaMesAnio</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <ID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</ID>
              <Name>ConsolidadoHojaPosicion</Name>
              <DimensionID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</DimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>__XL_RowNumber</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>CodCliente</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>NombreCliente</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>CodigoMoneda</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>CodigoAgenciaOper</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>CodigoAgenciaCli</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>CodProducto</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>FechaVencimiento</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>FechaApertura</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>NumeroOperacion</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>Plazo</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>OperacionCliente</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>CodCanal</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>OrdenN1</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>OrdenN2</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>Canal</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>Nivel1</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>Nivel2</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>Nivel3</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>TasaHoy</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>TasaAyer</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>TasaMesAnt</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>TasaAnioAnt</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>RealHoy</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>RealAyer</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>RealMesAnt</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>RealAnioAnt</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>CodCliente2</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>Add Column2</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>Nivel2Descrip</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>CodigoProducto</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>DescripcionCabecera</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <ID>DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f</ID>
              <Name>Rangos</Name>
              <DimensionID>DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f</DimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>__XL_RowNumber</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>Valor</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>Descripcion</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>Orden</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>CodigoRango</AttributeID>
                </Attribute>
              </Attributes>
              <Hierarchies>
                <Hierarchy>
                  <HierarchyID>Rango</HierarchyID>
                </Hierarchy>
              </Hierarchies>
            </Dimension>
            <Dimension>
              <ID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</ID>
              <Name>Canal</Name>
              <DimensionID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</DimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>__XL_RowNumber</AttributeID>
                  <AttributeHierarchyVisible>false</AttributeHierarchyVisible>
                </Attribute>
                <Attribute>
                  <AttributeID>Orden</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>caDescripcionAgrupacionCanal</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>caNegTes</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>OrdenNegTes</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>CodigoCanalOrden</AttributeID>
                </Attribute>
                <Attribute>
                  <AttributeID>caCodigoAgrupacionCanal</AttributeID>
                </Attribute>
              </Attributes>
              <Hierarchies>
                <Hierarchy>
                  <HierarchyID>Canal_N1</HierarchyID>
                </Hierarchy>
                <Hierarchy>
                  <HierarchyID>Canal_N2</HierarchyID>
                </Hierarchy>
              </Hierarchies>
            </Dimension>
          </Dimensions>
          <CubePermissions>
            <CubePermission>
              <ID>CubePermission</ID>
              <Name>CubePermission</Name>
              <RoleID>Role</RoleID>
              <Read>Allowed</Read>
              <ReadSourceData>None</ReadSourceData>
            </CubePermission>
            <CubePermission>
              <ID>CubePermission 1</ID>
              <Name>CubePermission 1</Name>
              <RoleID>Role 1</RoleID>
              <ReadSourceData>None</ReadSourceData>
            </CubePermission>
          </CubePermissions>
          <MeasureGroups>
            <MeasureGroup>
              <ID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</ID>
              <Name>HojaPosicion</Name>
              <Measures>
                <Measure>
                  <ID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</ID>
                  <Name>_Count HojaPosicion</Name>
                  <AggregateFunction>Count</AggregateFunction>
                  <DataType>BigInt</DataType>
                  <Source>
                    <DataType>BigInt</DataType>
                    <DataSize>8</DataSize>
                    <Source xsi:type="RowBinding">
                      <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                    </Source>
                  </Source>
                  <Visible>false</Visible>
                </Measure>
              </Measures>
              <StorageMode valuens="ddl200_200">InMemory</StorageMode>
              <ErrorConfiguration>
                <KeyNotFound>IgnoreError</KeyNotFound>
                <KeyDuplicate>ReportAndStop</KeyDuplicate>
                <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
              </ErrorConfiguration>
              <ProcessingMode>Regular</ProcessingMode>
              <Dimensions>
                <Dimension xsi:type="DegenerateMeasureGroupDimension">
                  <CubeDimensionID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>RowNumber</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion</TableID>
                            <ColumnID>RowNumber</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                      <Type>Granularity</Type>
                    </Attribute>
                    <Attribute>
                      <AttributeID>OrdenN1</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>OrdenN1</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>OrdenN2</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>OrdenN2</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>OrdenN3</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>OrdenN3</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Jerarquia</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>Jerarquia</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Canal</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32768</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>Canal</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Division</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32768</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>Division</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Nivel1</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32768</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>Nivel1</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Nivel2</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32768</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>Nivel2</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Nivel3</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32768</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>Nivel3</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Nivel4</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32768</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>Nivel4</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Nivel5</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32768</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>Nivel5</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>RealHoy</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>RealHoy</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>DenominadorHoy</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>DenominadorHoy</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>RealAyer</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>RealAyer</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>DenominadorAyer</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>DenominadorAyer</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>RealMesAnt</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>RealMesAnt</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>DenominadorMesAnt</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>DenominadorMesAnt</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>RealAnioAnt</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>RealAnioAnt</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>DenominadorAnioAnt</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>DenominadorAnioAnt</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>ValorPresupuesto</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>ValorPresupuesto</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>DenominadorPresupuesto</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>DenominadorPresupuesto</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>TipoBandera</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>ConcentracionMorosidad</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>FechaHoy</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>FechaHoy</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Consolidado</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</TableID>
                            <ColumnID>Consolidado</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Calculated Column 1</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>hpCalSeccion</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Nivel3_2</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodigoConsolidado</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                  </Attributes>
                  <ddl200_200:ShareDimensionStorage>Shared</ddl200_200:ShareDimensionStorage>
                </Dimension>
                <Dimension xsi:type="ReferenceMeasureGroupDimension">
                  <CubeDimensionID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>__XL_RowNumber</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>4</DataSize>
                          <NullProcessing>Error</NullProcessing>
                          <Source xsi:type="ddl200_200:RowNumberBinding" />
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Orden</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</TableID>
                            <ColumnID>Orden</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>caDescripcionAgrupacionCanal</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Error</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</TableID>
                            <ColumnID>caDescripcionAgrupacionCanal</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                      <Type>Granularity</Type>
                    </Attribute>
                    <Attribute>
                      <AttributeID>caNegTes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression>IF(Canal[caDescripcionAgrupacionCanal]="Comercial" || Canal[caDescripcionAgrupacionCanal]="Corporativo" || Canal[caDescripcionAgrupacionCanal]="Especializada","Negocios","Otros Canales")</Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>OrdenNegTes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression>IF([caNeg]="Negocios",1,2)</Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodigoCanalOrden</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression>"X"&amp;Canal[Orden]&amp;"X"</Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>caCodigoAgrupacionCanal</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</TableID>
                            <ColumnID>caCodigoAgrupacionCanal</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                  </Attributes>
                  <IntermediateCubeDimensionID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</IntermediateCubeDimensionID>
                  <IntermediateGranularityAttributeID>Canal</IntermediateGranularityAttributeID>
                  <Materialization>Regular</Materialization>
                  <ddl300:RelationshipID>b140766c-8d26-461d-9edc-b65b4e43a4a2</ddl300:RelationshipID>
                </Dimension>
                <Dimension xsi:type="ReferenceMeasureGroupDimension">
                  <CubeDimensionID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>__XL_RowNumber</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>4</DataSize>
                          <NullProcessing>Error</NullProcessing>
                          <Source xsi:type="ddl200_200:RowNumberBinding" />
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feIdFecha</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Error</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feIdFecha</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                      <Type>Granularity</Type>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFechaCodigoAlt</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFechaCodigoAlt</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFecha</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Date</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFecha</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feDescripcionFecha</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feDescripcionFecha</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCalAnio</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCalAnio</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCalMes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Currency</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCalMes</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCalDia</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCalDia</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCalDiaAnio</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCalDiaAnio</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feTrimNumero</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feTrimNumero</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feTrimMes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feTrimMes</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feTrimDia</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feTrimDia</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCopaCodigo</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCopaCodigo</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCopaMes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCopaMes</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCopaDia</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCopaDia</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFeriado</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFeriado</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFeriadoNombre</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFeriadoNombre</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feTemporada</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feTemporada</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCierreMes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCierreMes</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFinMes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFinMes</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFinSemana</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFinSemana</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFutura</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFutura</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feDiasReplicarProximos</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feDiasReplicarProximos</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feDiasReplicarAnteriores</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feDiasReplicarAnteriores</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>EsDiaAnterior</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>EsDiaAnterior</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>fecIdAnterior</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>fecIdAnterior</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>EsCierreAño</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>EsCierreAño</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feMesAntCierr</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feMesAntCierr</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feAnioAntCierr</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feAnioAntCierr</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feIdFechaAnioAnt</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feIdFechaAnioAnt</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feIdFechaCierreAnioAnt</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feIdFechaCierreAnioAnt</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFechaCierreAnio</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Date</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFechaCierreAnio</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>FechaFormato</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression>FORMAT(Fecha[feFecha],"Long Date")</Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>FormatoFechaMesAnio</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                  </Attributes>
                  <IntermediateCubeDimensionID>HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4</IntermediateCubeDimensionID>
                  <IntermediateGranularityAttributeID>FechaHoy</IntermediateGranularityAttributeID>
                  <Materialization>Regular</Materialization>
                  <ddl300:RelationshipID>9aedbd06-610b-4de5-bd74-2178a3bc798f</ddl300:RelationshipID>
                </Dimension>
              </Dimensions>
              <Partitions>
                <Partition>
                  <ID>HojaPosicion_80c17e51-66b3-45a0-bc35-9dc0f9249c4a</ID>
                  <Name>DWHHojaPosicionDiaria</Name>
                  <Annotations>
                    <Annotation>
                      <Name>QueryEditorSerialization</Name>
                      <Value>&lt;?xml version="1.0" encoding="UTF-16"?&gt;&lt;Gemini xmlns="QueryEditorSerialization"&gt;&lt;AnnotationContent&gt;&lt;![CDATA[&lt;RSQueryCommandText&gt;SET NOCOUNT ON

declare @FechAct int, @FechaAyer int, @FechaMesAnt int, @FechaAnioAnt int, @Nivel1 varchar(100),
@OrdenCaptacionConcetracion int, @OrdenCaptacionCanal int, @OrdenCaptacionSegmentacion int,
@DescripcionCartera varchar(50),@OrdenCarteraCanal int ,@OrdenCarteraSegmentacion int,
@OrdenContingenteCanal int, @OrdenContingenteSegmentacion int,
@OrdenCaptacionConcetracionN2 int, @OrdenCarteraNivel1 int,@OrdenCarteraNivel2 int,
@CanalAgrTit varchar(50), @OrdenCanalTit int, @CanalTit varchar(50),
@TitularizadaN1 int, @TitularizadaN2 int


select @FechAct=max(feIdFecha) from DWDFecha where fediaactual = 1

select
@FechaAyer=fecIdAnterior,
@FechaMesAnt=feMesAntCierr,
@FechaAnioAnt=feAnioAntCierr
from  DWDFecha
where feIdFecha=@FechAct


/* ----------------------- */
/*    DESENCRIPTACION      */
/* ----------------------- */

OPEN SYMMETRIC KEY ClaveMIS02
DECRYPTION BY CERTIFICATE Certi01


if object_id('[tempdb]..#DWDCuentaContable') is not null
begin
drop table #DWDCuentaContable
end

select
ccIdCuentaContable,
ccCodigoMoneda,
case 
when ccOrdenAgrupacionN2=4 then case 
								when CpEstadoProducto = 'VEN' then 'Vencida'
								when CpEstadoProducto = 'NDE' then 'QnDevInter'
								else 'Vigente' end 
else ccSubGrupo 
end ccSubGrupo,
ccGrupo,
ccFamiliaProducto,
ccCodigoIndicador,
ccClasificacionEstado,
ccOrdenAgrupacion,
ccOrdenAgrupacionN2,
ccOrdenAgrupacionN3 = case when indicadorNivel2=124 and ccOrdenAgrupacionN3 is null then 11 else ccOrdenAgrupacionN3 end ,
ccCodigoNivel6=CONVERT(varchar(15), DecryptByKey(ccCodigoNivel6)),
ccCovid,
AgrupacionCovid=case when ccCovid=1  then ccFamiliaProducto + ccSubGrupo  else ccFamiliaProducto end 
into #DWDCuentaContable 
from DWDCuentaContable
left outer join [vuClasificacionProductos] on indicadorNivel3 = cccodigoIndicador
where indicadorNivel1 != 64


if object_id('[tempdb]..#DWDTitularizadaOperacion') is not null
begin
drop table #DWDTitularizadaOperacion
end


select top 0
toNombre,
toCedula=CONVERT(varchar(15), DecryptByKey(toCedula)),
toOperacion=CONVERT(varchar(9), DecryptByKey(toOperacion))

into #DWDTitularizadaOperacion --0
from DWDTitularizadaOperacion


if object_id('[tempdb]..#DWHCuotaOperacion') is not null
begin
drop table #DWHCuotaOperacion
end


select
coIdFecha,
coIdAgencia,
coIdAsesorPrincipal,
coIdAsesorSecundario,
coIdCliente,
coIdCuentaContable,
coIdProducto,
coIdMoneda,
coCuotaCapital,
coNumeroOperacion=coNumeroOperacion2 --CONVERT(varchar(15), DecryptByKey(coNumeroOperacion))
into #DWHCuotaOperacion --944581
from DWHCuotaOperacionMes
where coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and abs(coCuotaCapital)&gt;0



if object_id('[tempdb]..#DWHActivoOperacion') is not null
begin
drop table #DWHActivoOperacion
end


select
aoIdFecha,
aoIdAgencia,
aoIdAsesorPrincipal,
aoIdAsesorSecundario,
aoIdCliente,
aoIdCuentaContable,
aoIdProducto,
aoIdMoneda,
aoMontoSaldoDolar,
aoPlazoOperacion,
aoNumeroOperacion=CONVERT(varchar(15), DecryptByKey(aoNumeroOperacion)),
aoNumeroOperacion2

into #DWHActivoOperacion
from DWHActivoOperacion --60973
where aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and abs(aoMontoSaldoDolar)&gt;0

CLOSE SYMMETRIC KEY ClaveMIS02

/* ---------------- */
/* PASIVO OPERACION */
/* ---------------- */

if object_id('[tempdb]..#DWHPasivoOperacion') is not null
begin
drop table #DWHPasivoOperacion
end

select
 poIdFecha
,poIdProducto
,poIdMoneda
,poIdAgencia
,poIdAsesor
,poIdCliente
,poSaldoOperacionUSD
,poIdCuentaContable
into  #DWHPasivoOperacion
from DWHPasivoOperacionMes --1727655
where poIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and abs(poSaldoOperacionUSD)&gt;0

/* ----------------- */
/* TARJETA OPERACION */
/* ----------------- */

if object_id('[tempdb]..#DWHTarjetaCreditoOperacion') is not null
begin
drop table #DWHTarjetaCreditoOperacion
end

select
 tcoIdFecha
,tcoIdAgencia
,tcoIdCuentaContable
,tcoIdMoneda
,tcoIdProducto
,tcoIdCliente
,tcoSaldo
into #DWHTarjetaCreditoOperacion
from DWHTarjetaCreditoOperacion
where tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and abs(tcoSaldo)&gt;0


--------------------------------------------------------
-- Actualizacion de titularizada a Cartera Titularizada
--------------------------------------------------------

update #DWDCuentaContable
set
ccFamiliaProducto='Cartera',
ccGrupo='C. Titularizada',
ccSubGrupo=null
where cccodigoindicador in (136,137,138)


/* -------------------------------------------- */
/* OBTENCION DE NUMERO DE ORDEN Y DESCRIPCIONES */
/* -------------------------------------------- */

--&gt;&gt; CAPTACIONES

select distinct @Nivel1=ccFamiliaProducto
from #DWDCuentaContable
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (2)
and p1.CpCodigoIndicador in (140)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3

select
@OrdenCaptacionConcetracion=max(ccOrdenAgrupacion),
@OrdenCaptacionConcetracionN2=max(ccOrdenAgrupacionN2)
from #DWDCuentaContable cc
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (2)
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3

select
@OrdenCaptacionCanal=max(ccOrdenAgrupacion)+1,
@OrdenCaptacionSegmentacion=max(ccOrdenAgrupacion)+2
from #DWDCuentaContable
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (2)
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3


--&gt;&gt; CARTERA

select
@OrdenCarteraNivel1=max(ccOrdenAgrupacion),
@OrdenCarteraNivel2=max(ccOrdenAgrupacionN2),
@OrdenCarteraCanal=max(ccOrdenAgrupacion)+1,
@OrdenCarteraSegmentacion=max(ccOrdenAgrupacion)+2
from #DWDCuentaContable
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (1)
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3


select @DescripcionCartera=max(ccFamiliaProducto)
from #DWDCuentaContable
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (1)
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3


--&gt;&gt; CONTINGENTES

select @OrdenContingenteCanal=max(ccOrdenAgrupacion)+1,
@OrdenContingenteSegmentacion=max(ccOrdenAgrupacion)+2
from #DWDCuentaContable
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (3)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3


--&gt;&gt; TITULARIZADA

select
@TitularizadaN1=max(prOrdenN1),
@TitularizadaN2=max(prOrdenN2)+1
from DWDProducto where prGrupo='Vehiculos'

select
@CanalTit=caDescripcionAgrupacionCanal,
@CanalAgrTit=caAgrupacion,
@OrdenCanalTit=caOrdenCanal
from DWDCanal
where caCodigoCanal='TIT'



if object_id('[tempdb]..#Cartera')  is not null
begin
drop table #Cartera
end

--- Identificacion vehiculos

if object_id('[tempdb]..#Vehiculos') is not null
begin
drop table #Vehiculos
end

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
pr.prOrdenN1,
pr.prOrdenN2,
pr.prOrdenN3,
ca.caOrdenCanal,
cc.ccOrdenAgrupacionN3,
--Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
--Division='NO',
cc.ccFamiliaProducto,
pr.prVehiculo,
ca.caAgrupacion,
cc.AgrupacionCovid,
pr.prSubGrupo,
pr.prCodigoIndicador,
cc.ccSubGrupo,
cc.ccCovid,

RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end

into #Vehiculos

from #DWHCuotaOperacion co
inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador =1
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and pr.prVehiculo='Vehiculos'
and ccCodigoMoneda=moCodigoMoneda
and clFechaFin is null
and ca.caEstado=1
--and cc.ccCodigoMoneda='USD'
group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
ca.caOrdenCanal,
mo.moCodigoMoneda,
ca.caDescripcionAgrupacionCanal,
pr.prOrdenN1,
pr.prOrdenN2,
cc.ccFamiliaProducto,
ccOrdenAgrupacion,
ccOrdenAgrupacionN2,
ccOrdenAgrupacionN3,
ca.caAgrupacion,
pr.prVehiculo,
co.coIdFecha, --202815
cc.AgrupacionCovid,
pr.prOrdenN3,
pr.prSubGrupo,
pr.prCodigoIndicador,
cc.ccSubGrupo,
cc.ccCovid,
cc.ccOrdenAgrupacionN3


/* ---------------------------------------------------------------------- */
/*                           CARTERA                                      */
/* ---------------------------------------------------------------------- */

-- Comer. + Micro. (525,526,524,501,504,506,505,509,507)
-- Consumo (510,511,512,513,514,515)
-- Vivienda (519,520,521,522,523)
-- Titularizada (136,137,138)

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=ca.caOrdenCanal,
Jerarquia=4,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='     '+ca.caAgrupacion,
Nivel4='     '+cc.AgrupacionCovid,
Nivel5='     '+cc.AgrupacionCovid,
RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0

into #Cartera

from #DWHCuotaOperacion co
inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
left outer join #DWDTitularizadaOperacion ti on  isnull(co.coNumeroOperacion,'')=ti.toOperacion
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end/**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and pr.prVehiculo is null
and cl.clFechaFin is null
and ca.caEstado=1
and ti.toOperacion is null -- Filtro Titularizada
--and cc.ccCodigoMoneda='USD'

group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
co.coIdFecha,
cl.clCodigoCliente,
ca.caAgrupacion,
ca.caOrdenCanal,
ca.caDescripcionAgrupacionCanal,
cl.clNombreCompleto,
mo.moCodigoMoneda,
cc.ccOrdenAgrupacionN2,
cc.ccFamiliaProducto,
prCodigoProducto,
ccCodigoNivel6,
cc.ccGrupo,
cc.ccOrdenAgrupacion,
cc.ccCodigoIndicador, --20303
cc.AgrupacionCovid

Union All

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
--  Agrupaciones
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=cc.ccOrdenAgrupacionN3,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3=cc.ccSubGrupo,
Nivel4=cc.ccSubGrupo,
Nivel5=cc.ccSubGrupo,
RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHCuotaOperacion co
inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
left outer join #DWDTitularizadaOperacion ti on  isnull(co.coNumeroOperacion,'')=ti.toOperacion
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha  in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and pr.prVehiculo is null
and cl.clFechaFin is null
and ccCodigoMoneda=moCodigoMoneda
and ca.caEstado=1
and ti.toOperacion is null -- Filtro titularizada
--and cc.ccCodigoMoneda='USD'
group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
cc.ccFamiliaProducto,
cc.ccGrupo,
cc.ccOrdenAgrupacion,
ca.caDescripcionAgrupacionCanal,
cc.ccOrdenAgrupacionN2,
cc.ccOrdenAgrupacionN3,
cc.ccSubGrupo,
co.coIdFecha--20354

Union All

--&gt;&gt;  Agrupaciones Valor Deduccion

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=cc.ccOrdenAgrupacionN3,
Jerarquia=2,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
RealHoy=case co.coIdFecha when @FechAct then (sum(isnull(co.coCuotaCapital,0))/1000)*-1 else 0 end,
DenominadorHoy=0,
RealAyer=case co.coIdFecha when @FechaAyer then (sum(isnull(co.coCuotaCapital,0))/1000)*-1 else 0 end,
DenominadorAyer=0,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then (sum(isnull(co.coCuotaCapital,0))/1000)*-1 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then (sum(isnull(co.coCuotaCapital,0))/1000)*-1 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHCuotaOperacion co
inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
left outer join #DWDTitularizadaOperacion ti on  isnull(co.coNumeroOperacion,'')=ti.toOperacion
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha  in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and pr.prVehiculo is null
and cl.clFechaFin is null
and ca.caEstado=1
and ccCodigoMoneda=moCodigoMoneda
and ti.toOperacion is null -- Filtro titularizada
--and cc.ccCodigoMoneda='USD'
group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
cc.ccFamiliaProducto,
cc.ccGrupo,
cc.ccOrdenAgrupacion,
ca.caDescripcionAgrupacionCanal,
cc.ccOrdenAgrupacionN2,
cc.ccOrdenAgrupacionN3,
co.coIdFecha --20405

Union All

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- T. Credito
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

			select
			Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
			OrdenN1=cc.ccOrdenAgrupacion,
			OrdenN2=cc.ccOrdenAgrupacionN2,
			OrdenN3=ca.caOrdenCanal,
			Jerarquia=4,
			Canal=ca.caDescripcionAgrupacionCanal,
			Division='NO',
			Nivel1=cc.ccFamiliaProducto,
			Nivel2=cc.ccGrupo,
			Nivel3='     '+ca.caAgrupacion,
			Nivel4='     '+cc.AgrupacionCovid,
			Nivel5='     '+cc.AgrupacionCovid,
			RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorHoy=0,
			RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorAyer=0,
			RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorMesAnt=0,
			RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorAnioAnt=0,
			ValorPresupuesto=0,
			DenominadorPresupuesto=0
			from #DWHTarjetaCreditoOperacion tco
			inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto
			inner join DWDMoneda on moIdMoneda=tcoIdMoneda
			inner join (
			SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
			,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador = 1
			and p1.CpCodigoIndicador = 124
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
			where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and cl.clFechaFin is null
			and ca.caEstado=1
			--and cc.ccCodigoMoneda='USD'
			group by
			cp.CpEstadoProducto, --ccClasificacionEstado, /**/
			cc.ccOrdenAgrupacion,
			cl.clCodigoCliente,
			ca.caOrdenCanal,
			cc.ccOrdenAgrupacionN2,
			ca.caDescripcionAgrupacionCanal,
			cc.ccFamiliaProducto,
			caAgrupacion,
			cc.ccGrupo,
			tco.tcoIdFecha, --202793
			cc.AgrupacionCovid

			union all

			-- Agrupacion Covid Tarjeta de credito

			select
			Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
			OrdenN1=cc.ccOrdenAgrupacion,
			OrdenN2=cc.ccOrdenAgrupacionN2,
			OrdenN3=cc.ccOrdenAgrupacionN3,
			Jerarquia=3,
			Canal=ca.caDescripcionAgrupacionCanal,
			Division='NO',
			Nivel1=cc.ccFamiliaProducto,
			Nivel2=cc.ccGrupo,
			Nivel3='     '+cc.ccSubGrupo,
			Nivel4='     '+cc.ccSubGrupo,
			Nivel5='     '+cc.ccSubGrupo,
			RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorHoy=0,
			RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorAyer=0,
			RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorMesAnt=0,
			RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorAnioAnt=0,
			ValorPresupuesto=0,
			DenominadorPresupuesto=0
			from #DWHTarjetaCreditoOperacion tco
			inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto
			inner join DWDMoneda on moIdMoneda=tcoIdMoneda
			inner join (
			SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
			,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador = 1
			and p1.CpCodigoIndicador = 124
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
			where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and cl.clFechaFin is null
			and ca.caEstado=1
			and cc.ccCovid=1
			--and cc.ccCodigoMoneda='USD'
			group by
			cp.CpEstadoProducto, --ccClasificacionEstado, /**/
			cc.ccOrdenAgrupacion,
			cl.clCodigoCliente,
			ca.caOrdenCanal,
			cc.ccOrdenAgrupacionN2,
			ca.caDescripcionAgrupacionCanal,
			cc.ccFamiliaProducto,
			cc.ccGrupo,
			tco.tcoIdFecha, --202793
			cc.ccSubGrupo,
			cc.ccOrdenAgrupacionN3

			union all

			-- valor deduccion covid de tarjeta

			select
			Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
			OrdenN1=cc.ccOrdenAgrupacion,
			OrdenN2=cc.ccOrdenAgrupacionN2,
			OrdenN3=cc.ccOrdenAgrupacionN3,
			Jerarquia=2,
			Canal=ca.caDescripcionAgrupacionCanal,
			Division='NO',
			Nivel1=cc.ccFamiliaProducto,
			Nivel2=cc.ccGrupo,
			Nivel3='Deducción',
			Nivel4='Deducción',
			Nivel5='Deducción',
			RealHoy=case tco.tcoIdFecha when @FechAct then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
			DenominadorHoy=0,
			RealAyer=case tco.tcoIdFecha when @FechaAyer then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
			DenominadorAyer=0,
			RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
			DenominadorMesAnt=0,
			RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
			DenominadorAnioAnt=0,
			ValorPresupuesto=0,
			DenominadorPresupuesto=0
			from #DWHTarjetaCreditoOperacion tco
			inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto
			inner join DWDMoneda on moIdMoneda=tcoIdMoneda
			inner join (
			SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
			,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador = 1
			and p1.CpCodigoIndicador = 124
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
			where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and cl.clFechaFin is null
			and ca.caEstado=1
			and cc.ccCovid=1
			--and cc.ccCodigoMoneda='USD'
			group by
			cp.CpEstadoProducto,
			cc.ccOrdenAgrupacion,
			cl.clCodigoCliente,
			ca.caOrdenCanal,
			cc.ccOrdenAgrupacionN2,
			ca.caDescripcionAgrupacionCanal,
			cc.ccFamiliaProducto,
			cc.ccGrupo,
			tco.tcoIdFecha, --202793
			cc.ccOrdenAgrupacionN3

			Union All

			-- Agrupacion Tarjeta de credito Dificultades

			select
			Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
			OrdenN1=cc.ccOrdenAgrupacion,
			OrdenN2=cc.ccOrdenAgrupacionN2,
			OrdenN3=cc.ccOrdenAgrupacionN3,
			Jerarquia=3,
			Canal=ca.caDescripcionAgrupacionCanal,
			Division='NO',
			Nivel1=cc.ccFamiliaProducto,
			Nivel2=cc.ccGrupo,
			Nivel3='     '+cc.ccSubGrupo,
			Nivel4='     '+cc.ccSubGrupo,
			Nivel5='     '+cc.ccSubGrupo,
			RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorHoy=0,
			RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorAyer=0,
			RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorMesAnt=0,
			RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorAnioAnt=0,
			ValorPresupuesto=0,
			DenominadorPresupuesto=0
			from #DWHTarjetaCreditoOperacion tco
			inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto
			inner join DWDMoneda on moIdMoneda=tcoIdMoneda
			inner join (
			SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
			,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador = 1
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
			where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and cl.clFechaFin is null
			and ca.caEstado=1
			and cc.ccCovid != 1
			group by
			cp.CpEstadoProducto,
			cc.ccOrdenAgrupacion,
			cl.clCodigoCliente,
			ca.caOrdenCanal,
			cc.ccOrdenAgrupacionN2,
			ca.caDescripcionAgrupacionCanal,
			cc.ccFamiliaProducto,
			cc.ccGrupo,
			tco.tcoIdFecha, --202793
			cc.ccSubGrupo,
			cc.ccOrdenAgrupacionN3

			union all

			-- valor deduccion de tarjeta Dificultades

			select
			Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
			OrdenN1=cc.ccOrdenAgrupacion,
			OrdenN2=cc.ccOrdenAgrupacionN2,
			OrdenN3=cc.ccOrdenAgrupacionN3,
			Jerarquia=2,
			Canal=ca.caDescripcionAgrupacionCanal,
			Division='NO',
			Nivel1=cc.ccFamiliaProducto,
			Nivel2=cc.ccGrupo,
			Nivel3='Deducción',
			Nivel4='Deducción',
			Nivel5='Deducción',
			RealHoy=case tco.tcoIdFecha when @FechAct then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
			DenominadorHoy=0,
			RealAyer=case tco.tcoIdFecha when @FechaAyer then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
			DenominadorAyer=0,
			RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
			DenominadorMesAnt=0,
			RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
			DenominadorAnioAnt=0,
			ValorPresupuesto=0,
			DenominadorPresupuesto=0
			from #DWHTarjetaCreditoOperacion tco
			inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto
			inner join DWDMoneda on moIdMoneda=tcoIdMoneda
			inner join (
			SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
			,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador = 1
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
			where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and cl.clFechaFin is null
			and ca.caEstado=1
			and cc.ccCovid != 1
			group by
			cp.CpEstadoProducto,
			cc.ccOrdenAgrupacion,
			cl.clCodigoCliente,
			ca.caOrdenCanal,
			cc.ccOrdenAgrupacionN2,
			ca.caDescripcionAgrupacionCanal,
			cc.ccFamiliaProducto,
			cc.ccGrupo,
			tco.tcoIdFecha,
			cc.ccOrdenAgrupacionN3

			Union All

			--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- Vehiculos
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
Estado,--ccClasificacionEstado, /**/
OrdenN1=prOrdenN1,
OrdenN2=prOrdenN2,
OrdenN3=caOrdenCanal,
Jerarquia=4,
Canal,
Division='NO',
Nivel1=ccFamiliaProducto,
Nivel2=prVehiculo,
Nivel3='     '+caAgrupacion,
Nivel4='     '+AgrupacionCovid,
Nivel5='     '+AgrupacionCovid,
RealHoy,
DenominadorHoy=0,
RealAyer,
DenominadorAyer=0,
RealMesAnt,
DenominadorMesAnt=0,
RealAnioAnt,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #Vehiculos co

Union All

--&gt;&gt; Vehiculos Credimetrica y Originarsa

select
Estado,--ccClasificacionEstado, /**/
OrdenN1=prOrdenN1,
OrdenN2=prOrdenN2,
OrdenN3=prOrdenN3,
Jerarquia=4,
Canal,
Division='NO',
Nivel1=ccFamiliaProducto,
Nivel2=prVehiculo,
Nivel3=prSubGrupo,
Nivel4=AgrupacionCovid,
Nivel5=AgrupacionCovid,
RealHoy,
DenominadorHoy=0,
RealAyer,
DenominadorAyer=0,
RealMesAnt,
DenominadorMesAnt=0,
RealAnioAnt,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #Vehiculos
where prCodigoIndicador in (527,528,529,530,531)


Union All

--&gt;&gt; Valor deduccion Credimetrica y Originarsa

select
Estado,--ccClasificacionEstado, /**/
OrdenN1=prOrdenN1,
OrdenN2=prOrdenN2,
OrdenN3=prOrdenN3,
Jerarquia=2,
Canal,
Division='NO',
Nivel1=ccFamiliaProducto,
Nivel2=prVehiculo,
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
RealHoy=RealHoy*-1,
DenominadorHoy=0,
RealAyer=RealAyer*-1,
DenominadorAyer=0,
RealMesAnt=RealMesAnt*-1,
DenominadorMesAnt=0,
RealAnioAnt=RealAnioAnt*-1,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #Vehiculos
where prCodigoIndicador in (527,528,529,530,531)

union all

-- agrupacion covid vehiculos
select
Estado,--ccClasificacionEstado, /**/
OrdenN1=prOrdenN1,
OrdenN2=prOrdenN2,
OrdenN3=ccOrdenAgrupacionN3,
Jerarquia=3,
Canal,
Division='NO',
Nivel1=ccFamiliaProducto,
Nivel2=prVehiculo,
Nivel3=ccSubGrupo,
Nivel4=ccSubGrupo,
Nivel5=ccSubGrupo,
RealHoy,
DenominadorHoy=0,
RealAyer,
DenominadorAyer=0,
RealMesAnt,
DenominadorMesAnt=0,
RealAnioAnt,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #Vehiculos
where ccCovid=1


union all

-- agrupacion covid vehiculos
select
Estado,--ccClasificacionEstado, /**/
OrdenN1=prOrdenN1,
OrdenN2=prOrdenN2,
OrdenN3=ccOrdenAgrupacionN3,
Jerarquia=2,
Canal,
Division='NO',
Nivel1=ccFamiliaProducto,
Nivel2=prVehiculo,
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
RealHoy=RealHoy*-1,
DenominadorHoy=0,
RealAyer=RealAyer*-1,
DenominadorAyer=0,
RealMesAnt=RealMesAnt*-1,
DenominadorMesAnt=0,
RealAnioAnt=RealAnioAnt*-1,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #Vehiculos
where ccCovid=1

Union all

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- Titularizada
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

--&gt; Identificacion de C.Titularizada por número de operación

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=@TitularizadaN1,
OrdenN2=@TitularizadaN2,
OrdenN3=@TitularizadaN2,
Jerarquia=2,
Canal=@CanalTit,
Division='NO',
Nivel1=@DescripcionCartera,
Nivel2='C. '+@CanalTit,
Nivel3=space(5)+ @CanalAgrTit,
Nivel4=space(5)+ @CanalAgrTit,
Nivel5=space(5)+ @CanalAgrTit,
RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co&lt;/RSQueryCommandText&gt;&lt;RSQueryCommandType&gt;Text&lt;/RSQueryCommandType&gt;&lt;RSQueryDesignState&gt;&lt;/RSQueryDesignState&gt;]]&gt;&lt;/AnnotationContent&gt;&lt;/Gemini&gt;</Value>
                    </Annotation>
                  </Annotations>
                  <Source xsi:type="QueryBinding">
                    <DataSourceID>21568b6b-c791-4141-8d9e-e542457fa7a5</DataSourceID>
                    <QueryDefinition>SET NOCOUNT ON

declare @FechAct int, @FechaAyer int, @FechaMesAnt int, @FechaAnioAnt int, @Nivel1 varchar(100),
@OrdenCaptacionConcetracion int, @OrdenCaptacionCanal int, @OrdenCaptacionSegmentacion int,
@DescripcionCartera varchar(50),@OrdenCarteraCanal int ,@OrdenCarteraSegmentacion int,
@OrdenContingenteCanal int, @OrdenContingenteSegmentacion int,
@OrdenCaptacionConcetracionN2 int, @OrdenCarteraNivel1 int,@OrdenCarteraNivel2 int,
@CanalAgrTit varchar(50), @OrdenCanalTit int, @CanalTit varchar(50),
@TitularizadaN1 int, @TitularizadaN2 int


select @FechAct=max(feIdFecha) from DWDFecha where fediaactual = 1

select
@FechaAyer=fecIdAnterior,
@FechaMesAnt=feMesAntCierr,
@FechaAnioAnt=feAnioAntCierr
from  DWDFecha
where feIdFecha=@FechAct


/* ----------------------- */
/*    DESENCRIPTACION      */
/* ----------------------- */

OPEN SYMMETRIC KEY ClaveMIS02
DECRYPTION BY CERTIFICATE Certi01


if object_id('[tempdb]..#DWDCuentaContable') is not null
begin
drop table #DWDCuentaContable
end

select
ccIdCuentaContable,
ccCodigoMoneda,
case 
when ccOrdenAgrupacionN2=4 then case 
								when CpEstadoProducto = 'VEN' then 'Vencida'
								when CpEstadoProducto = 'NDE' then 'QnDevInter'
								else 'Vigente' end 
else ccSubGrupo 
end ccSubGrupo,
ccGrupo,
ccFamiliaProducto,
ccCodigoIndicador,
ccClasificacionEstado,
ccOrdenAgrupacion,
ccOrdenAgrupacionN2,
ccOrdenAgrupacionN3 = case when indicadorNivel2=124 and ccOrdenAgrupacionN3 is null then 11 else ccOrdenAgrupacionN3 end ,
ccCodigoNivel6=CONVERT(varchar(15), DecryptByKey(ccCodigoNivel6)),
ccCovid,
AgrupacionCovid=case when ccCovid=1  then ccFamiliaProducto + ccSubGrupo  else ccFamiliaProducto end 
into #DWDCuentaContable 
from DWDCuentaContable
left outer join [vuClasificacionProductos] on indicadorNivel3 = cccodigoIndicador
where indicadorNivel1 != 64


if object_id('[tempdb]..#DWDTitularizadaOperacion') is not null
begin
drop table #DWDTitularizadaOperacion
end


select top 0
toNombre,
toCedula=CONVERT(varchar(15), DecryptByKey(toCedula)),
toOperacion=CONVERT(varchar(9), DecryptByKey(toOperacion))

into #DWDTitularizadaOperacion --0
from DWDTitularizadaOperacion


if object_id('[tempdb]..#DWHCuotaOperacion') is not null
begin
drop table #DWHCuotaOperacion
end


select
coIdFecha,
coIdAgencia,
coIdAsesorPrincipal,
coIdAsesorSecundario,
coIdCliente,
coIdCuentaContable,
coIdProducto,
coIdMoneda,
coCuotaCapital,
coNumeroOperacion=coNumeroOperacion2 --CONVERT(varchar(15), DecryptByKey(coNumeroOperacion))
into #DWHCuotaOperacion --944581
from DWHCuotaOperacionMes
where coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and abs(coCuotaCapital)&gt;0



if object_id('[tempdb]..#DWHActivoOperacion') is not null
begin
drop table #DWHActivoOperacion
end


select
aoIdFecha,
aoIdAgencia,
aoIdAsesorPrincipal,
aoIdAsesorSecundario,
aoIdCliente,
aoIdCuentaContable,
aoIdProducto,
aoIdMoneda,
aoMontoSaldoDolar,
aoPlazoOperacion,
aoNumeroOperacion=CONVERT(varchar(15), DecryptByKey(aoNumeroOperacion)),
aoNumeroOperacion2

into #DWHActivoOperacion
from DWHActivoOperacion --60973
where aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and abs(aoMontoSaldoDolar)&gt;0

CLOSE SYMMETRIC KEY ClaveMIS02

/* ---------------- */
/* PASIVO OPERACION */
/* ---------------- */

if object_id('[tempdb]..#DWHPasivoOperacion') is not null
begin
drop table #DWHPasivoOperacion
end

select
 poIdFecha
,poIdProducto
,poIdMoneda
,poIdAgencia
,poIdAsesor
,poIdCliente
,poSaldoOperacionUSD
,poIdCuentaContable
into  #DWHPasivoOperacion
from DWHPasivoOperacionMes --1727655
where poIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and abs(poSaldoOperacionUSD)&gt;0

/* ----------------- */
/* TARJETA OPERACION */
/* ----------------- */

if object_id('[tempdb]..#DWHTarjetaCreditoOperacion') is not null
begin
drop table #DWHTarjetaCreditoOperacion
end

select
 tcoIdFecha
,tcoIdAgencia
,tcoIdCuentaContable
,tcoIdMoneda
,tcoIdProducto
,tcoIdCliente
,tcoSaldo
into #DWHTarjetaCreditoOperacion
from DWHTarjetaCreditoOperacion
where tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and abs(tcoSaldo)&gt;0


--------------------------------------------------------
-- Actualizacion de titularizada a Cartera Titularizada
--------------------------------------------------------

update #DWDCuentaContable
set
ccFamiliaProducto='Cartera',
ccGrupo='C. Titularizada',
ccSubGrupo=null
where cccodigoindicador in (136,137,138)


/* -------------------------------------------- */
/* OBTENCION DE NUMERO DE ORDEN Y DESCRIPCIONES */
/* -------------------------------------------- */

--&gt;&gt; CAPTACIONES

select distinct @Nivel1=ccFamiliaProducto
from #DWDCuentaContable
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (2)
and p1.CpCodigoIndicador in (140)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3

select
@OrdenCaptacionConcetracion=max(ccOrdenAgrupacion),
@OrdenCaptacionConcetracionN2=max(ccOrdenAgrupacionN2)
from #DWDCuentaContable cc
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (2)
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3

select
@OrdenCaptacionCanal=max(ccOrdenAgrupacion)+1,
@OrdenCaptacionSegmentacion=max(ccOrdenAgrupacion)+2
from #DWDCuentaContable
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (2)
and p1.CpCodigoIndicador in (140,141,142)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3


--&gt;&gt; CARTERA

select
@OrdenCarteraNivel1=max(ccOrdenAgrupacion),
@OrdenCarteraNivel2=max(ccOrdenAgrupacionN2),
@OrdenCarteraCanal=max(ccOrdenAgrupacion)+1,
@OrdenCarteraSegmentacion=max(ccOrdenAgrupacion)+2
from #DWDCuentaContable
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (1)
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3


select @DescripcionCartera=max(ccFamiliaProducto)
from #DWDCuentaContable
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (1)
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3


--&gt;&gt; CONTINGENTES

select @OrdenContingenteCanal=max(ccOrdenAgrupacion)+1,
@OrdenContingenteSegmentacion=max(ccOrdenAgrupacion)+2
from #DWDCuentaContable
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador in (3)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3


--&gt;&gt; TITULARIZADA

select
@TitularizadaN1=max(prOrdenN1),
@TitularizadaN2=max(prOrdenN2)+1
from DWDProducto where prGrupo='Vehiculos'

select
@CanalTit=caDescripcionAgrupacionCanal,
@CanalAgrTit=caAgrupacion,
@OrdenCanalTit=caOrdenCanal
from DWDCanal
where caCodigoCanal='TIT'



if object_id('[tempdb]..#Cartera')  is not null
begin
drop table #Cartera
end

--- Identificacion vehiculos

if object_id('[tempdb]..#Vehiculos') is not null
begin
drop table #Vehiculos
end

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
pr.prOrdenN1,
pr.prOrdenN2,
pr.prOrdenN3,
ca.caOrdenCanal,
cc.ccOrdenAgrupacionN3,
--Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
--Division='NO',
cc.ccFamiliaProducto,
pr.prVehiculo,
ca.caAgrupacion,
cc.AgrupacionCovid,
pr.prSubGrupo,
pr.prCodigoIndicador,
cc.ccSubGrupo,
cc.ccCovid,

RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end

into #Vehiculos

from #DWHCuotaOperacion co
inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador =1
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and pr.prVehiculo='Vehiculos'
and ccCodigoMoneda=moCodigoMoneda
and clFechaFin is null
and ca.caEstado=1
--and cc.ccCodigoMoneda='USD'
group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
ca.caOrdenCanal,
mo.moCodigoMoneda,
ca.caDescripcionAgrupacionCanal,
pr.prOrdenN1,
pr.prOrdenN2,
cc.ccFamiliaProducto,
ccOrdenAgrupacion,
ccOrdenAgrupacionN2,
ccOrdenAgrupacionN3,
ca.caAgrupacion,
pr.prVehiculo,
co.coIdFecha, --202815
cc.AgrupacionCovid,
pr.prOrdenN3,
pr.prSubGrupo,
pr.prCodigoIndicador,
cc.ccSubGrupo,
cc.ccCovid,
cc.ccOrdenAgrupacionN3


/* ---------------------------------------------------------------------- */
/*                           CARTERA                                      */
/* ---------------------------------------------------------------------- */

-- Comer. + Micro. (525,526,524,501,504,506,505,509,507)
-- Consumo (510,511,512,513,514,515)
-- Vivienda (519,520,521,522,523)
-- Titularizada (136,137,138)

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=ca.caOrdenCanal,
Jerarquia=4,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='     '+ca.caAgrupacion,
Nivel4='     '+cc.AgrupacionCovid,
Nivel5='     '+cc.AgrupacionCovid,
RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0

into #Cartera

from #DWHCuotaOperacion co
inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
left outer join #DWDTitularizadaOperacion ti on  isnull(co.coNumeroOperacion,'')=ti.toOperacion
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end/**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and pr.prVehiculo is null
and cl.clFechaFin is null
and ca.caEstado=1
and ti.toOperacion is null -- Filtro Titularizada
--and cc.ccCodigoMoneda='USD'

group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
co.coIdFecha,
cl.clCodigoCliente,
ca.caAgrupacion,
ca.caOrdenCanal,
ca.caDescripcionAgrupacionCanal,
cl.clNombreCompleto,
mo.moCodigoMoneda,
cc.ccOrdenAgrupacionN2,
cc.ccFamiliaProducto,
prCodigoProducto,
ccCodigoNivel6,
cc.ccGrupo,
cc.ccOrdenAgrupacion,
cc.ccCodigoIndicador, --20303
cc.AgrupacionCovid

Union All

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
--  Agrupaciones
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=cc.ccOrdenAgrupacionN3,
Jerarquia=3,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3=cc.ccSubGrupo,
Nivel4=cc.ccSubGrupo,
Nivel5=cc.ccSubGrupo,
RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorAyer=0,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHCuotaOperacion co
inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
left outer join #DWDTitularizadaOperacion ti on  isnull(co.coNumeroOperacion,'')=ti.toOperacion
inner join (
SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha  in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and pr.prVehiculo is null
and cl.clFechaFin is null
and ccCodigoMoneda=moCodigoMoneda
and ca.caEstado=1
and ti.toOperacion is null -- Filtro titularizada
--and cc.ccCodigoMoneda='USD'
group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
cc.ccFamiliaProducto,
cc.ccGrupo,
cc.ccOrdenAgrupacion,
ca.caDescripcionAgrupacionCanal,
cc.ccOrdenAgrupacionN2,
cc.ccOrdenAgrupacionN3,
cc.ccSubGrupo,
co.coIdFecha--20354

Union All

--&gt;&gt;  Agrupaciones Valor Deduccion

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=cc.ccOrdenAgrupacionN3,
Jerarquia=2,
Canal=ca.caDescripcionAgrupacionCanal,
Division='NO',
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
RealHoy=case co.coIdFecha when @FechAct then (sum(isnull(co.coCuotaCapital,0))/1000)*-1 else 0 end,
DenominadorHoy=0,
RealAyer=case co.coIdFecha when @FechaAyer then (sum(isnull(co.coCuotaCapital,0))/1000)*-1 else 0 end,
DenominadorAyer=0,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then (sum(isnull(co.coCuotaCapital,0))/1000)*-1 else 0 end,
DenominadorMesAnt=0,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then (sum(isnull(co.coCuotaCapital,0))/1000)*-1 else 0 end,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #DWHCuotaOperacion co
inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
left outer join #DWDTitularizadaOperacion ti on  isnull(co.coNumeroOperacion,'')=ti.toOperacion
inner join (
SELECT DISTINCT
p2.CpCodigoIndicador indicadorNivel3
,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
FROM DWDClasificacionProductos p
join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
WHERE p.CpCodigoIndicador = 1
and p1.CpCodigoIndicador in (120,121,122,126)
and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha  in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and pr.prVehiculo is null
and cl.clFechaFin is null
and ca.caEstado=1
and ccCodigoMoneda=moCodigoMoneda
and ti.toOperacion is null -- Filtro titularizada
--and cc.ccCodigoMoneda='USD'
group by
cp.CpEstadoProducto, --ccClasificacionEstado, /**/
cc.ccFamiliaProducto,
cc.ccGrupo,
cc.ccOrdenAgrupacion,
ca.caDescripcionAgrupacionCanal,
cc.ccOrdenAgrupacionN2,
cc.ccOrdenAgrupacionN3,
co.coIdFecha --20405

Union All

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- T. Credito
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

			select
			Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
			OrdenN1=cc.ccOrdenAgrupacion,
			OrdenN2=cc.ccOrdenAgrupacionN2,
			OrdenN3=ca.caOrdenCanal,
			Jerarquia=4,
			Canal=ca.caDescripcionAgrupacionCanal,
			Division='NO',
			Nivel1=cc.ccFamiliaProducto,
			Nivel2=cc.ccGrupo,
			Nivel3='     '+ca.caAgrupacion,
			Nivel4='     '+cc.AgrupacionCovid,
			Nivel5='     '+cc.AgrupacionCovid,
			RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorHoy=0,
			RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorAyer=0,
			RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorMesAnt=0,
			RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorAnioAnt=0,
			ValorPresupuesto=0,
			DenominadorPresupuesto=0
			from #DWHTarjetaCreditoOperacion tco
			inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto
			inner join DWDMoneda on moIdMoneda=tcoIdMoneda
			inner join (
			SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
			,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador = 1
			and p1.CpCodigoIndicador = 124
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
			where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and cl.clFechaFin is null
			and ca.caEstado=1
			--and cc.ccCodigoMoneda='USD'
			group by
			cp.CpEstadoProducto, --ccClasificacionEstado, /**/
			cc.ccOrdenAgrupacion,
			cl.clCodigoCliente,
			ca.caOrdenCanal,
			cc.ccOrdenAgrupacionN2,
			ca.caDescripcionAgrupacionCanal,
			cc.ccFamiliaProducto,
			caAgrupacion,
			cc.ccGrupo,
			tco.tcoIdFecha, --202793
			cc.AgrupacionCovid

			union all

			-- Agrupacion Covid Tarjeta de credito

			select
			Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
			OrdenN1=cc.ccOrdenAgrupacion,
			OrdenN2=cc.ccOrdenAgrupacionN2,
			OrdenN3=cc.ccOrdenAgrupacionN3,
			Jerarquia=3,
			Canal=ca.caDescripcionAgrupacionCanal,
			Division='NO',
			Nivel1=cc.ccFamiliaProducto,
			Nivel2=cc.ccGrupo,
			Nivel3='     '+cc.ccSubGrupo,
			Nivel4='     '+cc.ccSubGrupo,
			Nivel5='     '+cc.ccSubGrupo,
			RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorHoy=0,
			RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorAyer=0,
			RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorMesAnt=0,
			RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorAnioAnt=0,
			ValorPresupuesto=0,
			DenominadorPresupuesto=0
			from #DWHTarjetaCreditoOperacion tco
			inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto
			inner join DWDMoneda on moIdMoneda=tcoIdMoneda
			inner join (
			SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
			,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador = 1
			and p1.CpCodigoIndicador = 124
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
			where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and cl.clFechaFin is null
			and ca.caEstado=1
			and cc.ccCovid=1
			--and cc.ccCodigoMoneda='USD'
			group by
			cp.CpEstadoProducto, --ccClasificacionEstado, /**/
			cc.ccOrdenAgrupacion,
			cl.clCodigoCliente,
			ca.caOrdenCanal,
			cc.ccOrdenAgrupacionN2,
			ca.caDescripcionAgrupacionCanal,
			cc.ccFamiliaProducto,
			cc.ccGrupo,
			tco.tcoIdFecha, --202793
			cc.ccSubGrupo,
			cc.ccOrdenAgrupacionN3

			union all

			-- valor deduccion covid de tarjeta

			select
			Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
			OrdenN1=cc.ccOrdenAgrupacion,
			OrdenN2=cc.ccOrdenAgrupacionN2,
			OrdenN3=cc.ccOrdenAgrupacionN3,
			Jerarquia=2,
			Canal=ca.caDescripcionAgrupacionCanal,
			Division='NO',
			Nivel1=cc.ccFamiliaProducto,
			Nivel2=cc.ccGrupo,
			Nivel3='Deducción',
			Nivel4='Deducción',
			Nivel5='Deducción',
			RealHoy=case tco.tcoIdFecha when @FechAct then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
			DenominadorHoy=0,
			RealAyer=case tco.tcoIdFecha when @FechaAyer then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
			DenominadorAyer=0,
			RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
			DenominadorMesAnt=0,
			RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
			DenominadorAnioAnt=0,
			ValorPresupuesto=0,
			DenominadorPresupuesto=0
			from #DWHTarjetaCreditoOperacion tco
			inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto
			inner join DWDMoneda on moIdMoneda=tcoIdMoneda
			inner join (
			SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
			,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador = 1
			and p1.CpCodigoIndicador = 124
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
			where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and cl.clFechaFin is null
			and ca.caEstado=1
			and cc.ccCovid=1
			--and cc.ccCodigoMoneda='USD'
			group by
			cp.CpEstadoProducto,
			cc.ccOrdenAgrupacion,
			cl.clCodigoCliente,
			ca.caOrdenCanal,
			cc.ccOrdenAgrupacionN2,
			ca.caDescripcionAgrupacionCanal,
			cc.ccFamiliaProducto,
			cc.ccGrupo,
			tco.tcoIdFecha, --202793
			cc.ccOrdenAgrupacionN3

			Union All

			-- Agrupacion Tarjeta de credito Dificultades

			select
			Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
			OrdenN1=cc.ccOrdenAgrupacion,
			OrdenN2=cc.ccOrdenAgrupacionN2,
			OrdenN3=cc.ccOrdenAgrupacionN3,
			Jerarquia=3,
			Canal=ca.caDescripcionAgrupacionCanal,
			Division='NO',
			Nivel1=cc.ccFamiliaProducto,
			Nivel2=cc.ccGrupo,
			Nivel3='     '+cc.ccSubGrupo,
			Nivel4='     '+cc.ccSubGrupo,
			Nivel5='     '+cc.ccSubGrupo,
			RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorHoy=0,
			RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorAyer=0,
			RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorMesAnt=0,
			RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
			DenominadorAnioAnt=0,
			ValorPresupuesto=0,
			DenominadorPresupuesto=0
			from #DWHTarjetaCreditoOperacion tco
			inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto
			inner join DWDMoneda on moIdMoneda=tcoIdMoneda
			inner join (
			SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
			,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador = 1
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
			where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and cl.clFechaFin is null
			and ca.caEstado=1
			and cc.ccCovid != 1
			group by
			cp.CpEstadoProducto,
			cc.ccOrdenAgrupacion,
			cl.clCodigoCliente,
			ca.caOrdenCanal,
			cc.ccOrdenAgrupacionN2,
			ca.caDescripcionAgrupacionCanal,
			cc.ccFamiliaProducto,
			cc.ccGrupo,
			tco.tcoIdFecha, --202793
			cc.ccSubGrupo,
			cc.ccOrdenAgrupacionN3

			union all

			-- valor deduccion de tarjeta Dificultades

			select
			Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
			OrdenN1=cc.ccOrdenAgrupacion,
			OrdenN2=cc.ccOrdenAgrupacionN2,
			OrdenN3=cc.ccOrdenAgrupacionN3,
			Jerarquia=2,
			Canal=ca.caDescripcionAgrupacionCanal,
			Division='NO',
			Nivel1=cc.ccFamiliaProducto,
			Nivel2=cc.ccGrupo,
			Nivel3='Deducción',
			Nivel4='Deducción',
			Nivel5='Deducción',
			RealHoy=case tco.tcoIdFecha when @FechAct then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
			DenominadorHoy=0,
			RealAyer=case tco.tcoIdFecha when @FechaAyer then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
			DenominadorAyer=0,
			RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
			DenominadorMesAnt=0,
			RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,
			DenominadorAnioAnt=0,
			ValorPresupuesto=0,
			DenominadorPresupuesto=0
			from #DWHTarjetaCreditoOperacion tco
			inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto
			inner join DWDMoneda on moIdMoneda=tcoIdMoneda
			inner join (
			SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3
			,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador = 1
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3
			where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and cl.clFechaFin is null
			and ca.caEstado=1
			and cc.ccCovid != 1
			group by
			cp.CpEstadoProducto,
			cc.ccOrdenAgrupacion,
			cl.clCodigoCliente,
			ca.caOrdenCanal,
			cc.ccOrdenAgrupacionN2,
			ca.caDescripcionAgrupacionCanal,
			cc.ccFamiliaProducto,
			cc.ccGrupo,
			tco.tcoIdFecha,
			cc.ccOrdenAgrupacionN3

			Union All

			--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- Vehiculos
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select
Estado,--ccClasificacionEstado, /**/
OrdenN1=prOrdenN1,
OrdenN2=prOrdenN2,
OrdenN3=caOrdenCanal,
Jerarquia=4,
Canal,
Division='NO',
Nivel1=ccFamiliaProducto,
Nivel2=prVehiculo,
Nivel3='     '+caAgrupacion,
Nivel4='     '+AgrupacionCovid,
Nivel5='     '+AgrupacionCovid,
RealHoy,
DenominadorHoy=0,
RealAyer,
DenominadorAyer=0,
RealMesAnt,
DenominadorMesAnt=0,
RealAnioAnt,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #Vehiculos co

Union All

--&gt;&gt; Vehiculos Credimetrica y Originarsa

select
Estado,--ccClasificacionEstado, /**/
OrdenN1=prOrdenN1,
OrdenN2=prOrdenN2,
OrdenN3=prOrdenN3,
Jerarquia=4,
Canal,
Division='NO',
Nivel1=ccFamiliaProducto,
Nivel2=prVehiculo,
Nivel3=prSubGrupo,
Nivel4=AgrupacionCovid,
Nivel5=AgrupacionCovid,
RealHoy,
DenominadorHoy=0,
RealAyer,
DenominadorAyer=0,
RealMesAnt,
DenominadorMesAnt=0,
RealAnioAnt,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #Vehiculos
where prCodigoIndicador in (527,528,529,530,531)


Union All

--&gt;&gt; Valor deduccion Credimetrica y Originarsa

select
Estado,--ccClasificacionEstado, /**/
OrdenN1=prOrdenN1,
OrdenN2=prOrdenN2,
OrdenN3=prOrdenN3,
Jerarquia=2,
Canal,
Division='NO',
Nivel1=ccFamiliaProducto,
Nivel2=prVehiculo,
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
RealHoy=RealHoy*-1,
DenominadorHoy=0,
RealAyer=RealAyer*-1,
DenominadorAyer=0,
RealMesAnt=RealMesAnt*-1,
DenominadorMesAnt=0,
RealAnioAnt=RealAnioAnt*-1,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #Vehiculos
where prCodigoIndicador in (527,528,529,530,531)

union all

-- agrupacion covid vehiculos
select
Estado,--ccClasificacionEstado, /**/
OrdenN1=prOrdenN1,
OrdenN2=prOrdenN2,
OrdenN3=ccOrdenAgrupacionN3,
Jerarquia=3,
Canal,
Division='NO',
Nivel1=ccFamiliaProducto,
Nivel2=prVehiculo,
Nivel3=ccSubGrupo,
Nivel4=ccSubGrupo,
Nivel5=ccSubGrupo,
RealHoy,
DenominadorHoy=0,
RealAyer,
DenominadorAyer=0,
RealMesAnt,
DenominadorMesAnt=0,
RealAnioAnt,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #Vehiculos
where ccCovid=1


union all

-- agrupacion covid vehiculos
select
Estado,--ccClasificacionEstado, /**/
OrdenN1=prOrdenN1,
OrdenN2=prOrdenN2,
OrdenN3=ccOrdenAgrupacionN3,
Jerarquia=2,
Canal,
Division='NO',
Nivel1=ccFamiliaProducto,
Nivel2=prVehiculo,
Nivel3='Deducción',
Nivel4='Deducción',
Nivel5='Deducción',
RealHoy=RealHoy*-1,
DenominadorHoy=0,
RealAyer=RealAyer*-1,
DenominadorAyer=0,
RealMesAnt=RealMesAnt*-1,
DenominadorMesAnt=0,
RealAnioAnt=RealAnioAnt*-1,
DenominadorAnioAnt=0,
ValorPresupuesto=0,
DenominadorPresupuesto=0
from #Vehiculos
where ccCovid=1

Union all

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- Titularizada
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

--&gt; Identificacion de C.Titularizada por número de operación

select
Estado=CpEstadoProducto,--ccClasificacionEstado, /**/
OrdenN1=@TitularizadaN1,
OrdenN2=@TitularizadaN2,
OrdenN3=@TitularizadaN2,
Jerarquia=2,
Canal=@CanalTit,
Division='NO',
Nivel1=@DescripcionCartera,
Nivel2='C. '+@CanalTit,
Nivel3=space(5)+ @CanalAgrTit,
Nivel4=space(5)+ @CanalAgrTit,
Nivel5=space(5)+ @CanalAgrTit,
RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
DenominadorHoy=0,
RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co</QueryDefinition>
                  </Source>
                  <StorageMode valuens="ddl200_200">InMemory</StorageMode>
                  <ProcessingMode>Regular</ProcessingMode>
                  <ProactiveCaching>
                    <SilenceInterval>-PT1S</SilenceInterval>
                    <Latency>-PT1S</Latency>
                    <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
                    <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
                    <Source xsi:type="ProactiveCachingInheritedBinding" />
                  </ProactiveCaching>
                </Partition>
              </Partitions>
              <ProactiveCaching>
                <SilenceInterval>-PT1S</SilenceInterval>
                <Latency>-PT1S</Latency>
                <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
                <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
                <Source xsi:type="ProactiveCachingInheritedBinding" />
              </ProactiveCaching>
            </MeasureGroup>
            <MeasureGroup>
              <ID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</ID>
              <Name>MargenFinanciero</Name>
              <Measures>
                <Measure>
                  <ID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</ID>
                  <Name>__XL_Count MargenFinanciero</Name>
                  <AggregateFunction>Count</AggregateFunction>
                  <DataType>BigInt</DataType>
                  <Source>
                    <DataType>BigInt</DataType>
                    <DataSize>8</DataSize>
                    <Source xsi:type="RowBinding">
                      <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                    </Source>
                  </Source>
                  <Visible>false</Visible>
                </Measure>
              </Measures>
              <StorageMode valuens="ddl200_200">InMemory</StorageMode>
              <ErrorConfiguration>
                <KeyNotFound>IgnoreError</KeyNotFound>
                <KeyDuplicate>ReportAndStop</KeyDuplicate>
                <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
              </ErrorConfiguration>
              <ProcessingMode>Regular</ProcessingMode>
              <Dimensions>
                <Dimension xsi:type="DegenerateMeasureGroupDimension">
                  <CubeDimensionID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>__XL_RowNumber</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero</TableID>
                            <ColumnID>__XL_RowNumber</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                      <Type>Granularity</Type>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Jerarquia</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>Jerarquia</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Agrupacion</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>Agrupacion</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodigoN1</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>CodigoN1</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>DescripcionN1</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>DescripcionN1</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodigoN2</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>CodigoN2</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>DescripcionN2</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>DescripcionN2</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodigoN3</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>CodigoN3</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>DescripcionN3</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>DescripcionN3</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodigoN4</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>CodigoN4</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>DescripcionN4</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>DescripcionN4</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodigoN5</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>CodigoN5</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>diaPart</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>diaPart</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>diaSaldo</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>diaSaldo</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>diaTPP</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>diaTPP</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>diaPYG</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>diaPYG</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>mesPart</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>mesPart</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>mesSaldo</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>mesSaldo</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>mesTPP</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>mesTPP</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>mesPYG</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>mesPYG</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>anioPart</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>anioPart</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>anioSaldo</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>anioSaldo</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>anioTPP</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>anioTPP</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>anioPYG</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>anioPYG</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>mesPres</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>mesPres</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>anioPres</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>anioPres</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>DescripcionN5</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</TableID>
                            <ColumnID>DescripcionN5</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodigoSeccion</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                  </Attributes>
                  <ddl200_200:ShareDimensionStorage>Shared</ddl200_200:ShareDimensionStorage>
                </Dimension>
              </Dimensions>
              <Partitions>
                <Partition>
                  <ID>MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d</ID>
                  <Name>DWHMargenFinanciero</Name>
                  <Source xsi:type="QueryBinding">
                    <DataSourceID>21568b6b-c791-4141-8d9e-e542457fa7a5</DataSourceID>
                    <QueryDefinition>set nocount on 

if OBJECT_ID('[tempdb]..#DWHMonitorConsolidadoMargenV2')	is not null
begin
drop table #DWHMonitorConsolidadoMargenV2
end


select * 
into #DWHMonitorConsolidadoMargenV2
from DWHMonitorConsolidadoMargenV2
where nombre is not null
and mcmIdFecha =(select feIdFecha from DWDFecha where feDiaActual=1)

update  #DWHMonitorConsolidadoMargenV2 
set CodigoPadre=null
where CodigoPadre in 
(
select 
codigo
from DWHMonitorConsolidadoMargenV2
where nivel=1
)


select distinct
Jerarquia,
Agrupacion= 
       case 
       when CodigoN1 between 101000000 and 200000000 then  'Captaciones' else 'Cartera' end,
CodigoN1,
DescripcionN1=NombreN1,
CodigoN2,
DescripcionN2=NombreN2,
CodigoN3,
DescripcionN3=NombreN3,
CodigoN4,
DescripcionN4=NombreN4,
CodigoN5,
DescripcionN5=CAST(NombreN5  as varchar(100)),
diaPart,
diaSaldo,
diaTPP,
diaPYG,
mesPart,
mesSaldo,
mesTPP,
mesPYG,
anioPart,
anioSaldo,
anioTPP,
anioPYG,
mesPres,
anioPres

from 

(

-------------------------
--- Tinen solo 1 nivel
-------------------------

select distinct
Jerarquia=1,

CodigoN1=n1.codigo,
NombreN1=n1.nombre,
Codigon2=null,
Nombren2=null,

CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,

CodigoN5=null,
NombreN5=null,

n1.diaPart,
n1.diaSaldo,
n1.diaTPP,
n1.diaPYG,
n1.mesPart,
n1.mesSaldo,
n1.mesTPP,
n1.mesPYG,
n1.anioPart,
n1.anioSaldo,
n1.anioTPP,
n1.anioPYG,
n1.mesPres,
n1.anioPres

from #DWHMonitorConsolidadoMargenV2 n1
where nivel in (1,2)
and n1.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)


union all

------------------------
-- Tinen solo 2 niveles
------------------------

-- nivel2

select distinct
Jerarquia=2,

CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,

CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,

CodigoN5=null,
NombreN5=null,

n2.diaPart,
n2.diaSaldo,
n2.diaTPP,
n2.diaPYG,
n2.mesPart,
n2.mesSaldo,
n2.mesTPP,
n2.mesPYG,
n2.anioPart,
n2.anioSaldo,
n2.anioTPP,
n2.anioPYG,
n2.mesPres,
n2.anioPres

from #DWHMonitorConsolidadoMargenV2  n2 inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n2.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3

union all

-- valor deduccion nivel2

select distinct
Jerarquia=1,

CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=null,
NombreN2='Deducción',

CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,

CodigoN5=null,
NombreN5=null,

n2.diaPart*-1,
n2.diaSaldo*-1,
n2.diaTPP*-1,
n2.diaPYG*-1,
n2.mesPart*-1,
n2.mesSaldo*-1,
n2.mesTPP*-1,
n2.mesPYG*-1,
n2.anioPart*-1,
n2.anioSaldo*-1,
n2.anioTPP*-1,
n2.anioPYG*-1,
n2.mesPres*-1,
n2.anioPres*-1

from #DWHMonitorConsolidadoMargenV2  n2 inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n2.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3

union all

-- nivel 1

select distinct
Jerarquia=1,

CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=null,
NombreN2=null,
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,

n1.diaPart,
n1.diaSaldo,
n1.diaTPP,
n1.diaPYG,
n1.mesPart,
n1.mesSaldo,
n1.mesTPP,
n1.mesPYG,
n1.anioPart,
n1.anioSaldo,
n1.anioTPP,
n1.anioPYG,
n1.mesPres,
n1.anioPres

from #DWHMonitorConsolidadoMargenV2  n2 inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n2.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3


union all
------------------------
-- Tinen solo 3 niveles
------------------------

-- nivel3

select distinct
Jerarquia=3,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n3.diaPart,
n3.diaSaldo,
n3.diaTPP,
n3.diaPYG,
n3.mesPart,
n3.mesSaldo,
n3.mesTPP,
n3.mesPYG,
n3.anioPart,
n3.anioSaldo,
n3.anioTPP,
n3.anioPYG,
n3.mesPres,
n3.anioPres
from #DWHMonitorConsolidadoMargenV2  n3 
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n3.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4

union all

-- valor deduccion nivel 3

select distinct
Jerarquia=2,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=null,
NombreN3='Deducción',
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n3.diaPart*-1,
n3.diaSaldo*-1,
n3.diaTPP*-1,
n3.diaPYG*-1,
n3.mesPart*-1,
n3.mesSaldo*-1,
n3.mesTPP*-1,
n3.mesPYG*-1,
n3.anioPart*-1,
n3.anioSaldo*-1,
n3.anioTPP*-1,
n3.anioPYG*-1,
n3.mesPres*-1,
n3.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n3 
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n3.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3 
and n3.nivel=4

union all

-- Valor Nivel 2

select distinct
Jerarquia=2,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n2.diaPart,
n2.diaSaldo,
n2.diaTPP,
n2.diaPYG,
n2.mesPart,
n2.mesSaldo,
n2.mesTPP,
n2.mesPYG,
n2.anioPart,
n2.anioSaldo,
n2.anioTPP,
n2.anioPYG,
n2.mesPres,
n2.anioPres
from #DWHMonitorConsolidadoMargenV2  n3 
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n3.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3 
and n3.nivel=4

union all

-- Valor Deduccion Nivel 2

select distinct
Jerarquia=1,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=null,
NombreN2='Deducción',
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n2.diaPart*-1,
n2.diaSaldo*-1,
n2.diaTPP*-1,
n2.diaPYG*-1,
n2.mesPart*-1,
n2.mesSaldo*-1,
n2.mesTPP*-1,
n2.mesPYG*-1,
n2.anioPart*-1,
n2.anioSaldo*-1,
n2.anioTPP*-1,
n2.anioPYG*-1,
n2.mesPres*-1,
n2.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n3 
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n3.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3 
and n3.nivel=4

union all

-- Valor Nivel 1

select distinct
Jerarquia=1,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=null,
NombreN2=null,
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n1.diaPart,
n1.diaSaldo,
n1.diaTPP,
n1.diaPYG,
n1.mesPart,
n1.mesSaldo,
n1.mesTPP,
n1.mesPYG,
n1.anioPart,
n1.anioSaldo,
n1.anioTPP,
n1.anioPYG,
n1.mesPres,
n1.anioPres
from #DWHMonitorConsolidadoMargenV2  n3 
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n3.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3 
and n3.nivel=4

union all


------------------------
-- Tinen solo 4 niveles
------------------------

-- nivel4

select distinct
Jerarquia=4,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=n4.codigo,
NombreN4=n4.nombre,
CodigoN5=null,
NombreN5=null,
n4.diaPart,
n4.diaSaldo,
n4.diaTPP,
n4.diaPYG,
n4.mesPart,
n4.mesSaldo,
n4.mesTPP,
n4.mesPYG,
n4.anioPart,
n4.anioSaldo,
n4.anioTPP,
n4.anioPYG,
n4.mesPres,
n4.anioPres
from #DWHMonitorConsolidadoMargenV2  n4 
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3
and n3.nivel=4 and n4.nivel=5

union all
-- valor deduccion nivel4

select distinct
Jerarquia=3,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=null,
NombreN4='Deducción',
CodigoN5=null,
NombreN5=null,
n4.diaPart*-1,
n4.diaSaldo*-1,
n4.diaTPP*-1,
n4.diaPYG*-1,
n4.mesPart*-1,
n4.mesSaldo*-1,
n4.mesTPP*-1,
n4.mesPYG*-1,
n4.anioPart*-1,
n4.anioSaldo*-1,
n4.anioTPP*-1,
n4.anioPYG*-1,
n4.mesPres*-1,
n4.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n4 
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3
and n3.nivel=4 and n4.nivel=5

union all

-- Valor Nivel 3

select distinct
Jerarquia=3,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n3.diaPart,
n3.diaSaldo,
n3.diaTPP,
n3.diaPYG,
n3.mesPart,
n3.mesSaldo,
n3.mesTPP,
n3.mesPYG,
n3.anioPart,
n3.anioSaldo,
n3.anioTPP,
n3.anioPYG,
n3.mesPres,
n3.anioPres
from #DWHMonitorConsolidadoMargenV2  n4 
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3
and n3.nivel=4 and n4.nivel=5

union all

-- Valor Deduccion Nivel 3

select distinct
Jerarquia=2,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=null,
NombreN3='Deducción',
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n3.diaPart*-1,
n3.diaSaldo*-1,
n3.diaTPP*-1,
n3.diaPYG*-1,
n3.mesPart*-1,
n3.mesSaldo*-1,
n3.mesTPP*-1,
n3.mesPYG*-1,
n3.anioPart*-1,
n3.anioSaldo*-1,
n3.anioTPP*-1,
n3.anioPYG*-1,
n3.mesPres*-1,
n3.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n4 
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3
and n3.nivel=4 and n4.nivel=5

union all
-- Valor Nivel 2

select distinct
Jerarquia=2,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n2.diaPart,
n2.diaSaldo,
n2.diaTPP,
n2.diaPYG,
n2.mesPart,
n2.mesSaldo,
n2.mesTPP,
n2.mesPYG,
n2.anioPart,
n2.anioSaldo,
n2.anioTPP,
n2.anioPYG,
n2.mesPres,
n2.anioPres
from #DWHMonitorConsolidadoMargenV2  n4 
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3
and n3.nivel=4 and n4.nivel=5

union all

-- Valor Deduccion Nivel 2

select distinct
Jerarquia=1,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=null,
NombreN2='Deducción',
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n2.diaPart*-1,
n2.diaSaldo*-1,
n2.diaTPP*-1,
n2.diaPYG*-1,
n2.mesPart*-1,
n2.mesSaldo*-1,
n2.mesTPP*-1,
n2.mesPYG*-1,
n2.anioPart*-1,
n2.anioSaldo*-1,
n2.anioTPP*-1,
n2.anioPYG*-1,
n2.mesPres*-1,
n2.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n4 
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3
and n3.nivel=4 and n4.nivel=5

union all

-- Valor Nivel 1

select distinct
Jerarquia=1,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=null,
NombreN2=null,
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n1.diaPart,
n1.diaSaldo,
n1.diaTPP,
n1.diaPYG,
n1.mesPart,
n1.mesSaldo,
n1.mesTPP,
n1.mesPYG,
n1.anioPart,
n1.anioSaldo,
n1.anioTPP,
n1.anioPYG,
n1.mesPres,
n1.anioPres
from #DWHMonitorConsolidadoMargenV2  n4 
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo
where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 and n2.nivel=3
and n3.nivel=4 and n4.nivel=5

Union all


------------------------
-- Tinen solo 5 niveles
------------------------

select distinct
Jerarquia=5,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=n4.codigo,
NombreN4=n4.nombre,
CodigoN5=n5.codigo,
NombreN5=n5.nombre,
n5.diaPart,
n5.diaSaldo,
n5.diaTPP,
n5.diaPYG,
n5.mesPart,
n5.mesSaldo,
n5.mesTPP,
n5.mesPYG,
n5.anioPart,
n5.anioSaldo,
n5.anioTPP,
n5.anioPYG,
n5.mesPres,
n5.anioPres
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6


union all

-- valor deduccion nivel5


select distinct
Jerarquia=4,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=n4.codigo,
NombreN4=n4.nombre,
CodigoN5=null,
NombreN5='Deducción',
n5.diaPart*-1,
n5.diaSaldo*-1,
n5.diaTPP*-1,
n5.diaPYG*-1,
n5.mesPart*-1,
n5.mesSaldo*-1,
n5.mesTPP*-1,
n5.mesPYG*-1,
n5.anioPart*-1,
n5.anioSaldo*-1,
n5.anioTPP*-1,
n5.anioPYG*-1,
n5.mesPres*-1,
n5.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6

union all

-- nivel4


select distinct
Jerarquia=4,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=n4.codigo,
NombreN4=n4.nombre,
CodigoN5=null,
NombreN5=null,
n4.diaPart,
n4.diaSaldo,
n4.diaTPP,
n4.diaPYG,
n4.mesPart,
n4.mesSaldo,
n4.mesTPP,
n4.mesPYG,
n4.anioPart,
n4.anioSaldo,
n4.anioTPP,
n4.anioPYG,
n4.mesPres,
n4.anioPres
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6




union all
-- valor deduccion nivel4


select distinct
Jerarquia=3,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=null,
NombreN4='Deducción',
CodigoN5=null,
NombreN5=null,
n4.diaPart*-1,
n4.diaSaldo*-1,
n4.diaTPP*-1,
n4.diaPYG*-1,
n4.mesPart*-1,
n4.mesSaldo*-1,
n4.mesTPP*-1,
n4.mesPYG*-1,
n4.anioPart*-1,
n4.anioSaldo*-1,
n4.anioTPP*-1,
n4.anioPYG*-1,
n4.mesPres*-1,
n4.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6


union all

-- Valor Nivel 3

select distinct
Jerarquia=3,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=n3.codigo,
NombreN3=n3.nombre,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n3.diaPart,
n3.diaSaldo,
n3.diaTPP,
n3.diaPYG,
n3.mesPart,
n3.mesSaldo,
n3.mesTPP,
n3.mesPYG,
n3.anioPart,
n3.anioSaldo,
n3.anioTPP,
n3.anioPYG,
n3.mesPres,
n3.anioPres
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6

union all

-- Valor Deduccion Nivel 3

select distinct
Jerarquia=2,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=null,
NombreN3='Deducción',
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n3.diaPart*-1,
n3.diaSaldo*-1,
n3.diaTPP*-1,
n3.diaPYG*-1,
n3.mesPart*-1,
n3.mesSaldo*-1,
n3.mesTPP*-1,
n3.mesPYG*-1,
n3.anioPart*-1,
n3.anioSaldo*-1,
n3.anioTPP*-1,
n3.anioPYG*-1,
n3.mesPres*-1,
n3.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6


union all
-- Valor Nivel 2

select distinct
Jerarquia=2,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=n2.codigo,
NombreN2=n2.nombre,
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n2.diaPart,
n2.diaSaldo,
n2.diaTPP,
n2.diaPYG,
n2.mesPart,
n2.mesSaldo,
n2.mesTPP,
n2.mesPYG,
n2.anioPart,
n2.anioSaldo,
n2.anioTPP,
n2.anioPYG,
n2.mesPres,
n2.anioPres
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6


union all

-- Valor Deduccion Nivel 2

select distinct
Jerarquia=1,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=null,
NombreN2='Deducción',
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n2.diaPart*-1,
n2.diaSaldo*-1,
n2.diaTPP*-1,
n2.diaPYG*-1,
n2.mesPart*-1,
n2.mesSaldo*-1,
n2.mesTPP*-1,
n2.mesPYG*-1,
n2.anioPart*-1,
n2.anioSaldo*-1,
n2.anioTPP*-1,
n2.anioPYG*-1,
n2.mesPres*-1,
n2.anioPres*-1
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6


union all

-- Valor Nivel 1

select distinct
Jerarquia=1,
CodigoN1=n1.codigo,
NombreN1=n1.nombre,
CodigoN2=null,
NombreN2=null,
CodigoN3=null,
NombreN3=null,
CodigoN4=null,
NombreN4=null,
CodigoN5=null,
NombreN5=null,
n1.diaPart,
n1.diaSaldo,
n1.diaTPP,
n1.diaPYG,
n1.mesPart,
n1.mesSaldo,
n1.mesTPP,
n1.mesPYG,
n1.anioPart,
n1.anioSaldo,
n1.anioTPP,
n1.anioPYG,
n1.mesPres,
n1.anioPres
from #DWHMonitorConsolidadoMargenV2  n5
inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo
inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo
inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo
inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo

where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)
and n1.nivel=2 
and n2.nivel=3
and n3.nivel=4
and n4.nivel=5
and n5.nivel=6
) as Margen 

order by 
CodigoN1,
CodigoN2,
CodigoN3,
CodigoN4,
CodigoN5</QueryDefinition>
                  </Source>
                  <StorageMode valuens="ddl200_200">InMemory</StorageMode>
                  <ProcessingMode>Regular</ProcessingMode>
                  <ErrorConfiguration>
                    <KeyNotFound>IgnoreError</KeyNotFound>
                    <KeyDuplicate>ReportAndStop</KeyDuplicate>
                    <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
                  </ErrorConfiguration>
                  <ProactiveCaching>
                    <SilenceInterval>-PT1S</SilenceInterval>
                    <Latency>-PT1S</Latency>
                    <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
                    <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
                    <Source xsi:type="ProactiveCachingInheritedBinding" />
                  </ProactiveCaching>
                </Partition>
              </Partitions>
              <ProactiveCaching>
                <SilenceInterval>-PT1S</SilenceInterval>
                <Latency>-PT1S</Latency>
                <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
                <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
                <Source xsi:type="ProactiveCachingInheritedBinding" />
              </ProactiveCaching>
            </MeasureGroup>
            <MeasureGroup>
              <ID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</ID>
              <Name>IndicadoresTasaMargen</Name>
              <Measures>
                <Measure>
                  <ID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</ID>
                  <Name>__XL_Count IndicadoresTasaMargen</Name>
                  <AggregateFunction>Count</AggregateFunction>
                  <DataType>BigInt</DataType>
                  <Source>
                    <DataType>BigInt</DataType>
                    <DataSize>8</DataSize>
                    <Source xsi:type="RowBinding">
                      <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                    </Source>
                  </Source>
                  <Visible>false</Visible>
                </Measure>
              </Measures>
              <StorageMode valuens="ddl200_200">InMemory</StorageMode>
              <ErrorConfiguration>
                <KeyNotFound>IgnoreError</KeyNotFound>
                <KeyDuplicate>ReportAndStop</KeyDuplicate>
                <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
              </ErrorConfiguration>
              <ProcessingMode>Regular</ProcessingMode>
              <Dimensions>
                <Dimension xsi:type="DegenerateMeasureGroupDimension">
                  <CubeDimensionID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>__XL_RowNumber</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <Source xsi:type="ColumnBinding">
                            <TableID>IndicadoresTasaMargen</TableID>
                            <ColumnID>__XL_RowNumber</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                      <Type>Granularity</Type>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Agrupacion</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                            <ColumnID>Agrupacion</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>tmFecha</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                            <ColumnID>tmFecha</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>tmCodigoIndicador</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                            <ColumnID>tmCodigoIndicador</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>tmDescripcion</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                            <ColumnID>tmDescripcion</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>tmTPPdia</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                            <ColumnID>tmTPPdia</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>TotalTPPdia</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                            <ColumnID>TotalTPPdia</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>tmTPPmes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                            <ColumnID>tmTPPmes</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>TotalTPPmes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                            <ColumnID>TotalTPPmes</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>tmTPPtrimestre</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                            <ColumnID>tmTPPtrimestre</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>TotalTPPtrimestre</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                            <ColumnID>TotalTPPtrimestre</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>tmTPPanio</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                            <ColumnID>tmTPPanio</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>TotalTPPanio</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                            <ColumnID>TotalTPPanio</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>tmSaldoDiario</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                            <ColumnID>tmSaldoDiario</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>TotalSaldoDiario</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                            <ColumnID>TotalSaldoDiario</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Orden</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Calculated Column 1</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression>SWITCH([tmDescripcion],"Total","TOTAL","Comercial + Micro","COMMICRO","Consumo","CONSUMO","Vivienda","VIVIENDA","Monetarios","MONETARIOS","Ahorros","AHORROS","PLAZOS")</Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Slicer_Agrupacion</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>DescripcionCabecera</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>tmbandera</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</TableID>
                            <ColumnID>tmbandera</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                  </Attributes>
                  <ddl200_200:ShareDimensionStorage>Shared</ddl200_200:ShareDimensionStorage>
                </Dimension>
                <Dimension xsi:type="ReferenceMeasureGroupDimension">
                  <CubeDimensionID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>__XL_RowNumber</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>4</DataSize>
                          <NullProcessing>Error</NullProcessing>
                          <Source xsi:type="ddl200_200:RowNumberBinding" />
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feIdFecha</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Error</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feIdFecha</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                      <Type>Granularity</Type>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFechaCodigoAlt</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFechaCodigoAlt</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFecha</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Date</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFecha</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feDescripcionFecha</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feDescripcionFecha</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCalAnio</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCalAnio</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCalMes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Currency</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCalMes</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCalDia</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCalDia</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCalDiaAnio</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCalDiaAnio</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feTrimNumero</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feTrimNumero</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feTrimMes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feTrimMes</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feTrimDia</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feTrimDia</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCopaCodigo</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCopaCodigo</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCopaMes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCopaMes</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCopaDia</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCopaDia</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFeriado</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFeriado</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFeriadoNombre</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFeriadoNombre</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feTemporada</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feTemporada</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCierreMes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCierreMes</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFinMes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFinMes</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFinSemana</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFinSemana</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFutura</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFutura</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feDiasReplicarProximos</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feDiasReplicarProximos</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feDiasReplicarAnteriores</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feDiasReplicarAnteriores</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>EsDiaAnterior</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>EsDiaAnterior</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>fecIdAnterior</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>fecIdAnterior</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>EsCierreAño</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>EsCierreAño</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feMesAntCierr</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feMesAntCierr</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feAnioAntCierr</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feAnioAntCierr</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feIdFechaAnioAnt</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feIdFechaAnioAnt</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feIdFechaCierreAnioAnt</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feIdFechaCierreAnioAnt</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFechaCierreAnio</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Date</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFechaCierreAnio</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>FechaFormato</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>FormatoFechaMesAnio</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                  </Attributes>
                  <IntermediateCubeDimensionID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</IntermediateCubeDimensionID>
                  <IntermediateGranularityAttributeID>tmFecha</IntermediateGranularityAttributeID>
                  <Materialization>Regular</Materialization>
                  <ddl300:RelationshipID>ceac72eb-4a3c-4b6d-9e74-8b41dfd49fb8</ddl300:RelationshipID>
                </Dimension>
              </Dimensions>
              <Partitions>
                <Partition>
                  <ID>IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953</ID>
                  <Name>DWHIndicadoresTasaMargen</Name>
                  <Annotations>
                    <Annotation>
                      <Name>QueryEditorSerialization</Name>
                      <Value>&lt;?xml version="1.0" encoding="UTF-16"?&gt;&lt;Gemini xmlns="QueryEditorSerialization"&gt;&lt;AnnotationContent&gt;&lt;![CDATA[&lt;RSQueryCommandText&gt;declare @fechaActual int
select @fechaActual = feidfecha from DWDFecha where feDiaActual = 1

if object_id('[tempdb]..#tmFecha') is not null
begin
drop table #tmFecha
end

select  ROW_NUMBER() OVER(ORDER BY tmFecha DESC) AS Row#,
tmFecha,
tmbandera=0
into #tmFecha
from (
select 
distinct top 90 tmFecha from DWHIndicadorTasaMargen
where tmFecha &lt;= @fechaActual
order by tmFecha desc ) a
update x
set
tmbandera = 1
 from #tmFecha x
inner join DWDFecha on tmFecha = feIdFecha
where feCierreMesTodosAnios = 1
update x
set
tmbandera = 1
 from #tmFecha x
inner join DWDFecha on tmFecha = feIdFechaHaceUnMesLab
where fediaactual = 1
update x
set
tmbandera = 2
 from #tmFecha x
where 
Row# = 1
update x
set
tmbandera = 3
 from #tmFecha x
where 
Row# = 2
update x
set
tmbandera = 4
 from #tmFecha x
where 
Row# = 3
--select * from #tmFecha

declare @fechaAtrasAño int

select @fechaAtrasAño= tmFecha from #tmFecha where Row# = 90

select 

Agrupacion,
MargenIndicadores.tmFecha,
tmCodigoIndicador,
tmDescripcion,
tmTPPdia,
TotalTPPdia,
tmTPPmes,
TotalTPPmes,
tmTPPtrimestre,
TotalTPPtrimestre,
tmTPPanio,
TotalTPPanio,
tmSaldoDiario,
TotalSaldoDiario,
a.tmbandera
from 
(
-------------------
-- Captaciones 
-------------------
select 
Agrupacion='Captaciones',

pr.tmFecha,
pr.tmCodigoIndicador,
tmDescripcion=
case pr.tmCodigoIndicador when 6 then 'Monetarios'
        when 7 then 'Ahorros'
        when 29 then 'Plazo' end,

pr.tmTPPdia,
t.tmTPPdia as TotalTPPdia,

pr.tmTPPmes,
t.tmTPPmes as TotalTPPmes,

pr.tmTPPtrimestre,
t.tmTPPtrimestre as TotalTPPtrimestre,

pr.tmTPPanio,
t.tmTPPanio as TotalTPPanio,

pr.tmSaldoDiario,
t.tmSaldoDiario as TotalSaldoDiario

from DWHIndicadorTasaMargen pr , DWHIndicadorTasaMargen t
where pr.tmCodigoIndicador in (6,7,29)
and t.tmCodigoIndicador=2
and pr.tmFecha=t.tmFecha
and pr.tmFecha&gt;=@fechaAtrasAño


Union

--Total

select 
Agrupacion='Captaciones',
tmFecha,
tmCodigoIndicador,
tmDescripcion='Total',

tmTPPdia,
TotalTPPdia=0,

tmTPPmes,
TotalTPPmes=0,

tmTPPtrimestre,
TotalTPPtrimestre=0,

tmTPPanio,
TotalTPPanio=0,

tmSaldoDiario,
TotalSaldoDiario=0

from DWHIndicadorTasaMargen
where tmCodigoIndicador in (2)
and tmFecha&gt;=@fechaAtrasAño


Union

-------------------
-- Cartera  
-------------------

select 

Agrupacion='Cartera',

pr.tmFecha,
pr.tmCodigoIndicador,
pr.tmDescripcion,

pr.tmTPPdia,
t.tmTPPdia as TotalTPPdia,

pr.tmTPPmes,
t.tmTPPmes as TotalTPPmes,

pr.tmTPPtrimestre,
t.tmTPPtrimestre as TotalTPPtrimestre,

pr.tmTPPanio,
t.tmTPPanio as TotalTPPanio,

pr.tmSaldoDiario,
t.tmSaldoDiario as TotalSaldoDiario

from DWHIndicadorTasaMargen pr , DWHIndicadorTasaMargen t
where pr.tmCodigoIndicador in (94,95,96)
and t.tmCodigoIndicador=1
and pr.tmFecha=t.tmFecha
and pr.tmFecha&gt;=@fechaAtrasAño


Union

--Total

select 

Agrupacion='Cartera',

tmFecha,
tmCodigoIndicador,
tmDescripcion='Total',

tmTPPdia,
TotalTPPdia=0,

tmTPPmes,
TotalTPPmes=0,

tmTPPtrimestre,
TotalTPPtrimestre=0,

tmTPPanio,
TotalTPPanio=0,

tmSaldoDiario,
TotalSaldoDiario=0

from DWHIndicadorTasaMargen
where tmCodigoIndicador in (1)
and tmFecha&gt;=@fechaAtrasAño

) as MargenIndicadores 
inner join #tmFecha a on a.tmFecha = MargenIndicadores.tmFecha
order by tmFecha&lt;/RSQueryCommandText&gt;&lt;RSQueryCommandType&gt;Text&lt;/RSQueryCommandType&gt;&lt;RSQueryDesignState&gt;&lt;/RSQueryDesignState&gt;]]&gt;&lt;/AnnotationContent&gt;&lt;/Gemini&gt;</Value>
                    </Annotation>
                  </Annotations>
                  <Source xsi:type="QueryBinding">
                    <DataSourceID>21568b6b-c791-4141-8d9e-e542457fa7a5</DataSourceID>
                    <QueryDefinition>declare @fechaActual int
select @fechaActual = feidfecha from DWDFecha where feDiaActual = 1

if object_id('[tempdb]..#tmFecha') is not null
begin
drop table #tmFecha
end

select  ROW_NUMBER() OVER(ORDER BY tmFecha DESC) AS Row#,
tmFecha,
tmbandera=0
into #tmFecha
from (
select 
distinct top 90 tmFecha from DWHIndicadorTasaMargen
where tmFecha &lt;= @fechaActual
order by tmFecha desc ) a
update x
set
tmbandera = 1
 from #tmFecha x
inner join DWDFecha on tmFecha = feIdFecha
where feCierreMesTodosAnios = 1
update x
set
tmbandera = 1
 from #tmFecha x
inner join DWDFecha on tmFecha = feIdFechaHaceUnMesLab
where fediaactual = 1
update x
set
tmbandera = 2
 from #tmFecha x
where 
Row# = 1
update x
set
tmbandera = 3
 from #tmFecha x
where 
Row# = 2
update x
set
tmbandera = 4
 from #tmFecha x
where 
Row# = 3
--select * from #tmFecha

declare @fechaAtrasAño int

select @fechaAtrasAño= tmFecha from #tmFecha where Row# = 90

select 

Agrupacion,
MargenIndicadores.tmFecha,
tmCodigoIndicador,
tmDescripcion,
tmTPPdia,
TotalTPPdia,
tmTPPmes,
TotalTPPmes,
tmTPPtrimestre,
TotalTPPtrimestre,
tmTPPanio,
TotalTPPanio,
tmSaldoDiario,
TotalSaldoDiario,
a.tmbandera
from 
(
-------------------
-- Captaciones 
-------------------
select 
Agrupacion='Captaciones',

pr.tmFecha,
pr.tmCodigoIndicador,
tmDescripcion=
case pr.tmCodigoIndicador when 6 then 'Monetarios'
        when 7 then 'Ahorros'
        when 29 then 'Plazo' end,

pr.tmTPPdia,
t.tmTPPdia as TotalTPPdia,

pr.tmTPPmes,
t.tmTPPmes as TotalTPPmes,

pr.tmTPPtrimestre,
t.tmTPPtrimestre as TotalTPPtrimestre,

pr.tmTPPanio,
t.tmTPPanio as TotalTPPanio,

pr.tmSaldoDiario,
t.tmSaldoDiario as TotalSaldoDiario

from DWHIndicadorTasaMargen pr , DWHIndicadorTasaMargen t
where pr.tmCodigoIndicador in (6,7,29)
and t.tmCodigoIndicador=2
and pr.tmFecha=t.tmFecha
and pr.tmFecha&gt;=@fechaAtrasAño


Union

--Total

select 
Agrupacion='Captaciones',
tmFecha,
tmCodigoIndicador,
tmDescripcion='Total',

tmTPPdia,
TotalTPPdia=0,

tmTPPmes,
TotalTPPmes=0,

tmTPPtrimestre,
TotalTPPtrimestre=0,

tmTPPanio,
TotalTPPanio=0,

tmSaldoDiario,
TotalSaldoDiario=0

from DWHIndicadorTasaMargen
where tmCodigoIndicador in (2)
and tmFecha&gt;=@fechaAtrasAño


Union

-------------------
-- Cartera  
-------------------

select 

Agrupacion='Cartera',

pr.tmFecha,
pr.tmCodigoIndicador,
pr.tmDescripcion,

pr.tmTPPdia,
t.tmTPPdia as TotalTPPdia,

pr.tmTPPmes,
t.tmTPPmes as TotalTPPmes,

pr.tmTPPtrimestre,
t.tmTPPtrimestre as TotalTPPtrimestre,

pr.tmTPPanio,
t.tmTPPanio as TotalTPPanio,

pr.tmSaldoDiario,
t.tmSaldoDiario as TotalSaldoDiario

from DWHIndicadorTasaMargen pr , DWHIndicadorTasaMargen t
where pr.tmCodigoIndicador in (94,95,96)
and t.tmCodigoIndicador=1
and pr.tmFecha=t.tmFecha
and pr.tmFecha&gt;=@fechaAtrasAño


Union

--Total

select 

Agrupacion='Cartera',

tmFecha,
tmCodigoIndicador,
tmDescripcion='Total',

tmTPPdia,
TotalTPPdia=0,

tmTPPmes,
TotalTPPmes=0,

tmTPPtrimestre,
TotalTPPtrimestre=0,

tmTPPanio,
TotalTPPanio=0,

tmSaldoDiario,
TotalSaldoDiario=0

from DWHIndicadorTasaMargen
where tmCodigoIndicador in (1)
and tmFecha&gt;=@fechaAtrasAño

) as MargenIndicadores 
inner join #tmFecha a on a.tmFecha = MargenIndicadores.tmFecha
order by tmFecha</QueryDefinition>
                  </Source>
                  <StorageMode valuens="ddl200_200">InMemory</StorageMode>
                  <ProcessingMode>Regular</ProcessingMode>
                  <ErrorConfiguration>
                    <KeyNotFound>IgnoreError</KeyNotFound>
                    <KeyDuplicate>ReportAndStop</KeyDuplicate>
                    <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
                  </ErrorConfiguration>
                  <ProactiveCaching>
                    <SilenceInterval>-PT1S</SilenceInterval>
                    <Latency>-PT1S</Latency>
                    <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
                    <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
                    <Source xsi:type="ProactiveCachingInheritedBinding" />
                  </ProactiveCaching>
                </Partition>
              </Partitions>
              <ProactiveCaching>
                <SilenceInterval>-PT1S</SilenceInterval>
                <Latency>-PT1S</Latency>
                <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
                <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
                <Source xsi:type="ProactiveCachingInheritedBinding" />
              </ProactiveCaching>
            </MeasureGroup>
            <MeasureGroup>
              <ID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</ID>
              <Name>Fecha</Name>
              <Measures>
                <Measure>
                  <ID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</ID>
                  <Name>__XL_Count Fecha</Name>
                  <AggregateFunction>Count</AggregateFunction>
                  <DataType>BigInt</DataType>
                  <Source>
                    <DataType>BigInt</DataType>
                    <DataSize>8</DataSize>
                    <Source xsi:type="RowBinding">
                      <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                    </Source>
                  </Source>
                  <Visible>false</Visible>
                </Measure>
              </Measures>
              <StorageMode valuens="ddl200_200">InMemory</StorageMode>
              <ErrorConfiguration>
                <KeyNotFound>IgnoreError</KeyNotFound>
                <KeyDuplicate>ReportAndStop</KeyDuplicate>
                <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
              </ErrorConfiguration>
              <ProcessingMode>Regular</ProcessingMode>
              <Dimensions>
                <Dimension xsi:type="DegenerateMeasureGroupDimension">
                  <CubeDimensionID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>__XL_RowNumber</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha</TableID>
                            <ColumnID>__XL_RowNumber</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                      <Type>Granularity</Type>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feIdFecha</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feIdFecha</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFechaCodigoAlt</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFechaCodigoAlt</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFecha</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Date</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFecha</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feDescripcionFecha</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feDescripcionFecha</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCalAnio</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCalAnio</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCalMes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Currency</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCalMes</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCalDia</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCalDia</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCalDiaAnio</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCalDiaAnio</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feTrimNumero</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feTrimNumero</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feTrimMes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feTrimMes</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feTrimDia</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feTrimDia</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCopaCodigo</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCopaCodigo</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCopaMes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCopaMes</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCopaDia</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCopaDia</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFeriado</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFeriado</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFeriadoNombre</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFeriadoNombre</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feTemporada</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feTemporada</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feCierreMes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feCierreMes</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFinMes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFinMes</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFinSemana</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFinSemana</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFutura</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFutura</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feDiasReplicarProximos</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feDiasReplicarProximos</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feDiasReplicarAnteriores</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feDiasReplicarAnteriores</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>EsDiaAnterior</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>EsDiaAnterior</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>fecIdAnterior</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>fecIdAnterior</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>EsCierreAño</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Boolean</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>EsCierreAño</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feMesAntCierr</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feMesAntCierr</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feAnioAntCierr</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feAnioAntCierr</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feIdFechaAnioAnt</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feIdFechaAnioAnt</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feIdFechaCierreAnioAnt</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feIdFechaCierreAnioAnt</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>feFechaCierreAnio</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Date</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</TableID>
                            <ColumnID>feFechaCierreAnio</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>FechaFormato</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>FormatoFechaMesAnio</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                  </Attributes>
                  <ddl200_200:ShareDimensionStorage>Shared</ddl200_200:ShareDimensionStorage>
                </Dimension>
              </Dimensions>
              <Partitions>
                <Partition>
                  <ID>DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2</ID>
                  <Name>DWDFecha</Name>
                  <Annotations>
                    <Annotation>
                      <Name>TableWidgetSerialization</Name>
                      <Value>&lt;?xml version="1.0" encoding="UTF-16"?&gt;&lt;Gemini xmlns="TableWidgetSerialization"&gt;&lt;AnnotationContent&gt;&lt;![CDATA[&lt;?xml version="1.0"?&gt;
&lt;TableWidgetGridSerialization xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;ColumnSuggestedType /&gt;
  &lt;ColumnFormat /&gt;
  &lt;ColumnAccuracy /&gt;
  &lt;ColumnCurrencySymbol /&gt;
  &lt;ColumnPositivePattern /&gt;
  &lt;ColumnNegativePattern /&gt;
  &lt;ColumnWidths&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feIdFecha&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;79&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFechaCodigoAlt&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;115&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFecha&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;69&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feDescripcionFecha&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;123&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCalAnio&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;76&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCalMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;74&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCalDia&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;70&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCalDiaAnio&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;91&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feTrimNumero&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;97&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feTrimMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;79&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feTrimDia&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;75&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCopaCodigo&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;98&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCopaMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;84&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCopaDia&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;80&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFeriado&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;76&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFeriadoNombre&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;113&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feTemporada&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;94&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCierreMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;88&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFinMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;73&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFinSemana&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;92&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFutura&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;72&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feDiasReplicarProximos&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;141&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feDiasReplicarAnteriores&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;148&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;EsDiaAnterior&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;95&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;fecIdAnterior&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;94&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;EsCierreAño&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;89&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feMesAntCierr&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;99&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feAnioAntCierr&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;101&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feIdFechaAnioAnt&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;117&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feIdFechaCierreAnioAnt&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;146&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFechaCierreAnio&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;119&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
  &lt;/ColumnWidths&gt;
  &lt;ColumnDisplayIndex&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feIdFecha&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;0&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFechaCodigoAlt&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;1&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFecha&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;2&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feDescripcionFecha&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;3&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCalAnio&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;4&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCalMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;5&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCalDia&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;6&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCalDiaAnio&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;7&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feTrimNumero&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;8&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feTrimMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;9&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feTrimDia&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;10&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCopaCodigo&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;11&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCopaMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;12&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCopaDia&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;13&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFeriado&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;14&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFeriadoNombre&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;15&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feTemporada&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;16&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feCierreMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;17&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFinMes&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;18&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFinSemana&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;19&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFutura&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;20&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feDiasReplicarProximos&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;21&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feDiasReplicarAnteriores&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;22&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;EsDiaAnterior&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;23&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;fecIdAnterior&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;24&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;EsCierreAño&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;25&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feMesAntCierr&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;26&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feAnioAntCierr&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;27&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feIdFechaAnioAnt&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;28&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feIdFechaCierreAnioAnt&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;29&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
    &lt;item&gt;
      &lt;key&gt;
        &lt;string&gt;feFechaCierreAnio&lt;/string&gt;
      &lt;/key&gt;
      &lt;value&gt;
        &lt;int&gt;30&lt;/int&gt;
      &lt;/value&gt;
    &lt;/item&gt;
  &lt;/ColumnDisplayIndex&gt;
  &lt;ColumnFrozen /&gt;
  &lt;ColumnChecked /&gt;
  &lt;ColumnFilter /&gt;
  &lt;SelectionFilter /&gt;
  &lt;FilterParameters /&gt;
  &lt;IsSortDescending&gt;false&lt;/IsSortDescending&gt;
&lt;/TableWidgetGridSerialization&gt;]]&gt;&lt;/AnnotationContent&gt;&lt;/Gemini&gt;</Value>
                    </Annotation>
                    <Annotation>
                      <Name>TableWidgetSourceTable</Name>
                    </Annotation>
                    <Annotation>
                      <Name>QueryEditorSerialization</Name>
                    </Annotation>
                    <Annotation>
                      <Name>IsQueryEditorUsed</Name>
                      <Value>False</Value>
                    </Annotation>
                  </Annotations>
                  <Source xsi:type="QueryBinding">
                    <DataSourceID>21568b6b-c791-4141-8d9e-e542457fa7a5</DataSourceID>
                    <QueryDefinition>SELECT [dbo].[DWDFecha].* 		FROM [dbo].[DWDFecha]</QueryDefinition>
                  </Source>
                  <StorageMode valuens="ddl200_200">InMemory</StorageMode>
                  <ProcessingMode>Regular</ProcessingMode>
                  <ErrorConfiguration>
                    <KeyNotFound>IgnoreError</KeyNotFound>
                    <KeyDuplicate>ReportAndStop</KeyDuplicate>
                    <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
                  </ErrorConfiguration>
                  <ProactiveCaching>
                    <SilenceInterval>-PT1S</SilenceInterval>
                    <Latency>-PT1S</Latency>
                    <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
                    <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
                    <Source xsi:type="ProactiveCachingInheritedBinding" />
                  </ProactiveCaching>
                </Partition>
              </Partitions>
              <ProactiveCaching>
                <SilenceInterval>-PT1S</SilenceInterval>
                <Latency>-PT1S</Latency>
                <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
                <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
                <Source xsi:type="ProactiveCachingInheritedBinding" />
              </ProactiveCaching>
            </MeasureGroup>
            <MeasureGroup>
              <ID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</ID>
              <Name>ConsolidadoHojaPosicion</Name>
              <Measures>
                <Measure>
                  <ID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</ID>
                  <Name>__XL_Count ConsolidadoHojaPosicion</Name>
                  <AggregateFunction>Count</AggregateFunction>
                  <DataType>BigInt</DataType>
                  <Source>
                    <DataType>BigInt</DataType>
                    <DataSize>8</DataSize>
                    <Source xsi:type="RowBinding">
                      <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                    </Source>
                  </Source>
                  <Visible>false</Visible>
                </Measure>
              </Measures>
              <StorageMode valuens="ddl200_200">InMemory</StorageMode>
              <ErrorConfiguration>
                <KeyNotFound>IgnoreError</KeyNotFound>
                <KeyDuplicate>ReportAndStop</KeyDuplicate>
                <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
              </ErrorConfiguration>
              <ProcessingMode>Regular</ProcessingMode>
              <Dimensions>
                <Dimension xsi:type="DegenerateMeasureGroupDimension">
                  <CubeDimensionID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>__XL_RowNumber</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion</TableID>
                            <ColumnID>__XL_RowNumber</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                      <Type>Granularity</Type>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodCliente</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>CodCliente</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>NombreCliente</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>NombreCliente</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodigoMoneda</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>CodigoMoneda</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodigoAgenciaOper</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>CodigoAgenciaOper</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodigoAgenciaCli</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>CodigoAgenciaCli</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodProducto</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>CodProducto</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>FechaVencimiento</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>FechaVencimiento</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>FechaApertura</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>FechaApertura</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>NumeroOperacion</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>NumeroOperacion</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Plazo</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>Plazo</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>OperacionCliente</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>OperacionCliente</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodCanal</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>CodCanal</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>OrdenN1</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>OrdenN1</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>OrdenN2</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>OrdenN2</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Canal</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>Canal</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Nivel1</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>Nivel1</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Nivel2</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>Nivel2</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Nivel3</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>Nivel3</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>TasaHoy</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>TasaHoy</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>TasaAyer</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>TasaAyer</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>TasaMesAnt</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>TasaMesAnt</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>TasaAnioAnt</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>TasaAnioAnt</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>RealHoy</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>RealHoy</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>RealAyer</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>RealAyer</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>RealMesAnt</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>RealMesAnt</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>RealAnioAnt</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Double</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</TableID>
                            <ColumnID>RealAnioAnt</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodCliente2</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Add Column2</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Nivel2Descrip</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodigoProducto</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>DescripcionCabecera</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                  </Attributes>
                  <ddl200_200:ShareDimensionStorage>Shared</ddl200_200:ShareDimensionStorage>
                </Dimension>
                <Dimension xsi:type="ReferenceMeasureGroupDimension">
                  <CubeDimensionID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>__XL_RowNumber</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <DataSize>4</DataSize>
                          <NullProcessing>Error</NullProcessing>
                          <Source xsi:type="ddl200_200:RowNumberBinding" />
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Orden</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</TableID>
                            <ColumnID>Orden</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>caDescripcionAgrupacionCanal</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Error</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</TableID>
                            <ColumnID>caDescripcionAgrupacionCanal</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                      <Type>Granularity</Type>
                    </Attribute>
                    <Attribute>
                      <AttributeID>caNegTes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression>IF(Canal[caDescripcionAgrupacionCanal]="Comercial" || Canal[caDescripcionAgrupacionCanal]="Corporativo" || Canal[caDescripcionAgrupacionCanal]="Especializada","Negocios","Otros Canales")</Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>OrdenNegTes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression>IF([caNeg]="Negocios",1,2)</Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodigoCanalOrden</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression>"X"&amp;Canal[Orden]&amp;"X"</Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>caCodigoAgrupacionCanal</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</TableID>
                            <ColumnID>caCodigoAgrupacionCanal</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                  </Attributes>
                  <IntermediateCubeDimensionID>ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32</IntermediateCubeDimensionID>
                  <IntermediateGranularityAttributeID>Canal</IntermediateGranularityAttributeID>
                  <Materialization>Regular</Materialization>
                  <ddl300:RelationshipID>25d1047b-5184-46fd-b7ae-a17fa67ae3c0</ddl300:RelationshipID>
                </Dimension>
              </Dimensions>
              <Partitions>
                <Partition>
                  <ID>ConsolidadoHojaPosicion_befcd035-8e93-4fb2-99cf-25e7844bd38a</ID>
                  <Name>DWHConsolidadoHojaPosicionDiaria</Name>
                  <Source xsi:type="QueryBinding">
                    <DataSourceID>21568b6b-c791-4141-8d9e-e542457fa7a5</DataSourceID>
                    <QueryDefinition>SET NOCOUNT ON

declare @FechAct int, @FechaAyer int, @FechaMesAnt int, @FechaAnioAnt int,
 @CanalTit varchar(50),  @CanalAgrTit varchar(50), @DescripcionCartera varchar(50)

  
select @FechAct=max(feIdFecha) from DWDFecha
where feDiaActual=1--feCierreMes=1 and feIdFecha&lt;=cast(convert(varchar(10),getdate(),112) as int)

select
@FechAct=max(feIdFecha)  
from  DWDFecha
where feIdFecha&lt;=@FechAct
and feFinSemana&lt;&gt;1
and feFeriado&lt;&gt;1

			-- quitar esto comentarios
			select
			@FechaAyer=fecIdAnterior,
			@FechaMesAnt=feMesAntCierr,
			@FechaAnioAnt=feAnioAntCierr
			from  DWDFecha
			where feIdFecha=@FechAct


			/* ----------------- */
			/* Desencriptacion   */
			/* ----------------- */


			OPEN SYMMETRIC KEY ClaveMIS02
			DECRYPTION BY CERTIFICATE Certi01

			-- ActivoOperacion

			if object_id('[tempdb]..#DWHActivoOperacion') is not null
			begin
			drop table #DWHActivoOperacion
			end

			select
			aoIdFecha,
			aoIdAgencia,
			aoIdAsesorPrincipal,
			aoIdAsesorSecundario,
			aoIdCliente,
			aoIdCuentaContable,
			aoIdProducto,
			aoIdMoneda,
			aoIdEstadoOperacion,
			aoIdEstadoCredito,
			aoIdFechaCarga,
			aoIdFechaConcesion,
			aoIdFechaVencimiento,
			aoIdCalificacionOperacionCliente,
			aoIdLegalOperacionCliente,
			aoRangoMontoUVC,
			aoRangoTasaInteres,
			aoRangoMorosidad,
			aoRangoOperacion,
			aoCotizaUVC,
			aoOperaciones,
			aoDiasOperacion,
			aoDiasVencidoPorVencer,
			aoTasaEfectiva,
			aoTasaInteres,
			aoTasaNominal,
			aoTasaComision,
			aoTasaPonderada,
			aoMontoCapitalDolares,
			aoMontoSaldoDolar,
			aoMontoInteresDolares,
			aoMontoTotalDolar,
			aoMontoInteresNoDevengaDolar,
			aoMontoInteresMoraDolar,
			aoPlazoOperacion,
			aoNumeroOperacion=cast(CONVERT(varchar(20), DecryptByKey(aoNumeroOperacion)) as float)--,
			--aoNumeroOperacion2=cast(CONVERT(varchar(20), DecryptByKey(aoNumeroOperacion2)) as float)
			into #DWHActivoOperacion
			from DWHActivoOperacion
			where aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and abs(aoMontoSaldoDolar) &gt; 0



			-- PasivoOperacion

			if object_id('[tempdb]..#DWHPasivoOperacion') is not null
			begin
			drop table #DWHPasivoOperacion
			end

			select
			poIdFecha,
			poIdProducto,
			poIdMoneda,
			poIdAgencia,
			poIdAsesor,
			poIdCliente,
			poIdCuentaContable,
			poIdEstadoDeposito,
			poIdEstadoOperacion,
			poNumeroDeOperaciones,
			poPlazoOperacion,
			poSaldoOperacion,
			poSaldoOperacionUSD,
			poSaldoDisponible,
			poSaldoDisponibleUSD,
			poSaldoPromedioDisponible,
			poSaldoTotal,
			poTasaEfectiva,
			poTasaNominal,
			poFechaVencimiento,
			poIdCalificacionOperacionCliente,
			poIdLegalOperacionCliente,
			poNoOperacion=cast(CONVERT(varchar(20), DecryptByKey(poNoOperacion)) as float)
			into #DWHPasivoOperacion
			from DWHPasivoOperacion
			where poIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and abs(poSaldoOperacionUSD) &gt; 0


			-- DWHCuotaOperacion

			if object_id('[tempdb]..#DWHCuotaOperacion') is not null
			begin
			drop table #DWHCuotaOperacion
			end

			select
			coIdFecha,
			coIdAgencia,
			coIdAsesorPrincipal,
			coIdAsesorSecundario,
			coIdCliente,
			coIdCuentaContable,
			coIdProducto,
			coIdMoneda,
			coIdEstadoOperacion,
			coIdFechaCarga,
			coIdFechaConcesion,
			coIdFechaVencimiento,
			coIdCalificacionOperacionCliente,
			coIdLegalOperacionCliente,
			coRangoMontoUVC,
			coRangoTasaInteres,
			coRangoMorosidad,
			coRangoOperacion,
			coCotizaUVC,
			coOperaciones,
			coDiasOperacion,
			coDiasVencidoPorVencer,
			coTasaInteres,
			coCuotaCapital,
			coValorInteresCuota,
			coCuotaCapitalPagado,
			coValorInteresCuotaPagado,
			coMontoInteresNoDevengaDolares,
			coInteresMoraPagado,
			coInteresAcruadoMora,
			coNumeroOperacion=cast(CONVERT(varchar(20), DecryptByKey(coNumeroOperacion)) as float)
			into #DWHCuotaOperacion
			from DWHCuotaOperacion
			where coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			--and coIdCliente in (182219,319128)

			-- DWDTitularizadaOperacion

			if object_id('[tempdb]..#DWDTitularizadaOperacion') is not null
			begin
			drop table #DWDTitularizadaOperacion
			end

			select top 0
			toNombre,
			toCedula=CONVERT(varchar(15), DecryptByKey(toCedula)),
			toOperacion=CONVERT(varchar(9), DecryptByKey(toOperacion))
			into #DWDTitularizadaOperacion
			from DWDTitularizadaOperacion


			CLOSE SYMMETRIC KEY ClaveMIS02


			--&gt;&gt; CARTERA &lt;&lt;--

select @DescripcionCartera=max(ccFamiliaProducto)
from DWDCuentaContable
inner join (  
    SELECT DISTINCT 
    p2.CpCodigoIndicador indicadorNivel3
    FROM DWDClasificacionProductos p
    join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
    join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
    WHERE p.CpCodigoIndicador in (1)
 and p1.CpCodigoIndicador in (120,121,122,126)
    and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
     ) cp ON ccCodigoIndicador=cp.indicadorNivel3


--&gt;&gt; TITULARIZADA &lt;&lt;--

select 
@CanalTit=caDescripcionAgrupacionCanal,
@CanalAgrTit=caAgrupacion
from DWDCanal 
where caCodigoCanal='TIT'




-- Eliminar Temporal

if object_id('[tempdb]..#ConsCart') is not null
begin
 drop table #ConsCart
end



/* ---------------------------------------------------------------------- */
/*                           CARTERA                                      */
/* ---------------------------------------------------------------------- */


-- Comer. + Micro. (525,526,524,501,504,506,505,509,507)
-- Consumo (510,511,512,513,514,515)
-- Vivienda (519,520,521,522,523)

select  
CodCliente= cl.clCodigoCliente,
NombreCliente=cl.clNombreCompleto,
CodigoMoneda=case co.coIdFecha when @FechAct then  mo.moCodigoMoneda else null end,
CodigoAgenciaOper=case co.coIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion 
CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Cliente
CodProducto=case co.coIdFecha when @FechAct then  pr.prCodigoProducto else null end, 
FechaVencimiento=case co.coIdFecha when @FechAct then  co.coIdFechaVencimiento else null end,
FechaApertura=case co.coIdFecha when @FechAct then  co.coIdFechaConcesion else null end,
NumeroOperacion=case co.coIdFecha when @FechAct then  co.coNumeroOperacion   else null end, 
Plazo='', 
OperacionCliente=case co.coIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,  
CodCanal=ca.caCodigoCanal,   
Estado=CpEstadoProducto, --ccClasificacionEstado,  
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=ca.caOrdenCanal,  
Canal=ca.caDescripcionAgrupacionCanal,
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='     '+ca.caAgrupacion,
RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end
into #ConsCart
--drop table #ConsCart
from #DWHCuotaOperacion co 
inner join DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda  
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
left outer join DWDAgenciaOperacion ago on ago.agIdAgencia=co.coIdAgencia -- Agencia de Operacion
left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente
left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=co.coIdCalificacionOperacionCliente
left outer join #DWDTitularizadaOperacion ti on  isnull(co.coNumeroOperacion,'')=ti.toOperacion 
--left outer join DWDFecha fv on fv.feIdFecha=co.coIdFechaVencimiento
--left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal
inner join 
(
  SELECT DISTINCT 
   p2.CpCodigoIndicador indicadorNivel3
  ,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end 
  FROM DWDClasificacionProductos p
  join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
  join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
  WHERE p.CpCodigoIndicador in (1)
  and p1.CpCodigoIndicador in (120,121,122,126)
  and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)  
and pr.prVehiculo is null
and cl.clFechaFin is null
and ca.caEstado=1
and ti.toOperacion is null -- Filtro Titularizada
group by 
--cc.ccClasificacionEstado,
CpEstadoProducto,
co.coIdFecha,
pr.prCodigoProducto,
co.coIdFechaVencimiento,
co.coIdFechaConcesion,
coc.cocCodigoCalificacionOperacionCliente,
ca.caCodigoCanal,
cl.clCodigoCliente,
co.coNumeroOperacion,
ago.agCodigoAgencia,
ag.agCodigoAgencia,
ca.caAgrupacion,
ca.caOrdenCanal,
ca.caDescripcionAgrupacionCanal,
cl.clNombreCompleto,  
mo.moCodigoMoneda,    
cc.ccOrdenAgrupacionN2,
cc.ccFamiliaProducto,
prCodigoProducto,
ccCodigoNivel6,
cc.ccGrupo,    
cc.ccOrdenAgrupacion,
cc.ccCodigoIndicador

Union All

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- T. Credito
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select 
CodCliente= cl.clCodigoCliente,
NombreCliente=cl.clNombreCompleto,
CodigoMoneda=case tco.tcoIdFecha when @FechAct then  mo.moCodigoMoneda else null end,
CodigoAgenciaOper=case tco.tcoIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion 
CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Cliente
CodProducto=case tco.tcoIdFecha when @FechAct then  pr.prCodigoProducto else null end, 
FechaVencimiento=null,
FechaApertura=null,
NumeroOperacion=null, 
Plazo='', 
OperacionCliente=case tco.tcoIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,  
CodCanal=ca.caCodigoCanal, 
Estado=CpEstadoProducto, --cc.ccClasificacionEstado,
OrdenN1=cc.ccOrdenAgrupacion,
OrdenN2=cc.ccOrdenAgrupacionN2,
OrdenN3=ca.caOrdenCanal,
Canal=ca.caDescripcionAgrupacionCanal,
Nivel1=cc.ccFamiliaProducto,
Nivel2=cc.ccGrupo,
Nivel3='     '+ca.caAgrupacion, 
RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,
RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end
from DWHTarjetaCreditoOperacion tco 
inner join DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto
inner join DWDMoneda mo on moIdMoneda=tcoIdMoneda
left outer join DWDAgenciaOperacion ago on ago.agIdAgencia=tco.tcoIdAgencia -- Agencia de Operacion
left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente
left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=tco.tcoIdCalificacionOperacionCliente
inner join 
(  
    SELECT DISTINCT 
     p2.CpCodigoIndicador indicadorNivel3
	,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end
    FROM DWDClasificacionProductos p
    join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
    join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
    WHERE p.CpCodigoIndicador = 1
    and p1.CpCodigoIndicador = 124
    and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3
where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and cl.clFechaFin is null
and ca.caEstado=1
--and tcoIdCliente in (182219,319128)
--and cc.ccCodigoMoneda='USD'
group by 
cl.clCodigoCliente,
cl.clNombreCompleto,
coc.cocCodigoCalificacionOperacionCliente,
CpEstadoProducto, --
ca.caCodigoCanal,
 mo.moCodigoMoneda,
cc.ccOrdenAgrupacion,
ca.caOrdenCanal,
cc.ccOrdenAgrupacionN2,
ca.caDescripcionAgrupacionCanal,
cc.ccFamiliaProducto,
caAgrupacion,
cc.ccGrupo,
ago.agCodigoAgencia,
pr.prCodigoProducto,
ag.agCodigoAgencia,
tco.tcoIdFecha


Union all


--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- Vehiculos
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select  
CodCliente= cl.clCodigoCliente,
NombreCliente=cl.clNombreCompleto,
CodigoMoneda=case co.coIdFecha when @FechAct then  mo.moCodigoMoneda else null end,
CodigoAgenciaOper=case co.coIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion 
CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Cliente
CodProducto=case co.coIdFecha when @FechAct then  pr.prCodigoProducto else null end, 
FechaVencimiento=case co.coIdFecha when @FechAct then  co.coIdFechaVencimiento else null end,
FechaApertura=case co.coIdFecha when @FechAct then  co.coIdFechaConcesion else null end,
NumeroOperacion=case co.coIdFecha when @FechAct then  co.coNumeroOperacion   else null end, 
Plazo='', 
OperacionCliente=case co.coIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,  
CodCanal=ca.caCodigoCanal,   
Estado=CpEstadoProducto, --ccClasificacionEstado,  
OrdenN1=pr.prOrdenN1,
OrdenN2=pr.prOrdenN2,
OrdenN3=ca.caOrdenCanal,  
Canal=ca.caDescripcionAgrupacionCanal,
Nivel1=cc.ccFamiliaProducto,
Nivel2=pr.prVehiculo,
Nivel3='     '+ca.caAgrupacion,
RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end
from #DWHCuotaOperacion co 
inner join DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
inner join DWDCliente cl on co.coIdCliente=clIdCliente
inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda  
inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
left outer join DWDAgenciaOperacion ago on ago.agIdAgencia=co.coIdAgencia -- Agencia de Operacion
left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente
left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=co.coIdCalificacionOperacionCliente
--left outer join DWDFecha fv on fv.feIdFecha=co.coIdFechaVencimiento
--left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal
inner join 
(  
   SELECT DISTINCT 
    p2.CpCodigoIndicador indicadorNivel3
  ,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end
   FROM DWDClasificacionProductos p
   join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
   join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
   WHERE p.CpCodigoIndicador in (1)
   and p1.CpCodigoIndicador in (120,121,122,126)
   and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
) cp ON ccCodigoIndicador=cp.indicadorNivel3
where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
and pr.prVehiculo='Vehiculos'   
and cl.clFechaFin is null
and ca.caEstado=1
--and ccCodigoMoneda=moCodigoMoneda
--and cc.ccCodigoMoneda='USD'
group by 
CpEstadoProducto,
co.coIdFecha,
pr.prCodigoProducto,
co.coIdFechaVencimiento,
co.coIdFechaConcesion,
coc.cocCodigoCalificacionOperacionCliente,
ca.caCodigoCanal,
cl.clCodigoCliente,
co.coNumeroOperacion,
ago.agCodigoAgencia,
ag.agCodigoAgencia,
ca.caAgrupacion,
ca.caOrdenCanal,
pr.prVehiculo,
ca.caDescripcionAgrupacionCanal,
cl.clNombreCompleto,  
mo.moCodigoMoneda,    
pr.prOrdenN1,
pr.prOrdenN2,
cc.ccFamiliaProducto,
prCodigoProducto,
ccCodigoNivel6,
--cc.ccGrupo,    
cc.ccCodigoIndicador

Union All

--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
-- Titularizada
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

--&gt; Identificacion de C.Titularizada por número de operación

			select
			CodCliente= cl.clCodigoCliente,
			NombreCliente=cl.clNombreCompleto,
			CodigoMoneda=case co.coIdFecha when @FechAct then  mo.moCodigoMoneda else null end,
			CodigoAgenciaOper=case co.coIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion
			CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Cliente
			CodProducto=case co.coIdFecha when @FechAct then  pr.prCodigoProducto else null end,
			FechaVencimiento=case co.coIdFecha when @FechAct then  co.coIdFechaVencimiento else null end,
			FechaApertura=case co.coIdFecha when @FechAct then  co.coIdFechaConcesion else null end,
			NumeroOperacion=case co.coIdFecha when @FechAct then  co.coNumeroOperacion   else null end,
			Plazo='',
			OperacionCliente=case co.coIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,
			CodCanal=ca.caCodigoCanal,

			Estado=ccClasificacionEstado,
			OrdenN1=cc.ccOrdenAgrupacion,
			OrdenN2=cc.ccOrdenAgrupacionN2,
			OrdenN3=ca.caOrdenCanal,
			Canal=@CanalTit,
			Nivel1=@DescripcionCartera,
			Nivel2='C. '+@CanalTit,
			Nivel3=space(5)+ @CanalAgrTit,
			RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
			RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
			RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,
			RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end
			from #DWHCuotaOperacion co
			inner join DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on co.coIdCliente=clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda
			inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto
			left outer join DWDAgenciaOperacion ago on ago.agIdAgencia=co.coIdAgencia -- Agencia de Operacion
			left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente
			left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=co.coIdCalificacionOperacionCliente
			inner join #DWDTitularizadaOperacion ti on isnull(co.coNumeroOperacion,'')=ti.toOperacion -- Titularizada
			--left outer join DWDFecha fv on fv.feIdFecha=co.coIdFechaVencimiento
			--left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal
			inner join (
			SELECT DISTINCT
			p2.CpCodigoIndicador indicadorNivel3
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador in (1)
			and p1.CpCodigoIndicador in (120,121,122,126)
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON ccCodigoIndicador=cp.indicadorNivel3
			where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and ccCodigoMoneda=moCodigoMoneda
			and cl.clFechaFin is null
			and ca.caEstado=1
			group by
			cc.ccClasificacionEstado,
			co.coIdFecha,
			pr.prCodigoProducto,
			co.coIdFechaVencimiento,
			co.coIdFechaConcesion,
			coc.cocCodigoCalificacionOperacionCliente,
			ca.caCodigoCanal,
			cl.clCodigoCliente,
			co.coNumeroOperacion,
			ago.agCodigoAgencia,
			ag.agCodigoAgencia,
			ca.caAgrupacion,
			ca.caOrdenCanal,
			ca.caDescripcionAgrupacionCanal,
			cl.clNombreCompleto,
			mo.moCodigoMoneda,
			cc.ccOrdenAgrupacionN2,
			cc.ccFamiliaProducto,
			prCodigoProducto,
			ccCodigoNivel6,
			cc.ccGrupo,
			cc.ccOrdenAgrupacion,
			cc.ccCodigoIndicador

			Union All


			-- Cambio de asignación de Titularizada a Cartera Titularizada

			select
			CodCliente= cl.clCodigoCliente,
			NombreCliente=cl.clNombreCompleto,
			CodigoMoneda=case ao.aoIdFecha when @FechAct then  mo.moCodigoMoneda else null end,
			CodigoAgenciaOper=case ao.aoIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion
			CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Cliente
			CodProducto=case ao.aoIdFecha when @FechAct then  pr.prCodigoProducto else null end,
			FechaVencimiento=case ao.aoIdFecha when @FechAct then  ao.aoIdFechaVencimiento else null end,
			FechaApertura=case ao.aoIdFecha when @FechAct then  ao.aoIdFechaConcesion else null end,
			NumeroOperacion=case ao.aoIdFecha when @FechAct then  ao.aoNumeroOperacion   else null end,
			Plazo='',
			OperacionCliente=case ao.aoIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,
			CodCanal=ca.caCodigoCanal,
			Estado=ccClasificacionEstado,
			OrdenN1=cc.ccOrdenAgrupacion,
			OrdenN2=cc.ccOrdenAgrupacionN2,
			OrdenN3=ca.caOrdenCanal,
			Canal=@CanalTit,
			Nivel1=@DescripcionCartera,
			Nivel2='C. '+@CanalTit,
			Nivel3=space(5)+ @CanalAgrTit,
			RealHoy=case ao.aoIdFecha when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
			RealAyer=case ao.aoIdFecha when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
			RealMesAnt=case ao.aoIdFecha when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,
			RealAnioAnt=case ao.aoIdFecha when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end
			from #DWHActivoOperacion ao
			inner join DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on ao.aoIdCliente=cl.clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDProducto pr on pr.prIdProducto=ao.aoIdProducto
			inner join DWDMoneda mo on mo.moIdMoneda=ao.aoIdMoneda
			left outer join DWDAgenciaOperacion ago on ago.agIdAgencia=ao.aoIdAgencia
			left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente
			left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=ao.aoIdCalificacionOperacionCliente
			inner join (
			SELECT DISTINCT
			p2.CpCodigoIndicador indicadorNivel3
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador = 1
			and p1.CpCodigoIndicador = 125
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON ccCodigoIndicador=cp.indicadorNivel3
			where ao.aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and pr.prVehiculo is null
			and cl.clFechaFin is null
			and ca.caEstado=1
			group by
			cc.ccOrdenAgrupacion,
			cc.ccOrdenAgrupacionN2,
			ca.caOrdenCanal,
			clCodigoCliente,
			ago.agCodigoAgencia,
			cc.ccClasificacionEstado,
			cc.ccGrupo,
			mo.moCodigoMoneda,
			ao.aoIdFecha,
			ao.aoNumeroOperacion,
			ca.caCodigoCanal,
			ag.agCodigoAgencia,
			cl.clNombreCompleto,
			pr.prCodigoProducto,
			ao.aoIdFechaVencimiento,
			ao.aoIdFechaConcesion,
			coc.cocCodigoCalificacionOperacionCliente

			-- Eliminar Temporal

			if object_id('[tempdb]..#Tasas') is not null
			begin
			drop table #Tasas
			end


			---------------------
			-- Obtener Tasas
			---------------------


			select
			clCodigoCliente,
			NumeroOperacion=case ao.aoIdFecha when @FechAct then ao.aoNumeroOperacion else null end,
			FechaVencimiento=case ao.aoIdFecha when @FechAct then ao.aoIdFechaVencimiento else null end, --co.coIdFechaVencimiento,
			FechaApertura=case ao.aoIdFecha when @FechAct then ao.aoIdFechaConcesion else null end,--co.coIdFechaConcesion,
			CodCanal=ca.caCodigoCanal,
			CodMoneda=case ao.aoIdFecha when @FechAct then  mo.moCodigoMoneda  else null end,
			CodProducto=case ao.aoIdFecha when @FechAct then  pr.prCodigoProducto  else null end,
			--OperCodigoAgencia=case ao.aoIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion
			CodigoAgenciaCli=ag.agCodigoAgencia,
			Estado=cc.ccClasificacionEstado,
			Nivel2=cc.ccGrupo,
			TasaHoy=case ao.aoIdFecha  when @FechAct then max(isnull(ao.aoTasaNominal,0)) else 0 end,
			TasaAyer=case ao.aoIdFecha  when @FechaAyer then max(isnull(ao.aoTasaNominal,0)) else 0 end,
			TasaMesAnt=case ao.aoIdFecha  when @FechaMesAnt then max(isnull(ao.aoTasaNominal,0)) else 0 end,
			TasaAnioAnt=case ao.aoIdFecha  when @FechaAnioAnt then max(isnull(ao.aoTasaNominal,0)) else 0 end
			into #Tasas
			--drop table #Tasas
			from #DWHActivoOperacion ao
			inner join DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on ao.aoIdCliente=cl.clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDProducto pr on pr.prIdProducto=ao.aoIdProducto
			inner join DWDMoneda mo on mo.moIdMoneda=ao.aoIdMoneda
			--inner join DWDAgenciaOperacion ag on ago.agIdAgencia=ao.aoIdAgencia
			left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente
			inner join (
			SELECT DISTINCT
			p2.CpCodigoIndicador indicadorNivel3
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador in (1)
			and p1.CpCodigoIndicador in (120,121,122,126)
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON ccCodigoIndicador=cp.indicadorNivel3
			where ao.aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and pr.prVehiculo is null
			and cl.clFechaFin is null
			and ca.caEstado=1
			and isnull(ao.aoTasaNominal,0) &gt; 0
			group by
			clCodigoCliente,
			--ca.caAgrupacion,
			cc.ccClasificacionEstado,
			cc.ccGrupo,
			mo.moCodigoMoneda,
			ao.aoIdFecha,
			ao.aoNumeroOperacion,
			ca.caCodigoCanal,
			ag.agCodigoAgencia,
			pr.prCodigoProducto,
			ao.aoIdFechaVencimiento,
			ao.aoIdFechaConcesion

			union all


			select
			clCodigoCliente,
			NumeroOperacion=case ao.aoIdFecha when @FechAct then ao.aoNumeroOperacion else null end,
			FechaVencimiento=case ao.aoIdFecha when @FechAct then ao.aoIdFechaVencimiento else null end, --co.coIdFechaVencimiento,
			FechaApertura=case ao.aoIdFecha when @FechAct then ao.aoIdFechaConcesion else null end,--co.coIdFechaConcesion,
			CodCanal=ca.caCodigoCanal,
			CodMoneda=case ao.aoIdFecha when @FechAct then  mo.moCodigoMoneda  else null end,
			CodProducto=case ao.aoIdFecha when @FechAct then  pr.prCodigoProducto  else null end,
			--OperCodigoAgencia=case ao.aoIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion
			CodigoAgenciaCli=ag.agCodigoAgencia,
			Estado=cc.ccClasificacionEstado,
			Nivel2=pr.prVehiculo,
			TasaHoy=case ao.aoIdFecha  when @FechAct then max(isnull(ao.aoTasaNominal,0)) else 0 end,
			TasaAyer=case ao.aoIdFecha  when @FechaAyer then max(isnull(ao.aoTasaNominal,0)) else 0 end,
			TasaMesAnt=case ao.aoIdFecha  when @FechaMesAnt then max(isnull(ao.aoTasaNominal,0)) else 0 end,
			TasaAnioAnt=case ao.aoIdFecha  when @FechaAnioAnt then max(isnull(ao.aoTasaNominal,0)) else 0 end
			from #DWHActivoOperacion ao
			inner join DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable
			inner join DWDCliente cl on ao.aoIdCliente=cl.clIdCliente
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDProducto pr on pr.prIdProducto=ao.aoIdProducto
			inner join DWDMoneda mo on mo.moIdMoneda=ao.aoIdMoneda
			--inner join DWDAgenciaOperacion ag on ago.agIdAgencia=ao.aoIdAgencia
			left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente
			inner join (
			SELECT DISTINCT
			p2.CpCodigoIndicador indicadorNivel3
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador in (1)
			and p1.CpCodigoIndicador in (120,121,122,126)
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON ccCodigoIndicador=cp.indicadorNivel3
			where ao.aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)
			and pr.prVehiculo='Vehiculos'
			and cl.clFechaFin is null
			and ca.caEstado=1
			and isnull(ao.aoTasaNominal,0)&gt;0
			group by
			clCodigoCliente,
			--ca.caAgrupacion,
			cc.ccClasificacionEstado,
			pr.prVehiculo,
			mo.moCodigoMoneda,
			ao.aoIdFecha,
			ao.aoNumeroOperacion,
			ca.caCodigoCanal,
			ag.agCodigoAgencia,
			pr.prCodigoProducto,
			ao.aoIdFechaVencimiento,
			ao.aoIdFechaConcesion


			-- Eliminar Temporal

			if object_id('[tempdb]..#Cartera') is not null
			begin
			drop table #Cartera
			end

			---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
--&gt;&gt;&gt;        AGRUPACION CARTERA           &lt;&lt;&lt;
---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;


			select
			CodCliente,
			NombreCliente,
			CodigoMoneda,
			CodigoAgenciaOper,
			CodigoAgenciaCli,
			CodProducto,
			FechaVencimiento,
			FechaApertura,
			NumeroOperacion,
			Plazo,
			OperacionCliente,
			CodCanal,
			Estado,
			OrdenN1,
			OrdenN2,
			OrdenN3,
			Canal,
			Nivel1,
			Nivel2,
			Nivel3,
			TasaHoy=cast(null as float),
			TasaAyer=cast(null as float),
			TasaMesAnt=cast(null as float),
			TasaAnioAnt=cast(null as float),
			RealHoy=sum(RealHoy),
			RealAyer=sum(RealAyer),
			RealMesAnt=sum(RealMesAnt),
			RealAnioAnt=sum(RealAnioAnt)

			into #Cartera

			from #ConsCart
			group by CodCliente,
			NombreCliente,
			CodigoMoneda,
			CodigoAgenciaOper,
			CodigoAgenciaCli,
			CodProducto,
			FechaVencimiento,
			FechaApertura,
			NumeroOperacion,
			Plazo,
			OperacionCliente,
			CodCanal,
			Estado,
			OrdenN1,
			OrdenN2,
			OrdenN3,
			Canal,
			Nivel1,
			Nivel2,
			Nivel3


			---------------------------
			-- Actualiza Tasas Cartera
			---------------------------

			update ca
			set ca.TasaHoy=ts.TasaHoy,
			ca.TasaAyer=ts.TasaAyer,
			ca.TasaMesAnt=ts.TasaMesAnt,
			ca.TasaAnioAnt=ts.TasaAnioAnt

			from #Cartera  ca
			inner join
			(

			select
			clCodigoCliente,
			NumeroOperacion,
			CodProducto,
			CodCanal,
			Nivel2,
			Estado,
			FechaVencimiento,
			TasaHoy=max(TasaHoy),
			TasaAyer=max(TasaAyer),
			TasaMesAnt=max(TasaMesAnt),
			TasaAnioAnt=max(TasaAnioAnt)
			from #Tasas
			group by clCodigoCliente,
			Estado,
			Nivel2,
			NumeroOperacion,
			CodigoAgenciaCli,
			CodProducto,
			FechaVencimiento,
			CodCanal

			) as ts  on ca.CodCliente=ts.clCodigoCliente
			and isnull(ca.NumeroOperacion,'')=isnull(ts.NumeroOperacion,'')
			and rtrim(ltrim(isnull(ca.CodProducto,'')))=rtrim(ltrim(isnull(ts.CodProducto,'')))
			and isnull(ca.FechaVencimiento,'')=isnull(ts.FechaVencimiento,'')
			and isnull(rtrim(ltrim(ca.Nivel2)),'')=isnull(rtrim(ltrim(ts.Nivel2)),'')
			and isnull(ca.Estado,'')=isnull(ts.Estado,'')



			-- Eliminar Temporal

			if object_id('[tempdb]..#Consolidados') is not null
			begin
			drop table #Consolidados
			end


			/* ------------------------------------------------------------------------ */
			/*                       CAPTACIONES                                        */
			/* ------------------------------------------------------------------------ */

			--  Monetarios(98, 100,55,54,99)
			--  Ahorros(247,600,601)
			--  Plazo(602, 603, 604, 605, 606, 607)

			select
			CodCliente= cl.clCodigoCliente,
			NombreCliente=cl.clNombreCompleto,
			CodigoMoneda=case po.poIdFecha when @FechAct then  mo.moCodigoMoneda else null end,
			CodigoAgenciaOper=case po.poIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion
			CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Operacion
			CodProducto=case po.poIdFecha when @FechAct then  prCodigoProducto else null end,
			FechaVencimiento=case po.poIdFecha when @FechAct then  po.poFechaVencimiento else null end,
			FechaApertura=null,
			NumeroOperacion=case po.poIdFecha when @FechAct then  po.poNoOperacion  else null end,
			Plazo=case po.poIdFecha when @FechAct then  po.poPlazoOperacion  else null end,
			OperacionCliente=case po.poIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,
			CodCanal=ca.caCodigoCanal,

			OrdenN1=cc.ccOrdenAgrupacion,
			OrdenN2=cc.ccOrdenAgrupacionN2,
			OrdenN3=caOrdenCanal,
			Canal=ca.caDescripcionAgrupacionCanal,
			Nivel1=cc.ccFamiliaProducto,
			Nivel2=left(cc.ccGrupo+SPACE(70),70)+'X'+right('0'+cast(cc.ccOrdenAgrupacion as varchar(10)),2)+right('0'+ cast(cc.ccOrdenAgrupacionN2 as varchar(10)),2)+'X',
			Nivel3='     '+ca.caAgrupacion,
			TasaHoy=case  when po.poIdFecha=@FechAct and isnull(po.poTasaNominal,0) &gt; 0 then max(isnull(po.poTasaNominal,0)) else 0 end,
			TasaAyer=case when po.poIdFecha=@FechaAyer and isnull(po.poTasaNominal,0) &gt; 0  then max(isnull(po.poTasaNominal,0))  else 0 end,
			TasaMesAnt=case  when po.poIdFecha=@FechaMesAnt and isnull(po.poTasaNominal,0) &gt; 0  then max(isnull(po.poTasaNominal,0))  else 0 end,
			TasaAnioAnt=case  when po.poIdFecha=@FechaAnioAnt and isnull(po.poTasaNominal,0) &gt; 0  then max(isnull(po.poTasaNominal,0))  else 0 end,
			--FechaHoy=@FechAct,
			RealHoy=case po.poIdFecha when @FechAct then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
			RealAyer=case po.poIdFecha when @FechaAyer then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
			RealMesAnt=case po.poIdFecha when @FechaMesAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,
			RealAnioAnt=case po.poIdFecha when @FechaAnioAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end

			into #Consolidados
			--drop table #Consolidados

			from #DWHPasivoOperacion po
			inner join DWDCuentaContable cc on po.poIdCuentaContable=ccIdCuentaContable
			inner join DWDCliente cl on po.poIdCliente=clIdCliente
			inner join DWDMoneda mo on po.poIdMoneda=moIdMoneda
			inner join DWDProducto pr on pr.prIdProducto=po.poIdProducto
			inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal
			inner join DWDAgenciaOperacion ago on ago.agIdAgencia=po.poIdAgencia
			left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia
			left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=po.poIdCalificacionOperacionCliente
			inner join (
			SELECT DISTINCT
			p2.CpCodigoIndicador indicadorNivel3
			FROM DWDClasificacionProductos p
			join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador
			join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador
			WHERE p.CpCodigoIndicador = 2
			and p1.CpCodigoIndicador in (141,142)
			and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3
			) cp ON ccCodigoIndicador=cp.indicadorNivel3
			where po.poIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)
			and ca.caEstado=1
			and cl.clFechaFin is null
			--and cc.ccCodigoMoneda='USD'
			group by isnull(po.poTasaNominal,0),
			ca.caCodigoCanal,
			cl.clCodigoCliente,
			cl.clNombreCompleto,
			mo.moCodigoMoneda,
			ago.agCodigoAgencia,
			ag.agCodigoAgencia,
			coc.cocCodigoCalificacionOperacionCliente,
			po.poFechaVencimiento,
			prCodigoProducto,
			po.poNoOperacion,
			po.poPlazoOperacion,
			cc.ccOrdenAgrupacion,
			cc.ccOrdenAgrupacionN2,
			ca.caOrdenCanal,
			ca.caAgrupacion,
			cc.ccFamiliaProducto,
			ca.caDescripcionAgrupacionCanal,
			cc.ccGrupo,
			po.poIdFecha


			union all

			/* ------------------------------------------------------------------------ */
			/*                          CARTERA                                         */
			/* ------------------------------------------------------------------------ */


			select
			CodCliente,
			NombreCliente,
			CodigoMoneda,
			CodigoAgenciaOper,
			CodigoAgenciaCli,
			CodProducto,
			FechaVencimiento,
			FechaApertura,
			NumeroOperacion,
			Plazo,
			OperacionCliente,
			CodCanal,
			OrdenN1,
			OrdenN2,
			OrdenN3,
			Canal,
			Nivel1,
			Nivel2=left(Nivel2+space(70),70)+'X'+right('0'+cast(OrdenN1 as varchar(10)),2)+right('0'+ cast(OrdenN2 as varchar(10)),2)+'X',
			Nivel3,
			TasaHoy,
			TasaAyer,
			TasaMesAnt,
			TasaAnioAnt,
			RealHoy,
			RealAyer,
			RealMesAnt,
			RealAnioAnt
			from #Cartera

			Union all

			--&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
---&gt;&gt;&gt;&gt;&gt;&gt;&gt;     CARTERA EN DIFICULTADES       &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

select 
CodCliente,
NombreCliente,
CodigoMoneda,
CodigoAgenciaOper,
CodigoAgenciaCli,
CodProducto,
FechaVencimiento,
FechaApertura,
NumeroOperacion,
Plazo,
OperacionCliente,
CodCanal,
OrdenN1,
OrdenN2,
OrdenN3,
Canal,
Nivel1,
Nivel2=left('Cartera en Dificultades'+space(70),70)+'X'+right('0'+cast(OrdenN1 as varchar(10)),2)+'13X',
Nivel3,
TasaHoy,
TasaAyer,
TasaMesAnt,
TasaAnioAnt,
RealHoy,
RealAyer,
RealMesAnt,
RealAnioAnt
from #Cartera
where Estado='Dif'

union all

--&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
---&gt;&gt;&gt;&gt;&gt;&gt;      VIGENTE      &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
--&gt;&gt;&gt;&gt;&gt;&gt;      DIFICULTADES  &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;


			select
			CodCliente,
			NombreCliente,
			CodigoMoneda,
			CodigoAgenciaOper,
			CodigoAgenciaCli,
			CodProducto,
			FechaVencimiento,
			FechaApertura,
			NumeroOperacion,
			Plazo,
			OperacionCliente,
			CodCanal,
			OrdenN1,
			OrdenN2,
			OrdenN3,
			Canal,
			Nivel1,
			Nivel2=
			case
			when Estado='Vig' then  left((Estado+'. '+Nivel2+SPACE(70)),70)+'X'+right('0'+cast(OrdenN1 as varchar(10)),2)+right('0'+ cast(OrdenN2+20 as varchar(10)),2)+'X'
			else left((Estado+'. '+Nivel2+SPACE(70)),70)+'X'+right('0'+cast(OrdenN1 as varchar(10)),2)+right('0'+ cast(OrdenN2+40 as varchar(10)),2)+'X'
			end,
			Nivel3,
			TasaHoy,
			TasaAyer,
			TasaMesAnt,
			TasaAnioAnt,
			RealHoy,
			RealAyer,
			RealMesAnt,
			RealAnioAnt
			from #Cartera
			where Estado in ('Dif','Vig')


			----------------------
			-- Consolidado final
			----------------------

			if object_id('[tempdb]..#Consolidado_final') is not null
			begin
			drop table #Consolidado_final
			end

			select
			CodCliente,
			NombreCliente,
			CodigoMoneda,
			CodigoAgenciaOper,
			CodigoAgenciaCli,
			CodProducto,
			FechaVencimiento,
			FechaApertura,
			NumeroOperacion,
			Plazo,
			OperacionCliente,
			CodCanal,
			OrdenN1,
			OrdenN2,
			Canal,
			Nivel1,
			Nivel2,
			Nivel3,
			TasaHoy=max(isnull(TasaHoy,0)),
			TasaAyer=max(isnull(TasaAyer,0)),
			TasaMesAnt=max(isnull(TasaMesAnt,0)),
			TasaAnioAnt=max(isnull(TasaAnioAnt,0)),
			RealHoy=sum(RealHoy),
			RealAyer=sum(RealAyer),
			RealMesAnt=sum(RealMesAnt),
			RealAnioAnt=sum(RealAnioAnt)

			--select *
			into #Consolidado_final

			from #Consolidados
			group by
			CodCliente,
			NombreCliente,
			CodigoMoneda,
			CodigoAgenciaOper,
			CodigoAgenciaCli,
			CodProducto,
			FechaVencimiento,
			FechaApertura,
			NumeroOperacion,
			Plazo,
			OperacionCliente,
			CodCanal,
			OrdenN1,
			OrdenN2,
			Canal,
			Nivel1,
			Nivel2,
			Nivel3


			---------------------------------
			-- Asignar clientes a menor 5000
			---------------------------------

			update a
			set
			CodCliente=-5000,
			CodigoAgenciaOper=-1,
			NumeroOperacion=-1,
			NombreCliente='Menor a 5000',
			CodCanal=-1,
			CodigoMoneda=-1,
			CodProducto=-1,
			FechaVencimiento=null,
			Plazo=-1,
			CodigoAgenciaCli=-1,
			OperacionCliente=-1,
			FechaApertura=null

			--select a.*

			from #Consolidado_final a inner join
			(
			select
			CodCliente,
			NumeroOperacion,
			Nivel1,
			Nivel2,
			Realhoy=sum(RealHoy),
			RealAyer=sum(RealAyer),
			RealMesAnt=sum(RealMesAnt),
			RealAnioAnt=sum(RealAnioAnt)
			from #Consolidado_final
			group by CodCliente,
			Nivel1,
			Nivel2,
			NumeroOperacion
			having  sum(RealHoy)&lt;5
 and abs(sum(RealHoy)-sum(RealAyer))&lt;5
 and abs(sum(RealHoy)-sum(RealMesAnt))&lt;5
 and abs(sum(RealHoy)-sum(RealAnioAnt))&lt;5

) b on
a.CodCliente=b.CodCliente
and isnull(a.NumeroOperacion,'')=isnull(b.NumeroOperacion,'')
and a.Nivel1=b.Nivel1
and a.Nivel2=b.Nivel2




--------------------------------------
--&gt;&gt;&gt;  Actualiza Operacion Cliente
			--------------------------------------

			update a
			set a.OperacionCliente=b.OperacionCliente
			from #Consolidado_final a inner join
			(
			select distinct
			CodCliente,
			OperacionCliente=max(OperacionCliente)
			from #Consolidado_final
			where OperacionCliente  is not null
			group by CodCliente
			) as b
			on a.CodCliente=b.CodCliente
			where a.OperacionCliente is null


			update #Consolidado_final
			set OperacionCliente=-1
			where OperacionCliente  is null



			------------------------------------
			---      CONSOLIDADO
			------------------------------------

			select
			CodCliente,
			NombreCliente,
			CodigoMoneda,
			CodigoAgenciaOper,
			CodigoAgenciaCli,
			CodProducto,
			FechaVencimiento=max(FechaVencimiento),
			FechaApertura,
			NumeroOperacion,
			Plazo,
			OperacionCliente,
			CodCanal,
			OrdenN1,
			OrdenN2,
			Canal,
			Nivel1,
			Nivel2,
			Nivel3,
			TasaHoy=max(TasaHoy),
			TasaAyer=max(TasaAyer),
			TasaMesAnt=max(TasaMesAnt),
			TasaAnioAnt=max(TasaAnioAnt),
			RealHoy=sum(RealHoy),
			RealAyer=sum(RealAyer),
			RealMesAnt=sum(RealMesAnt),
			RealAnioAnt=sum(RealAnioAnt)

			from #Consolidado_final
			group by CodCliente,
			NombreCliente,
			CodigoMoneda,
			CodigoAgenciaOper,
			CodigoAgenciaCli,
			CodProducto,
			--FechaVencimiento,
			FechaApertura,
			NumeroOperacion,
			Plazo,
			OperacionCliente,
			CodCanal,
			OrdenN1,
			OrdenN2,
			Canal,
			Nivel1,
			Nivel2,
			Nivel3
			having sum(abs(TasaHoy))+sum(abs(TasaAyer))+sum(abs(TasaMesAnt))+sum(abs(TasaAnioAnt))+
			sum(abs(RealHoy))+sum(abs(RealAyer))+sum(abs(RealMesAnt))+sum(abs(RealAnioAnt))&gt;0</QueryDefinition>
                  </Source>
                  <StorageMode valuens="ddl200_200">InMemory</StorageMode>
                  <ProcessingMode>Regular</ProcessingMode>
                  <ProactiveCaching>
                    <SilenceInterval>-PT1S</SilenceInterval>
                    <Latency>-PT1S</Latency>
                    <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
                    <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
                    <Source xsi:type="ProactiveCachingInheritedBinding" />
                  </ProactiveCaching>
                </Partition>
              </Partitions>
              <ProactiveCaching>
                <SilenceInterval>-PT1S</SilenceInterval>
                <Latency>-PT1S</Latency>
                <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
                <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
                <Source xsi:type="ProactiveCachingInheritedBinding" />
              </ProactiveCaching>
            </MeasureGroup>
            <MeasureGroup>
              <ID>DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f</ID>
              <Name>Rangos</Name>
              <Measures>
                <Measure>
                  <ID>DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f</ID>
                  <Name>__XL_Count Rangos</Name>
                  <AggregateFunction>Count</AggregateFunction>
                  <DataType>BigInt</DataType>
                  <Source>
                    <DataType>BigInt</DataType>
                    <DataSize>8</DataSize>
                    <Source xsi:type="RowBinding">
                      <TableID>DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f</TableID>
                    </Source>
                  </Source>
                  <Visible>false</Visible>
                </Measure>
              </Measures>
              <StorageMode valuens="ddl200_200">InMemory</StorageMode>
              <ErrorConfiguration>
                <KeyNotFound>IgnoreError</KeyNotFound>
                <KeyDuplicate>ReportAndStop</KeyDuplicate>
                <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
              </ErrorConfiguration>
              <ProcessingMode>Regular</ProcessingMode>
              <Dimensions>
                <Dimension xsi:type="DegenerateMeasureGroupDimension">
                  <CubeDimensionID>DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>__XL_RowNumber</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDRangos</TableID>
                            <ColumnID>__XL_RowNumber</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                      <Type>Granularity</Type>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Valor</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f</TableID>
                            <ColumnID>Valor</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Descripcion</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f</TableID>
                            <ColumnID>Descripcion</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Orden</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f</TableID>
                            <ColumnID>Orden</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodigoRango</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                  </Attributes>
                  <ddl200_200:ShareDimensionStorage>Shared</ddl200_200:ShareDimensionStorage>
                </Dimension>
              </Dimensions>
              <Partitions>
                <Partition>
                  <ID>DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f</ID>
                  <Name>DWDRangos</Name>
                  <Annotations>
                    <Annotation>
                      <Name>QueryEditorSerialization</Name>
                      <Value>&lt;?xml version="1.0" encoding="UTF-16"?&gt;&lt;Gemini xmlns="QueryEditorSerialization"&gt;&lt;AnnotationContent&gt;&lt;![CDATA[&lt;RSQueryCommandText&gt;SELECT 
Valor=cast(rgRangoIni as int),
Descripcion=rgDescripcion,
Orden=rgOrden
FROM DWDRangos
where rgCodSegmento=1&lt;/RSQueryCommandText&gt;&lt;RSQueryCommandType&gt;Text&lt;/RSQueryCommandType&gt;&lt;RSQueryDesignState&gt;&lt;/RSQueryDesignState&gt;]]&gt;&lt;/AnnotationContent&gt;&lt;/Gemini&gt;</Value>
                    </Annotation>
                  </Annotations>
                  <Source xsi:type="QueryBinding">
                    <DataSourceID>21568b6b-c791-4141-8d9e-e542457fa7a5</DataSourceID>
                    <QueryDefinition>SELECT 
Valor=cast(rgRangoIni as int),
Descripcion=rgDescripcion,
Orden=rgOrden
FROM DWDRangos
where rgCodSegmento=1</QueryDefinition>
                  </Source>
                  <StorageMode valuens="ddl200_200">InMemory</StorageMode>
                  <ProcessingMode>Regular</ProcessingMode>
                  <ErrorConfiguration>
                    <KeyNotFound>IgnoreError</KeyNotFound>
                    <KeyDuplicate>ReportAndStop</KeyDuplicate>
                    <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
                  </ErrorConfiguration>
                  <ProactiveCaching>
                    <SilenceInterval>-PT1S</SilenceInterval>
                    <Latency>-PT1S</Latency>
                    <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
                    <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
                    <Source xsi:type="ProactiveCachingInheritedBinding" />
                  </ProactiveCaching>
                </Partition>
              </Partitions>
              <ProactiveCaching>
                <SilenceInterval>-PT1S</SilenceInterval>
                <Latency>-PT1S</Latency>
                <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
                <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
                <Source xsi:type="ProactiveCachingInheritedBinding" />
              </ProactiveCaching>
            </MeasureGroup>
            <MeasureGroup>
              <ID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</ID>
              <Name>Canal</Name>
              <Measures>
                <Measure>
                  <ID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</ID>
                  <Name>__XL_Count Canal</Name>
                  <AggregateFunction>Count</AggregateFunction>
                  <DataType>BigInt</DataType>
                  <Source>
                    <DataType>BigInt</DataType>
                    <DataSize>8</DataSize>
                    <Source xsi:type="RowBinding">
                      <TableID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</TableID>
                    </Source>
                  </Source>
                  <Visible>false</Visible>
                </Measure>
              </Measures>
              <StorageMode valuens="ddl200_200">InMemory</StorageMode>
              <ErrorConfiguration>
                <KeyNotFound>IgnoreError</KeyNotFound>
                <KeyDuplicate>ReportAndStop</KeyDuplicate>
                <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
              </ErrorConfiguration>
              <ProcessingMode>Regular</ProcessingMode>
              <Dimensions>
                <Dimension xsi:type="DegenerateMeasureGroupDimension">
                  <CubeDimensionID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>__XL_RowNumber</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Integer</DataType>
                          <Source xsi:type="ColumnBinding">
                            <TableID>Canal</TableID>
                            <ColumnID>__XL_RowNumber</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                      <Type>Granularity</Type>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Orden</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>BigInt</DataType>
                          <DataSize>-1</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</TableID>
                            <ColumnID>Orden</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>caDescripcionAgrupacionCanal</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Error</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</TableID>
                            <ColumnID>caDescripcionAgrupacionCanal</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>caNegTes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>OrdenNegTes</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>CodigoCanalOrden</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>Empty</DataType>
                          <Source xsi:type="ddl200_200:ExpressionBinding">
                            <Expression></Expression>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                    <Attribute>
                      <AttributeID>caCodigoAgrupacionCanal</AttributeID>
                      <KeyColumns>
                        <KeyColumn>
                          <DataType>WChar</DataType>
                          <DataSize>32766</DataSize>
                          <NullProcessing>Preserve</NullProcessing>
                          <InvalidXmlCharacters>Remove</InvalidXmlCharacters>
                          <Source xsi:type="ColumnBinding">
                            <TableID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</TableID>
                            <ColumnID>caCodigoAgrupacionCanal</ColumnID>
                          </Source>
                        </KeyColumn>
                      </KeyColumns>
                    </Attribute>
                  </Attributes>
                  <ddl200_200:ShareDimensionStorage>Shared</ddl200_200:ShareDimensionStorage>
                </Dimension>
              </Dimensions>
              <Partitions>
                <Partition>
                  <ID>Canal_aa566168-7ef4-4c19-b8db-fe162403657a</ID>
                  <Name>Canal</Name>
                  <Annotations>
                    <Annotation>
                      <Name>QueryEditorSerialization</Name>
                      <Value>&lt;?xml version="1.0" encoding="UTF-16"?&gt;&lt;Gemini xmlns="QueryEditorSerialization"&gt;&lt;AnnotationContent&gt;&lt;![CDATA[&lt;RSQueryCommandText&gt;set nocount on

declare @id int

if object_id('tempdb..#DWDCanal') is not null
begin 
 drop table #DWDCanal
end

select distinct
 caCodigoAgrupacionCanal
,Orden=caOrdenCanal
,caDescripcionAgrupacionCanal
into #DWDCanal
from DWDCanal
where caEstado=1
order by caOrdenCanal
,caCodigoAgrupacionCanal
,caDescripcionAgrupacionCanal

select @id=max(Orden) from #DWDCanal

select 
 caCodigoAgrupacionCanal
,Orden
,caDescripcionAgrupacionCanal

from #DWDCanal

union all

select
caCodigoAgrupacionCanal='NA',
Orden=@id+1,
'Otr.Dep y Obl.Fin'

union all

select 
caCodigoAgrupacionCanal,
Orden=@id+2,
caDescripcionAgrupacionCanal
from dwdcanal
where caCodigoCanal='TIT'&lt;/RSQueryCommandText&gt;&lt;RSQueryCommandType&gt;Text&lt;/RSQueryCommandType&gt;&lt;RSQueryDesignState&gt;&lt;/RSQueryDesignState&gt;]]&gt;&lt;/AnnotationContent&gt;&lt;/Gemini&gt;</Value>
                    </Annotation>
                  </Annotations>
                  <Source xsi:type="QueryBinding">
                    <DataSourceID>21568b6b-c791-4141-8d9e-e542457fa7a5</DataSourceID>
                    <QueryDefinition>set nocount on

declare @id int

if object_id('tempdb..#DWDCanal') is not null
begin 
 drop table #DWDCanal
end

select distinct
 caCodigoAgrupacionCanal
,Orden=caOrdenCanal
,caDescripcionAgrupacionCanal
into #DWDCanal
from DWDCanal
where caEstado=1
order by caOrdenCanal
,caCodigoAgrupacionCanal
,caDescripcionAgrupacionCanal

select @id=max(Orden) from #DWDCanal

select 
 caCodigoAgrupacionCanal
,Orden
,caDescripcionAgrupacionCanal

from #DWDCanal

union all

select
caCodigoAgrupacionCanal='NA',
Orden=@id+1,
'Otr.Dep y Obl.Fin'

union all

select 
caCodigoAgrupacionCanal,
Orden=@id+2,
caDescripcionAgrupacionCanal
from dwdcanal
where caCodigoCanal='TIT'</QueryDefinition>
                  </Source>
                  <StorageMode valuens="ddl200_200">InMemory</StorageMode>
                  <ProcessingMode>Regular</ProcessingMode>
                  <ErrorConfiguration>
                    <KeyNotFound>IgnoreError</KeyNotFound>
                    <KeyDuplicate>ReportAndStop</KeyDuplicate>
                    <NullKeyNotAllowed>ReportAndStop</NullKeyNotAllowed>
                  </ErrorConfiguration>
                  <ProactiveCaching>
                    <SilenceInterval>-PT1S</SilenceInterval>
                    <Latency>-PT1S</Latency>
                    <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
                    <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
                    <Source xsi:type="ProactiveCachingInheritedBinding" />
                  </ProactiveCaching>
                </Partition>
              </Partitions>
              <ProactiveCaching>
                <SilenceInterval>-PT1S</SilenceInterval>
                <Latency>-PT1S</Latency>
                <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
                <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
                <Source xsi:type="ProactiveCachingInheritedBinding" />
              </ProactiveCaching>
            </MeasureGroup>
          </MeasureGroups>
          <Source>
            <DataSourceViewID>Sandbox</DataSourceViewID>
          </Source>
          <MdxScripts>
            <MdxScript>
              <ID>MdxScript</ID>
              <Name>MdxScript</Name>
              <Commands>
                <Command>
                  <Text>CALCULATE; 
CREATE MEMBER CURRENTCUBE.Measures.[__No measures defined] AS 1, VISIBLE = 0; 
ALTER CUBE CURRENTCUBE UPDATE DIMENSION Measures, Default_Member = [__No measures defined]; </Text>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[MaxNivel]=MAX([Jerarquia]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>MaxNivel</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[BrowseNivel]=ISFILTERED([Nivel1])+ISFILTERED([Nivel2])+ ISFILTERED([Nivel2_2])+ ISFILTERED([Nivel3])+ISFILTERED([Nivel4])+ISFILTERED([Nivel5]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>BrowseNivel</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[TotalHoy]=CALCULATE(SUM(HojaPosicion[RealHoy]),HojaPosicion[Division]="NO");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>TotalHoy</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[FiltroDivisionHoy]=CALCULATE(if(ISERROR(SUM(HojaPosicion[RealHoy])/SUM(HojaPosicion[DenominadorHoy])),0,SUM(HojaPosicion[RealHoy])/SUM(HojaPosicion[DenominadorHoy])),HojaPosicion[Division]="SI");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>FiltroDivisionHoy</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[Hoy]=sum(HojaPosicion[RealHoy]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Hoy</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[TotalAyer]=CALCULATE(SUM(HojaPosicion[RealAyer]),HojaPosicion[Division]="NO");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>TotalAyer</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[FiltroDivisionAyer]=CALCULATE(if(ISERROR(SUM(HojaPosicion[RealAyer])/SUM(HojaPosicion[DenominadorAyer])),0,SUM(HojaPosicion[RealAyer])/SUM(HojaPosicion[DenominadorAyer])),HojaPosicion[Division]="SI");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>FiltroDivisionAyer</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[Ayer]=SUM(HojaPosicion[RealAyer]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Ayer</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[TotalMesAnt]=CALCULATE(SUM(HojaPosicion[RealMesAnt]),HojaPosicion[Division]="NO");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>TotalMesAnt</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[FiltroDivisionMesAnt]=CALCULATE(if(ISERROR(SUM(HojaPosicion[RealMesAnt])/SUM(HojaPosicion[DenominadorMesAnt])),0,SUM(HojaPosicion[RealMesAnt])/SUM(HojaPosicion[DenominadorMesAnt])),HojaPosicion[Division]="SI");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>FiltroDivisionMesAnt</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[MesAnterior]=SUM(HojaPosicion[RealMesAnt]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>MesAnterior</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[TotalAnioAnt]=CALCULATE(SUM(HojaPosicion[RealAnioAnt]),HojaPosicion[Division]="NO");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>TotalAnioAnt</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[FiltroDivisionAnioAnt]=CALCULATE(if(ISERROR(SUM(HojaPosicion[RealAnioAnt])/SUM(HojaPosicion[DenominadorAnioAnt])),0,SUM(HojaPosicion[RealAnioAnt])/SUM(HojaPosicion[DenominadorAnioAnt])),HojaPosicion[Division]="SI");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>FiltroDivisionAnioAnt</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[AnioAnterior]=SUM(HojaPosicion[RealAnioAnt]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>AnioAnterior</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[VarDiaria]=CALCULATE([Hoy]-[Ayer],HojaPosicion[ConcentracionMorosidad]="NO");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarDiaria</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[VarDiaria%]=CALCULATE(if(ISERROR([Hoy]/[Ayer]),0,([Hoy]/[Ayer])-1),HojaPosicion[ConcentracionMorosidad]="NO");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarDiaria%</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[VarMensual]=CALCULATE([Hoy]-[MesAnterior],HojaPosicion[ConcentracionMorosidad]="NO");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarMensual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[VarMensual%]=CALCULATE(if(ISERROR([Hoy]/[MesAnterior]),0,(([Hoy]/[MesAnterior])-1)),HojaPosicion[ConcentracionMorosidad]="NO");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarMensual%</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[VarAnual]=CALCULATE([Hoy]-[AnioAnterior],HojaPosicion[ConcentracionMorosidad]="NO");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarAnual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[VarAnual%]=CALCULATE(if(ISERROR([Hoy]/[AnioAnterior]),0,(([Hoy]/[AnioAnterior])-1)),HojaPosicion[ConcentracionMorosidad]="NO");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarAnual%</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[Saldo]=[Hoy];
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Saldo</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[TotalPresupuesto]=CALCULATE(SUM(HojaPosicion[ValorPresupuesto]),HojaPosicion[Division]="NO");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>TotalPresupuesto</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[FiltroDivisionPresupuesto]=CALCULATE(if(ISERROR(SUM(HojaPosicion[ValorPresupuesto])/SUM(HojaPosicion[DenominadorPresupuesto])),0,SUM(HojaPosicion[ValorPresupuesto])/SUM(HojaPosicion[DenominadorPresupuesto])),HojaPosicion[Division]="SI");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>FiltroDivisionPresupuesto</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[Presupuesto]=SUM(HojaPosicion[ValorPresupuesto]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Presupuesto</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[Cumplimiento]=if(ISERROR([Hoy]/[Presupuesto]),BLANK(),([Hoy]/[Presupuesto]));
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Cumplimiento</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[DifCumplimiento]=CALCULATE([Cumplimiento],HojaPosicion[TipoBandera]="Dif");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>DifCumplimiento</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[MoCumplimiento]=CALCULATE([Cumplimiento],HojaPosicion[TipoBandera]="Mo");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>MoCumplimiento</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[DifRanCumpl]=IF(ABS([DifCumplimiento])&gt;0,
	IF([DifCumplimiento]&gt;1,-1,
	IF([DifCumplimiento]&gt;0.95 &amp;&amp; [DifCumplimiento]&lt;=1,0,
	IF([DifCumplimiento]&lt;=0.95,1,BLANK())   
	))
,BLANK());
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>DifRanCumpl</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[MoRanCumpl]=IF(abs([MoCumplimiento])&gt;0,
   IF([MoCumplimiento]&gt;1,-1,IF([MoCumplimiento]&gt;0.8 &amp;&amp; [MoCumplimiento]&lt;=1,0, IF([MoCumplimiento]&lt;=0.8,1,BLANK())  )),
   BLANK()
   );
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>MoRanCumpl</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[TotRanCumpl]=IF(
abs([Cumplimiento])&gt;0,
IF([Cumplimiento]&lt;0.7,-1,IF([Cumplimiento]&lt;1 &amp;&amp; [Cumplimiento]&gt;=0.7,0,IF([Cumplimiento]&gt;=1,1,BLANK()))),
BLANK()
);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>TotRanCumpl</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[CumplimientoBandera]=IF([Cumplimiento]=[DifCumplimiento],[DifRanCumpl],IF([Cumplimiento]=[MoCumplimiento],[MoRanCumpl],IF([Cumplimiento]=[Cumplimiento],[TotRanCumpl],BLANK())));
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>CumplimientoBandera</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[MaxNivelMF]=MAX([Jerarquia]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>MaxNivelMF</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[BrowseNivelMF]=ISFILTERED(MargenFinanciero[DescripcionN1])+ISFILTERED(MargenFinanciero[DescripcionN2])+ISFILTERED(MargenFinanciero[DescripcionN3])+ISFILTERED(MargenFinanciero[DescripcionN4])+ISFILTERED(MargenFinanciero[DescripcionN5]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>BrowseNivelMF</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[Part % Diario]=SUM([diaPart])/100;
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Part % Diario</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[Saldo Diario]=sum([diaSaldo]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Saldo Diario</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[TTP % Diario]=sum([diaTPP])/100;
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>TTP % Diario</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[PYG Diario]=sum([diaPYG]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>PYG Diario</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[Part % Mensual]=sum([mesPart])/100;
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Part % Mensual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[VolPromMes]=sum([mesSaldo]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VolPromMes</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[TPP % Mes]=sum([mesTPP])/100;
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>TPP % Mes</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[PYG Mensual]=sum([mesPYG]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>PYG Mensual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[Part % Anual]=SUM([anioPart])/100;
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Part % Anual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[VolProm Anual]=sum([anioSaldo]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VolProm Anual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[TTP % Anual]=sum([anioTPP])/100;
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>TTP % Anual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[PYG Anual]=sum([anioPYG]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>PYG Anual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[Proyeccion TTP Mes]=sum([mesPres])/100;
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Proyeccion TTP Mes</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[Proyeccion TTP Anual]=sum([anioPres])/100;
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Proyeccion TTP Anual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[BanderaPryTTPMes]=IF( (IF(ISERROR([TPP % Mes]/[Proyeccion TTP Mes]),0,[TPP % Mes]/[Proyeccion TTP Mes]))=0,blank(), (IF(ISERROR([TPP % Mes]/[Proyeccion TTP Mes]),0,[TPP % Mes]/[Proyeccion TTP Mes]))    );
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>BanderaPryTTPMes</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[BanderaPryTTPAnual]=IF( (IF(ISERROR([TTP % Anual]/[Proyeccion TTP Anual]),0,[TTP % Anual]/[Proyeccion TTP Anual])) =0,blank(),(IF(ISERROR([TTP % Anual]/[Proyeccion TTP Anual]),0,[TTP % Anual]/[Proyeccion TTP Anual])) );
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>BanderaPryTTPAnual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[BanderaMesCaptaciones]=CALCULATE([BanderaPryTTPMes],MargenFinanciero[Agrupacion]="Captaciones");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>BanderaMesCaptaciones</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[BanderaMesCartera]=CALCULATE([BanderaPryTTPMes],MargenFinanciero[Agrupacion]="Cartera");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>BanderaMesCartera</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[RangMesCaptaciones]=IF(
abs([BanderaMesCaptaciones])&gt;0,
IF([BanderaMesCaptaciones]&gt;1,-1,IF([BanderaMesCaptaciones]&lt;=0.95,1,IF([BanderaMesCaptaciones]&gt;0.95 &amp;&amp;[BanderaMesCaptaciones]&lt;=1,0,BLANK()))),
BLANK()
);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>RangMesCaptaciones</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[RangoMesCartera]=IF(
abs([BanderaMesCartera])&gt;0,
IF([BanderaMesCartera]&lt;0.95,-1,IF([BanderaMesCartera]&gt;=1,1,IF([BanderaMesCartera]&gt;=0.95 &amp;&amp; [BanderaMesCartera]&lt;1,0,BLANK()))),
BLANK()
);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>RangoMesCartera</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[BanderaMesTot]=IF([BanderaPryTTPMes]=[BanderaMesCaptaciones],[RangMesCaptaciones],IF([BanderaPryTTPMes]=[BanderaMesCartera],[RangoMesCartera],BLANK()));
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>BanderaMesTot</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[BanderaAnioCaptaciones]=CALCULATE([BanderaPryTTPAnual],MargenFinanciero[Agrupacion]="Captaciones");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>BanderaAnioCaptaciones</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[BanderaAnioCartera]=CALCULATE([BanderaPryTTPAnual],MargenFinanciero[Agrupacion]="Cartera");
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>BanderaAnioCartera</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[RangAnioCaptaciones]=IF(
abs([BanderaAnioCaptaciones])&gt;0,
IF([BanderaAnioCaptaciones]&gt;1,-1,IF([BanderaAnioCaptaciones]&lt;=0.95,1,IF([BanderaAnioCaptaciones]&lt;=1&amp;&amp;[BanderaAnioCaptaciones]&gt;0.95,0,
BLANK()))));
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>RangAnioCaptaciones</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[RangAnioCartera]=IF(ABS([BanderaAnioCartera])&gt;0,
IF([BanderaAnioCartera]&lt;0.95,-1,IF([BanderaAnioCartera]&gt;=1,1,IF([BanderaAnioCartera]&gt;=0.95&amp;&amp;[BanderaAnioCartera]&lt;1,0,BLANK()))));
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>RangAnioCartera</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'MargenFinanciero'[BanderaAnioTot]=IF([BanderaPryTTPAnual]=[BanderaAnioCaptaciones],[RangAnioCaptaciones],IF([BanderaPryTTPAnual]=[BanderaAnioCartera],[RangAnioCartera],BLANK()));
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>BanderaAnioTot</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>MargenFinanciero</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'IndicadoresTasaMargen'[T Diaria]=sum([tmTPPdia])/100;
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>T Diaria</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>IndicadoresTasaMargen</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'IndicadoresTasaMargen'[T Mensual]=SUM([tmTPPmes])/100;
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>T Mensual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>IndicadoresTasaMargen</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'IndicadoresTasaMargen'[T Anual]=sum([tmTPPanio])/100;
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>T Anual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>IndicadoresTasaMargen</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'IndicadoresTasaMargen'[Participacion]=CALCULATE( (if(ISERROR(sum([tmSaldoDiario])/sum([TotalSaldoDiario])),0,sum([tmSaldoDiario])/sum([TotalSaldoDiario]))));
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Participacion</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>IndicadoresTasaMargen</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[Fecha]=MAX(HojaPosicion[FechaHoy]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Fecha</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[Hoy_C]=IF(ABS((SUM(ConsolidadoHojaPosicion[RealHoy])))&gt;0,SUM(ConsolidadoHojaPosicion[RealHoy])*1000,BLANK());
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Hoy_C</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[Ayer_C]=IF(abs(SUM(ConsolidadoHojaPosicion[RealAyer])*1000)&gt;0,SUM(ConsolidadoHojaPosicion[RealAyer])*1000,BLANK());
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Ayer_C</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[MesAnt_C]=IF(abs(SUM(ConsolidadoHojaPosicion[RealMesAnt])*1000)&gt;0,SUM(ConsolidadoHojaPosicion[RealMesAnt])*1000,BLANK());
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>MesAnt_C</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[AnioAnt_C]=IF(ABS(SUM(ConsolidadoHojaPosicion[RealAnioAnt])*1000)&gt;0,SUM(ConsolidadoHojaPosicion[RealAnioAnt])*1000,BLANK());
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>AnioAnt_C</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[Sald_EstadoSaldoActualMenores]=IF(
HASONEVALUE(Rangos[Valor]),
IF([Hoy_C]=0,FALSE(),[Hoy_C]&lt;VALUES(Rangos[Valor])
)
);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Sald_EstadoSaldoActualMenores</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[Sald_EstadoSaldoActual]=IF(
HASONEVALUE(Rangos[Valor]),
IF([Hoy_C]=0,FALSE(),[Hoy_C]&gt;=VALUES(Rangos[Valor]))
);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Sald_EstadoSaldoActual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[Sald_EstadoSaldo]=IF([Sald_EstadoSaldoActual]=TRUE(),1,0);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Sald_EstadoSaldo</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[TasaHoy_C]=IF(ABS(MAX(ConsolidadoHojaPosicion[TasaHoy]))&gt;0,MAX(ConsolidadoHojaPosicion[TasaHoy])/100,BLANK());
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>TasaHoy_C</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[TasaAyer_C]=IF(ABS((max(ConsolidadoHojaPosicion[TasaAyer])/100))&gt;0,MAX(ConsolidadoHojaPosicion[TasaAyer])/100,BLANK());
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>TasaAyer_C</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[TasaMesAnt_C]=IF(ABS(MAX(ConsolidadoHojaPosicion[TasaMesAnt])/100)&gt;0,MAX(ConsolidadoHojaPosicion[TasaMesAnt])/100,BLANK());
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>TasaMesAnt_C</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[TasaAnioAnt_C]=IF(ABS(MAX(ConsolidadoHojaPosicion[TasaAnioAnt])/100)&gt;0,MAX(ConsolidadoHojaPosicion[TasaAnioAnt])/100,BLANK());
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>TasaAnioAnt_C</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarDia_VariacionDiariaAbsoluto]=ABS([VarDia_VarDiaria]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarDia_VariacionDiariaAbsoluto</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarDia_EstadoVariacionDiaria]=IF(
 HASONEVALUE(Rangos[Valor]), 
 IF( [VarDia_VariacionDiariaAbsoluto]=0,FALSE(),
[VarDia_VariacionDiariaAbsoluto]&gt;=VALUES(Rangos[Valor])
 ));
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarDia_EstadoVariacionDiaria</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarDia_EstadoVariacionDiariaMenores]=IF
(
 HASONEVALUE(Rangos[Valor]),  
 IF
 (
 [VarDia_VariacionDiariaAbsoluto]=0,false,
[VarDia_VariacionDiariaAbsoluto]&lt;VALUES(Rangos[Valor])
)

);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarDia_EstadoVariacionDiariaMenores</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarDia_EstadoVariacion]=IF([VarDia_EstadoVariacionDiaria]=TRUE(),1,0);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarDia_EstadoVariacion</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarDia_VariacionTasaDiaria]=[Sald_TsHoy];
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarDia_VariacionTasaDiaria</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarDia_VarDiaria]=IF(([Hoy_C]-[Ayer_C])=0,BLANK(),[Hoy_C]-[Ayer_C]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarDia_VarDiaria</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarMes_VarMensual]=[Hoy_C]-[MesAnt_C];
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarMes_VarMensual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarMes_VariacionMensualAbsoluto]=ABS([VarMes_VarMensual]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarMes_VariacionMensualAbsoluto</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarMes_EstadoVariacionMensual]=IF(
 HASONEVALUE(Rangos[Valor]),  
 IF([VarMes_VariacionMensualAbsoluto]=0,FALSE(),
[VarMes_VariacionMensualAbsoluto]&gt;=VALUES(Rangos[Valor])
)
 );
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarMes_EstadoVariacionMensual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarMes_EstadoVariacion]=IF([VarMes_EstadoVariacionMensual]=TRUE(),1,0);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarMes_EstadoVariacion</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarMes_VariacionTasaMensual]=IF(ISERROR([SubTotTasaMes]/[MesAnt_C]),0,[SubTotTasaMes]/[MesAnt_C]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarMes_VariacionTasaMensual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarMes_EstadoVariacionMensualMenores]=IF(
	HASONEVALUE(Rangos[Valor]),  
	IF([VarMes_VariacionMensualAbsoluto]=0,FALSE(),
	[VarMes_VariacionMensualAbsoluto]&lt;VALUES(Rangos[Valor])
	)
 );
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarMes_EstadoVariacionMensualMenores</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarAnio_VarAnual]=[Hoy_C]-[AnioAnt_C];
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarAnio_VarAnual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarAnio_VariacionAnualAbsoluto]=ABS([VarAnio_VarAnual]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarAnio_VariacionAnualAbsoluto</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarAnio_EstadoVariacionAnual]=IF(
  HASONEVALUE(Rangos[Valor]),  
 IF
 ( 
 [VarAnio_VariacionAnualAbsoluto]=0,FALSE(),
 [VarAnio_VariacionAnualAbsoluto]&gt;=VALUES(Rangos[Valor])
 )
 );
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarAnio_EstadoVariacionAnual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarAnio_EstadoVariacion]=IF([VarAnio_EstadoVariacionAnual]=TRUE(),1,0);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarAnio_EstadoVariacion</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarAnio_VariacionTasaAnual]=IF(ISERROR([SubTotTasaAnio]/[AnioAnt_C]),0,[SubTotTasaAnio]/[AnioAnt_C]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarAnio_VariacionTasaAnual</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarAnio_EstadoVariacionAnualMenores]=IF(
HASONEVALUE(Rangos[Valor]),  
IF
(
[VarAnio_VariacionAnualAbsoluto]=0,FALSE(),
[VarAnio_VariacionAnualAbsoluto]&lt;VALUES(Rangos[Valor])
)
);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarAnio_EstadoVariacionAnualMenores</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarAnio_VariacionAnualMenores]=IF(
[VarAnio_EstadoVariacionAnualMenores]=TRUE(),
[VarAnio_VarAnual],
BLANK()
);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarAnio_VariacionAnualMenores</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[Max_Plazo]=MAX(ConsolidadoHojaPosicion[Plazo]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Max_Plazo</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[Sald_SaldoMenores5000]=IF(
HASONEVALUE(Rangos[Valor]),
[Hoy_C],
BLANK()
);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Sald_SaldoMenores5000</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarMes_VariacionMensualMenores5000]=IF(
HASONEVALUE(Rangos[Valor]),
[VarMes_VarMensual],
BLANK()
);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarMes_VariacionMensualMenores5000</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarDia_VariacionDiariaMenores5000]=IF(
HASONEVALUE(Rangos[Valor]),
[VarDia_VarDiaria],
BLANK()
);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarDia_VariacionDiariaMenores5000</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarAnio_VariacionAnualMenores5000]=IF(
HASONEVALUE(Rangos[Valor]),
[VarAnio_VarAnual],
BLANK()
);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarAnio_VariacionAnualMenores5000</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[Sald_EstadoSaldoMenores]=IF([Sald_EstadoSaldoActualMenores]=TRUE(),1,0);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Sald_EstadoSaldoMenores</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarDia_EstadoVariacionMenores]=IF([VarDia_EstadoVariacionDiariaMenores]=TRUE(),1,0);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarDia_EstadoVariacionMenores</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarMes_EstadoVariacionMenores]=IF([VarMes_EstadoVariacionMensualMenores]=TRUE(),1,0);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarMes_EstadoVariacionMenores</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[VarAnio_EstadoVariacionMenores]=IF([VarAnio_EstadoVariacionAnualMenores]=TRUE(),1,0);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>VarAnio_EstadoVariacionMenores</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[Sald_TsHoy]=IF(ISERROR([SubTotTasaHoy]/[Hoy_C]),0,[SubTotTasaHoy]/[Hoy_C]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Sald_TsHoy</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[NumTasaHoy]=[Hoy_C]*[TasaHoy_C];
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>NumTasaHoy</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[SubTotTasaHoy]=SUMX(ConsolidadoHojaPosicion,[NumTasaHoy]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>SubTotTasaHoy</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[NumTasaMes]=[MesAnt_C]*[TasaMesAnt_C];
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>NumTasaMes</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[SubTotTasaMes]=SUMX(ConsolidadoHojaPosicion,[NumTasaMes]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>SubTotTasaMes</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[NumTasaAnio]=[AnioAnt_C]*[TasaAnioAnt_C];
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>NumTasaAnio</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[SubTotTasaAnio]=SUMX(ConsolidadoHojaPosicion,[NumTasaAnio]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>SubTotTasaAnio</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'ConsolidadoHojaPosicion'[Sald_SaldoHoy]=SUMX(ConsolidadoHojaPosicion,IF([Sald_EstadoSaldo]=1,[Hoy_C],0));
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>Sald_SaldoHoy</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>ConsolidadoHojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'Canal'[caValCanalConteo]=COUNT(Canal[Orden]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>caValCanalConteo</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>Canal</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[DenomAyer]=SUM(HojaPosicion[DenominadorAyer]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>DenomAyer</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[DenomMesAnt]=SUM(HojaPosicion[DenominadorMesAnt]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>DenomMesAnt</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[DenomAnioAnt]=SUM(HojaPosicion[DenominadorAnioAnt]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>DenomAnioAnt</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[DenomPresAnt]=SUM(HojaPosicion[DenominadorPresupuesto]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>DenomPresAnt</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'HojaPosicion'[DenomHoy]=SUM(HojaPosicion[DenominadorHoy]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>DenomHoy</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>HojaPosicion</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'Fecha'[feValConteoFecha]=COUNT(Fecha[feIdFecha]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>feValConteoFecha</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>Fecha</Value>
                    </Annotation>
                  </Annotations>
                </Command>
                <Command>
                  <Text>----------------------------------------------------------
-- PowerPivot measures command (do not modify manually) --
----------------------------------------------------------


CREATE MEASURE 'Rangos'[raValConteoRango]=COUNT(Rangos[Valor]);
</Text>
                  <Annotations>
                    <Annotation>
                      <Name>FullName</Name>
                      <Value>raValConteoRango</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Table</Name>
                      <Value>Rangos</Value>
                    </Annotation>
                  </Annotations>
                </Command>
              </Commands>
              <CalculationProperties>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[MaxNivel]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[BrowseNivel]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[TotalHoy]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[FiltroDivisionHoy]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Hoy]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[TotalAyer]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[FiltroDivisionAyer]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Ayer]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[TotalMesAnt]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[FiltroDivisionMesAnt]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[MesAnterior]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[TotalAnioAnt]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[FiltroDivisionAnioAnt]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[AnioAnterior]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarDiaria]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarDiaria%]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarMensual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarMensual%]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarAnual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarAnual%]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Saldo]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[TotalPresupuesto]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[FiltroDivisionPresupuesto]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Presupuesto]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Cumplimiento]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[DifCumplimiento]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[MoCumplimiento]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[DifRanCumpl]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[MoRanCumpl]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[TotRanCumpl]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[CumplimientoBandera]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[MaxNivelMF]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[BrowseNivelMF]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Part % Diario]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Saldo Diario]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[TTP % Diario]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[PYG Diario]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Part % Mensual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VolPromMes]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[TPP % Mes]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[PYG Mensual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Part % Anual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VolProm Anual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[TTP % Anual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[PYG Anual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Proyeccion TTP Mes]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Proyeccion TTP Anual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[BanderaPryTTPMes]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[BanderaPryTTPAnual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[BanderaMesCaptaciones]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[BanderaMesCartera]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[RangMesCaptaciones]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[RangoMesCartera]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[BanderaMesTot]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[BanderaAnioCaptaciones]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[BanderaAnioCartera]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[RangAnioCaptaciones]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[RangAnioCartera]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[BanderaAnioTot]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[T Diaria]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[T Mensual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[T Anual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Participacion]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Fecha]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Hoy_C]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Ayer_C]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[MesAnt_C]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[AnioAnt_C]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Sald_EstadoSaldoActualMenores]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Sald_EstadoSaldoActual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Sald_EstadoSaldo]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[TasaHoy_C]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[TasaAyer_C]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[TasaMesAnt_C]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[TasaAnioAnt_C]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarDia_VariacionDiariaAbsoluto]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarDia_EstadoVariacionDiaria]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarDia_EstadoVariacionDiariaMenores]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarDia_EstadoVariacion]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarDia_VariacionTasaDiaria]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarDia_VarDiaria]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarMes_VarMensual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarMes_VariacionMensualAbsoluto]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarMes_EstadoVariacionMensual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarMes_EstadoVariacion]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarMes_VariacionTasaMensual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarMes_EstadoVariacionMensualMenores]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarAnio_VarAnual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarAnio_VariacionAnualAbsoluto]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarAnio_EstadoVariacionAnual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarAnio_EstadoVariacion]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarAnio_VariacionTasaAnual]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarAnio_EstadoVariacionAnualMenores]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarAnio_VariacionAnualMenores]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Max_Plazo]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Sald_SaldoMenores5000]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarMes_VariacionMensualMenores5000]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarDia_VariacionDiariaMenores5000]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarAnio_VariacionAnualMenores5000]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Sald_EstadoSaldoMenores]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarDia_EstadoVariacionMenores]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarMes_EstadoVariacionMenores]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[VarAnio_EstadoVariacionMenores]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Sald_TsHoy]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[NumTasaHoy]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[SubTotTasaHoy]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[NumTasaMes]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[SubTotTasaMes]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[NumTasaAnio]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>True</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[SubTotTasaAnio]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[Sald_SaldoHoy]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[caValCanalConteo]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[DenomAyer]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[DenomMesAnt]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[DenomAnioAnt]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[DenomPresAnt]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[DenomHoy]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[feValConteoFecha]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <Annotations>
                    <Annotation>
                      <Name>Type</Name>
                      <Value>User</Value>
                    </Annotation>
                    <Annotation>
                      <Name>IsPrivate</Name>
                      <Value>False</Value>
                    </Annotation>
                    <Annotation>
                      <Name>Format</Name>
                      <Value>
                        <Format Format="General" xmlns="" />
                      </Value>
                    </Annotation>
                  </Annotations>
                  <CalculationReference>[raValConteoRango]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <FormatString>''</FormatString>
                </CalculationProperty>
                <CalculationProperty>
                  <CalculationReference>Measures.[__No measures defined]</CalculationReference>
                  <CalculationType>Member</CalculationType>
                  <Visible>false</Visible>
                </CalculationProperty>
              </CalculationProperties>
            </MdxScript>
          </MdxScripts>
          <StorageMode valuens="ddl200_200">InMemory</StorageMode>
          <ProactiveCaching>
            <SilenceInterval>-PT1S</SilenceInterval>
            <Latency>-PT1S</Latency>
            <SilenceOverrideInterval>-PT1S</SilenceOverrideInterval>
            <ForceRebuildInterval>-PT1S</ForceRebuildInterval>
            <Source xsi:type="ProactiveCachingInheritedBinding" />
          </ProactiveCaching>
        </Cube>
      </Cubes>
      <DataSources>
        <DataSource xsi:type="RelationalDataSource">
          <ID>21568b6b-c791-4141-8d9e-e542457fa7a5</ID>
          <Name>CxCorporativo</Name>
          <Annotations>
            <Annotation>
              <Name>ConnectionEditUISource</Name>
              <Value>SqlServer</Value>
            </Annotation>
          </Annotations>
          <ConnectionString>Data Source=172.16.172.161;Initial Catalog=DWHCORPORATIVO;Persist Security Info=true;User ID=dwh</ConnectionString>
          <ImpersonationInfo>
            <ImpersonationMode>ImpersonateAccount</ImpersonationMode>
            <Account>banintern\bincarro</Account>
          </ImpersonationInfo>
          <ManagedProvider>System.Data.SqlClient</ManagedProvider>
          <Timeout>PT0S</Timeout>
          <MaxActiveConnections>50</MaxActiveConnections>
        </DataSource>
      </DataSources>
      <DataSourceViews>
        <DataSourceView>
          <ID>Sandbox</ID>
          <Name>Sandbox</Name>
          <DataSourceID>21568b6b-c791-4141-8d9e-e542457fa7a5</DataSourceID>
          <Schema>
            <xs:schema id="NewDataSet" xmlns="" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:msdata="urn:schemas-microsoft-com:xml-msdata" xmlns:msprop="urn:schemas-microsoft-com:xml-msprop">
              <xs:element name="NewDataSet" msdata:IsDataSet="true" msdata:Locale="es-MX">
                <xs:complexType>
                  <xs:choice minOccurs="0" maxOccurs="unbounded">
                    <xs:element name="HojaPosicion_a94899b0-4c6a-4767-a756-5bda21a4b6b4" msdata:Locale="" msprop:IsLogical="True" msprop:FriendlyName="HojaPosicion" msprop:DbTableName="HojaPosicion" msprop:TableType="View" msprop:Description="HojaPosicion" msprop:QueryDefinition="SET NOCOUNT ON&#xA;&#xA;declare @FechAct int, @FechaAyer int, @FechaMesAnt int, @FechaAnioAnt int, @Nivel1 varchar(100),&#xA;@OrdenCaptacionConcetracion int, @OrdenCaptacionCanal int, @OrdenCaptacionSegmentacion int,&#xA;@DescripcionCartera varchar(50),@OrdenCarteraCanal int ,@OrdenCarteraSegmentacion int,&#xA;@OrdenContingenteCanal int, @OrdenContingenteSegmentacion int,&#xA;@OrdenCaptacionConcetracionN2 int, @OrdenCarteraNivel1 int,@OrdenCarteraNivel2 int,&#xA;@CanalAgrTit varchar(50), @OrdenCanalTit int, @CanalTit varchar(50),&#xA;@TitularizadaN1 int, @TitularizadaN2 int&#xA;&#xA;&#xA;select @FechAct=max(feIdFecha) from DWDFecha where fediaactual = 1&#xA;&#xA;select&#xA;@FechaAyer=fecIdAnterior,&#xA;@FechaMesAnt=feMesAntCierr,&#xA;@FechaAnioAnt=feAnioAntCierr&#xA;from  DWDFecha&#xA;where feIdFecha=@FechAct&#xA;&#xA;&#xA;/* ----------------------- */&#xA;/*    DESENCRIPTACION      */&#xA;/* ----------------------- */&#xA;&#xA;OPEN SYMMETRIC KEY ClaveMIS02&#xA;DECRYPTION BY CERTIFICATE Certi01&#xA;&#xA;&#xA;if object_id('[tempdb]..#DWDCuentaContable') is not null&#xA;begin&#xA;drop table #DWDCuentaContable&#xA;end&#xA;&#xA;select&#xA;ccIdCuentaContable,&#xA;ccCodigoMoneda,&#xA;case &#xA;when ccOrdenAgrupacionN2=4 then case &#xA;        when CpEstadoProducto = 'VEN' then 'Vencida'&#xA;        when CpEstadoProducto = 'NDE' then 'QnDevInter'&#xA;        else 'Vigente' end &#xA;else ccSubGrupo &#xA;end ccSubGrupo,&#xA;ccGrupo,&#xA;ccFamiliaProducto,&#xA;ccCodigoIndicador,&#xA;ccClasificacionEstado,&#xA;ccOrdenAgrupacion,&#xA;ccOrdenAgrupacionN2,&#xA;ccOrdenAgrupacionN3 = case when indicadorNivel2=124 and ccOrdenAgrupacionN3 is null then 11 else ccOrdenAgrupacionN3 end ,&#xA;ccCodigoNivel6=CONVERT(varchar(15), DecryptByKey(ccCodigoNivel6)),&#xA;ccCovid,&#xA;AgrupacionCovid=case when ccCovid=1  then ccFamiliaProducto + ccSubGrupo  else ccFamiliaProducto end &#xA;into #DWDCuentaContable &#xA;from DWDCuentaContable&#xA;left outer join [vuClasificacionProductos] on indicadorNivel3 = cccodigoIndicador&#xA;&#xA;&#xA;&#xA;if object_id('[tempdb]..#DWDTitularizadaOperacion') is not null&#xA;begin&#xA;drop table #DWDTitularizadaOperacion&#xA;end&#xA;&#xA;&#xA;select top 0&#xA;toNombre,&#xA;toCedula=CONVERT(varchar(15), DecryptByKey(toCedula)),&#xA;toOperacion=CONVERT(varchar(9), DecryptByKey(toOperacion))&#xA;&#xA;into #DWDTitularizadaOperacion --0&#xA;from DWDTitularizadaOperacion&#xA;&#xA;&#xA;if object_id('[tempdb]..#DWHCuotaOperacion') is not null&#xA;begin&#xA;drop table #DWHCuotaOperacion&#xA;end&#xA;&#xA;&#xA;select&#xA;coIdFecha,&#xA;coIdAgencia,&#xA;coIdAsesorPrincipal,&#xA;coIdAsesorSecundario,&#xA;coIdCliente,&#xA;coIdCuentaContable,&#xA;coIdProducto,&#xA;coIdMoneda,&#xA;coCuotaCapital,&#xA;coNumeroOperacion=CONVERT(varchar(15), DecryptByKey(coNumeroOperacion))&#xA;&#xA;into #DWHCuotaOperacion --944581&#xA;from DWHCuotaOperacion&#xA;where coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and isnull(coCuotaCapital,0)&lt;&gt;0&#xA;&#xA;&#xA;&#xA;if object_id('[tempdb]..#DWHActivoOperacion') is not null&#xA;begin&#xA;drop table #DWHActivoOperacion&#xA;end&#xA;&#xA;&#xA;select&#xA;aoIdFecha,&#xA;aoIdAgencia,&#xA;aoIdAsesorPrincipal,&#xA;aoIdAsesorSecundario,&#xA;aoIdCliente,&#xA;aoIdCuentaContable,&#xA;aoIdProducto,&#xA;aoIdMoneda,&#xA;aoMontoSaldoDolar,&#xA;aoPlazoOperacion,&#xA;aoNumeroOperacion=CONVERT(varchar(15), DecryptByKey(aoNumeroOperacion)),&#xA;aoNumeroOperacion2&#xA;&#xA;into #DWHActivoOperacion&#xA;from DWHActivoOperacion --60973&#xA;where aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and isnull(aoMontoSaldoDolar,0)&lt;&gt;0&#xA;&#xA;CLOSE SYMMETRIC KEY ClaveMIS02&#xA;&#xA;/* ---------------- */&#xA;/* PASIVO OPERACION */&#xA;/* ---------------- */&#xA;&#xA;if object_id('[tempdb]..#DWHPasivoOperacion') is not null&#xA;begin&#xA;drop table #DWHPasivoOperacion&#xA;end&#xA;&#xA;select&#xA; poIdFecha&#xA;,poIdProducto&#xA;,poIdMoneda&#xA;,poIdAgencia&#xA;,poIdAsesor&#xA;,poIdCliente&#xA;,poSaldoOperacionUSD&#xA;,poIdCuentaContable&#xA;into  #DWHPasivoOperacion&#xA;from DWHPasivoOperacion --1727655&#xA;where poIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and isnull(poSaldoOperacionUSD,0)&lt;&gt;0&#xA;&#xA;/* ----------------- */&#xA;/* TARJETA OPERACION */&#xA;/* ----------------- */&#xA;&#xA;if object_id('[tempdb]..#DWHTarjetaCreditoOperacion') is not null&#xA;begin&#xA;drop table #DWHTarjetaCreditoOperacion&#xA;end&#xA;&#xA;select&#xA; tcoIdFecha&#xA;,tcoIdAgencia&#xA;,tcoIdCuentaContable&#xA;,tcoIdMoneda&#xA;,tcoIdProducto&#xA;,tcoIdCliente&#xA;,tcoSaldo&#xA;into #DWHTarjetaCreditoOperacion&#xA;from DWHTarjetaCreditoOperacion&#xA;where tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and isnull(tcoSaldo,0)&lt;&gt;0&#xA;&#xA;&#xA;--------------------------------------------------------&#xA;-- Actualizacion de titularizada a Cartera Titularizada&#xA;--------------------------------------------------------&#xA;&#xA;update #DWDCuentaContable&#xA;set&#xA;ccFamiliaProducto='Cartera',&#xA;ccGrupo='C. Titularizada',&#xA;ccSubGrupo=null&#xA;where cccodigoindicador in (136,137,138)&#xA;&#xA;&#xA;/* -------------------------------------------- */&#xA;/* OBTENCION DE NUMERO DE ORDEN Y DESCRIPCIONES */&#xA;/* -------------------------------------------- */&#xA;&#xA;--&gt;&gt; CAPTACIONES&#xA;&#xA;select distinct @Nivel1=ccFamiliaProducto&#xA;from #DWDCuentaContable&#xA;inner join (&#xA;SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador in (2)&#xA;and p1.CpCodigoIndicador in (140)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON ccCodigoIndicador=cp.indicadorNivel3&#xA;&#xA;select&#xA;@OrdenCaptacionConcetracion=max(ccOrdenAgrupacion),&#xA;@OrdenCaptacionConcetracionN2=max(ccOrdenAgrupacionN2)&#xA;from #DWDCuentaContable cc&#xA;inner join (&#xA;SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador in (2)&#xA;and p1.CpCodigoIndicador in (140,141,142)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;&#xA;select&#xA;@OrdenCaptacionCanal=max(ccOrdenAgrupacion)+1,&#xA;@OrdenCaptacionSegmentacion=max(ccOrdenAgrupacion)+2&#xA;from #DWDCuentaContable&#xA;inner join (&#xA;SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador in (2)&#xA;and p1.CpCodigoIndicador in (140,141,142)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON ccCodigoIndicador=cp.indicadorNivel3&#xA;&#xA;&#xA;--&gt;&gt; CARTERA&#xA;&#xA;select&#xA;@OrdenCarteraNivel1=max(ccOrdenAgrupacion),&#xA;@OrdenCarteraNivel2=max(ccOrdenAgrupacionN2),&#xA;@OrdenCarteraCanal=max(ccOrdenAgrupacion)+1,&#xA;@OrdenCarteraSegmentacion=max(ccOrdenAgrupacion)+2&#xA;from #DWDCuentaContable&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador in (1)&#xA;and p1.CpCodigoIndicador in (120,121,122,126)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON ccCodigoIndicador=cp.indicadorNivel3&#xA;&#xA;&#xA;select @DescripcionCartera=max(ccFamiliaProducto)&#xA;from #DWDCuentaContable&#xA;inner join (&#xA;SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador in (1)&#xA;and p1.CpCodigoIndicador in (120,121,122,126)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON ccCodigoIndicador=cp.indicadorNivel3&#xA;&#xA;&#xA;--&gt;&gt; CONTINGENTES&#xA;&#xA;select @OrdenContingenteCanal=max(ccOrdenAgrupacion)+1,&#xA;@OrdenContingenteSegmentacion=max(ccOrdenAgrupacion)+2&#xA;from #DWDCuentaContable&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador in (3)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON ccCodigoIndicador=cp.indicadorNivel3&#xA;&#xA;&#xA;--&gt;&gt; TITULARIZADA&#xA;&#xA;select&#xA;@TitularizadaN1=max(prOrdenN1),&#xA;@TitularizadaN2=max(prOrdenN2)+1&#xA;from DWDProducto where prGrupo='Vehiculos'&#xA;&#xA;select&#xA;@CanalTit=caDescripcionAgrupacionCanal,&#xA;@CanalAgrTit=caAgrupacion,&#xA;@OrdenCanalTit=caOrdenCanal&#xA;from DWDCanal&#xA;where caCodigoCanal='TIT'&#xA;&#xA;&#xA;&#xA;if object_id('[tempdb]..#Cartera')  is not null&#xA;begin&#xA;drop table #Cartera&#xA;end&#xA;&#xA;--- Identificacion vehiculos&#xA;&#xA;if object_id('[tempdb]..#Vehiculos') is not null&#xA;begin&#xA;drop table #Vehiculos&#xA;end&#xA;&#xA;select&#xA;Estado=CpEstadoProducto,--ccClasificacionEstado, /**/&#xA;pr.prOrdenN1,&#xA;pr.prOrdenN2,&#xA;pr.prOrdenN3,&#xA;ca.caOrdenCanal,&#xA;cc.ccOrdenAgrupacionN3,&#xA;--Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;--Division='NO',&#xA;cc.ccFamiliaProducto,&#xA;pr.prVehiculo,&#xA;ca.caAgrupacion,&#xA;cc.AgrupacionCovid,&#xA;pr.prSubGrupo,&#xA;pr.prCodigoIndicador,&#xA;cc.ccSubGrupo,&#xA;cc.ccCovid,&#xA;&#xA;RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end&#xA;&#xA;into #Vehiculos&#xA;&#xA;from #DWHCuotaOperacion co&#xA;inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on co.coIdCliente=clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda&#xA;inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto&#xA;inner join (&#xA;SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3&#xA;,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador =1&#xA;and p1.CpCodigoIndicador in (120,121,122,126)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and pr.prVehiculo='Vehiculos'&#xA;and ccCodigoMoneda=moCodigoMoneda&#xA;and clFechaFin is null&#xA;and ca.caEstado=1&#xA;--and cc.ccCodigoMoneda='USD'&#xA;group by&#xA;cp.CpEstadoProducto, --ccClasificacionEstado, /**/&#xA;ca.caOrdenCanal,&#xA;mo.moCodigoMoneda,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;pr.prOrdenN1,&#xA;pr.prOrdenN2,&#xA;cc.ccFamiliaProducto,&#xA;ccOrdenAgrupacion,&#xA;ccOrdenAgrupacionN2,&#xA;ccOrdenAgrupacionN3,&#xA;ca.caAgrupacion,&#xA;pr.prVehiculo,&#xA;co.coIdFecha, --202815&#xA;cc.AgrupacionCovid,&#xA;pr.prOrdenN3,&#xA;pr.prSubGrupo,&#xA;pr.prCodigoIndicador,&#xA;cc.ccSubGrupo,&#xA;cc.ccCovid,&#xA;cc.ccOrdenAgrupacionN3&#xA;&#xA;&#xA;/* ---------------------------------------------------------------------- */&#xA;/*                           CARTERA                                      */&#xA;/* ---------------------------------------------------------------------- */&#xA;&#xA;-- Comer. + Micro. (525,526,524,501,504,506,505,509,507)&#xA;-- Consumo (510,511,512,513,514,515)&#xA;-- Vivienda (519,520,521,522,523)&#xA;-- Titularizada (136,137,138)&#xA;&#xA;select&#xA;Estado=CpEstadoProducto,--ccClasificacionEstado, /**/&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=ca.caOrdenCanal,&#xA;Jerarquia=4,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=cc.ccGrupo,&#xA;Nivel3='     '+ca.caAgrupacion,&#xA;Nivel4='     '+cc.AgrupacionCovid,&#xA;Nivel5='     '+cc.AgrupacionCovid,&#xA;RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;&#xA;into #Cartera&#xA;&#xA;from #DWHCuotaOperacion co&#xA;inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on co.coIdCliente=clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda&#xA;inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto&#xA;left outer join #DWDTitularizadaOperacion ti on  isnull(co.coNumeroOperacion,'')=ti.toOperacion&#xA;inner join (&#xA;SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3&#xA;,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end/**/&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador in (120,121,122,126)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and pr.prVehiculo is null&#xA;and cl.clFechaFin is null&#xA;and ca.caEstado=1&#xA;and ti.toOperacion is null -- Filtro Titularizada&#xA;--and cc.ccCodigoMoneda='USD'&#xA;&#xA;group by&#xA;cp.CpEstadoProducto, --ccClasificacionEstado, /**/&#xA;co.coIdFecha,&#xA;cl.clCodigoCliente,&#xA;ca.caAgrupacion,&#xA;ca.caOrdenCanal,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cl.clNombreCompleto,&#xA;mo.moCodigoMoneda,&#xA;cc.ccOrdenAgrupacionN2,&#xA;cc.ccFamiliaProducto,&#xA;prCodigoProducto,&#xA;ccCodigoNivel6,&#xA;cc.ccGrupo,&#xA;cc.ccOrdenAgrupacion,&#xA;cc.ccCodigoIndicador, --20303&#xA;cc.AgrupacionCovid&#xA;&#xA;Union All&#xA;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;--  Agrupaciones&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;select&#xA;Estado=CpEstadoProducto,--ccClasificacionEstado, /**/&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=cc.ccOrdenAgrupacionN3,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=cc.ccGrupo,&#xA;Nivel3=cc.ccSubGrupo,&#xA;Nivel4=cc.ccSubGrupo,&#xA;Nivel5=cc.ccSubGrupo,&#xA;RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHCuotaOperacion co&#xA;inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on co.coIdCliente=clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda&#xA;inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto&#xA;left outer join #DWDTitularizadaOperacion ti on  isnull(co.coNumeroOperacion,'')=ti.toOperacion&#xA;inner join (&#xA;SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3&#xA;,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador in (120,121,122,126)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where co.coIdFecha  in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and pr.prVehiculo is null&#xA;and cl.clFechaFin is null&#xA;and ccCodigoMoneda=moCodigoMoneda&#xA;and ca.caEstado=1&#xA;and ti.toOperacion is null -- Filtro titularizada&#xA;--and cc.ccCodigoMoneda='USD'&#xA;group by&#xA;cp.CpEstadoProducto, --ccClasificacionEstado, /**/&#xA;cc.ccFamiliaProducto,&#xA;cc.ccGrupo,&#xA;cc.ccOrdenAgrupacion,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cc.ccOrdenAgrupacionN2,&#xA;cc.ccOrdenAgrupacionN3,&#xA;cc.ccSubGrupo,&#xA;co.coIdFecha--20354&#xA;&#xA;Union All&#xA;&#xA;--&gt;&gt;  Agrupaciones Valor Deduccion&#xA;&#xA;select&#xA;Estado=CpEstadoProducto,--ccClasificacionEstado, /**/&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=cc.ccOrdenAgrupacionN3,&#xA;Jerarquia=2,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=cc.ccGrupo,&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;RealHoy=case co.coIdFecha when @FechAct then (sum(isnull(co.coCuotaCapital,0))/1000)*-1 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case co.coIdFecha when @FechaAyer then (sum(isnull(co.coCuotaCapital,0))/1000)*-1 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case co.coIdFecha when @FechaMesAnt then (sum(isnull(co.coCuotaCapital,0))/1000)*-1 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then (sum(isnull(co.coCuotaCapital,0))/1000)*-1 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHCuotaOperacion co&#xA;inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on co.coIdCliente=clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda&#xA;inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto&#xA;left outer join #DWDTitularizadaOperacion ti on  isnull(co.coNumeroOperacion,'')=ti.toOperacion&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador in (120,121,122,126)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where co.coIdFecha  in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and pr.prVehiculo is null&#xA;and cl.clFechaFin is null&#xA;and ca.caEstado=1&#xA;and ccCodigoMoneda=moCodigoMoneda&#xA;and ti.toOperacion is null -- Filtro titularizada&#xA;--and cc.ccCodigoMoneda='USD'&#xA;group by&#xA;cp.CpEstadoProducto, --ccClasificacionEstado, /**/&#xA;cc.ccFamiliaProducto,&#xA;cc.ccGrupo,&#xA;cc.ccOrdenAgrupacion,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cc.ccOrdenAgrupacionN2,&#xA;cc.ccOrdenAgrupacionN3,&#xA;co.coIdFecha --20405&#xA;&#xA;Union All&#xA;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;-- T. Credito&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;select&#xA;Estado=CpEstadoProducto,--ccClasificacionEstado, /**/&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=ca.caOrdenCanal,&#xA;Jerarquia=4,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=cc.ccGrupo,&#xA;Nivel3='     '+ca.caAgrupacion,&#xA;Nivel4='     '+cc.AgrupacionCovid,&#xA;Nivel5='     '+cc.AgrupacionCovid,&#xA;RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHTarjetaCreditoOperacion tco&#xA;inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto&#xA;inner join DWDMoneda on moIdMoneda=tcoIdMoneda&#xA;inner join (&#xA;SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3&#xA;,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador = 124&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and cl.clFechaFin is null&#xA;and ca.caEstado=1&#xA;--and cc.ccCodigoMoneda='USD'&#xA;group by&#xA;cp.CpEstadoProducto, --ccClasificacionEstado, /**/&#xA;cc.ccOrdenAgrupacion,&#xA;cl.clCodigoCliente,&#xA;ca.caOrdenCanal,&#xA;cc.ccOrdenAgrupacionN2,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cc.ccFamiliaProducto,&#xA;caAgrupacion,&#xA;cc.ccGrupo,&#xA;tco.tcoIdFecha, --202793&#xA;cc.AgrupacionCovid&#xA;&#xA;union all&#xA;&#xA;-- Agrupacion Covid Tarjeta de credito&#xA;&#xA;select&#xA;Estado=CpEstadoProducto,--ccClasificacionEstado, /**/&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=cc.ccOrdenAgrupacionN3,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=cc.ccGrupo,&#xA;Nivel3='     '+cc.ccSubGrupo,&#xA;Nivel4='     '+cc.ccSubGrupo,&#xA;Nivel5='     '+cc.ccSubGrupo,&#xA;RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHTarjetaCreditoOperacion tco&#xA;inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto&#xA;inner join DWDMoneda on moIdMoneda=tcoIdMoneda&#xA;inner join (&#xA;SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3&#xA;,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador = 124&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and cl.clFechaFin is null&#xA;and ca.caEstado=1&#xA;and cc.ccCovid=1&#xA;--and cc.ccCodigoMoneda='USD'&#xA;group by&#xA;cp.CpEstadoProducto, --ccClasificacionEstado, /**/&#xA;cc.ccOrdenAgrupacion,&#xA;cl.clCodigoCliente,&#xA;ca.caOrdenCanal,&#xA;cc.ccOrdenAgrupacionN2,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cc.ccFamiliaProducto,&#xA;cc.ccGrupo,&#xA;tco.tcoIdFecha, --202793&#xA;cc.ccSubGrupo,&#xA;cc.ccOrdenAgrupacionN3&#xA;&#xA;union all&#xA;&#xA;-- valor deduccion covid de tarjeta &#xA;&#xA;select&#xA;Estado=CpEstadoProducto,--ccClasificacionEstado, /**/&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=cc.ccOrdenAgrupacionN3,&#xA;Jerarquia=2,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=cc.ccGrupo,&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;RealHoy=case tco.tcoIdFecha when @FechAct then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case tco.tcoIdFecha when @FechaAyer then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHTarjetaCreditoOperacion tco&#xA;inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto&#xA;inner join DWDMoneda on moIdMoneda=tcoIdMoneda&#xA;inner join (&#xA;SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3&#xA;,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador = 124&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and cl.clFechaFin is null&#xA;and ca.caEstado=1&#xA;and cc.ccCovid=1&#xA;--and cc.ccCodigoMoneda='USD'&#xA;group by&#xA;cp.CpEstadoProducto,&#xA;cc.ccOrdenAgrupacion,&#xA;cl.clCodigoCliente,&#xA;ca.caOrdenCanal,&#xA;cc.ccOrdenAgrupacionN2,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cc.ccFamiliaProducto,&#xA;cc.ccGrupo,&#xA;tco.tcoIdFecha, --202793&#xA;cc.ccOrdenAgrupacionN3&#xA;&#xA;Union All&#xA;&#xA;-- Agrupacion Tarjeta de credito Dificultades &#xA;&#xA;select&#xA;Estado=CpEstadoProducto,--ccClasificacionEstado, /**/&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=cc.ccOrdenAgrupacionN3,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=cc.ccGrupo,&#xA;Nivel3='     '+cc.ccSubGrupo,&#xA;Nivel4='     '+cc.ccSubGrupo,&#xA;Nivel5='     '+cc.ccSubGrupo,&#xA;RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHTarjetaCreditoOperacion tco&#xA;inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto&#xA;inner join DWDMoneda on moIdMoneda=tcoIdMoneda&#xA;inner join (&#xA;SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3&#xA;,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and cl.clFechaFin is null&#xA;and ca.caEstado=1&#xA;group by&#xA;cp.CpEstadoProducto, &#xA;cc.ccOrdenAgrupacion,&#xA;cl.clCodigoCliente,&#xA;ca.caOrdenCanal,&#xA;cc.ccOrdenAgrupacionN2,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cc.ccFamiliaProducto,&#xA;cc.ccGrupo,&#xA;tco.tcoIdFecha, --202793&#xA;cc.ccSubGrupo,&#xA;cc.ccOrdenAgrupacionN3&#xA;&#xA;union all&#xA;&#xA;-- valor deduccion de tarjeta Dificultades&#xA;&#xA;select&#xA;Estado=CpEstadoProducto,--ccClasificacionEstado, /**/&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=cc.ccOrdenAgrupacionN3,&#xA;Jerarquia=2,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=cc.ccGrupo,&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;RealHoy=case tco.tcoIdFecha when @FechAct then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case tco.tcoIdFecha when @FechaAyer then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHTarjetaCreditoOperacion tco&#xA;inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto&#xA;inner join DWDMoneda on moIdMoneda=tcoIdMoneda&#xA;inner join (&#xA;SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3&#xA;,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and cl.clFechaFin is null&#xA;and ca.caEstado=1&#xA;group by&#xA;cp.CpEstadoProducto,&#xA;cc.ccOrdenAgrupacion,&#xA;cl.clCodigoCliente,&#xA;ca.caOrdenCanal,&#xA;cc.ccOrdenAgrupacionN2,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cc.ccFamiliaProducto,&#xA;cc.ccGrupo,&#xA;tco.tcoIdFecha, &#xA;cc.ccOrdenAgrupacionN3&#xA;&#xA;Union All&#xA;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;-- Vehiculos&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;select&#xA;Estado,--ccClasificacionEstado, /**/&#xA;OrdenN1=prOrdenN1,&#xA;OrdenN2=prOrdenN2,&#xA;OrdenN3=caOrdenCanal,&#xA;Jerarquia=4,&#xA;Canal,&#xA;Division='NO',&#xA;Nivel1=ccFamiliaProducto,&#xA;Nivel2=prVehiculo,&#xA;Nivel3='     '+caAgrupacion,&#xA;Nivel4='     '+AgrupacionCovid,&#xA;Nivel5='     '+AgrupacionCovid,&#xA;RealHoy,&#xA;DenominadorHoy=0,&#xA;RealAyer,&#xA;DenominadorAyer=0,&#xA;RealMesAnt,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #Vehiculos co&#xA;&#xA;Union All&#xA;&#xA;--&gt;&gt; Vehiculos Credimetrica y Originarsa&#xA;&#xA;select&#xA;Estado,--ccClasificacionEstado, /**/&#xA;OrdenN1=prOrdenN1,&#xA;OrdenN2=prOrdenN2,&#xA;OrdenN3=prOrdenN3,&#xA;Jerarquia=4,&#xA;Canal,&#xA;Division='NO',&#xA;Nivel1=ccFamiliaProducto,&#xA;Nivel2=prVehiculo,&#xA;Nivel3=prSubGrupo,&#xA;Nivel4=AgrupacionCovid,&#xA;Nivel5=AgrupacionCovid,&#xA;RealHoy,&#xA;DenominadorHoy=0,&#xA;RealAyer,&#xA;DenominadorAyer=0,&#xA;RealMesAnt,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #Vehiculos&#xA;where prCodigoIndicador in (527,528,529,530)&#xA;&#xA;&#xA;Union All&#xA;&#xA;--&gt;&gt; Valor deduccion Credimetrica y Originarsa&#xA;&#xA;select&#xA;Estado,--ccClasificacionEstado, /**/&#xA;OrdenN1=prOrdenN1,&#xA;OrdenN2=prOrdenN2,&#xA;OrdenN3=prOrdenN3,&#xA;Jerarquia=2,&#xA;Canal,&#xA;Division='NO',&#xA;Nivel1=ccFamiliaProducto,&#xA;Nivel2=prVehiculo,&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;RealHoy=RealHoy*-1,&#xA;DenominadorHoy=0,&#xA;RealAyer=RealAyer*-1,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=RealMesAnt*-1,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=RealAnioAnt*-1,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #Vehiculos&#xA;where prCodigoIndicador in (527,528,529,530)&#xA;&#xA;union all&#xA;&#xA;-- agrupacion covid vehiculos&#xA;select&#xA;Estado,--ccClasificacionEstado, /**/&#xA;OrdenN1=prOrdenN1,&#xA;OrdenN2=prOrdenN2,&#xA;OrdenN3=ccOrdenAgrupacionN3,&#xA;Jerarquia=3,&#xA;Canal,&#xA;Division='NO',&#xA;Nivel1=ccFamiliaProducto,&#xA;Nivel2=prVehiculo,&#xA;Nivel3=ccSubGrupo,&#xA;Nivel4=ccSubGrupo,&#xA;Nivel5=ccSubGrupo,&#xA;RealHoy,&#xA;DenominadorHoy=0,&#xA;RealAyer,&#xA;DenominadorAyer=0,&#xA;RealMesAnt,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #Vehiculos&#xA;where ccCovid=1&#xA;&#xA;&#xA;union all&#xA;&#xA;-- agrupacion covid vehiculos&#xA;select&#xA;Estado,--ccClasificacionEstado, /**/&#xA;OrdenN1=prOrdenN1,&#xA;OrdenN2=prOrdenN2,&#xA;OrdenN3=ccOrdenAgrupacionN3,&#xA;Jerarquia=2,&#xA;Canal,&#xA;Division='NO',&#xA;Nivel1=ccFamiliaProducto,&#xA;Nivel2=prVehiculo,&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;RealHoy=RealHoy*-1,&#xA;DenominadorHoy=0,&#xA;RealAyer=RealAyer*-1,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=RealMesAnt*-1,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=RealAnioAnt*-1,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #Vehiculos&#xA;where ccCovid=1&#xA;&#xA;Union all&#xA;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;-- Titularizada&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;--&gt; Identificacion de C.Titularizada por número de operación&#xA;&#xA;select&#xA;Estado=CpEstadoProducto,--ccClasificacionEstado, /**/&#xA;OrdenN1=@TitularizadaN1,&#xA;OrdenN2=@TitularizadaN2,&#xA;OrdenN3=@TitularizadaN2,&#xA;Jerarquia=2,&#xA;Canal=@CanalTit,&#xA;Division='NO',&#xA;Nivel1=@DescripcionCartera,&#xA;Nivel2='C. '+@CanalTit,&#xA;Nivel3=space(5)+ @CanalAgrTit,&#xA;Nivel4=space(5)+ @CanalAgrTit,&#xA;Nivel5=space(5)+ @CanalAgrTit,&#xA;RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHCuotaOperacion co&#xA;inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on co.coIdCliente=clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda&#xA;inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto&#xA;inner join #DWDTitularizadaOperacion ti on isnull(co.coNumeroOperacion,'')=ti.toOperacion -- Titularizada&#xA;inner join (&#xA;SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3&#xA;,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador in (120,121,122,126)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and ccCodigoMoneda=moCodigoMoneda&#xA;and clFechaFin is null&#xA;and ca.caEstado=1&#xA;--and cc.ccCodigoMoneda='USD'&#xA;group by&#xA;cp.CpEstadoProducto, --ccClasificacionEstado, /**/&#xA;ca.caOrdenCanal,&#xA;pr.prGrupo,&#xA;mo.moCodigoMoneda,&#xA;pr.prVehiculo,&#xA;co.coIdFecha--202839&#xA;/*&#xA;Union All&#xA;&#xA;-- Cambio de asignación de Titularizada a Cartera Titularizada&#xA;&#xA;select&#xA;Estado=CpEstadoProducto,--ccClasificacionEstado, /**/&#xA;OrdenN1=@TitularizadaN1,&#xA;OrdenN2=@TitularizadaN2,&#xA;OrdenN3=@TitularizadaN2,&#xA;Jerarquia=2,&#xA;Canal=@CanalTit,&#xA;Division='NO',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=cc.ccGrupo,&#xA;Nivel3=space(5)+ @CanalAgrTit,&#xA;Nivel4=space(5)+ @CanalAgrTit,&#xA;Nivel5=space(5)+ @CanalAgrTit,&#xA;RealHoy=case ao.aoIdFecha when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case ao.aoIdFecha when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case ao.aoIdFecha when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case ao.aoIdFecha when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHActivoOperacion ao&#xA;inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on ao.aoIdCliente=clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDMoneda mo on mo.moIdMoneda=ao.aoIdMoneda&#xA;inner join (&#xA;SELECT DISTINCT p2.CpCodigoIndicador indicadorNivel3&#xA;,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador = 125&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where ao.aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and cl.clfechafin is null&#xA;and ca.caEstado=1&#xA;group by&#xA;ca.caOrdenCanal,&#xA;ao.aoIdFecha,&#xA;ccFamiliaProducto,&#xA;ccGrupo,&#xA;cp.CpEstadoProducto --ccClasificacionEstado, /**/ -- 202839&#xA;*/&#xA;Union All&#xA;&#xA;/* PRESUPUESTO NEGOCIO */&#xA;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;-- Comer. + Micro. (525,526,524,501,504,506,505,509,507)&#xA;-- Consumo (510,511,512,515)&#xA;-- Vivienda (519,520,521,522,523)&#xA;-- Vehiculos (513,514)&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;select&#xA;Estado=CpEstadoProducto,--ccClasificacionEstado, /**/&#xA;OrdenN1=case when ccFamiliaProducto like '%Titularizada%' then @TitularizadaN1 else cc.ccOrdenAgrupacion end,   -- Control para obtener el orden de Titularizada y Situarlo dentro de Cartera Titularizada&#xA;OrdenN2=case when ccFamiliaProducto like '%Titularizada%' then @TitularizadaN2 else cc.ccOrdenAgrupacionN2 end,&#xA;OrdenN3=ca.caOrdenCanal,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=cc.ccGrupo,&#xA;Nivel3='     '+ca.caAgrupacion,&#xA;Nivel4='     '+ca.caAgrupacion,--no debe ir covid para presupuesto&#xA;Nivel5='     '+ca.caAgrupacion,--no debe ir covid para presupuesto&#xA;RealHoy=0,&#xA;DenominadorHoy=0,&#xA;RealAyer=0,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,&#xA;DenominadorPresupuesto=0&#xA;from DWHPresupuestoNegocio pn&#xA;inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador in (120,121,122,126)&#xA;and p2.CpCodigoIndicador not in (513,514)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where pn.pnIdFecha in (@FechAct)&#xA;and ca.caEstado=1&#xA;group by&#xA;cp.CpEstadoProducto, --ccClasificacionEstado, /**/&#xA;cc.ccOrdenAgrupacion,&#xA;ca.caOrdenCanal,&#xA;cc.ccOrdenAgrupacionN2,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cc.ccFamiliaProducto,&#xA;cc.ccGrupo,&#xA;ca.caAgrupacion --202842&#xA;&#xA;Union All&#xA;&#xA;-----------------&#xA;-- Agrupaciones&#xA;-----------------&#xA;&#xA;select&#xA;Estado=CpEstadoProducto,--ccClasificacionEstado, /**/&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=cc.ccOrdenAgrupacionN3,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=cc.ccGrupo,&#xA;Nivel3=cc.ccSubGrupo,&#xA;Nivel4=cc.ccSubGrupo,&#xA;Nivel5=cc.ccSubGrupo,&#xA;RealHoy=0,&#xA;DenominadorHoy=0,&#xA;RealAyer=0,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,&#xA;DenominadorPresupuesto=0&#xA;from DWHPresupuestoNegocio pn&#xA;inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador in (120,121,122,126)&#xA;and p2.CpCodigoIndicador not in (513,514)&#xA;and p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where pn.pnIdFecha in (@FechAct)&#xA;and ca.caEstado=1&#xA;group by&#xA;cp.CpEstadoProducto, --ccClasificacionEstado, /**/&#xA;cc.ccOrdenAgrupacion,&#xA;cc.ccOrdenAgrupacionN2,&#xA;cc.ccOrdenAgrupacionN3,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cc.ccFamiliaProducto,&#xA;cc.ccGrupo,&#xA;cc.ccSubGrupo --202848&#xA;&#xA;Union All&#xA;&#xA;--- Valor deduccion agrupaciones&#xA;&#xA;select&#xA;Estado=CpEstadoProducto,--ccClasificacionEstado, /**/&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=cc.ccOrdenAgrupacionN3,&#xA;Jerarquia=2,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=cc.ccGrupo,&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;RealHoy=0,&#xA;DenominadorHoy=0,&#xA;RealAyer=0,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=(sum(isnull(pn.pnValorPresupuesto,0))/1000)*-1,&#xA;DenominadorPresupuesto=0&#xA;from DWHPresupuestoNegocio pn&#xA;inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador in (120,121,122,126)&#xA;and p2.CpCodigoIndicador not in (513,514)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where pn.pnIdFecha in (@FechAct)&#xA;and ca.caEstado=1&#xA;group by&#xA;cp.CpEstadoProducto, --ccClasificacionEstado, /**/&#xA;cc.ccOrdenAgrupacion,&#xA;cc.ccOrdenAgrupacionN2,&#xA;cc.ccOrdenAgrupacionN3,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cc.ccFamiliaProducto,&#xA;cc.ccGrupo --202854&#xA;&#xA;Union All&#xA;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;-- T. Credito&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;select&#xA;Estado=CpEstadoProducto,--ccClasificacionEstado, /**/&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=ca.caOrdenCanal,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=cc.ccGrupo,&#xA;Nivel3='     '+ca.caAgrupacion,&#xA;Nivel4='     '+ca.caAgrupacion,-- no debe ir covid&#xA;Nivel5='     '+ca.caAgrupacion,-- no debe ir covid&#xA;RealHoy=0,&#xA;DenominadorHoy=0,&#xA;RealAyer=0,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,&#xA;DenominadorPresupuesto=0&#xA;from DWHPresupuestoNegocio pn&#xA;inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador in (124)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where pn.pnIdFecha in (@FechAct)&#xA;and ca.caEstado=1&#xA;group by&#xA;cp.CpEstadoProducto, --ccClasificacionEstado, /**/&#xA;ca.caOrdenCanal,&#xA;cc.ccOrdenAgrupacion,&#xA;cc.ccOrdenAgrupacionN2,&#xA;cc.ccOrdenAgrupacionN3,&#xA;cc.ccFamiliaProducto,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cc.ccGrupo,&#xA;ca.caAgrupacion&#xA;&#xA;Union All&#xA;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;-- Vehiculos&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;select&#xA;Estado=CpEstadoProducto,--ccClasificacionEstado, /**/&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=8,&#xA;OrdenN3=ca.caOrdenCanal,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2= 'Vehiculos',&#xA;Nivel3='     '+ca.caAgrupacion,&#xA;Nivel4='     '+ca.caAgrupacion,-- no debe ir covid&#xA;Nivel5='     '+ca.caAgrupacion,-- no debe ir covid&#xA;RealHoy=0,&#xA;DenominadorHoy=0,&#xA;RealAyer=0,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,&#xA;DenominadorPresupuesto=0&#xA;from DWHPresupuestoNegocio pn&#xA;inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable -- where ccgrupo like '%veh%' --ccCodigoNivel6 in (140280206011,141280202011)&#xA;inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal&#xA;inner join DWDProducto p on pn.pnIdProducto=p.prIdProducto&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end /**/&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador = 121&#xA;and p2.CpCodigoIndicador in (513,514)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where pn.pnIdFecha in (@FechAct)&#xA;and ca.caEstado=1&#xA;group by&#xA;cp.CpEstadoProducto, --ccClasificacionEstado, /**/&#xA;cc.ccOrdenAgrupacion,&#xA;cc.ccOrdenAgrupacionN2,&#xA;ca.caOrdenCanal,&#xA;ccOrdenAgrupacion,&#xA;cc.ccFamiliaProducto,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;p.prVehiculo,&#xA;ca.caAgrupacion --202857 OK&#xA;&#xA;&#xA;if OBJECT_ID('[tempdb]..#hoja') is not null&#xA;begin&#xA;drop table #hoja&#xA;end&#xA;&#xA;&#xA;/* ------------------------------------------------------------------------ */&#xA;/*                       CAPTACIONES                                        */&#xA;/* ------------------------------------------------------------------------ */&#xA;&#xA;-- Monetarios (98, 100,55,54,99)&#xA;-- Ahorros (247,600,601)&#xA;-- Plazo (602, 603, 604, 605, 606, 607)&#xA;&#xA;select&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=caOrdenCanal,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='SI',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=left(cc.ccGrupo+SPACE(70),70)+'X'+right('0'+cast(cc.ccOrdenAgrupacion as varchar(10)),2)+right('0'+ cast(cc.ccOrdenAgrupacionN2 as varchar(10)),2)+'X',&#xA;Nivel3='     '+ca.caAgrupacion,&#xA;Nivel4='     '+ca.caAgrupacion,&#xA;Nivel5='     '+ca.caAgrupacion,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case po.poIdFecha when @FechAct then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case po.poIdFecha when @FechaAyer then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case po.poIdFecha when @FechaMesAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case po.poIdFecha when @FechaAnioAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;into #hoja&#xA;from #DWHPasivoOperacion po&#xA;inner join #DWDCuentaContable cc on po.poIdCuentaContable=ccIdCuentaContable&#xA;inner join DWDCliente cl on po.poIdCliente=clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 2&#xA;and p1.CpCodigoIndicador in (140,141,142)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where po.poIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)&#xA;and ca.caEstado=1&#xA;and cl.clFechaFin is null&#xA;group by&#xA;cc.ccOrdenAgrupacion,&#xA;cc.ccOrdenAgrupacionN2,&#xA;ca.caOrdenCanal,&#xA;ca.caAgrupacion,&#xA;cc.ccFamiliaProducto,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cc.ccGrupo,&#xA;po.poIdFecha&#xA;&#xA;Union all&#xA;&#xA;-- Platinum(99); Ctas.Rentables(98) ; Ints.Financieras(54)&#xA;-- Depósitos QGI(55) ; Depósitos QNGI(100); Ahorro Tradicional(600)&#xA;-- Ahorro Programado(247); Inversion Empresarial(601); De 1 a 30 Dias (602)&#xA;-- De 31 a 90 Dias(603);  De 91 a 180 Dias(604)&#xA;-- De 181 a 360 Dias (605); Mas de 360 Dias (606)&#xA;-- Restringidos (607)&#xA;&#xA;select&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=cc.ccOrdenAgrupacionN3,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='SI',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=left(cc.ccGrupo+space(70),70)+'X'+right('0'+cast(cc.ccOrdenAgrupacion as varchar(10)),2)+right('0'+ cast(cc.ccOrdenAgrupacionN2 as varchar(10)),2)+'X',&#xA;Nivel3=cc.ccSubGrupo,&#xA;Nivel4=cc.ccSubGrupo,&#xA;Nivel5=cc.ccSubGrupo,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case po.poIdFecha when @FechAct then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case po.poIdFecha when @FechaAyer then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case po.poIdFecha when @FechaMesAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case po.poIdFecha when @FechaAnioAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHPasivoOperacion po&#xA;inner join #DWDCuentaContable cc on po.poIdCuentaContable=ccIdCuentaContable&#xA;inner join DWDCliente cl on po.poIdCliente=clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 2&#xA;and p1.CpCodigoIndicador in (140,141,142)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where po.poIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)&#xA;and ca.caEstado=1&#xA;and cl.clFechaFin is null&#xA;group by&#xA;cc.ccFamiliaProducto,&#xA;cc.ccGrupo,&#xA;cc.ccSubGrupo,&#xA;cc.ccOrdenAgrupacion,&#xA;cc.ccOrdenAgrupacionN2,&#xA;cc.ccOrdenAgrupacionN3,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;ca.caAgrupacion,&#xA;po.poIdFecha&#xA;&#xA;Union all&#xA;&#xA;--------&gt;&gt; Valor Deduccion&#xA;&#xA;select&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=cc.ccOrdenAgrupacionN3,&#xA;Jerarquia=2,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='SI',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=left(cc.ccGrupo+space(70),70)+'X'+right('0'+cast(cc.ccOrdenAgrupacion as varchar(10)),2)+right('0'+ cast(cc.ccOrdenAgrupacionN2 as varchar(10)),2)+'X',&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case po.poIdFecha when @FechAct then (sum(isnull(po.poSaldoOperacionUSD,0))/1000)*-1 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case po.poIdFecha when @FechaAyer then (sum(isnull(po.poSaldoOperacionUSD,0))/1000)*-1 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case po.poIdFecha when @FechaMesAnt then (sum(isnull(po.poSaldoOperacionUSD,0))/1000)*-1 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case po.poIdFecha when @FechaAnioAnt then (sum(isnull(po.poSaldoOperacionUSD,0))/1000)*-1 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHPasivoOperacion po&#xA;inner join #DWDCuentaContable cc on po.poIdCuentaContable=ccIdCuentaContable&#xA;inner join DWDCliente cl on po.poIdCliente=clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 2&#xA;and p1.CpCodigoIndicador in (140,141,142)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where po.poIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)&#xA;and ca.caEstado=1&#xA;and cl.clFechaFin is null&#xA;group by&#xA;cc.ccFamiliaProducto,&#xA;cc.ccGrupo,&#xA;cc.ccSubGrupo,&#xA;cc.ccOrdenAgrupacion,&#xA;cc.ccOrdenAgrupacionN2,&#xA;cc.ccOrdenAgrupacionN3,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;ca.caAgrupacion,&#xA;po.poIdFecha&#xA;&#xA;Union all&#xA;&#xA;/* Presupuesto Negocio */&#xA;&#xA;-- Monetarios (98, 100,55,54,99)&#xA;-- Ahorros (247,600,601)&#xA;-- Plazo (602, 603, 604, 605, 606, 607)&#xA;&#xA;select&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=ca.caOrdenCanal,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='SI',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=left(cc.ccGrupo+space(70),70)+'X'+right('0'+cast(cc.ccOrdenAgrupacion as varchar(10)),2)+right('0'+ cast(cc.ccOrdenAgrupacionN2 as varchar(10)),2)+'X',&#xA;Nivel3='     '+ca.caAgrupacion,&#xA;Nivel4='     '+ca.caAgrupacion,&#xA;Nivel5='     '+ca.caAgrupacion,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=0,&#xA;DenominadorHoy=0,&#xA;RealAyer=0,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,&#xA;DenominadorPresupuesto=0&#xA;from DWHPresupuestoNegocio pn&#xA;inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 2&#xA;and p1.CpCodigoIndicador in (140,141,142)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where pn.pnIdFecha in (@FechAct)&#xA;and ca.caEstado=1&#xA;and pn.pnIdIndicadorMedidaFinanciera=-10&#xA;group by&#xA;cc.ccOrdenAgrupacion,&#xA;cc.ccOrdenAgrupacionN2,&#xA;cc.ccOrdenAgrupacionN3,&#xA;cc.ccFamiliaProducto,&#xA;cc.ccGrupo,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;ca.caOrdenCanal,&#xA;ca.caAgrupacion&#xA;&#xA;Union all&#xA;&#xA;-- Platinum(99); Ctas.Rentables(98) ; Ints.Financieras(54)&#xA;-- Depósitos QGI(55) ; Depósitos QNGI(100); Ahorro Tradicional(600)&#xA;-- Ahorro Programado(247); Inversion Empresarial(601); De 1 a 30 Dias (602)&#xA;-- De 31 a 90 Dias(603);  De 91 a 180 Dias(604)&#xA;-- De 181 a 360 Dias (605); Mas de 360 Dias (606)&#xA;-- Restringidos (607)&#xA;&#xA;select&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=cc.ccOrdenAgrupacionN3,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='SI',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=left(cc.ccGrupo+space(70),70)+'X'+right('0'+cast(cc.ccOrdenAgrupacion as varchar(10)),2)+right('0'+ cast(cc.ccOrdenAgrupacionN2 as varchar(10)),2)+'X',&#xA;Nivel3=cc.ccSubGrupo,&#xA;Nivel4=cc.ccSubGrupo,&#xA;Nivel5=cc.ccSubGrupo,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=0,&#xA;DenominadorHoy=0,&#xA;RealAyer=0,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,&#xA;DenominadorPresupuesto=0&#xA;from DWHPresupuestoNegocio pn&#xA;inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 2&#xA;and p1.CpCodigoIndicador in (140,141,142)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where pn.pnIdFecha in (@FechAct)&#xA;and ca.caEstado=1&#xA;and pn.pnIdIndicadorMedidaFinanciera=-10&#xA;group by&#xA;cc.ccOrdenAgrupacion,&#xA;cc.ccOrdenAgrupacionN2,&#xA;cc.ccOrdenAgrupacionN3,&#xA;cc.ccFamiliaProducto,&#xA;cc.ccCodigoIndicador,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cc.ccGrupo,&#xA;cc.ccSubGrupo&#xA;&#xA;Union all&#xA;&#xA;----- &gt;&gt; Valor Deduccion Presupuesto Productos&#xA;&#xA;select&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=cc.ccOrdenAgrupacionN3,&#xA;Jerarquia=2,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='SI',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=left(cc.ccGrupo+space(70),70)+'X'+right('0'+cast(cc.ccOrdenAgrupacion as varchar(10)),2)+right('0'+ cast(cc.ccOrdenAgrupacionN2 as varchar(10)),2)+'X',&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=0,&#xA;DenominadorHoy=0,&#xA;RealAyer=0,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=(sum(isnull(pn.pnValorPresupuesto,0))/1000)*-1,&#xA;DenominadorPresupuesto=0&#xA;from DWHPresupuestoNegocio pn&#xA;inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 2&#xA;and p1.CpCodigoIndicador in (140,141,142)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where pn.pnIdFecha in (@FechAct)&#xA;and ca.caEstado=1&#xA;and pn.pnIdIndicadorMedidaFinanciera=-10&#xA;group by&#xA;cc.ccOrdenAgrupacion,&#xA;cc.ccOrdenAgrupacionN2,&#xA;cc.ccOrdenAgrupacionN3,&#xA;cc.ccFamiliaProducto,&#xA;cc.ccCodigoIndicador,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cc.ccGrupo,&#xA;cc.ccSubGrupo&#xA;&#xA;Union all&#xA;&#xA;-------------------------------------&#xA;--        Concentracion            --&#xA;-------------------------------------&#xA;&#xA;select&#xA;OrdenN1=@OrdenCaptacionConcetracion,&#xA;OrdenN2=Orden,&#xA;OrdenN3=Orden,&#xA;Jerarquia=2,&#xA;Canal='Otr.Dep y Obl.Fin',&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=@Nivel1,&#xA;Nivel2=Nivel,&#xA;Nivel3=Nivel,&#xA;Nivel4=Nivel,&#xA;Nivel5=Nivel,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=sum(RealHoy),&#xA;DenominadorHoy=0,&#xA;RealAyer=sum(RealAyer),&#xA;DenominadorAyer=0,&#xA;RealMesAnt=sum(RealMesAnt),&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=sum(RealAnioAnt),&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from&#xA;(&#xA;select&#xA;Orden=&#xA;case ppCodigoProducto&#xA;when 39 then @OrdenCaptacionConcetracionN2+1&#xA;when 40 then @OrdenCaptacionConcetracionN2+2&#xA;when 41 then @OrdenCaptacionConcetracionN2+3 end,&#xA;Nivel=&#xA;case ppCodigoProducto&#xA;when 39 then 'Concentración 100'&#xA;when 40 then 'Concentración 50'&#xA;when 41 then 'Concentración 25' end,&#xA;RealHoy=case ppFecha when @FechAct then sum(isnull(ppPronostico,0)) else 0 end,&#xA;RealAyer=case ppFecha when @FechaAyer then sum(isnull(ppPronostico,0)) else 0 end,&#xA;RealMesAnt=case ppFecha when @FechaMesAnt then sum(isnull(ppPronostico,0)) else 0 end,&#xA;RealAnioAnt=case ppFecha when @FechaAnioAnt then sum(isnull(ppPronostico,0)) else 0 end&#xA;from DWDPronosticoProducto&#xA;where ppCodigoProducto in (39,40,41)&#xA;group by ppFecha,&#xA;ppCodigoProducto&#xA;) Concentracion&#xA;group by Orden,&#xA;Nivel&#xA;&#xA;&#xA;Union all&#xA;&#xA;------&gt;&gt;&gt; Valor Deduccion&#xA;&#xA;select&#xA;OrdenN1=@OrdenCaptacionConcetracion,&#xA;OrdenN2=Orden,&#xA;OrdenN3=Orden,&#xA;Jerarquia=1,&#xA;Canal='Otr.Dep y Obl.Fin',&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=@Nivel1,&#xA;Nivel2='Deducción',&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=sum(RealHoy)*-1,&#xA;DenominadorHoy=0,&#xA;RealAyer=sum(RealAyer)*-1,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=sum(RealMesAnt)*-1,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=sum(RealAnioAnt)*-1,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from&#xA;(&#xA;select&#xA;Orden=&#xA;case ppCodigoProducto&#xA;when 39 then @OrdenCaptacionConcetracionN2+1&#xA;when 40 then @OrdenCaptacionConcetracionN2+2&#xA;when 41 then @OrdenCaptacionConcetracionN2+3 end,&#xA;Nivel=&#xA;case ppCodigoProducto&#xA;when 39 then 'Concentración 100'&#xA;when 40 then 'Concentración 50'&#xA;when 41 then 'Concentración 25' end,&#xA;RealHoy=case ppFecha when @FechAct then sum(isnull(ppPronostico,0)) else 0 end,&#xA;RealAyer=case ppFecha when @FechaAyer then sum(isnull(ppPronostico,0)) else 0 end,&#xA;RealMesAnt=case ppFecha when @FechaMesAnt then sum(isnull(ppPronostico,0)) else 0 end,&#xA;RealAnioAnt=case ppFecha when @FechaAnioAnt then sum(isnull(ppPronostico,0)) else 0 end&#xA;from DWDPronosticoProducto&#xA;where ppCodigoProducto in (39,40,41)&#xA;group by ppFecha,&#xA;ppCodigoProducto&#xA;) Concentracion&#xA;group by Orden,&#xA;Nivel&#xA;&#xA;Union all&#xA;&#xA;/* //////////////////////////////////////// */&#xA;/*      CAPTACIONES - CANAL                 */&#xA;/* //////////////////////////////////////// */&#xA;&#xA;-- Canal Comercial por Region Agencia (1,8,5,9,12,13)&#xA;-- Canal Corporativo por Asesor (10)&#xA;-- Canal Especializada por Subcanal (7,15,17,11)&#xA;-- Canal Tesoreria por Region Agencia (14)&#xA;&#xA;select&#xA;OrdenN1=@OrdenCaptacionCanal,&#xA;OrdenN2=ca.caOrdenCanal,&#xA;OrdenN3=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4) then&#xA;case when ag.agNombreRegion like '%SIN%REGION%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 1000 else ag.agOrdenRegionAsesor end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then&#xA;case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 1000 else asOrdenAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then caOrdenDescripcionCanal&#xA;else 1000&#xA;end,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Canal',&#xA;Nivel2=ca.caAgrupacion,&#xA;Nivel3=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4) then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then&#xA;case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;Nivel4=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then&#xA;case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;Nivel5=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then&#xA;case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case po.poIdFecha when @FechAct then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case po.poIdFecha when @FechaAyer then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case po.poIdFecha when @FechaMesAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case po.poIdFecha when @FechaAnioAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHPasivoOperacion po&#xA;inner join #DWDCuentaContable cc on po.poIdCuentaContable=ccIdCuentaContable&#xA;inner join DWDCliente cl on po.poIdCliente=clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia&#xA;inner join DWDAsesorOperacion ao on cl.clIdAsesorPrincipal=ao.asIdAsesor&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 2&#xA;and p1.CpCodigoIndicador in (140,141,142)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where po.poIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)&#xA;and ca.caEstado=1&#xA;group by&#xA;ag.agOrdenRegionAsesor,&#xA;ao.asOrdenAsesor,&#xA;ca.caOrdenDescripcionCanal,&#xA;ca.caOrdenCanal,&#xA;cc.ccFamiliaProducto,&#xA;ca.caAgrupacion,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;ag.agNombreRegion,&#xA;ao.asNombreAsesor,&#xA;ca.caDescripcionCanal,&#xA;ao.asAsesorPrincipal,&#xA;ca.caCodDescripcionAgrupacionCanal,&#xA;po.poIdFecha,&#xA;cl.clCodigoCliente&#xA;&#xA;Union all&#xA;&#xA;/* Presupuesto Operacion */&#xA;&#xA;select&#xA;OrdenN1=@OrdenCaptacionCanal,&#xA;OrdenN2=ca.caOrdenCanal,&#xA;OrdenN3=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%REGION%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 1000 else ag.agOrdenRegionAsesor end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then&#xA;case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 1000 else asOrdenAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then caOrdenDescripcionCanal&#xA;else 1000&#xA;end,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Canal',&#xA;Nivel2=ca.caAgrupacion,&#xA;Nivel3=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then&#xA;case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;Nivel4=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then&#xA;case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;Nivel5=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then&#xA;case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=0,&#xA;DenominadorHoy=0,&#xA;RealAyer=0,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,&#xA;DenominadorPresupuesto=0&#xA;from DWHPresupuestoNegocio pn&#xA;inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal&#xA;inner join DWDAgenciaOperacion ag on pn.pnIdAgencia=ag.agIdAgencia&#xA;inner join DWDAsesorOperacion ao on pn.pnIdAsesor=ao.asIdAsesor&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 2&#xA;and p1.CpCodigoIndicador in (140,141,142)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where pn.pnIdFecha in (@FechAct)&#xA;and ca.caEstado=1&#xA;and pn.pnIdIndicadorMedidaFinanciera=-10&#xA;group by cc.ccFamiliaProducto,&#xA;ca.caOrdenCanal,&#xA;agOrdenRegionAsesor,&#xA;caOrdenDescripcionCanal,&#xA;asOrdenAsesor,&#xA;ca.caDescripcionCanal,&#xA;ca.caCodDescripcionAgrupacionCanal,&#xA;ca.caAgrupacion,&#xA;ag.agNombreRegion,&#xA;ao.asAsesorPrincipal,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;ao.asNombreAsesor,&#xA;ca.caDescripcionCanal&#xA;&#xA;Union all&#xA;&#xA;/* //////////////////////////////////////// */&#xA;/*     CAPTACIONES - SEGMENTACION           */&#xA;/* //////////////////////////////////////// */&#xA;&#xA;-- NATURALES (4,5,6,7,8,9,10)&#xA;-- JURIDICOS (11,12,13,14,15,16,17,18,19)&#xA;-- SIN PERFIL (1,2,3)&#xA;&#xA;select&#xA;OrdenN1=@OrdenCaptacionSegmentacion,&#xA;OrdenN2=sc.scSegmentacionOrdenN2,&#xA;OrdenN3=scSegmentacionOrdenN3,&#xA;Jerarquia=&#xA;case&#xA;when sc.scIdCodigo in (11,12,13,14,15,16,17,18,19) then 3&#xA;when sc.scIdCodigo in (4,5,6,7,8,9,10) then 5&#xA;else 2&#xA;end,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel2=sc.scSegmentacionTipo,&#xA;Nivel3=&#xA;case&#xA;when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo&#xA;else sc.scSegmentacion&#xA;end,&#xA;Nivel4=&#xA;case&#xA;when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo&#xA;else sc.scDetalleNombre&#xA;end,&#xA;Nivel5=&#xA;case&#xA;when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo&#xA;when sc.scIdCodigo in (11,12,13,14,15,16,17,18,19) then sc.scDetalleNombre&#xA;else v.vcVinculacionAgrupacion&#xA;end,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case po.poIdFecha when @FechAct then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case po.poIdFecha when @FechaAyer then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case po.poIdFecha when @FechaMesAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case po.poIdFecha when @FechaAnioAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHPasivoOperacion po&#xA;inner join #DWDCuentaContable cc on po.poIdCuentaContable=ccIdCuentaContable&#xA;inner join DWDCliente cl on po.poIdCliente=clIdCliente&#xA;inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente&#xA;inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 2&#xA;and p1.CpCodigoIndicador in (140,141,142)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where po.poIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)&#xA;and cl.clfechafin is null&#xA;and ca.caEstado=1&#xA;group by cc.ccFamiliaProducto,&#xA;sc.scSegmentacionOrdenN2,&#xA;sc.scSegmentacionOrdenN3,&#xA;sc.scIdCodigo,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cl.clIdSegmentacionCliente,&#xA;clCodigoCliente,&#xA;po.poIdFecha,&#xA;sc.scSegmentacionTipo,&#xA;sc.scSegmentacion,&#xA;sc.scDetalleNombre,&#xA;v.vcVinculacionAgrupacion&#xA;&#xA;Union all&#xA;&#xA;---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;-- Alta y Baja Vinculacion&#xA;-- para Natural y Juridico&#xA;---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;select&#xA;OrdenN1=@OrdenCaptacionSegmentacion,&#xA;OrdenN2=sc.scSegmentacionOrdenN2,&#xA;OrdenN3=v.vcOrdenVinculacion,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel2=sc.scSegmentacionTipo,&#xA;Nivel3=v.vcVinculacionAgrupacion,&#xA;Nivel4=v.vcVinculacionAgrupacion,&#xA;Nivel5=v.vcVinculacionAgrupacion,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case po.poIdFecha when @FechAct then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case po.poIdFecha when @FechaAyer then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case po.poIdFecha when @FechaMesAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case po.poIdFecha when @FechaAnioAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHPasivoOperacion po&#xA;inner join #DWDCuentaContable cc on po.poIdCuentaContable=ccIdCuentaContable&#xA;inner join DWDCliente cl on po.poIdCliente=clIdCliente&#xA;inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente&#xA;inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 2&#xA;and p1.CpCodigoIndicador in (140,141,142)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where po.poIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)&#xA;and cl.clFechaFin is null&#xA;and ca.caEstado=1&#xA;and sc.scIdCodigo not in (1,2,3)&#xA;group by cc.ccFamiliaProducto,&#xA;sc.scIdCodigo,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;sc.scSegmentacionOrdenN2,&#xA;sc.scSegmentacionTipo,&#xA;v.vcOrdenVinculacion,&#xA;v.vcVinculacionAgrupacion,&#xA;po.poIdFecha&#xA;&#xA;Union all&#xA;&#xA;-- Valor Deduccion Alta y Baja Vinculacion para Natural y Juridico&#xA;&#xA;select&#xA;OrdenN1=@OrdenCaptacionSegmentacion,&#xA;OrdenN2=sc.scSegmentacionOrdenN2,&#xA;OrdenN3=v.vcOrdenVinculacion,&#xA;Jerarquia=2,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel2=sc.scSegmentacionTipo,&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case po.poIdFecha when @FechAct then (sum(isnull(po.poSaldoOperacionUSD,0))/1000)*-1 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case po.poIdFecha when @FechaAyer then (sum(isnull(po.poSaldoOperacionUSD,0))/1000)*-1 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case po.poIdFecha when @FechaMesAnt then (sum(isnull(po.poSaldoOperacionUSD,0))/1000)*-1 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case po.poIdFecha when @FechaAnioAnt then (sum(isnull(po.poSaldoOperacionUSD,0))/1000)*-1 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHPasivoOperacion po&#xA;inner join #DWDCuentaContable cc on po.poIdCuentaContable=ccIdCuentaContable&#xA;inner join DWDCliente cl on po.poIdCliente=clIdCliente&#xA;inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente&#xA;inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 2&#xA;and p1.CpCodigoIndicador in (140,141,142)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where po.poIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)&#xA;and cl.clFechaFin is null&#xA;and ca.caEstado=1&#xA;and sc.scIdCodigo not in (1,2,3)&#xA;group by cc.ccFamiliaProducto,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;sc.scSegmentacionOrdenN2,&#xA;sc.scSegmentacionTipo,&#xA;v.vcOrdenVinculacion,&#xA;po.poIdFecha&#xA;&#xA;Union all&#xA;&#xA;/* Presupuesto Negocio*/&#xA;&#xA;select&#xA;OrdenN1=@OrdenCaptacionSegmentacion,&#xA;OrdenN2=1,&#xA;OrdenN3=1,&#xA;Jerarquia=1,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel2=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel3=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel4=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel5=cc.ccFamiliaProducto+'-Segm',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=0,&#xA;DenominadorHoy=0,&#xA;RealAyer=0,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,&#xA;DenominadorPresupuesto=0&#xA;from DWHPresupuestoNegocio pn&#xA;inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal&#xA;inner join DWDAgenciaOperacion ag on pn.pnIdAgencia=ag.agIdAgencia&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 2&#xA;and p1.CpCodigoIndicador in (140,141,142)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where pn.pnIdFecha in (@FechAct)&#xA;and ca.caEstado=1&#xA;and pn.pnIdIndicadorMedidaFinanciera=-10&#xA;group by cc.ccFamiliaProducto,&#xA;ca.caDescripcionAgrupacionCanal&#xA;&#xA;Union all&#xA;&#xA;/* //////////////////////////////////////// */&#xA;/*           OTROS DEPOSITOS               */&#xA;/*           OBLIGACIONES FINANCIERAS       */&#xA;/* //////////////////////////////////////// */&#xA;&#xA;select&#xA;OrdenN1=ccOrdenAgrupacion,&#xA;OrdenN2=ccOrdenAgrupacionN2,&#xA;OrdenN3=ccOrdenAgrupacionN2,&#xA;Jerarquia=1,&#xA;Canal='Otr.Dep y Obl.Fin',&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=ccFamiliaProducto,&#xA;Nivel2=ccFamiliaProducto,&#xA;Nivel3=ccFamiliaProducto,&#xA;Nivel4=ccFamiliaProducto,&#xA;Nivel5=ccFamiliaProducto,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case bs.bsIdFecha when @FechAct then sum(bs.bsSaldoDolarizado)/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case bs.bsIdFecha when @FechaAyer then sum(bs.bsSaldoDolarizado)/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case bs.bsIdFecha when @FechaMesAnt then sum(bs.bsSaldoDolarizado)/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case bs.bsIdFecha when @FechaAnioAnt then sum(bs.bsSaldoDolarizado)/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,-- el presupuesto va a ser igual a hoy&#xA;DenominadorPresupuesto=0&#xA;from DWHBalanceSaldo bs&#xA;inner join #DWDCuentaContable cc on bs.bsIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 2&#xA;and p1.CpCodigoIndicador in (143,144)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where bs.bsIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;group by bs.bsIdFecha,&#xA;ccOrdenAgrupacion,&#xA;ccOrdenAgrupacionN2,&#xA;ccFamiliaProducto&#xA;&#xA;Union all&#xA;&#xA;/*Prespuesto Negocio*/&#xA;&#xA;select&#xA;OrdenN1=ccOrdenAgrupacion,&#xA;OrdenN2=ccOrdenAgrupacionN2,&#xA;OrdenN3=ccOrdenAgrupacionN2,&#xA;Jerarquia=1,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=cc.ccFamiliaProducto,&#xA;Nivel3=cc.ccFamiliaProducto,&#xA;Nivel4=cc.ccFamiliaProducto,&#xA;Nivel5=cc.ccFamiliaProducto,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=0,&#xA;DenominadorHoy=0,&#xA;RealAyer=0,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,&#xA;DenominadorPresupuesto=0&#xA;from DWHPresupuestoNegocio pn&#xA;inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 2&#xA;and p1.CpCodigoIndicador in (143,144)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where pn.pnIdFecha in (@FechAct)&#xA;and cc.ccCodigoMoneda='USD'&#xA;and pn.pnIdIndicadorMedidaFinanciera=-10&#xA;group by cc.ccFamiliaProducto,&#xA;ccOrdenAgrupacion,&#xA;ccOrdenAgrupacionN2,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cccodigonivel6 --2746514&#xA;&#xA;Union  all&#xA;&#xA;/* ----------------------------------------------------------------------------------------------- */&#xA;/*                                      CARTERA                                                    */&#xA;/* ----------------------------------------------------------------------------------------------- */&#xA;&#xA;select&#xA;OrdenN1,&#xA;OrdenN2,&#xA;OrdenN3,&#xA;Jerarquia,&#xA;Canal,&#xA;Division,&#xA;Consolidado=case when Nivel2 like '%C.%Titularizada%' then 'NO' else 'SI' end,&#xA;Nivel1,&#xA;Nivel2=&#xA;case&#xA;when Nivel2 like '%C.%Titularizada%' then Nivel2&#xA;else left(Nivel2+space(70),70)+'X'+right('0'+cast(isnull(OrdenN1,'') as varchar(10)),2)+right('0'+ cast(isnull(OrdenN2,'') as varchar(10)),2)+'X'&#xA;end,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=sum(RealHoy),&#xA;DenominadorHoy=sum(DenominadorHoy),&#xA;RealAyer=sum(RealAyer),&#xA;DenominadorAyer=sum(DenominadorAyer),&#xA;RealMesAnt=sum(RealMesAnt),&#xA;DenominadorMesAnt=sum(DenominadorMesAnt),&#xA;RealAnioAnt=sum(RealAnioAnt),&#xA;DenominadorAnioAnt=sum(DenominadorAnioAnt),&#xA;ValorPresupuesto=sum(ValorPresupuesto),&#xA;DenominadorPresupuesto=sum(DenominadorPresupuesto)&#xA;from #Cartera&#xA;group by OrdenN1,&#xA;OrdenN2,&#xA;OrdenN3,&#xA;Estado,&#xA;Jerarquia,&#xA;Canal,&#xA;Division,&#xA;Nivel1,&#xA;Nivel2,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5&#xA;&#xA;Union All&#xA;&#xA;&#xA;---&gt;&gt;&gt;&gt;&gt;&gt;&gt;     CARTERA X VENCER&#xA;---&gt;&gt;&gt;&gt;&gt;&gt;&gt;     CARTERA EN DIFICULTADES&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;select&#xA;OrdenN1,&#xA;OrdenN2=&#xA;case when Estado='Vig' then 10&#xA;else 30 end,&#xA;OrdenN3,&#xA;Jerarquia, --Jerarquia=4 comente EA&#xA;Canal,&#xA;Division='NO',&#xA;Consolidado='SI',&#xA;Nivel1,&#xA;Nivel2=&#xA;case when Estado='Vig' then 'Cartera x Vencer'&#xA;else&#xA;left('Cartera en Dificultades'+space(70),70)+'X'+right('0'+cast(isnull(OrdenN1,'') as varchar(10)),2)+'13X'&#xA;end,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=sum(RealHoy),&#xA;DenominadorHoy=sum(DenominadorHoy),&#xA;RealAyer=sum(RealAyer),&#xA;DenominadorAyer=sum(DenominadorAyer),&#xA;RealMesAnt=sum(RealMesAnt),&#xA;DenominadorMesAnt=sum(DenominadorMesAnt),&#xA;RealAnioAnt=sum(RealAnioAnt),&#xA;DenominadorAnioAnt=sum(DenominadorAnioAnt),&#xA;ValorPresupuesto=sum(ValorPresupuesto),&#xA;DenominadorPresupuesto=sum(DenominadorPresupuesto)&#xA;from #Cartera&#xA;where Estado in ('Vig','Dif')&#xA;and Nivel3 like '%Canal%'&#xA;group by OrdenN1,&#xA;OrdenN3,&#xA;Estado,&#xA;Jerarquia,&#xA;Canal,&#xA;Nivel1,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5&#xA;&#xA;----&gt;&gt; Valor Deduccion&#xA;&#xA;Union all&#xA;&#xA;select&#xA;OrdenN1,&#xA;OrdenN2=9,&#xA;OrdenN3,&#xA;Jerarquia=1,&#xA;Canal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1,&#xA;Nivel2='Deducción',&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=sum(RealHoy)*-1,&#xA;DenominadorHoy=sum(DenominadorHoy)*-1,&#xA;RealAyer=sum(RealAyer)*-1,&#xA;DenominadorAyer=sum(DenominadorAyer)*-1,&#xA;RealMesAnt=sum(RealMesAnt)*-1,&#xA;DenominadorMesAnt=sum(DenominadorMesAnt)*-1,&#xA;RealAnioAnt=sum(RealAnioAnt)*-1,&#xA;DenominadorAnioAnt=sum(DenominadorAnioAnt)*-1,&#xA;ValorPresupuesto=sum(ValorPresupuesto)*-1,&#xA;DenominadorPresupuesto=sum(DenominadorPresupuesto)*-1&#xA;from #Cartera&#xA;where Estado in ('Vig','Dif')&#xA;and Nivel3 like '%Canal%'&#xA;group by OrdenN1,&#xA;OrdenN3,&#xA;Estado,&#xA;Nivel1,&#xA;Canal&#xA;&#xA;Union all&#xA;&#xA;&#xA;---&gt;&gt;&gt;&gt;&gt;&gt;      VIGENTE&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;      DIFICULTADES&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;-- Los Valores de deduccion por producto se encuentran en el query que obtiene la tabla #Cartera&#xA;&#xA;select&#xA;OrdenN1,&#xA;OrdenN2=&#xA;case when Estado='Vig' then OrdenN2+20&#xA;else  OrdenN2+40 end,&#xA;OrdenN3,&#xA;Jerarquia,&#xA;Canal,&#xA;Division,&#xA;Consolidado=case when (Nivel2 like '%C%Titularizada%')  then  'NO' else 'SI' end,---when (Nivel2 like '%T.%Credito%') or&#xA;Nivel1,&#xA;Nivel2=&#xA;case&#xA;when Estado='Vig' then  left((Estado+'. '+Nivel2+SPACE(70)),70)+'X'+right('0'+cast(OrdenN1 as varchar(10)),2)+right('0'+ cast(OrdenN2+20 as varchar(10)),2)+'X'&#xA;else left((Estado+'. '+Nivel2+SPACE(70)),70)+'X'+right('0'+cast(OrdenN1 as varchar(10)),2)+right('0'+ cast(OrdenN2+40 as varchar(10)),2)+'X'&#xA;end,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=sum(RealHoy),&#xA;DenominadorHoy=sum(DenominadorHoy),&#xA;RealAyer=sum(RealAyer),&#xA;DenominadorAyer=sum(DenominadorAyer),&#xA;RealMesAnt=sum(RealMesAnt),&#xA;DenominadorMesAnt=sum(DenominadorMesAnt),&#xA;RealAnioAnt=sum(RealAnioAnt),&#xA;DenominadorAnioAnt=sum(DenominadorAnioAnt),&#xA;ValorPresupuesto=sum(ValorPresupuesto),&#xA;DenominadorPresupuesto=sum(DenominadorPresupuesto)&#xA;from #Cartera&#xA;where Estado in ('Vig','Dif')&#xA;group by OrdenN1,&#xA;OrdenN2,&#xA;OrdenN3,&#xA;Estado,&#xA;Jerarquia,&#xA;Canal,&#xA;Division,&#xA;Nivel1,&#xA;Nivel2,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5&#xA;&#xA;Union all&#xA;&#xA;----&gt;&gt; Valor Deduccion&#xA;&#xA;select&#xA;OrdenN1,&#xA;OrdenN2=&#xA;case when Estado='Vig' then OrdenN2+20&#xA;else  OrdenN2+40 end,&#xA;OrdenN3,&#xA;Jerarquia=1,&#xA;Canal,&#xA;Division,&#xA;Consolidado='NO',&#xA;Nivel1,&#xA;Nivel2='Deducción',&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=sum(RealHoy)*-1,&#xA;DenominadorHoy=sum(DenominadorHoy)*-1,&#xA;RealAyer=sum(RealAyer)*-1,&#xA;DenominadorAyer=sum(DenominadorAyer)*-1,&#xA;RealMesAnt=sum(RealMesAnt)*-1,&#xA;DenominadorMesAnt=sum(DenominadorMesAnt)*-1,&#xA;RealAnioAnt=sum(RealAnioAnt)*-1,&#xA;DenominadorAnioAnt=sum(DenominadorAnioAnt)*-1,&#xA;ValorPresupuesto=sum(ValorPresupuesto)*-1,&#xA;DenominadorPresupuesto=sum(DenominadorPresupuesto)*-1&#xA;from #Cartera&#xA;where Estado in ('Vig','Dif')&#xA;group by OrdenN1,&#xA;OrdenN2,&#xA;OrdenN3,&#xA;Estado,&#xA;Canal,&#xA;Division,&#xA;Nivel1&#xA;&#xA;Union all&#xA;&#xA;/* ///////////////////////////////////////////////////// */&#xA;/*                                                       */&#xA;/*      Morosidad Ampliada Titularizada                  */&#xA;/*                                                       */&#xA;/* ///////////////////////////////////////////////////// */&#xA;&#xA;-----------------&#xA;-- Numerador Dif&#xA;-----------------&#xA;&#xA;select&#xA;OrdenN1,&#xA;OrdenN2=70,&#xA;OrdenN3,&#xA;Jerarquia=4,&#xA;Canal,&#xA;Division='SI',&#xA;Consolidado='NO',&#xA;Nivel1,&#xA;Nivel2='Morosidad Ampl. (-Tit.)',&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=sum(RealHoy),&#xA;DenominadorHoy=0,&#xA;RealAyer=sum(RealAyer),&#xA;DenominadorAyer=0,&#xA;RealMesAnt=sum(RealMesAnt),&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=sum(RealAnioAnt),&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(ValorPresupuesto),&#xA;DenominadorPresupuesto=0&#xA;from #Cartera&#xA;where Estado in ('Dif')&#xA;and Nivel3 like '%Canal%'&#xA;group by OrdenN1,&#xA;OrdenN3,&#xA;Canal,&#xA;Division,&#xA;Nivel1,&#xA;--Nivel2,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5&#xA;&#xA;union all&#xA;&#xA;--Valor Deduccion&#xA;&#xA;select&#xA;OrdenN1,&#xA;OrdenN2=70,&#xA;OrdenN3,&#xA;Jerarquia=1,&#xA;Canal,&#xA;Division='SI',&#xA;Consolidado='NO',&#xA;Nivel1,&#xA;Nivel2='Deducción',&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=sum(RealHoy)*-1,&#xA;DenominadorHoy=0,&#xA;RealAyer=sum(RealAyer)*-1,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=sum(RealMesAnt)*-1,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=sum(RealAnioAnt)*-1,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(ValorPresupuesto)*-1,&#xA;DenominadorPresupuesto=0&#xA;from #Cartera&#xA;where Estado in ('Dif')&#xA;and Nivel3 like '%Canal%'&#xA;group by OrdenN1,&#xA;OrdenN3,&#xA;Canal,&#xA;Division,&#xA;Nivel1,&#xA;Nivel2,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5&#xA;&#xA;union all&#xA;&#xA;--------------------&#xA;-- Denominador Total&#xA;--------------------&#xA;&#xA;select&#xA;OrdenN1,&#xA;OrdenN2=70,&#xA;OrdenN3,&#xA;Jerarquia=4,&#xA;Canal,&#xA;Division='SI',&#xA;Consolidado='NO',&#xA;Nivel1,&#xA;Nivel2='Morosidad Ampl. (-Tit.)',&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=0,&#xA;DenominadorHoy=sum(RealHoy),&#xA;RealAyer=0,&#xA;DenominadorAyer=sum(RealAyer),&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=sum(RealMesAnt),&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=sum(RealAnioAnt),&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=sum(ValorPresupuesto)&#xA;from #Cartera&#xA;where Nivel3 like '%Canal%'&#xA;group by OrdenN1,&#xA;OrdenN3,&#xA;Canal,&#xA;Division,&#xA;Nivel1,&#xA;--Nivel2,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5&#xA;&#xA;Union all&#xA;&#xA;-- Valor deduccion (NO se le multiplica por -1 por la division)&#xA;&#xA;select&#xA;OrdenN1,&#xA;OrdenN2=70,&#xA;OrdenN3,&#xA;Jerarquia=1,&#xA;Canal,&#xA;Division='SI',&#xA;Consolidado='NO',&#xA;Nivel1,&#xA;Nivel2='Deducción',&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=0,&#xA;DenominadorHoy=sum(RealHoy),&#xA;RealAyer=0,&#xA;DenominadorAyer=sum(RealAyer),&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=sum(RealMesAnt),&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=sum(RealAnioAnt),&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=sum(ValorPresupuesto)&#xA;from #Cartera&#xA;where Nivel3 like '%Canal%'&#xA;group by OrdenN1,&#xA;OrdenN3,&#xA;Canal,&#xA;Division,&#xA;Nivel1,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5&#xA;&#xA;Union all&#xA;&#xA;/* /////////////////////////////////////////////// */&#xA;/*                                                 */&#xA;/*  MOROSIDAD AMPLIADA - AGRUPACION POR CANALES    */&#xA;/*                                                 */&#xA;/* /////////////////////////////////////////////// */&#xA;&#xA;-----------------&#xA;-- Numerador Dif&#xA;-----------------&#xA;select&#xA;OrdenN1,&#xA;OrdenN2=&#xA;case when nivel2 like '%Comer%Micro%' then 80&#xA;when nivel2 like '%Consumo%' then 81&#xA;when nivel2 like '%Vivienda%' then 82&#xA;when nivel2 like '%Credito%' then 83&#xA;when nivel2 like '%Vehiculos%' then 84&#xA;when nivel2 like '%Titularizada%' then 85 end,&#xA;OrdenN3,&#xA;Jerarquia,&#xA;Canal,&#xA;Division='SI',&#xA;Consolidado='NO',&#xA;Nivel1,&#xA;Nivel2='.'+Nivel2,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=sum(RealHoy),&#xA;DenominadorHoy=0,&#xA;RealAyer=sum(RealAyer),&#xA;DenominadorAyer=0,&#xA;RealMesAnt=sum(RealMesAnt),&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=sum(RealAnioAnt),&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(ValorPresupuesto),&#xA;DenominadorPresupuesto=0&#xA;from #Cartera&#xA;where Estado in ('Dif')&#xA;group by OrdenN1,&#xA;OrdenN3,&#xA;Canal,&#xA;Jerarquia,&#xA;Nivel1,&#xA;Nivel2,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5&#xA;&#xA;Union all&#xA;&#xA;-- Valor Deduccion&#xA;&#xA;select&#xA;OrdenN1,&#xA;OrdenN2=&#xA;case when nivel2 like '%Comer%Micro%' then 80&#xA;when nivel2 like '%Consumo%' then 81&#xA;when nivel2 like '%Vivienda%' then 82&#xA;when nivel2 like '%Credito%' then 83&#xA;when nivel2 like '%Vehiculos' then 84&#xA;when nivel2 like '%Titularizada%' then 85 end,&#xA;OrdenN3,&#xA;Jerarquia=1,&#xA;Canal,&#xA;Division='SI',&#xA;Consolidado='NO',&#xA;Nivel1,&#xA;Nivel2='Deducción',&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=sum(RealHoy)*-1,&#xA;DenominadorHoy=0,&#xA;RealAyer=sum(RealAyer)*-1,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=sum(RealMesAnt)*-1,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=sum(RealAnioAnt)*-1,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(ValorPresupuesto)*-1,&#xA;DenominadorPresupuesto=0&#xA;from #Cartera&#xA;where Estado in ('Dif')&#xA;group by OrdenN1,&#xA;OrdenN3,&#xA;Canal,&#xA;Jerarquia,&#xA;Nivel1,&#xA;Nivel2,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5&#xA;&#xA;Union all&#xA;&#xA;--------------------&#xA;-- Denominador Total&#xA;--------------------&#xA;&#xA;select&#xA;OrdenN1,&#xA;OrdenN2=&#xA;case when nivel2 like '%Comer%Micro%' then 80&#xA;when nivel2 like '%Consumo%' then 81&#xA;when nivel2 like '%Vivienda%' then 82&#xA;when nivel2 like '%Credito%' then 83&#xA;when nivel2 like '%Vehiculos%' then 84&#xA;when nivel2 like '%Titularizada%' then 85 end,&#xA;OrdenN3,&#xA;Jerarquia,&#xA;Canal,&#xA;Division='SI',&#xA;Consolidado='NO',&#xA;Nivel1,&#xA;Nivel2='.'+Nivel2,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=0,&#xA;DenominadorHoy=sum(RealHoy),&#xA;RealAyer=0,&#xA;DenominadorAyer=sum(RealAyer),&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=sum(RealMesAnt),&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=sum(RealAnioAnt),&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=sum(ValorPresupuesto)&#xA;from #Cartera&#xA;group by OrdenN1,&#xA;OrdenN3,&#xA;Canal,&#xA;Jerarquia,&#xA;Nivel1,&#xA;Nivel2,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5&#xA;&#xA;Union all&#xA;&#xA;-- Valor deduccion (NO se le multiplica para cero por la division)&#xA;&#xA;select&#xA;OrdenN1,&#xA;OrdenN2=&#xA;case when nivel2 like '%Comer%Micro%' then 80&#xA;when nivel2 like '%Consumo%' then 81&#xA;when nivel2 like '%Vivienda%' then 82&#xA;when nivel2 like '%Credito%' then 83&#xA;when nivel2 like '%Vehiculos%' then 84&#xA;when nivel2 like '%Titularizada%' then 85 end,&#xA;OrdenN3,&#xA;Jerarquia=1,&#xA;Canal,&#xA;Division='SI',&#xA;Consolidado='NO',&#xA;Nivel1,&#xA;Nivel2='Deducción',&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=0,&#xA;DenominadorHoy=sum(RealHoy),&#xA;RealAyer=0,&#xA;DenominadorAyer=sum(RealAyer),&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=sum(RealMesAnt),&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=sum(RealAnioAnt),&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=sum(ValorPresupuesto)&#xA;from #Cartera&#xA;group by OrdenN1,&#xA;OrdenN3,&#xA;Canal,&#xA;Jerarquia,&#xA;Nivel1,&#xA;Nivel2,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5&#xA;&#xA;Union all&#xA;&#xA;/* ///////////////////////////////////////////// */&#xA;/*       CONCENTRACION  100; 50; 25              */&#xA;/* ///////////////////////////////////////////// */&#xA;&#xA;&#xA;select&#xA;OrdenN1=@OrdenCarteraNivel1,&#xA;OrdenN2=90+Orden,&#xA;OrdenN3=90+Orden,&#xA;Jerarquia=2,&#xA;Canal='Otr.Dep y Obl.Fin',&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=@DescripcionCartera,&#xA;Nivel2=Nivel,&#xA;Nivel3=Nivel,&#xA;Nivel4=Nivel,&#xA;Nivel5=Nivel,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=sum(RealHoy),&#xA;DenominadorHoy=0,&#xA;RealAyer=sum(RealAyer),&#xA;DenominadorAyer=0,&#xA;RealMesAnt=sum(RealMesAnt),&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=sum(RealAnioAnt),&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from&#xA;(&#xA;select&#xA;Orden=&#xA;case ppCodigoProducto&#xA;when 36 then @OrdenCarteraNivel2+24&#xA;when 37 then @OrdenCarteraNivel2+25&#xA;when 38 then @OrdenCarteraNivel2+26 end,&#xA;Nivel=&#xA;case ppCodigoProducto&#xA;when 36 then 'Concentración 100'&#xA;when 37 then 'Concentración 50'&#xA;when 38 then 'Concentración 25' end,&#xA;RealHoy=case ppFecha when @FechAct then sum(isnull(ppPronostico,0)) else 0 end,&#xA;RealAyer=case ppFecha when @FechaAyer then sum(isnull(ppPronostico,0)) else 0 end,&#xA;RealMesAnt=case ppFecha when @FechaMesAnt then sum(isnull(ppPronostico,0)) else 0 end,&#xA;RealAnioAnt=case ppFecha when @FechaAnioAnt then sum(isnull(ppPronostico,0)) else 0 end&#xA;from  DWDPronosticoProducto&#xA;where ppCodigoProducto in (36,37,38)&#xA;group by ppFecha,&#xA;ppCodigoProducto&#xA;) Concentracion&#xA;group by Orden,&#xA;Nivel&#xA;&#xA;Union all&#xA;&#xA;-- Valor Deduccion&#xA;&#xA;select&#xA;OrdenN1=@OrdenCarteraNivel1,&#xA;OrdenN2=90+Orden,&#xA;OrdenN3=90+Orden,&#xA;Jerarquia=1,&#xA;Canal='Otr.Dep y Obl.Fin',&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=@DescripcionCartera,&#xA;Nivel2=Nivel,&#xA;Nivel3=Nivel,&#xA;Nivel4=Nivel,&#xA;Nivel5=Nivel,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=sum(RealHoy)*-1,&#xA;DenominadorHoy=0,&#xA;RealAyer=sum(RealAyer)*-1,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=sum(RealMesAnt)*-1,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=sum(RealAnioAnt)*-1,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from&#xA;(&#xA;select&#xA;Orden=&#xA;case ppCodigoProducto&#xA;when 36 then @OrdenCarteraNivel2+24&#xA;when 37 then @OrdenCarteraNivel2+25&#xA;when 38 then @OrdenCarteraNivel2+26 end,&#xA;Nivel=&#xA;case ppCodigoProducto&#xA;when 36 then 'Deducción'&#xA;when 37 then 'Deducción'&#xA;when 38 then 'Deducción' end,&#xA;RealHoy=case ppFecha when @FechAct then sum(isnull(ppPronostico,0)) else 0 end,&#xA;RealAyer=case ppFecha when @FechaAyer then sum(isnull(ppPronostico,0)) else 0 end,&#xA;RealMesAnt=case ppFecha when @FechaMesAnt then sum(isnull(ppPronostico,0)) else 0 end,&#xA;RealAnioAnt=case ppFecha when @FechaAnioAnt then sum(isnull(ppPronostico,0)) else 0 end&#xA;from  DWDPronosticoProducto&#xA;where ppCodigoProducto in (36,37,38)&#xA;group by ppFecha,&#xA;ppCodigoProducto&#xA;) Concentracion&#xA;group by Orden,&#xA;Nivel --550&#xA;&#xA;Union all&#xA;&#xA;&#xA;/* ///////////////////////////////////////////// */&#xA;/*                CARTERA CANAL                  */&#xA;/* ///////////////////////////////////////////// */&#xA;&#xA;-- Canal Comercial por Region Agencia (1,8,5,9,12,13)&#xA;-- Canal Corporativo por Asesor (10)&#xA;-- Canal Especializada por Subcanal (7,15,17,11)&#xA;-- Canal Tesoreria por Region Agencia (14)&#xA;&#xA;select&#xA;OrdenN1=@OrdenCarteraCanal,&#xA;OrdenN2=ca.caOrdenCanal,&#xA;OrdenN3=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%REGION%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 1000 else ag.agOrdenRegionAsesor end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ase.asAsesorPrincipal=1))  then&#xA;case when ase.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 1000 else asOrdenAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then caOrdenDescripcionCanal&#xA;else 1000&#xA;end,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Canal',&#xA;Nivel2=ca.caAgrupacion,&#xA;Nivel3=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ase.asAsesorPrincipal=1))  then&#xA;case when ase.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ase.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;Nivel4=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ase.asAsesorPrincipal=1))  then&#xA;case when ase.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ase.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;Nivel5=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ase.asAsesorPrincipal=1))  then&#xA;case when ase.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ase.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case ao.aoIdFecha  when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case ao.aoIdFecha  when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case ao.aoIdFecha  when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case ao.aoIdFecha  when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHActivoOperacion ao&#xA;inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on ao.aoIdCliente=clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDProducto pr on pr.prIdProducto=ao.aoIdProducto&#xA;inner join DWDAsesorOperacion ase on cl.clIdAsesorPrincipal=ase.asIdAsesor&#xA;inner join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia&#xA;inner join DWDMoneda mo on mo.moIdMoneda=ao.aoIdMoneda&#xA;left outer join #DWDTitularizadaOperacion ti on isnull(ao.aoNumeroOperacion,'')=ti.toOperacion&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador in (120,121,122,126)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where ao.aoIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)&#xA;and cc.ccCodigoMoneda=mo.moCodigoMoneda&#xA;and cl.clFechaFin is null&#xA;and ca.caEstado=1&#xA;and ti.toOperacion is null -- Filtro Titularizada&#xA;group by cc.ccFamiliaProducto,&#xA;clCodigoCliente,&#xA;ccCodigoNivel6,&#xA;asCodigoAsesor,&#xA;ca.caCodDescripcionAgrupacionCanal,&#xA;ase.asAsesorPrincipal,&#xA;asOrdenAsesor,&#xA;asNombreAsesor,&#xA;ao.aoIdFecha,&#xA;ca.caEstado,&#xA;ca.caOrdenCanal,&#xA;agOrdenRegionAsesor,&#xA;caOrdenDescripcionCanal,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;ca.caAgrupacion,&#xA;ag.agNombreRegion,&#xA;asNombreAsesor,&#xA;ca.caDescripcionCanal&#xA;&#xA;Union all&#xA;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;-- T. Credito&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;select&#xA;OrdenN1=@OrdenCarteraCanal,&#xA;OrdenN2=ca.caOrdenCanal,&#xA;OrdenN3=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%REGION%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 1000 else ag.agOrdenRegionAsesor end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (aso.asAsesorPrincipal=1))  then&#xA;case when aso.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 1000 else asOrdenAsesor  end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then caOrdenDescripcionCanal&#xA;else 1000&#xA;end,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Canal',&#xA;Nivel2=ca.caAgrupacion,&#xA;Nivel3=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (aso.asAsesorPrincipal=1))  then&#xA;case when aso.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else aso.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;Nivel4=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (aso.asAsesorPrincipal=1))  then&#xA;case when aso.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else aso.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;Nivel5=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (aso.asAsesorPrincipal=1))  then&#xA;case when aso.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else aso.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end  ,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHTarjetaCreditoOperacion tco&#xA;inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente&#xA;inner join DWDMoneda mo on mo.moIdMoneda=tco.tcoIdMoneda&#xA;inner join DWDProducto pr on tco.tcoIdProducto=pr.prIdProducto&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDAsesorOperacion aso on cl.clIdAsesorPrincipal=aso.asIdAsesor&#xA;inner join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador = 124&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and prVehiculo is null&#xA;and ccCodigoMoneda=moCodigoMoneda&#xA;and clFechaFin is null&#xA;and ca.caEstado=1&#xA;--and cc.ccCodigoMoneda='USD'&#xA;group by&#xA;cc.ccOrdenAgrupacion,&#xA;ag.agOrdenRegionAsesor,&#xA;aso.asOrdenAsesor,&#xA;ca.caOrdenDescripcionCanal,&#xA;clCodigoCliente,&#xA;ca.caOrdenCanal,&#xA;aso.asAsesorPrincipal,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;aso.asNombreAsesor,&#xA;cc.ccFamiliaProducto,&#xA;ca.caDescripcionCanal,&#xA;ag.agNombreRegion,&#xA;ca.caCodDescripcionAgrupacionCanal,&#xA;cc.ccGrupo,&#xA;ca.caAgrupacion,&#xA;tco.tcoIdFecha&#xA;&#xA;Union all&#xA;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;-- Titularizada&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;--&gt; Cambio de titularizada a Cartera Titularizada&#xA;&#xA;select&#xA;OrdenN1=@OrdenCarteraCanal,&#xA;OrdenN2=@OrdenCanalTit,&#xA;OrdenN3=@OrdenCanalTit,&#xA;Jerarquia=2,&#xA;Canal=@CanalTit,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Canal',&#xA;Nivel2=@CanalAgrTit,&#xA;Nivel3=@CanalAgrTit,&#xA;Nivel4=@CanalAgrTit,&#xA;Nivel5=@CanalAgrTit,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHCuotaOperacion co&#xA;inner join #DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on co.coIdCliente=clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda&#xA;inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto&#xA;inner join #DWDTitularizadaOperacion ti on isnull(co.coNumeroOperacion,'')=ti.toOperacion -- Titularizada&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador in (120,121,122,126)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and ccCodigoMoneda=moCodigoMoneda&#xA;and clFechaFin is null&#xA;and ca.caEstado=1&#xA;--and cc.ccCodigoMoneda='USD'&#xA;group by&#xA;ca.caOrdenCanal,&#xA;pr.prGrupo,&#xA;mo.moCodigoMoneda,&#xA;cc.ccFamiliaProducto,&#xA;co.coIdFecha&#xA;/*&#xA;Union all&#xA;&#xA;-- Cambio de asignación de Titularizada a Cartera Titularizada&#xA;&#xA;select&#xA;OrdenN1=@OrdenCarteraCanal,&#xA;OrdenN2=@OrdenCanalTit,&#xA;OrdenN3=@OrdenCanalTit,&#xA;Jerarquia=2,&#xA;Canal=@CanalTit,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Canal',&#xA;Nivel2=@CanalAgrTit,&#xA;Nivel3=@CanalAgrTit,&#xA;Nivel4=@CanalAgrTit,&#xA;Nivel5=@CanalAgrTit,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case ao.aoIdFecha when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case ao.aoIdFecha when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case ao.aoIdFecha when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case ao.aoIdFecha when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHActivoOperacion ao&#xA;inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on ao.aoIdCliente=clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador = 125&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where ao.aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and cl.clfechafin is null&#xA;and ca.caEstado=1&#xA;group by&#xA;ca.caOrdenCanal,&#xA;ao.aoIdFecha,&#xA;ccFamiliaProducto,&#xA;ccGrupo,&#xA;cc.ccClasificacionEstado&#xA;*/&#xA;union all&#xA;&#xA;/* Presupuesto Operacion */&#xA;&#xA;select&#xA;OrdenN1=@OrdenCarteraCanal,&#xA;OrdenN2=case when cc.ccFamiliaProducto like '%Titularizada%' then @OrdenCanalTit else ca.caOrdenCanal end,&#xA;OrdenN3=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%REGION%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 1000 else ag.agOrdenRegionAsesor end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then&#xA;case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 1000 else asOrdenAsesor  end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then caOrdenDescripcionCanal&#xA;else 1000&#xA;end,&#xA;&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Canal',&#xA;Nivel2=ca.caAgrupacion,&#xA;Nivel3=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then&#xA;case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;&#xA;Nivel4=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then&#xA;case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;Nivel5=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then&#xA;case when ao.asNombreAsesor LIKE '%SIN%ASESOR%' THEN 'NDI' else ao.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=0,&#xA;DenominadorHoy=0,&#xA;RealAyer=0,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,&#xA;DenominadorPresupuesto=0&#xA;from DWHPresupuestoNegocio pn&#xA;inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal&#xA;inner join DWDAgenciaOperacion ag on pn.pnIdAgencia=ag.agIdAgencia&#xA;inner join DWDAsesorOperacion ao on pn.pnIdAsesor=ao.asIdAsesor&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where pn.pnIdFecha in (@FechAct)&#xA;and ca.caEstado=1&#xA;and pn.pnIdIndicadorMedidaFinanciera=-10&#xA;group by cc.ccFamiliaProducto,&#xA;ca.caOrdenCanal,&#xA;agOrdenRegionAsesor,&#xA;caOrdenDescripcionCanal,&#xA;asOrdenAsesor,&#xA;ca.caDescripcionCanal,&#xA;ca.caCodDescripcionAgrupacionCanal,&#xA;ca.caAgrupacion,&#xA;ag.agNombreRegion,&#xA;ao.asAsesorPrincipal,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;ao.asNombreAsesor,&#xA;ca.caDescripcionCanal&#xA;&#xA;Union all&#xA;&#xA;/* //////////////////////////////////////// */&#xA;/*         CARTERA - SEGMENTACION           */&#xA;/* //////////////////////////////////////// */&#xA;&#xA;-- NATURALES (4,5,6,7,8,9,10)&#xA;-- JURIDICOS (11,12,13,14,15,16,17,18,19)&#xA;-- SIN PERFIL (1,2,3)&#xA;&#xA;select&#xA;OrdenN1=@OrdenCarteraSegmentacion,&#xA;OrdenN2=sc.scSegmentacionOrdenN2,&#xA;OrdenN3=sc.scSegmentacionOrdenN3,&#xA;Jerarquia=&#xA;case&#xA;when sc.scIdCodigo in (11,12,13,14,15,16,17,18,19) then 3&#xA;when sc.scIdCodigo in (4,5,6,7,8,9,10) then 5&#xA;else 2&#xA;end,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel2=sc.scSegmentacionTipo,&#xA;Nivel3=&#xA;case&#xA;when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo&#xA;else sc.scSegmentacion&#xA;end,&#xA;Nivel4=&#xA;case&#xA;when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo&#xA;else sc.scDetalleNombre&#xA;end,&#xA;Nivel5=&#xA;case&#xA;when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo&#xA;when sc.scIdCodigo in (11,12,13,14,15,16,17,18,19) then sc.scDetalleNombre&#xA;else v.vcVinculacionAgrupacion&#xA;end,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case ao.aoIdFecha when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case ao.aoIdFecha  when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case ao.aoIdFecha  when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case ao.aoIdFecha  when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHActivoOperacion ao&#xA;inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=ccIdCuentaContable&#xA;inner join DWDCliente cl on ao.aoIdCliente=clIdCliente&#xA;inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente -- revisar los left outer&#xA;inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador in (120,121,122,126)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where ao.aoIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)&#xA;and cl.clfechafin is null&#xA;and ca.caEstado=1&#xA;group by&#xA;sc.scSegmentacionOrdenN2,&#xA;sc.scSegmentacionOrdenN3,&#xA;cc.ccFamiliaProducto,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cl.clIdSegmentacionCliente,&#xA;ao.aoIdFecha,&#xA;sc.scSegmentacionTipo,&#xA;sc.scIdCodigo,&#xA;sc.scSegmentacion,&#xA;sc.scDetalleNombre,&#xA;v.vcVinculacionAgrupacion&#xA;&#xA;Union all&#xA;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;-- T. Credito&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;select&#xA;OrdenN1=@OrdenCarteraSegmentacion,&#xA;OrdenN2=scSegmentacionOrdenN2,&#xA;OrdenN3=scSegmentacionOrdenN3,&#xA;Jerarquia=&#xA;case&#xA;when sc.scIdCodigo in (11,12,13,14,15,16,17,18,19) then 3&#xA;when sc.scIdCodigo in (4,5,6,7,8,9,10) then 5&#xA;else 2&#xA;end,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel2=sc.scSegmentacionTipo,&#xA;Nivel3=&#xA;case&#xA;when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo&#xA;else sc.scSegmentacion&#xA;end,&#xA;Nivel4=&#xA;case&#xA;when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo&#xA;else sc.scDetalleNombre&#xA;end,&#xA;Nivel5=&#xA;case&#xA;when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo&#xA;when sc.scIdCodigo in (11,12,13,14,15,16,17,18,19) then sc.scDetalleNombre&#xA;else v.vcVinculacionAgrupacion&#xA;end,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHTarjetaCreditoOperacion tco&#xA;inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente&#xA;inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador = 124&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and cl.clFechaFin is null&#xA;and ca.caEstado=1&#xA;group by cc.ccFamiliaProducto,&#xA;cl.clIdSegmentacionCliente,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;sc.scSegmentacionTipo,&#xA;sc.scSegmentacion,&#xA;sc.scDetalleNombre,&#xA;sc.scIdCodigo,&#xA;v.vcVinculacionAgrupacion,&#xA;sc.scSegmentacionOrden,&#xA;tco.tcoIdFecha,&#xA;cc.ccOrdenAgrupacion,&#xA;sc.scSegmentacionOrdenN2,&#xA;sc.scSegmentacionOrdenN3&#xA;&#xA;Union all&#xA;&#xA;---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;-- Alta y Baja Vinculacion&#xA;-- para Natural y Juridico&#xA;---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;select&#xA;OrdenN1=@OrdenCarteraSegmentacion,&#xA;OrdenN2=sc.scSegmentacionOrdenN2,&#xA;OrdenN3=v.vcOrdenVinculacion,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel2=sc.scSegmentacionTipo,&#xA;Nivel3=v.vcVinculacionAgrupacion,&#xA;Nivel4=v.vcVinculacionAgrupacion,&#xA;Nivel5=v.vcVinculacionAgrupacion,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case ao.aoIdFecha when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case ao.aoIdFecha when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case ao.aoIdFecha when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case ao.aoIdFecha when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHActivoOperacion ao&#xA;inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=ccIdCuentaContable&#xA;inner join DWDCliente cl on ao.aoIdCliente=clIdCliente&#xA;inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente&#xA;inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador in (120,121,122,124,126)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where ao.aoIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)&#xA;and sc.scIdCodigo not in (1,2,3)&#xA;and cl.clFechaFin is null&#xA;group by cc.ccFamiliaProducto,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;sc.scSegmentacionOrdenN2,&#xA;sc.scSegmentacionOrdenN3,&#xA;sc.scSegmentacionTipo,&#xA;v.vcOrdenVinculacion,&#xA;v.vcVinculacionAgrupacion,&#xA;ao.aoIdFecha&#xA;&#xA;Union all&#xA;&#xA;--&gt;&gt; Tarjeta Credito&#xA;&#xA;select&#xA;OrdenN1=@OrdenCarteraSegmentacion,&#xA;OrdenN2=scSegmentacionOrdenN2,&#xA;OrdenN3=v.vcOrdenVinculacion,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel2=sc.scSegmentacionTipo,&#xA;Nivel3=v.vcVinculacionAgrupacion,&#xA;Nivel4=v.vcVinculacionAgrupacion,&#xA;Nivel5=v.vcVinculacionAgrupacion,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHTarjetaCreditoOperacion tco&#xA;inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente&#xA;inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente&#xA;inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;--and p1.CpCodigoIndicador = 124&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and cl.clFechaFin is null&#xA;and sc.scIdCodigo not in (1,2,3)&#xA;group by cc.ccFamiliaProducto,&#xA;cl.clIdSegmentacionCliente,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;sc.scSegmentacionOrdenN2,&#xA;sc.scSegmentacionTipo,&#xA;v.vcOrdenVinculacion,&#xA;v.vcVinculacionAgrupacion,&#xA;tco.tcoIdFecha,&#xA;ccOrdenAgrupacion,&#xA;clCodigoCliente&#xA;&#xA;Union All&#xA;&#xA;---&gt;&gt; Valor Deduccion&#xA;&#xA;select&#xA;OrdenN1=@OrdenCarteraSegmentacion,&#xA;OrdenN2=sc.scSegmentacionOrdenN2,&#xA;OrdenN3=v.vcOrdenVinculacion,&#xA;Jerarquia=2,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel2=sc.scSegmentacionTipo,&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case ao.aoIdFecha when @FechAct then (sum(isnull(ao.aoMontoSaldoDolar,0))/1000)*-1 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case ao.aoIdFecha when @FechaAyer then (sum(isnull(ao.aoMontoSaldoDolar,0))/1000)*-1 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case ao.aoIdFecha when @FechaMesAnt then (sum(isnull(ao.aoMontoSaldoDolar,0))/1000)*-1 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case ao.aoIdFecha when @FechaAnioAnt then (sum(isnull(ao.aoMontoSaldoDolar,0))/1000)*-1 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHActivoOperacion ao&#xA;inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=ccIdCuentaContable&#xA;inner join DWDCliente cl on ao.aoIdCliente=clIdCliente&#xA;inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente&#xA;inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador in (120,121,122,126)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where ao.aoIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)&#xA;and sc.scIdCodigo not in (1,2,3)&#xA;group by cc.ccFamiliaProducto,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;sc.scSegmentacionOrdenN2,&#xA;sc.scSegmentacionOrdenN3,&#xA;sc.scSegmentacionTipo,&#xA;v.vcOrdenVinculacion,&#xA;ao.aoIdFecha&#xA;&#xA;Union all&#xA;&#xA;--&gt;&gt; Tarjeta Credito&#xA;&#xA;select&#xA;OrdenN1=@OrdenCarteraSegmentacion,&#xA;OrdenN2=scSegmentacionOrdenN2,&#xA;OrdenN3=v.vcOrdenVinculacion,&#xA;Jerarquia=2,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel2=sc.scSegmentacionTipo,&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case tco.tcoIdFecha when @FechAct then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case tco.tcoIdFecha when @FechaAyer then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then (sum(isnull(tco.tcoSaldo,0))/1000)*-1 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHTarjetaCreditoOperacion tco&#xA;inner join #DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente&#xA;inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente&#xA;inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and p1.CpCodigoIndicador = 124&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and cl.clFechaFin is null&#xA;and sc.scIdCodigo not in (1,2,3)&#xA;group by cc.ccFamiliaProducto,&#xA;cl.clIdSegmentacionCliente,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;sc.scSegmentacionOrdenN2,&#xA;sc.scSegmentacionTipo,&#xA;v.vcOrdenVinculacion,&#xA;tco.tcoIdFecha,&#xA;ccOrdenAgrupacion,&#xA;clCodigoCliente&#xA;&#xA;Union all&#xA;&#xA;/* Presupuesto Negocio*/&#xA;&#xA;select&#xA;OrdenN1=@OrdenCarteraSegmentacion,&#xA;OrdenN2=@OrdenCarteraSegmentacion,&#xA;OrdenN3=@OrdenCarteraSegmentacion,&#xA;Jerarquia=1,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel2=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel3=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel4=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel5=cc.ccFamiliaProducto+'-Segm',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=0,&#xA;DenominadorHoy=0,&#xA;RealAyer=0,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,&#xA;DenominadorPresupuesto=0&#xA;from DWHPresupuestoNegocio pn&#xA;inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal&#xA;inner join DWDAgenciaOperacion ag on pn.pnIdAgencia=ag.agIdAgencia&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 1&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where pn.pnIdFecha = @FechAct&#xA;and ca.caEstado=1&#xA;and cc.ccCodigoMoneda='USD'&#xA;and pn.pnIdIndicadorMedidaFinanciera=-10&#xA;group by cc.ccFamiliaProducto,&#xA;ca.caDescripcionAgrupacionCanal --575879&#xA;&#xA;Union all&#xA;&#xA;/* ----------------------------------------------------------------------------------------------- */&#xA;/*                                  CONTINGENTES                                                    */&#xA;/* ----------------------------------------------------------------------------------------------- */&#xA;&#xA;select&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=cc.ccOrdenAgrupacionN3,&#xA;Jerarquia=3,&#xA;Canal=&#xA;case when cc.ccCodigoNivel6 in (630281802003,640215802003)&#xA;then&#xA;(&#xA;case when asCodigoAsesor in ('IBS','-1') then isnull(--clCanal&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where caIdCanal=cl.clIdCanal),&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG')&#xA;)--'NNG')&#xA;&#xA;else isnull(--asCodigoCanal&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where rtrim(ltrim(caCodigoCanal))= case when ltrim(rtrim(ase.asCodigoCanal)) in ('N/A','-1') then 'NDI' else ltrim(rtrim(ase.asCodigoCanal))  end )&#xA;--(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal=  ase.asCodigoCanal )&#xA;,isnull(caDescripcionAgrupacionCanal,(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'))--'NNG')&#xA;)&#xA;end&#xA;)&#xA;else isnull(&#xA;--clCanal&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where caIdCanal=cl.clIdCanal),&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'))--'NNG')&#xA;end,&#xA;&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=ccFamiliaProducto,&#xA;Nivel2=ccGrupo,&#xA;Nivel3=ccSubGrupo,&#xA;Nivel4=ccSubGrupo,&#xA;Nivel5=ccSubGrupo,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case ao.aoIdFecha when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case ao.aoIdFecha when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case ao.aoIdFecha when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case ao.aoIdFecha when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHActivoOperacion ao&#xA;inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on ao.aoIdCliente=cl.clIdCliente&#xA;inner join DWDProducto pr on pr.prIdProducto=ao.aoIdProducto&#xA;inner join DWDCanal ca on cl.clCodigoCanal=ca.caCodigoCanal --cl.clIdCanal=ca.caIdCanal&#xA;left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 3&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where ao.aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and cl.clFechaFin is null&#xA;and ca.caEstado=1&#xA;group by&#xA;ao.aoIdFecha,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cc.ccOrdenAgrupacionN2,&#xA;cc.ccOrdenAgrupacionN3,&#xA;cc.ccOrdenAgrupacion,&#xA;ccFamiliaProducto,&#xA;ccGrupo,&#xA;clIdCanal,&#xA;asCodigoCanal,&#xA;ccSubGrupo,&#xA;ccCodigoNivel6,&#xA;asCodigoAsesor&#xA;&#xA;Union all&#xA;&#xA;---Creditos no desembolsados&#xA;&#xA;select&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN2=cc.ccOrdenAgrupacionN3,&#xA;Jerarquia=3,&#xA;Canal=(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'),&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=ccFamiliaProducto,&#xA;Nivel2=ccGrupo,&#xA;Nivel3=ccSubGrupo,&#xA;Nivel4=ccSubGrupo,&#xA;Nivel5=ccSubGrupo,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case bs.bsIdFecha when @FechAct then sum(bs.bsSaldoDolarizado)/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case bs.bsIdFecha when @FechaAyer then sum(bs.bsSaldoDolarizado)/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case bs.bsIdFecha when @FechaMesAnt then sum(bs.bsSaldoDolarizado)/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case bs.bsIdFecha when @FechaAnioAnt then sum(bs.bsSaldoDolarizado)/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=case bs.bsIdFecha when @FechAct then sum(bs.bsSaldoDolarizado)/1000 else 0 end,-- el presupuesto va a ser igual a hoy&#xA;DenominadorPresupuesto=0&#xA;from DWHBalanceSaldo bs&#xA;inner join #DWDCuentaContable cc on bs.bsIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 3&#xA;and p1.CpCodigoIndicador = 162&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where bs.bsIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;group by bs.bsIdFecha,&#xA;cc.ccOrdenAgrupacion,&#xA;cc.ccOrdenAgrupacionN2,&#xA;cc.ccOrdenAgrupacionN3,&#xA;ccFamiliaProducto,&#xA;ccGrupo,&#xA;ccSubGrupo&#xA;&#xA;Union all&#xA;&#xA;/* PRESUPUESTO NEGOCIO */&#xA;&#xA;select&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN2=cc.ccOrdenAgrupacionN3,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=ccFamiliaProducto,&#xA;Nivel2=ccGrupo,&#xA;Nivel3=ccSubGrupo,&#xA;Nivel4=ccSubGrupo,&#xA;Nivel5=ccSubGrupo,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=0,&#xA;DenominadorHoy=0,&#xA;RealAyer=0,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,&#xA;DenominadorPresupuesto=0&#xA;from DWHPresupuestoNegocio pn&#xA;inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable&#xA;left outer join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 3&#xA;and p1.CpCodigoIndicador in (160,161)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where pn.pnIdFecha in (@FechAct)&#xA;and ca.caEstado=1&#xA;--and ca.caIdCanal in (1,5,7,8,9,10,11,14,15,17,12,13)&#xA;--and cc.ccCodigoMoneda='USD'&#xA;and pn.pnIdIndicadorMedidaFinanciera=-10&#xA;group by&#xA;ca.caOrdenCanal,&#xA;cc.ccFamiliaProducto,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cc.ccOrdenAgrupacion,&#xA;ccOrdenAgrupacionN2,&#xA;cc.ccOrdenAgrupacionN3,&#xA;cc.ccGrupo,&#xA;ccSubGrupo,&#xA;ca.caAgrupacion&#xA;&#xA;Union All&#xA;&#xA;/* /////////////////////////////// */&#xA;/*      CONTINGENTES CANAL         */&#xA;/* /////////////////////////////// */&#xA;&#xA;select&#xA;OrdenN1=@OrdenContingenteCanal,&#xA;OrdenN2=ca.caOrdenCanal,&#xA;OrdenN3=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)   then --ContCanal.agOrdenRegionAsesor&#xA;case when ContCanal.nombreRegion like '%SIN NOMBRE%' or ContCanal.nombreRegion like '%SIN REGION%' then 1000 else ContCanal.agOrdenRegionAsesor  end&#xA;when ca.caCodDescripcionAgrupacionCanal = 2  then --ContCanal.asOrdenAsesor&#xA;case when ContCanal.nombreAsesor LIKE '%SIN%ASESOR%' THEN 1000 else ContCanal.asOrdenAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caOrdenDescripcionCanal --cl.clCanal&#xA;else 1000&#xA;end,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1,&#xA;Nivel2=ca.caAgrupacion,&#xA;Nivel3=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal = 2 then --nombreAsesor&#xA;case when ContCanal.nombreAsesor LIKE '%SIN ASESOR%' THEN 'NDI' else ContCanal.nombreAsesor end&#xA;when  ca.caCodDescripcionAgrupacionCanal = 3 then caDescripcionCanal&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then --nombreRegion&#xA;case when ContCanal.nombreRegion like '%SIN%NOMBRE%' then 'SIN REGION' else ContCanal.nombreRegion end&#xA;else 'NDI'&#xA;end,&#xA;Nivel4=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal = 2 then --nombreAsesor&#xA;case when ContCanal.nombreAsesor LIKE '%SIN ASESOR%' THEN 'NDI' else ContCanal.nombreAsesor end&#xA;when  ca.caCodDescripcionAgrupacionCanal = 3 then caDescripcionCanal&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then --nombreRegion&#xA;case when ContCanal.nombreRegion like '%SIN%NOMBRE%' then 'SIN REGION' else ContCanal.nombreRegion end&#xA;else 'NDI'&#xA;end,&#xA;Nivel5=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal = 2 then --nombreAsesor&#xA;case when ContCanal.nombreAsesor LIKE '%SIN ASESOR%' THEN 'NDI' else ContCanal.nombreAsesor end&#xA;when  ca.caCodDescripcionAgrupacionCanal = 3 then caDescripcionCanal&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then --nombreRegion&#xA;case when ContCanal.nombreRegion like '%SIN%NOMBRE%' then 'SIN REGION' else ContCanal.nombreRegion end&#xA;else 'NDI'&#xA;end,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=sum(RealHoy)/1000,&#xA;DenominadorHoy=0,&#xA;RealAyer=sum(RealAyer)/1000,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=sum(RealMesAnt)/1000,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=sum(RealAnioAnt)/1000,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from&#xA;(&#xA;select&#xA;CodCliente=clCodigoCliente,&#xA;Nivel1=cc.ccFamiliaProducto+'-Canal',&#xA;&#xA;clIdCanal=&#xA;case when ccCodigoNivel6 in (630281802003,640215802003) then&#xA;(case when asCodigoAsesor in ('IBS','-1') then&#xA;isnull(--clCanal&#xA;(select caIdCanal from dwdcanal where caIdCanal=clIdCanal),&#xA;(select caIdCanal from dwdcanal where caCodigoCanal='NNG')&#xA;)--'NNG')&#xA;else isnull(--asCodigoCanal&#xA;(select caIdCanal from dwdcanal where caCodigoCanal=asCodigoCanal),&#xA;isnull(clIdCanal,(select caIdCanal from dwdcanal where caCodigoCanal='NNG'))--'NNG')&#xA;)&#xA;end&#xA;)&#xA;else isnull(--clCanal&#xA;(select caIdCanal from dwdcanal where caIdCanal=clIdCanal),&#xA;(select caIdCanal from dwdcanal where caCodigoCanal='NNG')&#xA;)--'NNG')&#xA;end,&#xA;&#xA;-- Aumente&#xA;--&gt;&#xA;asOrdenAsesor=&#xA;case when ccCodigoNivel6 in (630281802003,640215802003)&#xA;then&#xA;(&#xA;case when asCodigoAsesor in ('IBS','-1') then (select asOrdenAsesor from DWDAsesorOperacion where clCodigoAsesorPrincipal=asCodigoAsesor and asAsesorPrincipal=1)&#xA;else asOrdenAsesor&#xA;end&#xA;)&#xA;else (select asOrdenAsesor from DWDAsesorOperacion where clCodigoAsesorPrincipal=asCodigoAsesor and asAsesorPrincipal=1 )--clCodigoAsesorPrincipal&#xA;end,&#xA;--&gt;&#xA;&#xA;NombreAsesor=&#xA;case when ccCodigoNivel6 in (630281802003,640215802003) then&#xA;(&#xA;case when asCodigoAsesor in ('IBS','-1') then (select asNombreAsesor from DWDAsesorOperacion where clCodigoAsesorPrincipal=asCodigoAsesor and asAsesorPrincipal=1)&#xA;else asNombreAsesor&#xA;end&#xA;)&#xA;else (select asNombreAsesor from DWDAsesorOperacion where clCodigoAsesorPrincipal=asCodigoAsesor and asAsesorPrincipal=1 )--clCodigoAsesorPrincipal&#xA;end ,&#xA;&#xA;--&gt;Aumente&#xA;--&gt;&#xA;agOrdenRegionAsesor=&#xA;case when ccCodigoNivel6 in (630281802003,640215802003) then agOrdenRegionAsesor&#xA;else&#xA;(case isnull(clIdAgencia,-1) when -1 then agOrdenRegionAsesor&#xA;else --clCodigoAgencia&#xA;(select agOrdenRegionAsesor from DWDAgenciaOperacion where clCodigoAgencia=agCodigoAgencia)&#xA;end&#xA;)&#xA;end,&#xA;--&gt;&#xA;&#xA;NombreRegion=&#xA;case when ccCodigoNivel6 in (630281802003,640215802003) then agNombreRegion&#xA;else (case isnull(clIdAgencia,-1) when -1 then agNombreRegion&#xA;else --clCodigoAgencia&#xA;(select agNombreRegion from DWDAgenciaOperacion where clCodigoAgencia=agCodigoAgencia)&#xA;end&#xA;)&#xA;end,&#xA;&#xA;RealHoy=case ao.aoIdFecha  when @FechAct then sum(ao.aoMontoSaldoDolar) else 0 end,&#xA;RealAyer=case ao.aoIdFecha  when @FechaAyer then sum(ao.aoMontoSaldoDolar) else 0 end,&#xA;RealMesAnt=case ao.aoIdFecha  when @FechaMesAnt then sum(ao.aoMontoSaldoDolar) else 0 end,&#xA;RealAnioAnt=case ao.aoIdFecha  when @FechaAnioAnt then sum(ao.aoMontoSaldoDolar) else 0 end&#xA;&#xA;from #DWHActivoOperacion ao&#xA;inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on ao.aoIdCliente=clIdCliente&#xA;inner join DWDAgenciaOperacion on agIdAgencia=aoIdAgencia&#xA;left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal&#xA;and asEstado=1&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 3&#xA;and p1.CpCodigoIndicador in (160,161)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where ao.aoIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)&#xA;and clFechaFin is null&#xA;group by&#xA;clCodigoCliente,&#xA;cc.ccFamiliaProducto,&#xA;ccCodigoNivel6,&#xA;asCodigoAsesor,&#xA;aoIdFecha,&#xA;asOrdenAsesor,&#xA;agOrdenRegionAsesor,&#xA;asCodigoCanal,&#xA;clCodigoAsesorPrincipal,&#xA;clCodigoAgencia,&#xA;agNombreRegion,&#xA;asNombreAsesor,&#xA;clIdAgencia,&#xA;clIdCanal&#xA;&#xA;)  as ContCanal&#xA;&#xA;join dwdcanal ca on caIdCanal=ContCanal.clIdCanal&#xA;--join dwdagenciaoperacion ag on ContCanal.IdAgencia=ag.agIdAgencia&#xA;--join DWDAsesorOperacion ase on ContCanal.IdAsesor=ase.asIdAsesor&#xA;&#xA;group by&#xA;caOrdenDescripcionCanal,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;Nivel1,&#xA;caOrdenCanal,&#xA;ca.caCodDescripcionAgrupacionCanal,&#xA;nombreAsesor,&#xA;caDescripcionCanal,&#xA;ca.caAgrupacion,&#xA;nombreRegion,&#xA;ContCanal.agOrdenRegionAsesor,&#xA;ContCanal.asOrdenAsesor&#xA;&#xA;Union all&#xA;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;-- Creditos No Desembolsados&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;select&#xA;OrdenN1=@OrdenContingenteCanal,&#xA;OrdenN2=100,&#xA;OrdenN3=100,&#xA;&#xA;Jerarquia=2,&#xA;Canal=(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'),&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=ccFamiliaProducto+'-Canal',&#xA;Nivel2=ccGrupo,&#xA;Nivel3=ccGrupo,&#xA;Nivel4=ccGrupo,&#xA;Nivel5=ccGrupo,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case bs.bsIdFecha when @FechAct then sum(bs.bsSaldoDolarizado)/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case bs.bsIdFecha when @FechaAyer then sum(bs.bsSaldoDolarizado)/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case bs.bsIdFecha when @FechaMesAnt then sum(bs.bsSaldoDolarizado)/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case bs.bsIdFecha when @FechaAnioAnt then sum(bs.bsSaldoDolarizado)/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=case bs.bsIdFecha when @FechAct then sum(bs.bsSaldoDolarizado)/1000 else 0 end, -- el presupuesto va a ser igual al valor de Hoy&#xA;DenominadorPresupuesto=0&#xA;from DWHBalanceSaldo bs&#xA;inner join #DWDCuentaContable cc on bs.bsIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 3&#xA;and p1.CpCodigoIndicador = 162&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where bs.bsIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;group by bs.bsIdFecha,&#xA;cc.ccOrdenAgrupacion,&#xA;ccFamiliaProducto,&#xA;ccGrupo&#xA;&#xA;Union all&#xA;&#xA;--Valor Deduccion Credito No desembolsado&#xA;&#xA;select&#xA;OrdenN1=@OrdenContingenteCanal,&#xA;OrdenN2=100,&#xA;OrdenN3=100,&#xA;Jerarquia=1,&#xA;Canal=(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'),&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=ccFamiliaProducto+'-Canal',&#xA;Nivel2='Deducción',&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case bs.bsIdFecha when @FechAct then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case bs.bsIdFecha when @FechaAyer then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case bs.bsIdFecha when @FechaMesAnt then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case bs.bsIdFecha when @FechaAnioAnt then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=case bs.bsIdFecha when @FechAct then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end, -- el presupuesto va a ser igual al valor de Hoy&#xA;DenominadorPresupuesto=0&#xA;from DWHBalanceSaldo bs&#xA;inner join #DWDCuentaContable cc on bs.bsIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 3&#xA;and p1.CpCodigoIndicador = 162&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where bs.bsIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;group by bs.bsIdFecha,&#xA;cc.ccOrdenAgrupacion,&#xA;ccFamiliaProducto,&#xA;ccGrupo&#xA;&#xA;Union all&#xA;&#xA;/* Presupuesto Operacion */&#xA;&#xA;select&#xA;OrdenN1=@OrdenContingenteCanal,&#xA;OrdenN2=ca.caOrdenCanal,&#xA;OrdenN3=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%REGION%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 1000 else ag.agOrdenRegionAsesor end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then&#xA;case when ao.asNombreAsesor LIKE '%SIN ASESOR%' THEN 1000 else asOrdenAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then caOrdenDescripcionCanal --cl.clCanal&#xA;else 1000&#xA;end,&#xA;Jerarquia=3,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Canal',&#xA;Nivel2=ca.caAgrupacion,&#xA;Nivel3=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then&#xA;case when ao.asNombreAsesor LIKE '%SIN ASESOR%' THEN 'NDI' else ao.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;Nivel4=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then&#xA;case when ao.asNombreAsesor LIKE '%SIN ASESOR%' THEN 'NDI' else ao.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;Nivel5=&#xA;case&#xA;when ca.caCodDescripcionAgrupacionCanal in (1,4)  then&#xA;case when ag.agNombreRegion like '%SIN%NOMBRE%' or ag.agNombreRegion like '%NO%DEFINIDO%' then 'SIN REGION' else ag.agNombreRegion end&#xA;when ((ca.caCodDescripcionAgrupacionCanal = 2) and (ao.asAsesorPrincipal=1))  then&#xA;case when ao.asNombreAsesor LIKE '%SIN ASESOR%' THEN 'NDI' else ao.asNombreAsesor end&#xA;when ca.caCodDescripcionAgrupacionCanal = 3 then ca.caDescripcionCanal&#xA;else 'NDI'&#xA;end,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=0,&#xA;DenominadorHoy=0,&#xA;RealAyer=0,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,&#xA;DenominadorPresupuesto=0&#xA;from DWHPresupuestoNegocio pn&#xA;inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal&#xA;inner join DWDAgenciaOperacion ag on pn.pnIdAgencia=ag.agIdAgencia&#xA;inner join DWDAsesorOperacion ao on pn.pnIdAsesor=ao.asIdAsesor&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 3&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where pn.pnIdFecha = @FechAct&#xA;and ca.caEstado=1&#xA;and pn.pnIdIndicadorMedidaFinanciera=-10&#xA;group by cc.ccFamiliaProducto,&#xA;ca.caOrdenCanal,&#xA;agOrdenRegionAsesor,&#xA;caOrdenDescripcionCanal,&#xA;asOrdenAsesor,&#xA;ca.caDescripcionCanal,&#xA;ca.caCodDescripcionAgrupacionCanal,&#xA;ca.caAgrupacion,&#xA;ag.agNombreRegion,&#xA;ao.asAsesorPrincipal,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;ao.asNombreAsesor,&#xA;ca.caDescripcionCanal&#xA;&#xA;Union all&#xA;&#xA;/* //////////////////////////////////// */&#xA;/*    CONTINGENTES - SEGMENTACION       */&#xA;/* //////////////////////////////////// */&#xA;&#xA;-- NATURALES (4,5,6,7,8,9,10)&#xA;-- JURIDICOS (11,12,13,14,15,16,17,18,19)&#xA;-- SIN PERFIL (1,2,3)&#xA;&#xA;select&#xA;OrdenN1=@OrdenContingenteSegmentacion,&#xA;OrdenN2=sc.scSegmentacionOrdenN2,&#xA;OrdenN3=sc.scSegmentacionOrdenN3,&#xA;Jerarquia=&#xA;case&#xA;when sc.scIdCodigo in (11,12,13,14,15,16,17,18,19) then 3&#xA;when sc.scIdCodigo in (4,5,6,7,8,9,10) then 5&#xA;else 2&#xA;end,&#xA;Canal=&#xA;case when cc.ccCodigoNivel6 in (630281802003,640215802003)&#xA;then&#xA;(&#xA;case when asCodigoAsesor in ('IBS','-1') then isnull(--clCanal&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where caIdCanal=cl.clIdCanal),&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG')&#xA;)--'NNG')&#xA;else isnull(--asCodigoCanal&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where rtrim(ltrim(caCodigoCanal))= case when ltrim(rtrim(ase.asCodigoCanal)) in ('N/A','-1') then 'NDI' else ltrim(rtrim(ase.asCodigoCanal))  end  )&#xA;--(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal=  ase.asCodigoCanal )&#xA;,isnull(caDescripcionAgrupacionCanal,(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'))--'NNG')&#xA;)&#xA;end&#xA;)&#xA;else isnull(--clCanal&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where caIdCanal=cl.clIdCanal),&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG')&#xA;)--'NNG')&#xA;end,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel2=sc.scSegmentacionTipo,&#xA;Nivel3=&#xA;case&#xA;when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo&#xA;else sc.scSegmentacion&#xA;end,&#xA;Nivel4=&#xA;case&#xA;when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo&#xA;else sc.scDetalleNombre&#xA;end,&#xA;Nivel5=&#xA;case&#xA;when sc.scIdCodigo in (1,2,3) then sc.scSegmentacionTipo&#xA;when sc.scIdCodigo in (11,12,13,14,15,16,17,18,19) then sc.scDetalleNombre&#xA;else v.vcVinculacionAgrupacion&#xA;end,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case ao.aoIdFecha when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case ao.aoIdFecha  when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case ao.aoIdFecha  when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case ao.aoIdFecha  when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;&#xA;from #DWHActivoOperacion ao&#xA;inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on ao.aoIdCliente=cl.clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente&#xA;inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente&#xA;left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal --validacion para las cuentas (630281802003,640215802003)&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 3&#xA;and p1.CpCodigoIndicador in (160,161)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where ao.aoIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)&#xA;and cl.clfechafin is null&#xA;and ca.caEstado=1&#xA;group by&#xA;ase.asCodigoCanal,&#xA;cc.ccCodigoNivel6,&#xA;asCodigoAsesor,&#xA;cl.clIdCanal,&#xA;sc.scSegmentacionOrdenN2,&#xA;sc.scSegmentacionOrdenN3,&#xA;sc.scIdCodigo,&#xA;cc.ccFamiliaProducto,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cl.clIdSegmentacionCliente,&#xA;ao.aoIdFecha,&#xA;sc.scSegmentacionTipo,&#xA;sc.scSegmentacion,&#xA;sc.scDetalleNombre,&#xA;v.vcVinculacionAgrupacion&#xA;&#xA;Union all&#xA;&#xA;---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;-- Alta y Baja Vinculacion&#xA;-- para Natural y Juridico&#xA;---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;select&#xA;OrdenN1=@OrdenContingenteSegmentacion,&#xA;OrdenN2=sc.scSegmentacionOrdenN2,&#xA;OrdenN3=v.vcOrdenVinculacion,&#xA;&#xA;Jerarquia=3,&#xA;Canal=--ca.caDescripcionAgrupacionCanal,&#xA;case when cc.ccCodigoNivel6 in (630281802003,640215802003)&#xA;then&#xA;(&#xA;case when asCodigoAsesor in ('IBS','-1') then isnull(--clCanal&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where caIdCanal=cl.clIdCanal),&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG')&#xA;)--'NNG')&#xA;&#xA;else isnull(--asCodigoCanal&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where rtrim(ltrim(caCodigoCanal))= case when ltrim(rtrim(ase.asCodigoCanal)) in ('N/A','-1') then 'NDI' else ltrim(rtrim(ase.asCodigoCanal))  end  )&#xA;--(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal=  ase.asCodigoCanal )&#xA;,isnull(caDescripcionAgrupacionCanal,(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'))--'NNG')&#xA;)&#xA;end&#xA;)&#xA;else isnull(--clCanal&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where caIdCanal=cl.clIdCanal),&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG')&#xA;)--'NNG')&#xA;end,&#xA;&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel2=sc.scSegmentacionTipo,&#xA;Nivel3=v.vcVinculacionAgrupacion,&#xA;Nivel4=v.vcVinculacionAgrupacion,&#xA;Nivel5=v.vcVinculacionAgrupacion,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case ao.aoIdFecha when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case ao.aoIdFecha when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case ao.aoIdFecha when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case ao.aoIdFecha when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;from #DWHActivoOperacion ao&#xA;inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=ccIdCuentaContable&#xA;inner join DWDCliente cl on ao.aoIdCliente=clIdCliente&#xA;inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente&#xA;inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal  --validacion para las cuentas (630281802003,640215802003)&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 3&#xA;and p1.CpCodigoIndicador in (160,161)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where ao.aoIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)&#xA;and sc.scIdCodigo not in (1,2,3)&#xA;group by&#xA;cl.clIdCanal,&#xA;cc.ccCodigoNivel6,&#xA;asCodigoAsesor,&#xA;ase.asCodigoCanal,&#xA;cc.ccFamiliaProducto,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;sc.scSegmentacionOrdenN2,&#xA;sc.scSegmentacionOrdenN3,&#xA;sc.scSegmentacionTipo,&#xA;v.vcOrdenVinculacion,&#xA;v.vcVinculacionAgrupacion,&#xA;ao.aoIdFecha&#xA;&#xA;Union all&#xA;&#xA;--&gt;&gt; Valor Deducccion&#xA;&#xA;select&#xA;OrdenN1=@OrdenContingenteSegmentacion,&#xA;OrdenN2=sc.scSegmentacionOrdenN2,&#xA;OrdenN3=v.vcOrdenVinculacion,&#xA;&#xA;Jerarquia=2,&#xA;Canal=--ca.caDescripcionAgrupacionCanal,&#xA;case when cc.ccCodigoNivel6 in (630281802003,640215802003)&#xA;then&#xA;(&#xA;case when asCodigoAsesor in ('IBS','-1') then isnull(--clCanal&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where caIdCanal=cl.clIdCanal),&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG')&#xA;)--'NNG')&#xA;&#xA;else isnull(--asCodigoCanal&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where rtrim(ltrim(caCodigoCanal))= case when ltrim(rtrim(ase.asCodigoCanal)) in ('N/A','-1') then 'NDI' else ltrim(rtrim(ase.asCodigoCanal))  end  )&#xA;--(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal=  ase.asCodigoCanal )&#xA;,isnull(caDescripcionAgrupacionCanal,(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'))--'NNG')&#xA;)&#xA;end&#xA;)&#xA;else isnull(&#xA;--clCanal&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where caIdCanal=cl.clIdCanal),&#xA;(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG')&#xA;)--'NNG')&#xA;end,&#xA;&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel2=sc.scSegmentacionTipo,&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case ao.aoIdFecha when @FechAct then (sum(isnull(ao.aoMontoSaldoDolar,0))/1000)*-1 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case ao.aoIdFecha when @FechaAyer then (sum(isnull(ao.aoMontoSaldoDolar,0))/1000)*-1 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case ao.aoIdFecha when @FechaMesAnt then (sum(isnull(ao.aoMontoSaldoDolar,0))/1000)*-1 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case ao.aoIdFecha when @FechaAnioAnt then (sum(isnull(ao.aoMontoSaldoDolar,0))/1000)*-1 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=0,&#xA;DenominadorPresupuesto=0&#xA;&#xA;from #DWHActivoOperacion ao&#xA;inner join #DWDCuentaContable cc on ao.aoIdCuentaContable=ccIdCuentaContable&#xA;inner join DWDCliente cl on ao.aoIdCliente=clIdCliente&#xA;inner join DWDSegmentacionCliente sc on cl.clIdSegmentacionCliente=sc.scIdSegmentacionCliente  -- verificar los left&#xA;inner join DWDVinculacionCliente v on cl.clIdVinculacionCliente=v.vcIdVinculacionCliente -- verificar los left&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 3&#xA;and p1.CpCodigoIndicador in (160,161)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where ao.aoIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)&#xA;and sc.scIdCodigo not in (1,2,3)&#xA;group by cc.ccFamiliaProducto,&#xA;cl.clIdCanal,&#xA;cc.ccCodigoNivel6,&#xA;ase.asCodigoCanal,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;sc.scSegmentacionOrdenN2,&#xA;sc.scSegmentacionOrdenN3,&#xA;sc.scSegmentacionTipo,&#xA;v.vcOrdenVinculacion,&#xA;v.vcVinculacionAgrupacion,&#xA;asCodigoAsesor,&#xA;ao.aoIdFecha&#xA;&#xA;union all&#xA;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;---- Creditos no desembolsados&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;select&#xA;OrderN1=@OrdenContingenteSegmentacion,&#xA;OrderN2=100,&#xA;OrderN2=1,&#xA;Jerarquia=2,&#xA;Canal=(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'),&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=ccFamiliaProducto+'-Segm',&#xA;Nivel2=ccGrupo,&#xA;Nivel3=ccGrupo,&#xA;Nivel4=ccGrupo,&#xA;Nivel5=ccGrupo,&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case bs.bsIdFecha when @FechAct then sum(bs.bsSaldoDolarizado)/1000 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case bs.bsIdFecha when @FechaAyer then sum(bs.bsSaldoDolarizado)/1000 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case bs.bsIdFecha when @FechaMesAnt then sum(bs.bsSaldoDolarizado)/1000 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case bs.bsIdFecha when @FechaAnioAnt then sum(bs.bsSaldoDolarizado)/1000 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=case bs.bsIdFecha when @FechAct then sum(bs.bsSaldoDolarizado)/1000 else 0 end,-- el presupuesto es igual al real hoy&#xA;DenominadorPresupuesto=0&#xA;from DWHBalanceSaldo bs&#xA;inner join #DWDCuentaContable cc on bs.bsIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 3&#xA;and p1.CpCodigoIndicador = 162&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where bs.bsIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;group by bs.bsIdFecha,&#xA;cc.ccOrdenAgrupacion,&#xA;ccFamiliaProducto,&#xA;ccGrupo,&#xA;ccSubGrupo&#xA;&#xA;&#xA;union all&#xA;&#xA;-- Valor Deduccion Creditos No desembolsados&#xA;&#xA;select&#xA;OrderN1=@OrdenContingenteSegmentacion,&#xA;OrderN2=100,&#xA;OrderN3=100,&#xA;Jerarquia=1,&#xA;Canal=(select caDescripcionAgrupacionCanal from dwdcanal where caCodigoCanal='NNG'),&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=ccFamiliaProducto+'-Segm',&#xA;Nivel2='Deducción',&#xA;Nivel3='Deducción',&#xA;Nivel4='Deducción',&#xA;Nivel5='Deducción',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=case bs.bsIdFecha when @FechAct then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,&#xA;DenominadorHoy=0,&#xA;RealAyer=case bs.bsIdFecha when @FechaAyer then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=case bs.bsIdFecha when @FechaMesAnt then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=case bs.bsIdFecha when @FechaAnioAnt then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=case bs.bsIdFecha when @FechAct then (sum(bs.bsSaldoDolarizado)/1000)*-1 else 0 end,&#xA;DenominadorPresupuesto=0&#xA;from DWHBalanceSaldo bs&#xA;inner join #DWDCuentaContable cc on bs.bsIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 3&#xA;and p1.CpCodigoIndicador = 162&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where bs.bsIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;group by bs.bsIdFecha,&#xA;cc.ccOrdenAgrupacion,&#xA;ccFamiliaProducto,&#xA;ccGrupo,&#xA;ccSubGrupo&#xA;&#xA;Union all&#xA;&#xA;/* Presupuesto Negocio*/&#xA;&#xA;select&#xA;OrdenN1=@OrdenContingenteSegmentacion,&#xA;OrdenN2=@OrdenContingenteSegmentacion,&#xA;OrdenN3=@OrdenContingenteSegmentacion,&#xA;Jerarquia=1,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Division='NO',&#xA;Consolidado='NO',&#xA;Nivel1=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel2=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel3=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel4=cc.ccFamiliaProducto+'-Segm',&#xA;Nivel5=cc.ccFamiliaProducto+'-Segm',&#xA;FechaHoy=@FechAct,&#xA;RealHoy=0,&#xA;DenominadorHoy=0,&#xA;RealAyer=0,&#xA;DenominadorAyer=0,&#xA;RealMesAnt=0,&#xA;DenominadorMesAnt=0,&#xA;RealAnioAnt=0,&#xA;DenominadorAnioAnt=0,&#xA;ValorPresupuesto=sum(isnull(pn.pnValorPresupuesto,0))/1000,&#xA;DenominadorPresupuesto=0&#xA;from DWHPresupuestoNegocio pn&#xA;inner join #DWDCuentaContable cc on pn.pnIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCanal ca on pn.pnIdCanal=ca.caIdCanal&#xA;inner join DWDAgenciaOperacion ag on pn.pnIdAgencia=ag.agIdAgencia&#xA;inner join (&#xA;SELECT DISTINCT&#xA;p2.CpCodigoIndicador indicadorNivel3&#xA;FROM DWDClasificacionProductos p&#xA;join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;WHERE p.CpCodigoIndicador = 3&#xA;and p1.CpCodigoIndicador in (160,161)&#xA;and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON cc.ccCodigoIndicador=cp.indicadorNivel3&#xA;where pn.pnIdFecha in (@FechAct)&#xA;and ca.caEstado=1&#xA;and pn.pnIdIndicadorMedidaFinanciera=-10&#xA;group by cc.ccFamiliaProducto,&#xA;ca.caDescripcionAgrupacionCanal&#xA;&#xA;&#xA;-------------------&#xA;-- Hoja Posicion&#xA;-------------------&#xA;&#xA;&#xA;select&#xA;OrdenN1,&#xA;OrdenN2,&#xA;OrdenN3,&#xA;Jerarquia,&#xA;Canal,&#xA;Division,&#xA;Consolidado,&#xA;Nivel1,&#xA;Nivel2,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5,&#xA;FechaHoy,&#xA;RealHoy=sum(RealHoy),&#xA;DenominadorHoy=sum(DenominadorHoy),&#xA;RealAyer=sum(RealAyer),&#xA;DenominadorAyer=sum(DenominadorAyer),&#xA;RealMesAnt=sum(RealMesAnt),&#xA;DenominadorMesAnt=sum(DenominadorMesAnt),&#xA;RealAnioAnt=sum(RealAnioAnt),&#xA;DenominadorAnioAnt=sum(DenominadorAnioAnt),&#xA;ValorPresupuesto=sum(ValorPresupuesto),&#xA;DenominadorPresupuesto=sum(DenominadorPresupuesto)&#xA;from #hoja&#xA;group by&#xA;OrdenN1,&#xA;OrdenN2,&#xA;OrdenN3,&#xA;Jerarquia,&#xA;Canal,&#xA;Division,&#xA;Consolidado,&#xA;Nivel1,&#xA;Nivel2,&#xA;Nivel3,&#xA;Nivel4,&#xA;Nivel5,&#xA;FechaHoy&#xA;having&#xA;abs(sum(RealHoy))+abs(sum(DenominadorHoy))+abs(sum(RealAyer))+abs(sum(DenominadorAyer))&#xA;+abs(sum(RealMesAnt))+abs(sum(DenominadorMesAnt))+abs(sum(RealAnioAnt))+abs(sum(DenominadorAnioAnt))+abs(sum(ValorPresupuesto))&#xA;+abs(sum(DenominadorPresupuesto))&gt;0&#xA;order by 1,2,3">
                      <xs:complexType>
                        <xs:sequence>
                          <xs:element name="OrdenN1" msprop:DbColumnName="OrdenN1" msprop:FriendlyName="OrdenN1" type="xs:int" minOccurs="0" />
                          <xs:element name="OrdenN2" msprop:DbColumnName="OrdenN2" msprop:FriendlyName="OrdenN2" type="xs:int" minOccurs="0" />
                          <xs:element name="OrdenN3" msprop:DbColumnName="OrdenN3" msprop:FriendlyName="OrdenN3" type="xs:int" minOccurs="0" />
                          <xs:element name="Jerarquia" msprop:DbColumnName="Jerarquia" msprop:FriendlyName="Jerarquia" type="xs:int" minOccurs="0" />
                          <xs:element name="Canal" msprop:DbColumnName="Canal" msprop:FriendlyName="Canal" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32768" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="Division" msprop:DbColumnName="Division" msprop:FriendlyName="Division" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32768" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="Nivel1" msprop:DbColumnName="Nivel1" msprop:FriendlyName="Nivel1" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32768" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="Nivel2" msprop:DbColumnName="Nivel2" msprop:FriendlyName="Nivel2" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32768" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="Nivel3" msprop:DbColumnName="Nivel3" msprop:FriendlyName="Nivel3" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32768" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="Nivel4" msprop:DbColumnName="Nivel4" msprop:FriendlyName="Nivel4" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32768" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="Nivel5" msprop:DbColumnName="Nivel5" msprop:FriendlyName="Nivel5" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32768" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="RealHoy" msprop:DbColumnName="RealHoy" msprop:FriendlyName="RealHoy" type="xs:double" minOccurs="0" />
                          <xs:element name="DenominadorHoy" msprop:DbColumnName="DenominadorHoy" msprop:FriendlyName="DenominadorHoy" type="xs:int" minOccurs="0" />
                          <xs:element name="RealAyer" msprop:DbColumnName="RealAyer" msprop:FriendlyName="RealAyer" type="xs:double" minOccurs="0" />
                          <xs:element name="DenominadorAyer" msprop:DbColumnName="DenominadorAyer" msprop:FriendlyName="DenominadorAyer" type="xs:int" minOccurs="0" />
                          <xs:element name="RealMesAnt" msprop:DbColumnName="RealMesAnt" msprop:FriendlyName="RealMesAnt" type="xs:double" minOccurs="0" />
                          <xs:element name="DenominadorMesAnt" msprop:DbColumnName="DenominadorMesAnt" msprop:FriendlyName="DenominadorMesAnt" type="xs:int" minOccurs="0" />
                          <xs:element name="RealAnioAnt" msprop:DbColumnName="RealAnioAnt" msprop:FriendlyName="RealAnioAnt" type="xs:double" minOccurs="0" />
                          <xs:element name="DenominadorAnioAnt" msprop:DbColumnName="DenominadorAnioAnt" msprop:FriendlyName="DenominadorAnioAnt" type="xs:int" minOccurs="0" />
                          <xs:element name="ValorPresupuesto" msprop:DbColumnName="ValorPresupuesto" msprop:FriendlyName="ValorPresupuesto" type="xs:double" minOccurs="0" />
                          <xs:element name="DenominadorPresupuesto" msprop:DbColumnName="DenominadorPresupuesto" msprop:FriendlyName="DenominadorPresupuesto" type="xs:int" minOccurs="0" />
                          <xs:element name="FechaHoy" msprop:DbColumnName="FechaHoy" msprop:FriendlyName="FechaHoy" type="xs:int" minOccurs="0" />
                          <xs:element name="Consolidado" msprop:DbColumnName="Consolidado" msprop:FriendlyName="Consolidado" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                        </xs:sequence>
                      </xs:complexType>
                    </xs:element>
                    <xs:element name="MargenFinanciero_28a72c58-fcda-49e2-8c5b-690a01cb201d" msdata:Locale="" msprop:IsLogical="True" msprop:FriendlyName="MargenFinanciero" msprop:DbTableName="MargenFinanciero" msprop:TableType="View" msprop:Description="MargenFinanciero" msprop:QueryDefinition="set nocount on &#xA;&#xA;if OBJECT_ID('[tempdb]..#DWHMonitorConsolidadoMargenV2') is not null&#xA;begin&#xA;drop table #DWHMonitorConsolidadoMargenV2&#xA;end&#xA;&#xA;&#xA;select * &#xA;into #DWHMonitorConsolidadoMargenV2&#xA;from DWHMonitorConsolidadoMargenV2&#xA;where nombre is not null&#xA;&#xA;update  #DWHMonitorConsolidadoMargenV2 &#xA;set CodigoPadre=null&#xA;where CodigoPadre in &#xA;(&#xA;select &#xA;codigo&#xA;from DWHMonitorConsolidadoMargenV2&#xA;where nivel=1&#xA;)&#xA;&#xA;&#xA;select &#xA;Jerarquia,&#xA;Agrupacion= &#xA;       case &#xA;       when CodigoN1 between 101000000 and 200000000 then  'Captaciones' else 'Cartera' end,&#xA;CodigoN1,&#xA;DescripcionN1=NombreN1,&#xA;CodigoN2,&#xA;DescripcionN2=NombreN2,&#xA;CodigoN3,&#xA;DescripcionN3=NombreN3,&#xA;CodigoN4,&#xA;DescripcionN4=NombreN4,&#xA;CodigoN5,&#xA;DescripcionN5=CAST(NombreN5  as varchar(100)),&#xA;diaPart,&#xA;diaSaldo,&#xA;diaTPP,&#xA;diaPYG,&#xA;mesPart,&#xA;mesSaldo,&#xA;mesTPP,&#xA;mesPYG,&#xA;anioPart,&#xA;anioSaldo,&#xA;anioTPP,&#xA;anioPYG,&#xA;mesPres,&#xA;anioPres&#xA;&#xA;from &#xA;&#xA;(&#xA;&#xA;-------------------------&#xA;--- Tinen solo 1 nivel&#xA;-------------------------&#xA;&#xA;select distinct&#xA;Jerarquia=1,&#xA;&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;Codigon2=null,&#xA;Nombren2=null,&#xA;&#xA;CodigoN3=null,&#xA;NombreN3=null,&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;&#xA;n1.diaPart,&#xA;n1.diaSaldo,&#xA;n1.diaTPP,&#xA;n1.diaPYG,&#xA;n1.mesPart,&#xA;n1.mesSaldo,&#xA;n1.mesTPP,&#xA;n1.mesPYG,&#xA;n1.anioPart,&#xA;n1.anioSaldo,&#xA;n1.anioTPP,&#xA;n1.anioPYG,&#xA;n1.mesPres,&#xA;n1.anioPres&#xA;&#xA;from #DWHMonitorConsolidadoMargenV2 n1&#xA;where nivel in (1,2)&#xA;and n1.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;&#xA;&#xA;union all&#xA;&#xA;------------------------&#xA;-- Tinen solo 2 niveles&#xA;------------------------&#xA;&#xA;-- nivel2&#xA;&#xA;select distinct&#xA;Jerarquia=2,&#xA;&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=n2.codigo,&#xA;NombreN2=n2.nombre,&#xA;&#xA;CodigoN3=null,&#xA;NombreN3=null,&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;&#xA;n2.diaPart,&#xA;n2.diaSaldo,&#xA;n2.diaTPP,&#xA;n2.diaPYG,&#xA;n2.mesPart,&#xA;n2.mesSaldo,&#xA;n2.mesTPP,&#xA;n2.mesPYG,&#xA;n2.anioPart,&#xA;n2.anioSaldo,&#xA;n2.anioTPP,&#xA;n2.anioPYG,&#xA;n2.mesPres,&#xA;n2.anioPres&#xA;&#xA;from #DWHMonitorConsolidadoMargenV2  n2 inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;where n2.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 and n2.nivel=3&#xA;&#xA;union all&#xA;&#xA;-- valor deduccion nivel2&#xA;&#xA;select distinct&#xA;Jerarquia=1,&#xA;&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=null,&#xA;NombreN2='Deducción',&#xA;&#xA;CodigoN3=null,&#xA;NombreN3=null,&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;&#xA;n2.diaPart*-1,&#xA;n2.diaSaldo*-1,&#xA;n2.diaTPP*-1,&#xA;n2.diaPYG*-1,&#xA;n2.mesPart*-1,&#xA;n2.mesSaldo*-1,&#xA;n2.mesTPP*-1,&#xA;n2.mesPYG*-1,&#xA;n2.anioPart*-1,&#xA;n2.anioSaldo*-1,&#xA;n2.anioTPP*-1,&#xA;n2.anioPYG*-1,&#xA;n2.mesPres*-1,&#xA;n2.anioPres*-1&#xA;&#xA;from #DWHMonitorConsolidadoMargenV2  n2 inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;where n2.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 and n2.nivel=3&#xA;&#xA;union all&#xA;&#xA;-- nivel 1&#xA;&#xA;select distinct&#xA;Jerarquia=1,&#xA;&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=null,&#xA;NombreN2=null,&#xA;CodigoN3=null,&#xA;NombreN3=null,&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;&#xA;n1.diaPart,&#xA;n1.diaSaldo,&#xA;n1.diaTPP,&#xA;n1.diaPYG,&#xA;n1.mesPart,&#xA;n1.mesSaldo,&#xA;n1.mesTPP,&#xA;n1.mesPYG,&#xA;n1.anioPart,&#xA;n1.anioSaldo,&#xA;n1.anioTPP,&#xA;n1.anioPYG,&#xA;n1.mesPres,&#xA;n1.anioPres&#xA;&#xA;from #DWHMonitorConsolidadoMargenV2  n2 inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;where n2.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 and n2.nivel=3&#xA;&#xA;&#xA;union all&#xA;------------------------&#xA;-- Tinen solo 3 niveles&#xA;------------------------&#xA;&#xA;-- nivel3&#xA;&#xA;select distinct&#xA;Jerarquia=3,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=n2.codigo,&#xA;NombreN2=n2.nombre,&#xA;CodigoN3=n3.codigo,&#xA;NombreN3=n3.nombre,&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n3.diaPart,&#xA;n3.diaSaldo,&#xA;n3.diaTPP,&#xA;n3.diaPYG,&#xA;n3.mesPart,&#xA;n3.mesSaldo,&#xA;n3.mesTPP,&#xA;n3.mesPYG,&#xA;n3.anioPart,&#xA;n3.anioSaldo,&#xA;n3.anioTPP,&#xA;n3.anioPYG,&#xA;n3.mesPres,&#xA;n3.anioPres&#xA;from #DWHMonitorConsolidadoMargenV2  n3 &#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;where n3.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 &#xA;and n2.nivel=3&#xA;and n3.nivel=4&#xA;&#xA;union all&#xA;&#xA;-- valor deduccion nivel 3&#xA;&#xA;select distinct&#xA;Jerarquia=2,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=n2.codigo,&#xA;NombreN2=n2.nombre,&#xA;CodigoN3=null,&#xA;NombreN3='Deducción',&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n3.diaPart*-1,&#xA;n3.diaSaldo*-1,&#xA;n3.diaTPP*-1,&#xA;n3.diaPYG*-1,&#xA;n3.mesPart*-1,&#xA;n3.mesSaldo*-1,&#xA;n3.mesTPP*-1,&#xA;n3.mesPYG*-1,&#xA;n3.anioPart*-1,&#xA;n3.anioSaldo*-1,&#xA;n3.anioTPP*-1,&#xA;n3.anioPYG*-1,&#xA;n3.mesPres*-1,&#xA;n3.anioPres*-1&#xA;from #DWHMonitorConsolidadoMargenV2  n3 &#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;where n3.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 &#xA;and n2.nivel=3 &#xA;and n3.nivel=4&#xA;&#xA;union all&#xA;&#xA;-- Valor Nivel 2&#xA;&#xA;select distinct&#xA;Jerarquia=2,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=n2.codigo,&#xA;NombreN2=n2.nombre,&#xA;CodigoN3=null,&#xA;NombreN3=null,&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n2.diaPart,&#xA;n2.diaSaldo,&#xA;n2.diaTPP,&#xA;n2.diaPYG,&#xA;n2.mesPart,&#xA;n2.mesSaldo,&#xA;n2.mesTPP,&#xA;n2.mesPYG,&#xA;n2.anioPart,&#xA;n2.anioSaldo,&#xA;n2.anioTPP,&#xA;n2.anioPYG,&#xA;n2.mesPres,&#xA;n2.anioPres&#xA;from #DWHMonitorConsolidadoMargenV2  n3 &#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;where n3.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 &#xA;and n2.nivel=3 &#xA;and n3.nivel=4&#xA;&#xA;union all&#xA;&#xA;-- Valor Deduccion Nivel 2&#xA;&#xA;select distinct&#xA;Jerarquia=1,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=null,&#xA;NombreN2='Deducción',&#xA;CodigoN3=null,&#xA;NombreN3=null,&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n2.diaPart*-1,&#xA;n2.diaSaldo*-1,&#xA;n2.diaTPP*-1,&#xA;n2.diaPYG*-1,&#xA;n2.mesPart*-1,&#xA;n2.mesSaldo*-1,&#xA;n2.mesTPP*-1,&#xA;n2.mesPYG*-1,&#xA;n2.anioPart*-1,&#xA;n2.anioSaldo*-1,&#xA;n2.anioTPP*-1,&#xA;n2.anioPYG*-1,&#xA;n2.mesPres*-1,&#xA;n2.anioPres*-1&#xA;from #DWHMonitorConsolidadoMargenV2  n3 &#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;where n3.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 &#xA;and n2.nivel=3 &#xA;and n3.nivel=4&#xA;&#xA;union all&#xA;&#xA;-- Valor Nivel 1&#xA;&#xA;select distinct&#xA;Jerarquia=1,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=null,&#xA;NombreN2=null,&#xA;CodigoN3=null,&#xA;NombreN3=null,&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n1.diaPart,&#xA;n1.diaSaldo,&#xA;n1.diaTPP,&#xA;n1.diaPYG,&#xA;n1.mesPart,&#xA;n1.mesSaldo,&#xA;n1.mesTPP,&#xA;n1.mesPYG,&#xA;n1.anioPart,&#xA;n1.anioSaldo,&#xA;n1.anioTPP,&#xA;n1.anioPYG,&#xA;n1.mesPres,&#xA;n1.anioPres&#xA;from #DWHMonitorConsolidadoMargenV2  n3 &#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;where n3.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 &#xA;and n2.nivel=3 &#xA;and n3.nivel=4&#xA;&#xA;union all&#xA;&#xA;------------------------&#xA;-- Tinen solo 4 niveles&#xA;------------------------&#xA;&#xA;-- nivel4&#xA;&#xA;select distinct&#xA;Jerarquia=4,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=n2.codigo,&#xA;NombreN2=n2.nombre,&#xA;CodigoN3=n3.codigo,&#xA;NombreN3=n3.nombre,&#xA;CodigoN4=n4.codigo,&#xA;NombreN4=n4.nombre,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n4.diaPart,&#xA;n4.diaSaldo,&#xA;n4.diaTPP,&#xA;n4.diaPYG,&#xA;n4.mesPart,&#xA;n4.mesSaldo,&#xA;n4.mesTPP,&#xA;n4.mesPYG,&#xA;n4.anioPart,&#xA;n4.anioSaldo,&#xA;n4.anioTPP,&#xA;n4.anioPYG,&#xA;n4.mesPres,&#xA;n4.anioPres&#xA;from #DWHMonitorConsolidadoMargenV2  n4 &#xA;inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 and n2.nivel=3&#xA;and n3.nivel=4 and n4.nivel=5&#xA;&#xA;union all&#xA;-- valor deduccion nivel4&#xA;&#xA;select distinct&#xA;Jerarquia=3,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=n2.codigo,&#xA;NombreN2=n2.nombre,&#xA;CodigoN3=n3.codigo,&#xA;NombreN3=n3.nombre,&#xA;CodigoN4=null,&#xA;NombreN4='Deducción',&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n4.diaPart*-1,&#xA;n4.diaSaldo*-1,&#xA;n4.diaTPP*-1,&#xA;n4.diaPYG*-1,&#xA;n4.mesPart*-1,&#xA;n4.mesSaldo*-1,&#xA;n4.mesTPP*-1,&#xA;n4.mesPYG*-1,&#xA;n4.anioPart*-1,&#xA;n4.anioSaldo*-1,&#xA;n4.anioTPP*-1,&#xA;n4.anioPYG*-1,&#xA;n4.mesPres*-1,&#xA;n4.anioPres*-1&#xA;from #DWHMonitorConsolidadoMargenV2  n4 &#xA;inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 and n2.nivel=3&#xA;and n3.nivel=4 and n4.nivel=5&#xA;&#xA;union all&#xA;&#xA;-- Valor Nivel 3&#xA;&#xA;select distinct&#xA;Jerarquia=3,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=n2.codigo,&#xA;NombreN2=n2.nombre,&#xA;CodigoN3=n3.codigo,&#xA;NombreN3=n3.nombre,&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n3.diaPart,&#xA;n3.diaSaldo,&#xA;n3.diaTPP,&#xA;n3.diaPYG,&#xA;n3.mesPart,&#xA;n3.mesSaldo,&#xA;n3.mesTPP,&#xA;n3.mesPYG,&#xA;n3.anioPart,&#xA;n3.anioSaldo,&#xA;n3.anioTPP,&#xA;n3.anioPYG,&#xA;n3.mesPres,&#xA;n3.anioPres&#xA;from #DWHMonitorConsolidadoMargenV2  n4 &#xA;inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 and n2.nivel=3&#xA;and n3.nivel=4 and n4.nivel=5&#xA;&#xA;union all&#xA;&#xA;-- Valor Deduccion Nivel 3&#xA;&#xA;select distinct&#xA;Jerarquia=2,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=n2.codigo,&#xA;NombreN2=n2.nombre,&#xA;CodigoN3=null,&#xA;NombreN3='Deducción',&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n3.diaPart*-1,&#xA;n3.diaSaldo*-1,&#xA;n3.diaTPP*-1,&#xA;n3.diaPYG*-1,&#xA;n3.mesPart*-1,&#xA;n3.mesSaldo*-1,&#xA;n3.mesTPP*-1,&#xA;n3.mesPYG*-1,&#xA;n3.anioPart*-1,&#xA;n3.anioSaldo*-1,&#xA;n3.anioTPP*-1,&#xA;n3.anioPYG*-1,&#xA;n3.mesPres*-1,&#xA;n3.anioPres*-1&#xA;from #DWHMonitorConsolidadoMargenV2  n4 &#xA;inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 and n2.nivel=3&#xA;and n3.nivel=4 and n4.nivel=5&#xA;&#xA;union all&#xA;-- Valor Nivel 2&#xA;&#xA;select distinct&#xA;Jerarquia=2,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=n2.codigo,&#xA;NombreN2=n2.nombre,&#xA;CodigoN3=null,&#xA;NombreN3=null,&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n2.diaPart,&#xA;n2.diaSaldo,&#xA;n2.diaTPP,&#xA;n2.diaPYG,&#xA;n2.mesPart,&#xA;n2.mesSaldo,&#xA;n2.mesTPP,&#xA;n2.mesPYG,&#xA;n2.anioPart,&#xA;n2.anioSaldo,&#xA;n2.anioTPP,&#xA;n2.anioPYG,&#xA;n2.mesPres,&#xA;n2.anioPres&#xA;from #DWHMonitorConsolidadoMargenV2  n4 &#xA;inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 and n2.nivel=3&#xA;and n3.nivel=4 and n4.nivel=5&#xA;&#xA;union all&#xA;&#xA;-- Valor Deduccion Nivel 2&#xA;&#xA;select distinct&#xA;Jerarquia=1,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=null,&#xA;NombreN2='Deducción',&#xA;CodigoN3=null,&#xA;NombreN3=null,&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n2.diaPart*-1,&#xA;n2.diaSaldo*-1,&#xA;n2.diaTPP*-1,&#xA;n2.diaPYG*-1,&#xA;n2.mesPart*-1,&#xA;n2.mesSaldo*-1,&#xA;n2.mesTPP*-1,&#xA;n2.mesPYG*-1,&#xA;n2.anioPart*-1,&#xA;n2.anioSaldo*-1,&#xA;n2.anioTPP*-1,&#xA;n2.anioPYG*-1,&#xA;n2.mesPres*-1,&#xA;n2.anioPres*-1&#xA;from #DWHMonitorConsolidadoMargenV2  n4 &#xA;inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 and n2.nivel=3&#xA;and n3.nivel=4 and n4.nivel=5&#xA;&#xA;union all&#xA;&#xA;-- Valor Nivel 1&#xA;&#xA;select distinct&#xA;Jerarquia=1,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=null,&#xA;NombreN2=null,&#xA;CodigoN3=null,&#xA;NombreN3=null,&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n1.diaPart,&#xA;n1.diaSaldo,&#xA;n1.diaTPP,&#xA;n1.diaPYG,&#xA;n1.mesPart,&#xA;n1.mesSaldo,&#xA;n1.mesTPP,&#xA;n1.mesPYG,&#xA;n1.anioPart,&#xA;n1.anioSaldo,&#xA;n1.anioTPP,&#xA;n1.anioPYG,&#xA;n1.mesPres,&#xA;n1.anioPres&#xA;from #DWHMonitorConsolidadoMargenV2  n4 &#xA;inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;where n4.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 and n2.nivel=3&#xA;and n3.nivel=4 and n4.nivel=5&#xA;&#xA;Union all&#xA;&#xA;&#xA;------------------------&#xA;-- Tinen solo 5 niveles&#xA;------------------------&#xA;&#xA;select distinct&#xA;Jerarquia=5,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=n2.codigo,&#xA;NombreN2=n2.nombre,&#xA;CodigoN3=n3.codigo,&#xA;NombreN3=n3.nombre,&#xA;CodigoN4=n4.codigo,&#xA;NombreN4=n4.nombre,&#xA;CodigoN5=n5.codigo,&#xA;NombreN5=n5.nombre,&#xA;n5.diaPart,&#xA;n5.diaSaldo,&#xA;n5.diaTPP,&#xA;n5.diaPYG,&#xA;n5.mesPart,&#xA;n5.mesSaldo,&#xA;n5.mesTPP,&#xA;n5.mesPYG,&#xA;n5.anioPart,&#xA;n5.anioSaldo,&#xA;n5.anioTPP,&#xA;n5.anioPYG,&#xA;n5.mesPres,&#xA;n5.anioPres&#xA;from #DWHMonitorConsolidadoMargenV2  n5&#xA;inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;&#xA;where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 &#xA;and n2.nivel=3&#xA;and n3.nivel=4&#xA;and n4.nivel=5&#xA;and n5.nivel=6&#xA;&#xA;&#xA;union all&#xA;&#xA;-- valor deduccion nivel5&#xA;&#xA;&#xA;select distinct&#xA;Jerarquia=4,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=n2.codigo,&#xA;NombreN2=n2.nombre,&#xA;CodigoN3=n3.codigo,&#xA;NombreN3=n3.nombre,&#xA;CodigoN4=n4.codigo,&#xA;NombreN4=n4.nombre,&#xA;CodigoN5=null,&#xA;NombreN5='Deducción',&#xA;n5.diaPart*-1,&#xA;n5.diaSaldo*-1,&#xA;n5.diaTPP*-1,&#xA;n5.diaPYG*-1,&#xA;n5.mesPart*-1,&#xA;n5.mesSaldo*-1,&#xA;n5.mesTPP*-1,&#xA;n5.mesPYG*-1,&#xA;n5.anioPart*-1,&#xA;n5.anioSaldo*-1,&#xA;n5.anioTPP*-1,&#xA;n5.anioPYG*-1,&#xA;n5.mesPres*-1,&#xA;n5.anioPres*-1&#xA;from #DWHMonitorConsolidadoMargenV2  n5&#xA;inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;&#xA;where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 &#xA;and n2.nivel=3&#xA;and n3.nivel=4&#xA;and n4.nivel=5&#xA;and n5.nivel=6&#xA;&#xA;union all&#xA;&#xA;-- nivel4&#xA;&#xA;&#xA;select distinct&#xA;Jerarquia=4,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=n2.codigo,&#xA;NombreN2=n2.nombre,&#xA;CodigoN3=n3.codigo,&#xA;NombreN3=n3.nombre,&#xA;CodigoN4=n4.codigo,&#xA;NombreN4=n4.nombre,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n4.diaPart,&#xA;n4.diaSaldo,&#xA;n4.diaTPP,&#xA;n4.diaPYG,&#xA;n4.mesPart,&#xA;n4.mesSaldo,&#xA;n4.mesTPP,&#xA;n4.mesPYG,&#xA;n4.anioPart,&#xA;n4.anioSaldo,&#xA;n4.anioTPP,&#xA;n4.anioPYG,&#xA;n4.mesPres,&#xA;n4.anioPres&#xA;from #DWHMonitorConsolidadoMargenV2  n5&#xA;inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;&#xA;where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 &#xA;and n2.nivel=3&#xA;and n3.nivel=4&#xA;and n4.nivel=5&#xA;and n5.nivel=6&#xA;&#xA;&#xA;&#xA;&#xA;union all&#xA;-- valor deduccion nivel4&#xA;&#xA;&#xA;select distinct&#xA;Jerarquia=3,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=n2.codigo,&#xA;NombreN2=n2.nombre,&#xA;CodigoN3=n3.codigo,&#xA;NombreN3=n3.nombre,&#xA;CodigoN4=null,&#xA;NombreN4='Deducción',&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n4.diaPart*-1,&#xA;n4.diaSaldo*-1,&#xA;n4.diaTPP*-1,&#xA;n4.diaPYG*-1,&#xA;n4.mesPart*-1,&#xA;n4.mesSaldo*-1,&#xA;n4.mesTPP*-1,&#xA;n4.mesPYG*-1,&#xA;n4.anioPart*-1,&#xA;n4.anioSaldo*-1,&#xA;n4.anioTPP*-1,&#xA;n4.anioPYG*-1,&#xA;n4.mesPres*-1,&#xA;n4.anioPres*-1&#xA;from #DWHMonitorConsolidadoMargenV2  n5&#xA;inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;&#xA;where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 &#xA;and n2.nivel=3&#xA;and n3.nivel=4&#xA;and n4.nivel=5&#xA;and n5.nivel=6&#xA;&#xA;&#xA;union all&#xA;&#xA;-- Valor Nivel 3&#xA;&#xA;select distinct&#xA;Jerarquia=3,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=n2.codigo,&#xA;NombreN2=n2.nombre,&#xA;CodigoN3=n3.codigo,&#xA;NombreN3=n3.nombre,&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n3.diaPart,&#xA;n3.diaSaldo,&#xA;n3.diaTPP,&#xA;n3.diaPYG,&#xA;n3.mesPart,&#xA;n3.mesSaldo,&#xA;n3.mesTPP,&#xA;n3.mesPYG,&#xA;n3.anioPart,&#xA;n3.anioSaldo,&#xA;n3.anioTPP,&#xA;n3.anioPYG,&#xA;n3.mesPres,&#xA;n3.anioPres&#xA;from #DWHMonitorConsolidadoMargenV2  n5&#xA;inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;&#xA;where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 &#xA;and n2.nivel=3&#xA;and n3.nivel=4&#xA;and n4.nivel=5&#xA;and n5.nivel=6&#xA;&#xA;union all&#xA;&#xA;-- Valor Deduccion Nivel 3&#xA;&#xA;select distinct&#xA;Jerarquia=2,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=n2.codigo,&#xA;NombreN2=n2.nombre,&#xA;CodigoN3=null,&#xA;NombreN3='Deducción',&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n3.diaPart*-1,&#xA;n3.diaSaldo*-1,&#xA;n3.diaTPP*-1,&#xA;n3.diaPYG*-1,&#xA;n3.mesPart*-1,&#xA;n3.mesSaldo*-1,&#xA;n3.mesTPP*-1,&#xA;n3.mesPYG*-1,&#xA;n3.anioPart*-1,&#xA;n3.anioSaldo*-1,&#xA;n3.anioTPP*-1,&#xA;n3.anioPYG*-1,&#xA;n3.mesPres*-1,&#xA;n3.anioPres*-1&#xA;from #DWHMonitorConsolidadoMargenV2  n5&#xA;inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;&#xA;where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 &#xA;and n2.nivel=3&#xA;and n3.nivel=4&#xA;and n4.nivel=5&#xA;and n5.nivel=6&#xA;&#xA;&#xA;union all&#xA;-- Valor Nivel 2&#xA;&#xA;select distinct&#xA;Jerarquia=2,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=n2.codigo,&#xA;NombreN2=n2.nombre,&#xA;CodigoN3=null,&#xA;NombreN3=null,&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n2.diaPart,&#xA;n2.diaSaldo,&#xA;n2.diaTPP,&#xA;n2.diaPYG,&#xA;n2.mesPart,&#xA;n2.mesSaldo,&#xA;n2.mesTPP,&#xA;n2.mesPYG,&#xA;n2.anioPart,&#xA;n2.anioSaldo,&#xA;n2.anioTPP,&#xA;n2.anioPYG,&#xA;n2.mesPres,&#xA;n2.anioPres&#xA;from #DWHMonitorConsolidadoMargenV2  n5&#xA;inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;&#xA;where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 &#xA;and n2.nivel=3&#xA;and n3.nivel=4&#xA;and n4.nivel=5&#xA;and n5.nivel=6&#xA;&#xA;&#xA;union all&#xA;&#xA;-- Valor Deduccion Nivel 2&#xA;&#xA;select distinct&#xA;Jerarquia=1,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=null,&#xA;NombreN2='Deducción',&#xA;CodigoN3=null,&#xA;NombreN3=null,&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n2.diaPart*-1,&#xA;n2.diaSaldo*-1,&#xA;n2.diaTPP*-1,&#xA;n2.diaPYG*-1,&#xA;n2.mesPart*-1,&#xA;n2.mesSaldo*-1,&#xA;n2.mesTPP*-1,&#xA;n2.mesPYG*-1,&#xA;n2.anioPart*-1,&#xA;n2.anioSaldo*-1,&#xA;n2.anioTPP*-1,&#xA;n2.anioPYG*-1,&#xA;n2.mesPres*-1,&#xA;n2.anioPres*-1&#xA;from #DWHMonitorConsolidadoMargenV2  n5&#xA;inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;&#xA;where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 &#xA;and n2.nivel=3&#xA;and n3.nivel=4&#xA;and n4.nivel=5&#xA;and n5.nivel=6&#xA;&#xA;&#xA;union all&#xA;&#xA;-- Valor Nivel 1&#xA;&#xA;select distinct&#xA;Jerarquia=1,&#xA;CodigoN1=n1.codigo,&#xA;NombreN1=n1.nombre,&#xA;CodigoN2=null,&#xA;NombreN2=null,&#xA;CodigoN3=null,&#xA;NombreN3=null,&#xA;CodigoN4=null,&#xA;NombreN4=null,&#xA;CodigoN5=null,&#xA;NombreN5=null,&#xA;n1.diaPart,&#xA;n1.diaSaldo,&#xA;n1.diaTPP,&#xA;n1.diaPYG,&#xA;n1.mesPart,&#xA;n1.mesSaldo,&#xA;n1.mesTPP,&#xA;n1.mesPYG,&#xA;n1.anioPart,&#xA;n1.anioSaldo,&#xA;n1.anioTPP,&#xA;n1.anioPYG,&#xA;n1.mesPres,&#xA;n1.anioPres&#xA;from #DWHMonitorConsolidadoMargenV2  n5&#xA;inner join #DWHMonitorConsolidadoMargenV2  n4 on n5.CodigoPadre=n4.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n3 on n4.CodigoPadre=n3.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2  n2 on n3.CodigoPadre=n2.codigo&#xA;inner join #DWHMonitorConsolidadoMargenV2 n1 on n2.CodigoPadre=n1.codigo&#xA;&#xA;where n5.codigo not in (select distinct CodigoPadre from #DWHMonitorConsolidadoMargenV2 where CodigoPadre is not null)&#xA;and n1.nivel=2 &#xA;and n2.nivel=3&#xA;and n3.nivel=4&#xA;and n4.nivel=5&#xA;and n5.nivel=6&#xA;&#xA;&#xA;&#xA;) as Margen &#xA;&#xA;order by &#xA;CodigoN1,&#xA;CodigoN2,&#xA;CodigoN3,&#xA;CodigoN4,&#xA;CodigoN5">
                      <xs:complexType>
                        <xs:sequence>
                          <xs:element name="Jerarquia" msprop:DbColumnName="Jerarquia" msprop:FriendlyName="Jerarquia" type="xs:int" minOccurs="0" />
                          <xs:element name="Agrupacion" msprop:DbColumnName="Agrupacion" msprop:FriendlyName="Agrupacion" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="CodigoN1" msprop:DbColumnName="CodigoN1" msprop:FriendlyName="CodigoN1" type="xs:int" minOccurs="0" />
                          <xs:element name="DescripcionN1" msprop:DbColumnName="DescripcionN1" msprop:FriendlyName="DescripcionN1" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="CodigoN2" msprop:DbColumnName="CodigoN2" msprop:FriendlyName="CodigoN2" type="xs:int" minOccurs="0" />
                          <xs:element name="DescripcionN2" msprop:DbColumnName="DescripcionN2" msprop:FriendlyName="DescripcionN2" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="CodigoN3" msprop:DbColumnName="CodigoN3" msprop:FriendlyName="CodigoN3" type="xs:int" minOccurs="0" />
                          <xs:element name="DescripcionN3" msprop:DbColumnName="DescripcionN3" msprop:FriendlyName="DescripcionN3" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="CodigoN4" msprop:DbColumnName="CodigoN4" msprop:FriendlyName="CodigoN4" type="xs:int" minOccurs="0" />
                          <xs:element name="DescripcionN4" msprop:DbColumnName="DescripcionN4" msprop:FriendlyName="DescripcionN4" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="CodigoN5" msprop:DbColumnName="CodigoN5" msprop:FriendlyName="CodigoN5" type="xs:int" minOccurs="0" />
                          <xs:element name="diaPart" msprop:DbColumnName="diaPart" msprop:FriendlyName="diaPart" type="xs:double" minOccurs="0" />
                          <xs:element name="diaSaldo" msprop:DbColumnName="diaSaldo" msprop:FriendlyName="diaSaldo" type="xs:double" minOccurs="0" />
                          <xs:element name="diaTPP" msprop:DbColumnName="diaTPP" msprop:FriendlyName="diaTPP" type="xs:double" minOccurs="0" />
                          <xs:element name="diaPYG" msprop:DbColumnName="diaPYG" msprop:FriendlyName="diaPYG" type="xs:double" minOccurs="0" />
                          <xs:element name="mesPart" msprop:DbColumnName="mesPart" msprop:FriendlyName="mesPart" type="xs:double" minOccurs="0" />
                          <xs:element name="mesSaldo" msprop:DbColumnName="mesSaldo" msprop:FriendlyName="mesSaldo" type="xs:double" minOccurs="0" />
                          <xs:element name="mesTPP" msprop:DbColumnName="mesTPP" msprop:FriendlyName="mesTPP" type="xs:double" minOccurs="0" />
                          <xs:element name="mesPYG" msprop:DbColumnName="mesPYG" msprop:FriendlyName="mesPYG" type="xs:double" minOccurs="0" />
                          <xs:element name="anioPart" msprop:DbColumnName="anioPart" msprop:FriendlyName="anioPart" type="xs:double" minOccurs="0" />
                          <xs:element name="anioSaldo" msprop:DbColumnName="anioSaldo" msprop:FriendlyName="anioSaldo" type="xs:double" minOccurs="0" />
                          <xs:element name="anioTPP" msprop:DbColumnName="anioTPP" msprop:FriendlyName="anioTPP" type="xs:double" minOccurs="0" />
                          <xs:element name="anioPYG" msprop:DbColumnName="anioPYG" msprop:FriendlyName="anioPYG" type="xs:double" minOccurs="0" />
                          <xs:element name="mesPres" msprop:DbColumnName="mesPres" msprop:FriendlyName="mesPres" type="xs:double" minOccurs="0" />
                          <xs:element name="anioPres" msprop:DbColumnName="anioPres" msprop:FriendlyName="anioPres" type="xs:double" minOccurs="0" />
                          <xs:element name="DescripcionN5" msprop:DbColumnName="DescripcionN5" msprop:FriendlyName="DescripcionN5" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                        </xs:sequence>
                      </xs:complexType>
                    </xs:element>
                    <xs:element name="IndicadoresTasaMargen_05da7464-4aa7-4d86-8e45-5bf7da422953" msdata:Locale="" msprop:IsLogical="True" msprop:FriendlyName="IndicadoresTasaMargen" msprop:DbTableName="IndicadoresTasaMargen" msprop:TableType="View" msprop:Description="IndicadoresTasaMargen" msprop:QueryDefinition="declare @fechaActual int&#xD;&#xA;select @fechaActual = feidfecha from DWDFecha where feDiaActual = 1&#xD;&#xA;&#xD;&#xA;if object_id('[tempdb]..#tmFecha') is not null&#xD;&#xA;begin&#xD;&#xA;drop table #tmFecha&#xD;&#xA;end&#xD;&#xA;&#xD;&#xA;select  ROW_NUMBER() OVER(ORDER BY tmFecha DESC) AS Row#,&#xD;&#xA;tmFecha,&#xD;&#xA;tmbandera=0&#xD;&#xA;into #tmFecha&#xD;&#xA;from (&#xD;&#xA;select &#xD;&#xA;distinct top 90 tmFecha from DWHIndicadorTasaMargen&#xD;&#xA;where tmFecha &lt;= @fechaActual&#xD;&#xA;order by tmFecha desc ) a&#xD;&#xA;update x&#xD;&#xA;set&#xD;&#xA;tmbandera = 1&#xD;&#xA; from #tmFecha x&#xD;&#xA;inner join DWDFecha on tmFecha = feIdFecha&#xD;&#xA;where feCierreMesTodosAnios = 1&#xD;&#xA;update x&#xD;&#xA;set&#xD;&#xA;tmbandera = 1&#xD;&#xA; from #tmFecha x&#xD;&#xA;inner join DWDFecha on tmFecha = feIdFechaHaceUnMesLab&#xD;&#xA;where fediaactual = 1&#xD;&#xA;update x&#xD;&#xA;set&#xD;&#xA;tmbandera = 2&#xD;&#xA; from #tmFecha x&#xD;&#xA;where &#xD;&#xA;Row# = 1&#xD;&#xA;update x&#xD;&#xA;set&#xD;&#xA;tmbandera = 3&#xD;&#xA; from #tmFecha x&#xD;&#xA;where &#xD;&#xA;Row# = 2&#xD;&#xA;update x&#xD;&#xA;set&#xD;&#xA;tmbandera = 4&#xD;&#xA; from #tmFecha x&#xD;&#xA;where &#xD;&#xA;Row# = 3&#xD;&#xA;--select * from #tmFecha&#xD;&#xA;&#xD;&#xA;declare @fechaAtrasAño int&#xD;&#xA;&#xD;&#xA;select @fechaAtrasAño= tmFecha from #tmFecha where Row# = 90&#xD;&#xA;&#xD;&#xA;select &#xD;&#xA;&#xD;&#xA;Agrupacion,&#xD;&#xA;MargenIndicadores.tmFecha,&#xD;&#xA;tmCodigoIndicador,&#xD;&#xA;tmDescripcion,&#xD;&#xA;tmTPPdia,&#xD;&#xA;TotalTPPdia,&#xD;&#xA;tmTPPmes,&#xD;&#xA;TotalTPPmes,&#xD;&#xA;tmTPPtrimestre,&#xD;&#xA;TotalTPPtrimestre,&#xD;&#xA;tmTPPanio,&#xD;&#xA;TotalTPPanio,&#xD;&#xA;tmSaldoDiario,&#xD;&#xA;TotalSaldoDiario,&#xD;&#xA;a.tmbandera&#xD;&#xA;from &#xD;&#xA;(&#xD;&#xA;-------------------&#xD;&#xA;-- Captaciones &#xD;&#xA;-------------------&#xD;&#xA;select &#xD;&#xA;Agrupacion='Captaciones',&#xD;&#xA;&#xD;&#xA;pr.tmFecha,&#xD;&#xA;pr.tmCodigoIndicador,&#xD;&#xA;tmDescripcion=&#xD;&#xA;case pr.tmCodigoIndicador when 6 then 'Monetarios'&#xD;&#xA;        when 7 then 'Ahorros'&#xD;&#xA;        when 29 then 'Plazo' end,&#xD;&#xA;&#xD;&#xA;pr.tmTPPdia,&#xD;&#xA;t.tmTPPdia as TotalTPPdia,&#xD;&#xA;&#xD;&#xA;pr.tmTPPmes,&#xD;&#xA;t.tmTPPmes as TotalTPPmes,&#xD;&#xA;&#xD;&#xA;pr.tmTPPtrimestre,&#xD;&#xA;t.tmTPPtrimestre as TotalTPPtrimestre,&#xD;&#xA;&#xD;&#xA;pr.tmTPPanio,&#xD;&#xA;t.tmTPPanio as TotalTPPanio,&#xD;&#xA;&#xD;&#xA;pr.tmSaldoDiario,&#xD;&#xA;t.tmSaldoDiario as TotalSaldoDiario&#xD;&#xA;&#xD;&#xA;from DWHIndicadorTasaMargen pr , DWHIndicadorTasaMargen t&#xD;&#xA;where pr.tmCodigoIndicador in (6,7,29)&#xD;&#xA;and t.tmCodigoIndicador=2&#xD;&#xA;and pr.tmFecha=t.tmFecha&#xD;&#xA;and pr.tmFecha&gt;=@fechaAtrasAño&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;Union&#xD;&#xA;&#xD;&#xA;--Total&#xD;&#xA;&#xD;&#xA;select &#xD;&#xA;Agrupacion='Captaciones',&#xD;&#xA;tmFecha,&#xD;&#xA;tmCodigoIndicador,&#xD;&#xA;tmDescripcion='Total',&#xD;&#xA;&#xD;&#xA;tmTPPdia,&#xD;&#xA;TotalTPPdia=0,&#xD;&#xA;&#xD;&#xA;tmTPPmes,&#xD;&#xA;TotalTPPmes=0,&#xD;&#xA;&#xD;&#xA;tmTPPtrimestre,&#xD;&#xA;TotalTPPtrimestre=0,&#xD;&#xA;&#xD;&#xA;tmTPPanio,&#xD;&#xA;TotalTPPanio=0,&#xD;&#xA;&#xD;&#xA;tmSaldoDiario,&#xD;&#xA;TotalSaldoDiario=0&#xD;&#xA;&#xD;&#xA;from DWHIndicadorTasaMargen&#xD;&#xA;where tmCodigoIndicador in (2)&#xD;&#xA;and tmFecha&gt;=@fechaAtrasAño&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;Union&#xD;&#xA;&#xD;&#xA;-------------------&#xD;&#xA;-- Cartera  &#xD;&#xA;-------------------&#xD;&#xA;&#xD;&#xA;select &#xD;&#xA;&#xD;&#xA;Agrupacion='Cartera',&#xD;&#xA;&#xD;&#xA;pr.tmFecha,&#xD;&#xA;pr.tmCodigoIndicador,&#xD;&#xA;pr.tmDescripcion,&#xD;&#xA;&#xD;&#xA;pr.tmTPPdia,&#xD;&#xA;t.tmTPPdia as TotalTPPdia,&#xD;&#xA;&#xD;&#xA;pr.tmTPPmes,&#xD;&#xA;t.tmTPPmes as TotalTPPmes,&#xD;&#xA;&#xD;&#xA;pr.tmTPPtrimestre,&#xD;&#xA;t.tmTPPtrimestre as TotalTPPtrimestre,&#xD;&#xA;&#xD;&#xA;pr.tmTPPanio,&#xD;&#xA;t.tmTPPanio as TotalTPPanio,&#xD;&#xA;&#xD;&#xA;pr.tmSaldoDiario,&#xD;&#xA;t.tmSaldoDiario as TotalSaldoDiario&#xD;&#xA;&#xD;&#xA;from DWHIndicadorTasaMargen pr , DWHIndicadorTasaMargen t&#xD;&#xA;where pr.tmCodigoIndicador in (94,95,96)&#xD;&#xA;and t.tmCodigoIndicador=1&#xD;&#xA;and pr.tmFecha=t.tmFecha&#xD;&#xA;and pr.tmFecha&gt;=@fechaAtrasAño&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;Union&#xD;&#xA;&#xD;&#xA;--Total&#xD;&#xA;&#xD;&#xA;select &#xD;&#xA;&#xD;&#xA;Agrupacion='Cartera',&#xD;&#xA;&#xD;&#xA;tmFecha,&#xD;&#xA;tmCodigoIndicador,&#xD;&#xA;tmDescripcion='Total',&#xD;&#xA;&#xD;&#xA;tmTPPdia,&#xD;&#xA;TotalTPPdia=0,&#xD;&#xA;&#xD;&#xA;tmTPPmes,&#xD;&#xA;TotalTPPmes=0,&#xD;&#xA;&#xD;&#xA;tmTPPtrimestre,&#xD;&#xA;TotalTPPtrimestre=0,&#xD;&#xA;&#xD;&#xA;tmTPPanio,&#xD;&#xA;TotalTPPanio=0,&#xD;&#xA;&#xD;&#xA;tmSaldoDiario,&#xD;&#xA;TotalSaldoDiario=0&#xD;&#xA;&#xD;&#xA;from DWHIndicadorTasaMargen&#xD;&#xA;where tmCodigoIndicador in (1)&#xD;&#xA;and tmFecha&gt;=@fechaAtrasAño&#xD;&#xA;&#xD;&#xA;) as MargenIndicadores &#xD;&#xA;inner join #tmFecha a on a.tmFecha = MargenIndicadores.tmFecha&#xD;&#xA;order by tmFecha">
                      <xs:complexType>
                        <xs:sequence>
                          <xs:element name="Agrupacion" msprop:DbColumnName="Agrupacion" msprop:FriendlyName="Agrupacion" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="tmFecha" msprop:DbColumnName="tmFecha" msprop:FriendlyName="tmFecha" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="tmCodigoIndicador" msprop:DbColumnName="tmCodigoIndicador" msprop:FriendlyName="tmCodigoIndicador" type="xs:int" minOccurs="0" />
                          <xs:element name="tmDescripcion" msprop:DbColumnName="tmDescripcion" msprop:FriendlyName="tmDescripcion" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="tmTPPdia" msprop:DbColumnName="tmTPPdia" msprop:FriendlyName="tmTPPdia" type="xs:double" minOccurs="0" />
                          <xs:element name="TotalTPPdia" msprop:DbColumnName="TotalTPPdia" msprop:FriendlyName="TotalTPPdia" type="xs:double" minOccurs="0" />
                          <xs:element name="tmTPPmes" msprop:DbColumnName="tmTPPmes" msprop:FriendlyName="tmTPPmes" type="xs:double" minOccurs="0" />
                          <xs:element name="TotalTPPmes" msprop:DbColumnName="TotalTPPmes" msprop:FriendlyName="TotalTPPmes" type="xs:double" minOccurs="0" />
                          <xs:element name="tmTPPtrimestre" msprop:DbColumnName="tmTPPtrimestre" msprop:FriendlyName="tmTPPtrimestre" type="xs:double" minOccurs="0" />
                          <xs:element name="TotalTPPtrimestre" msprop:DbColumnName="TotalTPPtrimestre" msprop:FriendlyName="TotalTPPtrimestre" type="xs:double" minOccurs="0" />
                          <xs:element name="tmTPPanio" msprop:DbColumnName="tmTPPanio" msprop:FriendlyName="tmTPPanio" type="xs:double" minOccurs="0" />
                          <xs:element name="TotalTPPanio" msprop:DbColumnName="TotalTPPanio" msprop:FriendlyName="TotalTPPanio" type="xs:double" minOccurs="0" />
                          <xs:element name="tmSaldoDiario" msprop:DbColumnName="tmSaldoDiario" msprop:FriendlyName="tmSaldoDiario" type="xs:double" minOccurs="0" />
                          <xs:element name="TotalSaldoDiario" msprop:DbColumnName="TotalSaldoDiario" msprop:FriendlyName="TotalSaldoDiario" type="xs:double" minOccurs="0" />
                          <xs:element name="tmbandera" msprop:DbColumnName="tmbandera" msprop:FriendlyName="tmbandera" type="xs:int" minOccurs="0" />
                        </xs:sequence>
                      </xs:complexType>
                    </xs:element>
                    <xs:element name="DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2" msdata:Locale="" msprop:IsLogical="True" msprop:FriendlyName="Fecha" msprop:DbSchemaName="dbo" msprop:DbTableName="DWDFecha" msprop:TableType="View" msprop:Description="DWDFecha" msprop:QueryDefinition=" SELECT [dbo].[DWDFecha].* FROM [dbo].[DWDFecha] ">
                      <xs:complexType>
                        <xs:sequence>
                          <xs:element name="feIdFecha" msprop:DbColumnName="feIdFecha" msprop:FriendlyName="feIdFecha" type="xs:long" />
                          <xs:element name="feFechaCodigoAlt" msprop:DbColumnName="feFechaCodigoAlt" msprop:FriendlyName="feFechaCodigoAlt" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="feFecha" msprop:DbColumnName="feFecha" msprop:FriendlyName="feFecha" type="xs:dateTime" minOccurs="0" />
                          <xs:element name="feDescripcionFecha" msprop:DbColumnName="feDescripcionFecha" msprop:FriendlyName="feDescripcionFecha" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="feCalAnio" msprop:DbColumnName="feCalAnio" msprop:FriendlyName="feCalAnio" type="xs:long" minOccurs="0" />
                          <xs:element name="feCalMes" msprop:DbColumnName="feCalMes" msprop:FriendlyName="feCalMes" type="xs:long" minOccurs="0" />
                          <xs:element name="feCalDia" msprop:DbColumnName="feCalDia" msprop:FriendlyName="feCalDia" type="xs:long" minOccurs="0" />
                          <xs:element name="feCalDiaAnio" msprop:DbColumnName="feCalDiaAnio" msprop:FriendlyName="feCalDiaAnio" type="xs:long" minOccurs="0" />
                          <xs:element name="feTrimNumero" msprop:DbColumnName="feTrimNumero" msprop:FriendlyName="feTrimNumero" type="xs:long" minOccurs="0" />
                          <xs:element name="feTrimMes" msprop:DbColumnName="feTrimMes" msprop:FriendlyName="feTrimMes" type="xs:long" minOccurs="0" />
                          <xs:element name="feTrimDia" msprop:DbColumnName="feTrimDia" msprop:FriendlyName="feTrimDia" type="xs:long" minOccurs="0" />
                          <xs:element name="feCopaCodigo" msprop:DbColumnName="feCopaCodigo" msprop:FriendlyName="feCopaCodigo" type="xs:long" minOccurs="0" />
                          <xs:element name="feCopaMes" msprop:DbColumnName="feCopaMes" msprop:FriendlyName="feCopaMes" type="xs:long" minOccurs="0" />
                          <xs:element name="feCopaDia" msprop:DbColumnName="feCopaDia" msprop:FriendlyName="feCopaDia" type="xs:long" minOccurs="0" />
                          <xs:element name="feFeriado" msprop:DbColumnName="feFeriado" msprop:FriendlyName="feFeriado" type="xs:boolean" minOccurs="0" />
                          <xs:element name="feFeriadoNombre" msprop:DbColumnName="feFeriadoNombre" msprop:FriendlyName="feFeriadoNombre" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="feTemporada" msprop:DbColumnName="feTemporada" msprop:FriendlyName="feTemporada" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="feCierreMes" msprop:DbColumnName="feCierreMes" msprop:FriendlyName="feCierreMes" type="xs:boolean" minOccurs="0" />
                          <xs:element name="feFinMes" msprop:DbColumnName="feFinMes" msprop:FriendlyName="feFinMes" type="xs:boolean" minOccurs="0" />
                          <xs:element name="feFinSemana" msprop:DbColumnName="feFinSemana" msprop:FriendlyName="feFinSemana" type="xs:boolean" minOccurs="0" />
                          <xs:element name="feFutura" msprop:DbColumnName="feFutura" msprop:FriendlyName="feFutura" type="xs:boolean" minOccurs="0" />
                          <xs:element name="feDiasReplicarProximos" msprop:DbColumnName="feDiasReplicarProximos" msprop:FriendlyName="feDiasReplicarProximos" type="xs:long" minOccurs="0" />
                          <xs:element name="feDiasReplicarAnteriores" msprop:DbColumnName="feDiasReplicarAnteriores" msprop:FriendlyName="feDiasReplicarAnteriores" type="xs:long" minOccurs="0" />
                          <xs:element name="EsDiaAnterior" msprop:DbColumnName="EsDiaAnterior" msprop:FriendlyName="EsDiaAnterior" type="xs:boolean" minOccurs="0" />
                          <xs:element name="fecIdAnterior" msprop:DbColumnName="fecIdAnterior" msprop:FriendlyName="fecIdAnterior" type="xs:long" minOccurs="0" />
                          <xs:element name="EsCierreAño" msprop:DbColumnName="EsCierreAño" msprop:FriendlyName="EsCierreAño" type="xs:boolean" minOccurs="0" />
                          <xs:element name="feMesAntCierr" msprop:DbColumnName="feMesAntCierr" msprop:FriendlyName="feMesAntCierr" type="xs:long" minOccurs="0" />
                          <xs:element name="feAnioAntCierr" msprop:DbColumnName="feAnioAntCierr" msprop:FriendlyName="feAnioAntCierr" type="xs:long" minOccurs="0" />
                          <xs:element name="feIdFechaAnioAnt" msprop:DbColumnName="feIdFechaAnioAnt" msprop:FriendlyName="feIdFechaAnioAnt" type="xs:long" minOccurs="0" />
                          <xs:element name="feIdFechaCierreAnioAnt" msprop:DbColumnName="feIdFechaCierreAnioAnt" msprop:FriendlyName="feIdFechaCierreAnioAnt" type="xs:long" minOccurs="0" />
                          <xs:element name="feFechaCierreAnio" msprop:DbColumnName="feFechaCierreAnio" msprop:FriendlyName="feFechaCierreAnio" type="xs:dateTime" minOccurs="0" />
                        </xs:sequence>
                      </xs:complexType>
                    </xs:element>
                    <xs:element name="ConsolidadoHojaPosicion_d53ddd83-8aed-4960-ab67-87f4dfd2cb32" msdata:Locale="" msprop:IsLogical="True" msprop:FriendlyName="ConsolidadoHojaPosicion" msprop:DbTableName="ConsolidadoHojaPosicion" msprop:TableType="View" msprop:Description="ConsolidadoHojaPosicion" msprop:QueryDefinition="SET NOCOUNT ON&#xA;&#xA;declare @FechAct int, @FechaAyer int, @FechaMesAnt int, @FechaAnioAnt int,&#xA; @CanalTit varchar(50),  @CanalAgrTit varchar(50), @DescripcionCartera varchar(50)&#xA;&#xA;  &#xA;select @FechAct=max(feIdFecha) from DWDFecha&#xA;where feDiaActual=1--feCierreMes=1 and feIdFecha&lt;=cast(convert(varchar(10),getdate(),112) as int)&#xA;&#xA;select&#xA;@FechAct=max(feIdFecha)  &#xA;from  DWDFecha&#xA;where feIdFecha&lt;=@FechAct&#xA;and feFinSemana&lt;&gt;1&#xA;and feFeriado&lt;&gt;1&#xA;&#xA;-- quitar esto comentarios&#xA;select&#xA;@FechaAyer=fecIdAnterior,&#xA;@FechaMesAnt=feMesAntCierr,&#xA;@FechaAnioAnt=feAnioAntCierr&#xA;from  DWDFecha&#xA;where feIdFecha=@FechAct&#xA;&#xA;&#xA;/* ----------------- */&#xA;/* Desencriptacion   */&#xA;/* ----------------- */&#xA;&#xA;&#xA;OPEN SYMMETRIC KEY ClaveMIS02&#xA;DECRYPTION BY CERTIFICATE Certi01&#xA;&#xA;-- ActivoOperacion&#xA;&#xA;if object_id('[tempdb]..#DWHActivoOperacion') is not null&#xA;begin&#xA; drop table #DWHActivoOperacion&#xA;end&#xA;&#xA;select &#xA;aoIdFecha,&#xA;aoIdAgencia,&#xA;aoIdAsesorPrincipal,&#xA;aoIdAsesorSecundario,&#xA;aoIdCliente,&#xA;aoIdCuentaContable,&#xA;aoIdProducto,&#xA;aoIdMoneda,&#xA;aoIdEstadoOperacion,&#xA;aoIdEstadoCredito,&#xA;aoIdFechaCarga,&#xA;aoIdFechaConcesion,&#xA;aoIdFechaVencimiento,&#xA;aoIdCalificacionOperacionCliente,&#xA;aoIdLegalOperacionCliente,&#xA;aoRangoMontoUVC,&#xA;aoRangoTasaInteres,&#xA;aoRangoMorosidad,&#xA;aoRangoOperacion,&#xA;aoCotizaUVC,&#xA;aoOperaciones,&#xA;aoDiasOperacion,&#xA;aoDiasVencidoPorVencer,&#xA;aoTasaEfectiva,&#xA;aoTasaInteres,&#xA;aoTasaNominal,&#xA;aoTasaComision,&#xA;aoTasaPonderada,&#xA;aoMontoCapitalDolares,&#xA;aoMontoSaldoDolar,&#xA;aoMontoInteresDolares,&#xA;aoMontoTotalDolar,&#xA;aoMontoInteresNoDevengaDolar,&#xA;aoMontoInteresMoraDolar,&#xA;aoPlazoOperacion,&#xA;aoNumeroOperacion=cast(CONVERT(varchar(20), DecryptByKey(aoNumeroOperacion)) as float)--,&#xA;--aoNumeroOperacion2=cast(CONVERT(varchar(20), DecryptByKey(aoNumeroOperacion2)) as float)&#xA;into #DWHActivoOperacion&#xA;from DWHActivoOperacion&#xA;where aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;--and aoIdCliente in (182219,319128)&#xA;&#xA;&#xA;&#xA;-- PasivoOperacion&#xA;&#xA;if object_id('[tempdb]..#DWHPasivoOperacion') is not null&#xA;begin&#xA; drop table #DWHPasivoOperacion&#xA;end&#xA;&#xA;select &#xA;poIdFecha,&#xA;poIdProducto,&#xA;poIdMoneda,&#xA;poIdAgencia,&#xA;poIdAsesor,&#xA;poIdCliente,&#xA;poIdCuentaContable,&#xA;poIdEstadoDeposito,&#xA;poIdEstadoOperacion,&#xA;poNumeroDeOperaciones,&#xA;poPlazoOperacion,&#xA;poSaldoOperacion,&#xA;poSaldoOperacionUSD,&#xA;poSaldoDisponible,&#xA;poSaldoDisponibleUSD,&#xA;poSaldoPromedioDisponible,&#xA;poSaldoTotal,&#xA;poTasaEfectiva,&#xA;poTasaNominal,&#xA;poFechaVencimiento,&#xA;poIdCalificacionOperacionCliente,&#xA;poIdLegalOperacionCliente,&#xA;poNoOperacion=cast(CONVERT(varchar(20), DecryptByKey(poNoOperacion)) as float)&#xA;into #DWHPasivoOperacion&#xA;from DWHPasivoOperacion&#xA;where poIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;--and poIdCliente in (182219,319128)&#xA;&#xA;&#xA;-- DWHCuotaOperacion&#xA;&#xA;if object_id('[tempdb]..#DWHCuotaOperacion') is not null&#xA;begin&#xA; drop table #DWHCuotaOperacion&#xA;end&#xA;&#xA;select &#xA;coIdFecha,&#xA;coIdAgencia,&#xA;coIdAsesorPrincipal,&#xA;coIdAsesorSecundario,&#xA;coIdCliente,&#xA;coIdCuentaContable,&#xA;coIdProducto,&#xA;coIdMoneda,&#xA;coIdEstadoOperacion,&#xA;coIdFechaCarga,&#xA;coIdFechaConcesion,&#xA;coIdFechaVencimiento,&#xA;coIdCalificacionOperacionCliente,&#xA;coIdLegalOperacionCliente,&#xA;coRangoMontoUVC,&#xA;coRangoTasaInteres,&#xA;coRangoMorosidad,&#xA;coRangoOperacion,&#xA;coCotizaUVC,&#xA;coOperaciones,&#xA;coDiasOperacion,&#xA;coDiasVencidoPorVencer,&#xA;coTasaInteres,&#xA;coCuotaCapital,&#xA;coValorInteresCuota,&#xA;coCuotaCapitalPagado,&#xA;coValorInteresCuotaPagado,&#xA;coMontoInteresNoDevengaDolares,&#xA;coInteresMoraPagado,&#xA;coInteresAcruadoMora,&#xA;coNumeroOperacion=cast(CONVERT(varchar(20), DecryptByKey(coNumeroOperacion)) as float)&#xA;into #DWHCuotaOperacion&#xA;from DWHCuotaOperacion&#xA;where coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;--and coIdCliente in (182219,319128)&#xA;&#xA;-- DWDTitularizadaOperacion&#xA;&#xA;if object_id('[tempdb]..#DWDTitularizadaOperacion') is not null&#xA;begin&#xA; drop table #DWDTitularizadaOperacion&#xA;end&#xA; &#xA;select top 0&#xA;toNombre,&#xA;toCedula=CONVERT(varchar(15), DecryptByKey(toCedula)),&#xA;toOperacion=CONVERT(varchar(9), DecryptByKey(toOperacion))&#xA;into #DWDTitularizadaOperacion&#xA;from DWDTitularizadaOperacion&#xA;&#xA;&#xA;CLOSE SYMMETRIC KEY ClaveMIS02&#xA;&#xA;&#xA;--&gt;&gt; CARTERA &lt;&lt;--&#xA;&#xA;select @DescripcionCartera=max(ccFamiliaProducto)&#xA;from DWDCuentaContable&#xA;inner join (  &#xA;    SELECT DISTINCT &#xA;    p2.CpCodigoIndicador indicadorNivel3&#xA;    FROM DWDClasificacionProductos p&#xA;    join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;    join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;    WHERE p.CpCodigoIndicador in (1)&#xA; and p1.CpCodigoIndicador in (120,121,122,126)&#xA;    and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;     ) cp ON ccCodigoIndicador=cp.indicadorNivel3&#xA;&#xA;&#xA;--&gt;&gt; TITULARIZADA &lt;&lt;--&#xA;&#xA;select &#xA;@CanalTit=caDescripcionAgrupacionCanal,&#xA;@CanalAgrTit=caAgrupacion&#xA;from DWDCanal &#xA;where caCodigoCanal='TIT'&#xA;&#xA;&#xA;&#xA;&#xA;-- Eliminar Temporal&#xA;&#xA;if object_id('[tempdb]..#ConsCart') is not null&#xA;begin&#xA; drop table #ConsCart&#xA;end&#xA;&#xA;&#xA;&#xA;/* ---------------------------------------------------------------------- */&#xA;/*                           CARTERA                                      */&#xA;/* ---------------------------------------------------------------------- */&#xA;&#xA;&#xA;-- Comer. + Micro. (525,526,524,501,504,506,505,509,507)&#xA;-- Consumo (510,511,512,513,514,515)&#xA;-- Vivienda (519,520,521,522,523)&#xA;&#xA;select  &#xA;CodCliente= cl.clCodigoCliente,&#xA;NombreCliente=cl.clNombreCompleto,&#xA;CodigoMoneda=case co.coIdFecha when @FechAct then  mo.moCodigoMoneda else null end,&#xA;CodigoAgenciaOper=case co.coIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion &#xA;CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Cliente&#xA;CodProducto=case co.coIdFecha when @FechAct then  pr.prCodigoProducto else null end, &#xA;FechaVencimiento=case co.coIdFecha when @FechAct then  co.coIdFechaVencimiento else null end,&#xA;FechaApertura=case co.coIdFecha when @FechAct then  co.coIdFechaConcesion else null end,&#xA;NumeroOperacion=case co.coIdFecha when @FechAct then  co.coNumeroOperacion   else null end, &#xA;Plazo='', &#xA;OperacionCliente=case co.coIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,  &#xA;CodCanal=ca.caCodigoCanal,   &#xA;Estado=CpEstadoProducto, --ccClasificacionEstado,  &#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=ca.caOrdenCanal,  &#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=cc.ccGrupo,&#xA;Nivel3='     '+ca.caAgrupacion,&#xA;RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end&#xA;into #ConsCart&#xA;--drop table #ConsCart&#xA;from #DWHCuotaOperacion co &#xA;inner join DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on co.coIdCliente=clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda  &#xA;inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto&#xA;left outer join DWDAgenciaOperacion ago on ago.agIdAgencia=co.coIdAgencia -- Agencia de Operacion&#xA;left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente&#xA;left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=co.coIdCalificacionOperacionCliente&#xA;left outer join #DWDTitularizadaOperacion ti on  isnull(co.coNumeroOperacion,'')=ti.toOperacion &#xA;--left outer join DWDFecha fv on fv.feIdFecha=co.coIdFechaVencimiento&#xA;--left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal&#xA;inner join &#xA;(&#xA;  SELECT DISTINCT &#xA;   p2.CpCodigoIndicador indicadorNivel3&#xA;  ,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end &#xA;  FROM DWDClasificacionProductos p&#xA;  join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;  join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;  WHERE p.CpCodigoIndicador in (1)&#xA;  and p1.CpCodigoIndicador in (120,121,122,126)&#xA;  and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON ccCodigoIndicador=cp.indicadorNivel3&#xA;where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)  &#xA;and pr.prVehiculo is null&#xA;and cl.clFechaFin is null&#xA;and ca.caEstado=1&#xA;and ti.toOperacion is null -- Filtro Titularizada&#xA;group by &#xA;--cc.ccClasificacionEstado,&#xA;CpEstadoProducto,&#xA;co.coIdFecha,&#xA;pr.prCodigoProducto,&#xA;co.coIdFechaVencimiento,&#xA;co.coIdFechaConcesion,&#xA;coc.cocCodigoCalificacionOperacionCliente,&#xA;ca.caCodigoCanal,&#xA;cl.clCodigoCliente,&#xA;co.coNumeroOperacion,&#xA;ago.agCodigoAgencia,&#xA;ag.agCodigoAgencia,&#xA;ca.caAgrupacion,&#xA;ca.caOrdenCanal,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cl.clNombreCompleto,  &#xA;mo.moCodigoMoneda,    &#xA;cc.ccOrdenAgrupacionN2,&#xA;cc.ccFamiliaProducto,&#xA;prCodigoProducto,&#xA;ccCodigoNivel6,&#xA;cc.ccGrupo,    &#xA;cc.ccOrdenAgrupacion,&#xA;cc.ccCodigoIndicador&#xA;&#xA;Union All&#xA;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;-- T. Credito&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;select &#xA;CodCliente= cl.clCodigoCliente,&#xA;NombreCliente=cl.clNombreCompleto,&#xA;CodigoMoneda=case tco.tcoIdFecha when @FechAct then  mo.moCodigoMoneda else null end,&#xA;CodigoAgenciaOper=case tco.tcoIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion &#xA;CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Cliente&#xA;CodProducto=case tco.tcoIdFecha when @FechAct then  pr.prCodigoProducto else null end, &#xA;FechaVencimiento=null,&#xA;FechaApertura=null,&#xA;NumeroOperacion=null, &#xA;Plazo='', &#xA;OperacionCliente=case tco.tcoIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,  &#xA;CodCanal=ca.caCodigoCanal, &#xA;Estado=CpEstadoProducto, --cc.ccClasificacionEstado,&#xA;OrdenN1=cc.ccOrdenAgrupacion,&#xA;OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;OrdenN3=ca.caOrdenCanal,&#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=cc.ccGrupo,&#xA;Nivel3='     '+ca.caAgrupacion, &#xA;RealHoy=case tco.tcoIdFecha when @FechAct then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;RealAyer=case tco.tcoIdFecha when @FechaAyer then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;RealMesAnt=case tco.tcoIdFecha when @FechaMesAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end,&#xA;RealAnioAnt=case tco.tcoIdFecha when @FechaAnioAnt then sum(isnull(tco.tcoSaldo,0))/1000 else 0 end&#xA;from DWHTarjetaCreditoOperacion tco &#xA;inner join DWDCuentaContable cc on tco.tcoIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on tco.tcoIdCliente=cl.clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDProducto pr on pr.prIdProducto=tco.tcoIdProducto&#xA;inner join DWDMoneda mo on moIdMoneda=tcoIdMoneda&#xA;left outer join DWDAgenciaOperacion ago on ago.agIdAgencia=tco.tcoIdAgencia -- Agencia de Operacion&#xA;left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente&#xA;left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=tco.tcoIdCalificacionOperacionCliente&#xA;inner join &#xA;(  &#xA;    SELECT DISTINCT &#xA;     p2.CpCodigoIndicador indicadorNivel3&#xA; ,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end&#xA;    FROM DWDClasificacionProductos p&#xA;    join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;    join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;    WHERE p.CpCodigoIndicador = 1&#xA;    and p1.CpCodigoIndicador = 124&#xA;    and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON ccCodigoIndicador=cp.indicadorNivel3&#xA;where tco.tcoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and cl.clFechaFin is null&#xA;and ca.caEstado=1&#xA;--and tcoIdCliente in (182219,319128)&#xA;--and cc.ccCodigoMoneda='USD'&#xA;group by &#xA;cl.clCodigoCliente,&#xA;cl.clNombreCompleto,&#xA;coc.cocCodigoCalificacionOperacionCliente,&#xA;CpEstadoProducto, --&#xA;ca.caCodigoCanal,&#xA; mo.moCodigoMoneda,&#xA;cc.ccOrdenAgrupacion,&#xA;ca.caOrdenCanal,&#xA;cc.ccOrdenAgrupacionN2,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cc.ccFamiliaProducto,&#xA;caAgrupacion,&#xA;cc.ccGrupo,&#xA;ago.agCodigoAgencia,&#xA;pr.prCodigoProducto,&#xA;ag.agCodigoAgencia,&#xA;tco.tcoIdFecha&#xA;&#xA;&#xA;Union all&#xA;&#xA;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;-- Vehiculos&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;select  &#xA;CodCliente= cl.clCodigoCliente,&#xA;NombreCliente=cl.clNombreCompleto,&#xA;CodigoMoneda=case co.coIdFecha when @FechAct then  mo.moCodigoMoneda else null end,&#xA;CodigoAgenciaOper=case co.coIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion &#xA;CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Cliente&#xA;CodProducto=case co.coIdFecha when @FechAct then  pr.prCodigoProducto else null end, &#xA;FechaVencimiento=case co.coIdFecha when @FechAct then  co.coIdFechaVencimiento else null end,&#xA;FechaApertura=case co.coIdFecha when @FechAct then  co.coIdFechaConcesion else null end,&#xA;NumeroOperacion=case co.coIdFecha when @FechAct then  co.coNumeroOperacion   else null end, &#xA;Plazo='', &#xA;OperacionCliente=case co.coIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,  &#xA;CodCanal=ca.caCodigoCanal,   &#xA;Estado=CpEstadoProducto, --ccClasificacionEstado,  &#xA;OrdenN1=pr.prOrdenN1,&#xA;OrdenN2=pr.prOrdenN2,&#xA;OrdenN3=ca.caOrdenCanal,  &#xA;Canal=ca.caDescripcionAgrupacionCanal,&#xA;Nivel1=cc.ccFamiliaProducto,&#xA;Nivel2=pr.prVehiculo,&#xA;Nivel3='     '+ca.caAgrupacion,&#xA;RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end&#xA;from #DWHCuotaOperacion co &#xA;inner join DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable&#xA;inner join DWDCliente cl on co.coIdCliente=clIdCliente&#xA;inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda  &#xA;inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto&#xA;left outer join DWDAgenciaOperacion ago on ago.agIdAgencia=co.coIdAgencia -- Agencia de Operacion&#xA;left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente&#xA;left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=co.coIdCalificacionOperacionCliente&#xA;--left outer join DWDFecha fv on fv.feIdFecha=co.coIdFechaVencimiento&#xA;--left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal&#xA;inner join &#xA;(  &#xA;   SELECT DISTINCT &#xA;    p2.CpCodigoIndicador indicadorNivel3&#xA;  ,CpEstadoProducto=CASE WHEN p2.CpEstadoProducto='VIG' then 'Vig' else 'Dif' end&#xA;   FROM DWDClasificacionProductos p&#xA;   join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;   join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;   WHERE p.CpCodigoIndicador in (1)&#xA;   and p1.CpCodigoIndicador in (120,121,122,126)&#xA;   and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;) cp ON ccCodigoIndicador=cp.indicadorNivel3&#xA;where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;and pr.prVehiculo='Vehiculos'   &#xA;and cl.clFechaFin is null&#xA;and ca.caEstado=1&#xA;--and ccCodigoMoneda=moCodigoMoneda&#xA;--and cc.ccCodigoMoneda='USD'&#xA;group by &#xA;CpEstadoProducto,&#xA;co.coIdFecha,&#xA;pr.prCodigoProducto,&#xA;co.coIdFechaVencimiento,&#xA;co.coIdFechaConcesion,&#xA;coc.cocCodigoCalificacionOperacionCliente,&#xA;ca.caCodigoCanal,&#xA;cl.clCodigoCliente,&#xA;co.coNumeroOperacion,&#xA;ago.agCodigoAgencia,&#xA;ag.agCodigoAgencia,&#xA;ca.caAgrupacion,&#xA;ca.caOrdenCanal,&#xA;pr.prVehiculo,&#xA;ca.caDescripcionAgrupacionCanal,&#xA;cl.clNombreCompleto,  &#xA;mo.moCodigoMoneda,    &#xA;pr.prOrdenN1,&#xA;pr.prOrdenN2,&#xA;cc.ccFamiliaProducto,&#xA;prCodigoProducto,&#xA;ccCodigoNivel6,&#xA;--cc.ccGrupo,    &#xA;cc.ccCodigoIndicador&#xA;&#xA;Union All&#xA;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;-- Titularizada&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;--&gt; Identificacion de C.Titularizada por número de operación&#xA;&#xA;   select&#xA;   CodCliente= cl.clCodigoCliente,&#xA;   NombreCliente=cl.clNombreCompleto,&#xA;   CodigoMoneda=case co.coIdFecha when @FechAct then  mo.moCodigoMoneda else null end,&#xA;   CodigoAgenciaOper=case co.coIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion&#xA;   CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Cliente&#xA;   CodProducto=case co.coIdFecha when @FechAct then  pr.prCodigoProducto else null end,&#xA;   FechaVencimiento=case co.coIdFecha when @FechAct then  co.coIdFechaVencimiento else null end,&#xA;   FechaApertura=case co.coIdFecha when @FechAct then  co.coIdFechaConcesion else null end,&#xA;   NumeroOperacion=case co.coIdFecha when @FechAct then  co.coNumeroOperacion   else null end,&#xA;   Plazo='',&#xA;   OperacionCliente=case co.coIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,&#xA;   CodCanal=ca.caCodigoCanal,&#xA;&#xA;   Estado=ccClasificacionEstado,&#xA;   OrdenN1=cc.ccOrdenAgrupacion,&#xA;   OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;   OrdenN3=ca.caOrdenCanal,&#xA;   Canal=@CanalTit,&#xA;   Nivel1=@DescripcionCartera,&#xA;   Nivel2='C. '+@CanalTit,&#xA;   Nivel3=space(5)+ @CanalAgrTit,&#xA;   RealHoy=case co.coIdFecha when @FechAct then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;   RealAyer=case co.coIdFecha when @FechaAyer then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;   RealMesAnt=case co.coIdFecha when @FechaMesAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end,&#xA;   RealAnioAnt=case co.coIdFecha when @FechaAnioAnt then sum(isnull(co.coCuotaCapital,0))/1000 else 0 end&#xA;   from #DWHCuotaOperacion co&#xA;   inner join DWDCuentaContable cc on co.coIdCuentaContable=cc.ccIdCuentaContable&#xA;   inner join DWDCliente cl on co.coIdCliente=clIdCliente&#xA;   inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;   inner join DWDMoneda mo on co.coIdMoneda=mo.moIdMoneda&#xA;   inner join DWDProducto pr on pr.prIdProducto=co.coIdProducto&#xA;   left outer join DWDAgenciaOperacion ago on ago.agIdAgencia=co.coIdAgencia -- Agencia de Operacion&#xA;   left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente&#xA;   left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=co.coIdCalificacionOperacionCliente&#xA;   inner join #DWDTitularizadaOperacion ti on isnull(co.coNumeroOperacion,'')=ti.toOperacion -- Titularizada&#xA;   --left outer join DWDFecha fv on fv.feIdFecha=co.coIdFechaVencimiento&#xA;   --left outer join DWDAsesorOperacion ase on ase.asIdAsesor=ao.aoIdAsesorPrincipal&#xA;   inner join (&#xA;   SELECT DISTINCT&#xA;   p2.CpCodigoIndicador indicadorNivel3&#xA;   FROM DWDClasificacionProductos p&#xA;   join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;   join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;   WHERE p.CpCodigoIndicador in (1)&#xA;   and p1.CpCodigoIndicador in (120,121,122,126)&#xA;   and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;   ) cp ON ccCodigoIndicador=cp.indicadorNivel3&#xA;   where co.coIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;   and ccCodigoMoneda=moCodigoMoneda&#xA;   and cl.clFechaFin is null&#xA;   and ca.caEstado=1&#xA;   group by&#xA;   cc.ccClasificacionEstado,&#xA;   co.coIdFecha,&#xA;   pr.prCodigoProducto,&#xA;   co.coIdFechaVencimiento,&#xA;   co.coIdFechaConcesion,&#xA;   coc.cocCodigoCalificacionOperacionCliente,&#xA;   ca.caCodigoCanal,&#xA;   cl.clCodigoCliente,&#xA;   co.coNumeroOperacion,&#xA;   ago.agCodigoAgencia,&#xA;   ag.agCodigoAgencia,&#xA;   ca.caAgrupacion,&#xA;   ca.caOrdenCanal,&#xA;   ca.caDescripcionAgrupacionCanal,&#xA;   cl.clNombreCompleto,&#xA;   mo.moCodigoMoneda,&#xA;   cc.ccOrdenAgrupacionN2,&#xA;   cc.ccFamiliaProducto,&#xA;   prCodigoProducto,&#xA;   ccCodigoNivel6,&#xA;   cc.ccGrupo,&#xA;   cc.ccOrdenAgrupacion,&#xA;   cc.ccCodigoIndicador&#xA;&#xA;   Union All&#xA;&#xA;&#xA;   -- Cambio de asignación de Titularizada a Cartera Titularizada&#xA;&#xA;   select&#xA;   CodCliente= cl.clCodigoCliente,&#xA;   NombreCliente=cl.clNombreCompleto,&#xA;   CodigoMoneda=case ao.aoIdFecha when @FechAct then  mo.moCodigoMoneda else null end,&#xA;   CodigoAgenciaOper=case ao.aoIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion&#xA;   CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Cliente&#xA;   CodProducto=case ao.aoIdFecha when @FechAct then  pr.prCodigoProducto else null end,&#xA;   FechaVencimiento=case ao.aoIdFecha when @FechAct then  ao.aoIdFechaVencimiento else null end,&#xA;   FechaApertura=case ao.aoIdFecha when @FechAct then  ao.aoIdFechaConcesion else null end,&#xA;   NumeroOperacion=case ao.aoIdFecha when @FechAct then  ao.aoNumeroOperacion   else null end,&#xA;   Plazo='',&#xA;   OperacionCliente=case ao.aoIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,&#xA;   CodCanal=ca.caCodigoCanal,&#xA;   Estado=ccClasificacionEstado,&#xA;   OrdenN1=cc.ccOrdenAgrupacion,&#xA;   OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;   OrdenN3=ca.caOrdenCanal,&#xA;   Canal=@CanalTit,&#xA;   Nivel1=@DescripcionCartera,&#xA;   Nivel2='C. '+@CanalTit,&#xA;   Nivel3=space(5)+ @CanalAgrTit,&#xA;   RealHoy=case ao.aoIdFecha when @FechAct then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;   RealAyer=case ao.aoIdFecha when @FechaAyer then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;   RealMesAnt=case ao.aoIdFecha when @FechaMesAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end,&#xA;   RealAnioAnt=case ao.aoIdFecha when @FechaAnioAnt then sum(isnull(ao.aoMontoSaldoDolar,0))/1000 else 0 end&#xA;   from #DWHActivoOperacion ao&#xA;   inner join DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable&#xA;   inner join DWDCliente cl on ao.aoIdCliente=cl.clIdCliente&#xA;   inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;   inner join DWDProducto pr on pr.prIdProducto=ao.aoIdProducto&#xA;   inner join DWDMoneda mo on mo.moIdMoneda=ao.aoIdMoneda&#xA;   left outer join DWDAgenciaOperacion ago on ago.agIdAgencia=ao.aoIdAgencia&#xA;   left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente&#xA;   left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=ao.aoIdCalificacionOperacionCliente&#xA;   inner join (&#xA;   SELECT DISTINCT&#xA;   p2.CpCodigoIndicador indicadorNivel3&#xA;   FROM DWDClasificacionProductos p&#xA;   join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;   join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;   WHERE p.CpCodigoIndicador = 1&#xA;   and p1.CpCodigoIndicador = 125&#xA;   and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;   ) cp ON ccCodigoIndicador=cp.indicadorNivel3&#xA;   where ao.aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;   and pr.prVehiculo is null&#xA;   and cl.clFechaFin is null&#xA;   and ca.caEstado=1&#xA;   group by&#xA;   cc.ccOrdenAgrupacion,&#xA;   cc.ccOrdenAgrupacionN2,&#xA;   ca.caOrdenCanal,&#xA;   clCodigoCliente,&#xA;   ago.agCodigoAgencia,&#xA;   cc.ccClasificacionEstado,&#xA;   cc.ccGrupo,&#xA;   mo.moCodigoMoneda,&#xA;   ao.aoIdFecha,&#xA;   ao.aoNumeroOperacion,&#xA;   ca.caCodigoCanal,&#xA;   ag.agCodigoAgencia,&#xA;   cl.clNombreCompleto,&#xA;   pr.prCodigoProducto,&#xA;   ao.aoIdFechaVencimiento,&#xA;   ao.aoIdFechaConcesion,&#xA;   coc.cocCodigoCalificacionOperacionCliente&#xA;&#xA;   -- Eliminar Temporal&#xA;&#xA;   if object_id('[tempdb]..#Tasas') is not null&#xA;   begin&#xA;   drop table #Tasas&#xA;   end&#xA;&#xA;&#xA;   ---------------------&#xA;   -- Obtener Tasas&#xA;   ---------------------&#xA;&#xA;&#xA;   select&#xA;   clCodigoCliente,&#xA;   NumeroOperacion=case ao.aoIdFecha when @FechAct then ao.aoNumeroOperacion else null end,&#xA;   FechaVencimiento=case ao.aoIdFecha when @FechAct then ao.aoIdFechaVencimiento else null end, --co.coIdFechaVencimiento,&#xA;   FechaApertura=case ao.aoIdFecha when @FechAct then ao.aoIdFechaConcesion else null end,--co.coIdFechaConcesion,&#xA;   CodCanal=ca.caCodigoCanal,&#xA;   CodMoneda=case ao.aoIdFecha when @FechAct then  mo.moCodigoMoneda  else null end,&#xA;   CodProducto=case ao.aoIdFecha when @FechAct then  pr.prCodigoProducto  else null end,&#xA;   --OperCodigoAgencia=case ao.aoIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion&#xA;   CodigoAgenciaCli=ag.agCodigoAgencia,&#xA;   Estado=cc.ccClasificacionEstado,&#xA;   Nivel2=cc.ccGrupo,&#xA;   TasaHoy=case ao.aoIdFecha  when @FechAct then avg(isnull(ao.aoTasaNominal,0)) else 0 end,&#xA;   TasaAyer=case ao.aoIdFecha  when @FechaAyer then avg(isnull(ao.aoTasaNominal,0)) else 0 end,&#xA;   TasaMesAnt=case ao.aoIdFecha  when @FechaMesAnt then avg(isnull(ao.aoTasaNominal,0)) else 0 end,&#xA;   TasaAnioAnt=case ao.aoIdFecha  when @FechaAnioAnt then avg(isnull(ao.aoTasaNominal,0)) else 0 end&#xA;   into #Tasas&#xA;   --drop table #Tasas&#xA;   from #DWHActivoOperacion ao&#xA;   inner join DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable&#xA;   inner join DWDCliente cl on ao.aoIdCliente=cl.clIdCliente&#xA;   inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;   inner join DWDProducto pr on pr.prIdProducto=ao.aoIdProducto&#xA;   inner join DWDMoneda mo on mo.moIdMoneda=ao.aoIdMoneda&#xA;   --inner join DWDAgenciaOperacion ag on ago.agIdAgencia=ao.aoIdAgencia&#xA;   left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente&#xA;   inner join (&#xA;   SELECT DISTINCT&#xA;   p2.CpCodigoIndicador indicadorNivel3&#xA;   FROM DWDClasificacionProductos p&#xA;   join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;   join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;   WHERE p.CpCodigoIndicador in (1)&#xA;   and p1.CpCodigoIndicador in (120,121,122,126)&#xA;   and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;   ) cp ON ccCodigoIndicador=cp.indicadorNivel3&#xA;   where ao.aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;   and pr.prVehiculo is null&#xA;   and cl.clFechaFin is null&#xA;   and ca.caEstado=1&#xA;   and isnull(ao.aoTasaNominal,0) &gt; 0&#xA;   group by&#xA;   clCodigoCliente,&#xA;   --ca.caAgrupacion,&#xA;   cc.ccClasificacionEstado,&#xA;   cc.ccGrupo,&#xA;   mo.moCodigoMoneda,&#xA;   ao.aoIdFecha,&#xA;   ao.aoNumeroOperacion,&#xA;   ca.caCodigoCanal,&#xA;   ag.agCodigoAgencia,&#xA;   pr.prCodigoProducto,&#xA;   ao.aoIdFechaVencimiento,&#xA;   ao.aoIdFechaConcesion&#xA;&#xA;   union all&#xA;&#xA;&#xA;   select&#xA;   clCodigoCliente,&#xA;   NumeroOperacion=case ao.aoIdFecha when @FechAct then ao.aoNumeroOperacion else null end,&#xA;   FechaVencimiento=case ao.aoIdFecha when @FechAct then ao.aoIdFechaVencimiento else null end, --co.coIdFechaVencimiento,&#xA;   FechaApertura=case ao.aoIdFecha when @FechAct then ao.aoIdFechaConcesion else null end,--co.coIdFechaConcesion,&#xA;   CodCanal=ca.caCodigoCanal,&#xA;   CodMoneda=case ao.aoIdFecha when @FechAct then  mo.moCodigoMoneda  else null end,&#xA;   CodProducto=case ao.aoIdFecha when @FechAct then  pr.prCodigoProducto  else null end,&#xA;   --OperCodigoAgencia=case ao.aoIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion&#xA;   CodigoAgenciaCli=ag.agCodigoAgencia,&#xA;   Estado=cc.ccClasificacionEstado,&#xA;   Nivel2=pr.prVehiculo,&#xA;   TasaHoy=case ao.aoIdFecha  when @FechAct then avg(isnull(ao.aoTasaNominal,0)) else 0 end,&#xA;   TasaAyer=case ao.aoIdFecha  when @FechaAyer then avg(isnull(ao.aoTasaNominal,0)) else 0 end,&#xA;   TasaMesAnt=case ao.aoIdFecha  when @FechaMesAnt then avg(isnull(ao.aoTasaNominal,0)) else 0 end,&#xA;   TasaAnioAnt=case ao.aoIdFecha  when @FechaAnioAnt then avg(isnull(ao.aoTasaNominal,0)) else 0 end&#xA;   from #DWHActivoOperacion ao&#xA;   inner join DWDCuentaContable cc on ao.aoIdCuentaContable=cc.ccIdCuentaContable&#xA;   inner join DWDCliente cl on ao.aoIdCliente=cl.clIdCliente&#xA;   inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;   inner join DWDProducto pr on pr.prIdProducto=ao.aoIdProducto&#xA;   inner join DWDMoneda mo on mo.moIdMoneda=ao.aoIdMoneda&#xA;   --inner join DWDAgenciaOperacion ag on ago.agIdAgencia=ao.aoIdAgencia&#xA;   left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia   -- Agencia de Cliente&#xA;   inner join (&#xA;   SELECT DISTINCT&#xA;   p2.CpCodigoIndicador indicadorNivel3&#xA;   FROM DWDClasificacionProductos p&#xA;   join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;   join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;   WHERE p.CpCodigoIndicador in (1)&#xA;   and p1.CpCodigoIndicador in (120,121,122,126)&#xA;   and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;   ) cp ON ccCodigoIndicador=cp.indicadorNivel3&#xA;   where ao.aoIdFecha in (@FechAct,@FechaAyer,@FechaMesAnt,@FechaAnioAnt)&#xA;   and pr.prVehiculo='Vehiculos'&#xA;   and cl.clFechaFin is null&#xA;   and ca.caEstado=1&#xA;   and isnull(ao.aoTasaNominal,0)&gt;0&#xA;   group by&#xA;   clCodigoCliente,&#xA;   --ca.caAgrupacion,&#xA;   cc.ccClasificacionEstado,&#xA;   pr.prVehiculo,&#xA;   mo.moCodigoMoneda,&#xA;   ao.aoIdFecha,&#xA;   ao.aoNumeroOperacion,&#xA;   ca.caCodigoCanal,&#xA;   ag.agCodigoAgencia,&#xA;   pr.prCodigoProducto,&#xA;   ao.aoIdFechaVencimiento,&#xA;   ao.aoIdFechaConcesion&#xA;&#xA;&#xA;   -- Eliminar Temporal&#xA;&#xA;   if object_id('[tempdb]..#Cartera') is not null&#xA;   begin&#xA;   drop table #Cartera&#xA;   end&#xA;&#xA;   ---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;--&gt;&gt;&gt;        AGRUPACION CARTERA           &lt;&lt;&lt;&#xA;---&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;&#xA;   select&#xA;   CodCliente,&#xA;   NombreCliente,&#xA;   CodigoMoneda,&#xA;   CodigoAgenciaOper,&#xA;   CodigoAgenciaCli,&#xA;   CodProducto,&#xA;   FechaVencimiento,&#xA;   FechaApertura,&#xA;   NumeroOperacion,&#xA;   Plazo,&#xA;   OperacionCliente,&#xA;   CodCanal,&#xA;   Estado,&#xA;   OrdenN1,&#xA;   OrdenN2,&#xA;   OrdenN3,&#xA;   Canal,&#xA;   Nivel1,&#xA;   Nivel2,&#xA;   Nivel3,&#xA;   TasaHoy=cast(null as float),&#xA;   TasaAyer=cast(null as float),&#xA;   TasaMesAnt=cast(null as float),&#xA;   TasaAnioAnt=cast(null as float),&#xA;   RealHoy=sum(RealHoy),&#xA;   RealAyer=sum(RealAyer),&#xA;   RealMesAnt=sum(RealMesAnt),&#xA;   RealAnioAnt=sum(RealAnioAnt)&#xA;&#xA;   into #Cartera&#xA;&#xA;   from #ConsCart&#xA;   group by CodCliente,&#xA;   NombreCliente,&#xA;   CodigoMoneda,&#xA;   CodigoAgenciaOper,&#xA;   CodigoAgenciaCli,&#xA;   CodProducto,&#xA;   FechaVencimiento,&#xA;   FechaApertura,&#xA;   NumeroOperacion,&#xA;   Plazo,&#xA;   OperacionCliente,&#xA;   CodCanal,&#xA;   Estado,&#xA;   OrdenN1,&#xA;   OrdenN2,&#xA;   OrdenN3,&#xA;   Canal,&#xA;   Nivel1,&#xA;   Nivel2,&#xA;   Nivel3&#xA;&#xA;&#xA;   ---------------------------&#xA;   -- Actualiza Tasas Cartera&#xA;   ---------------------------&#xA;&#xA;   update ca&#xA;   set ca.TasaHoy=ts.TasaHoy,&#xA;   ca.TasaAyer=ts.TasaAyer,&#xA;   ca.TasaMesAnt=ts.TasaMesAnt,&#xA;   ca.TasaAnioAnt=ts.TasaAnioAnt&#xA;&#xA;   from #Cartera  ca&#xA;   inner join&#xA;   (&#xA;&#xA;   select&#xA;   clCodigoCliente,&#xA;   NumeroOperacion,&#xA;   CodProducto,&#xA;   CodCanal,&#xA;   Nivel2,&#xA;   Estado,&#xA;   FechaVencimiento,&#xA;   TasaHoy=avg(TasaHoy),&#xA;   TasaAyer=avg(TasaAyer),&#xA;   TasaMesAnt=avg(TasaMesAnt),&#xA;   TasaAnioAnt=avg(TasaAnioAnt)&#xA;   from #Tasas&#xA;   group by clCodigoCliente,&#xA;   Estado,&#xA;   Nivel2,&#xA;   NumeroOperacion,&#xA;   CodigoAgenciaCli,&#xA;   CodProducto,&#xA;   FechaVencimiento,&#xA;   CodCanal&#xA;&#xA;   ) as ts  on ca.CodCliente=ts.clCodigoCliente&#xA;   and isnull(ca.NumeroOperacion,'')=isnull(ts.NumeroOperacion,'')&#xA;   and rtrim(ltrim(isnull(ca.CodProducto,'')))=rtrim(ltrim(isnull(ts.CodProducto,'')))&#xA;   and isnull(ca.FechaVencimiento,'')=isnull(ts.FechaVencimiento,'')&#xA;   and isnull(rtrim(ltrim(ca.Nivel2)),'')=isnull(rtrim(ltrim(ts.Nivel2)),'')&#xA;   and isnull(ca.Estado,'')=isnull(ts.Estado,'')&#xA;&#xA;&#xA;&#xA;   -- Eliminar Temporal&#xA;&#xA;   if object_id('[tempdb]..#Consolidados') is not null&#xA;   begin&#xA;   drop table #Consolidados&#xA;   end&#xA;&#xA;&#xA;   /* ------------------------------------------------------------------------ */&#xA;   /*                       CAPTACIONES                                        */&#xA;   /* ------------------------------------------------------------------------ */&#xA;&#xA;   --  Monetarios(98, 100,55,54,99)&#xA;   --  Ahorros(247,600,601)&#xA;   --  Plazo(602, 603, 604, 605, 606, 607)&#xA;&#xA;   select&#xA;   CodCliente= cl.clCodigoCliente,&#xA;   NombreCliente=cl.clNombreCompleto,&#xA;   CodigoMoneda=case po.poIdFecha when @FechAct then  mo.moCodigoMoneda else null end,&#xA;   CodigoAgenciaOper=case po.poIdFecha when @FechAct then  ago.agCodigoAgencia else null end,-- Agencia Operacion&#xA;   CodigoAgenciaCli=ag.agCodigoAgencia,-- Agencia Operacion&#xA;   CodProducto=case po.poIdFecha when @FechAct then  prCodigoProducto else null end,&#xA;   FechaVencimiento=case po.poIdFecha when @FechAct then  po.poFechaVencimiento else null end,&#xA;   FechaApertura=null,&#xA;   NumeroOperacion=case po.poIdFecha when @FechAct then  po.poNoOperacion  else null end,&#xA;   Plazo=case po.poIdFecha when @FechAct then  po.poPlazoOperacion  else null end,&#xA;   OperacionCliente=case po.poIdFecha when @FechAct then  coc.cocCodigoCalificacionOperacionCliente else null end,&#xA;   CodCanal=ca.caCodigoCanal,&#xA;&#xA;   OrdenN1=cc.ccOrdenAgrupacion,&#xA;   OrdenN2=cc.ccOrdenAgrupacionN2,&#xA;   OrdenN3=caOrdenCanal,&#xA;   Canal=ca.caDescripcionAgrupacionCanal,&#xA;   Nivel1=cc.ccFamiliaProducto,&#xA;   Nivel2=left(cc.ccGrupo+SPACE(70),70)+'X'+right('0'+cast(cc.ccOrdenAgrupacion as varchar(10)),2)+right('0'+ cast(cc.ccOrdenAgrupacionN2 as varchar(10)),2)+'X',&#xA;   Nivel3='     '+ca.caAgrupacion,&#xA;   TasaHoy=case  when po.poIdFecha=@FechAct and isnull(po.poTasaNominal,0) &gt; 0 then avg(isnull(po.poTasaNominal,0)) else 0 end,&#xA;   TasaAyer=case when po.poIdFecha=@FechaAyer and isnull(po.poTasaNominal,0) &gt; 0  then avg(isnull(po.poTasaNominal,0))  else 0 end,&#xA;   TasaMesAnt=case  when po.poIdFecha=@FechaMesAnt and isnull(po.poTasaNominal,0) &gt; 0  then avg(isnull(po.poTasaNominal,0))  else 0 end,&#xA;   TasaAnioAnt=case  when po.poIdFecha=@FechaAnioAnt and isnull(po.poTasaNominal,0) &gt; 0  then avg(isnull(po.poTasaNominal,0))  else 0 end,&#xA;   --FechaHoy=@FechAct,&#xA;   RealHoy=case po.poIdFecha when @FechAct then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;   RealAyer=case po.poIdFecha when @FechaAyer then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;   RealMesAnt=case po.poIdFecha when @FechaMesAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end,&#xA;   RealAnioAnt=case po.poIdFecha when @FechaAnioAnt then sum(isnull(po.poSaldoOperacionUSD,0))/1000 else 0 end&#xA;&#xA;   into #Consolidados&#xA;   --drop table #Consolidados&#xA;&#xA;   from #DWHPasivoOperacion po&#xA;   inner join DWDCuentaContable cc on po.poIdCuentaContable=ccIdCuentaContable&#xA;   inner join DWDCliente cl on po.poIdCliente=clIdCliente&#xA;   inner join DWDMoneda mo on po.poIdMoneda=moIdMoneda&#xA;   inner join DWDProducto pr on pr.prIdProducto=po.poIdProducto&#xA;   inner join DWDCanal ca on cl.clIdCanal=ca.caIdCanal&#xA;   inner join DWDAgenciaOperacion ago on ago.agIdAgencia=po.poIdAgencia&#xA;   left outer join DWDAgenciaOperacion ag on cl.clIdAgencia=ag.agIdAgencia&#xA;   left outer join DWDCalificacionOperacionCliente coc on coc.cocIdCalificacionOperacionCliente=po.poIdCalificacionOperacionCliente&#xA;   inner join (&#xA;   SELECT DISTINCT&#xA;   p2.CpCodigoIndicador indicadorNivel3&#xA;   FROM DWDClasificacionProductos p&#xA;   join DWDClasificacionProductos p1 ON p1.CpPadre=p.CpCodigoIndicador&#xA;   join DWDClasificacionProductos p2 ON p2.CpPadre=p1.CpCodigoIndicador&#xA;   WHERE p.CpCodigoIndicador = 2&#xA;   and p1.CpCodigoIndicador in (141,142)&#xA;   and  p.CpNivel=1 and p1.CpNivel=2 and p2.CpNivel=3&#xA;   ) cp ON ccCodigoIndicador=cp.indicadorNivel3&#xA;   where po.poIdFecha in (@FechAct, @FechaAyer, @FechaMesAnt , @FechaAnioAnt)&#xA;   and ca.caEstado=1&#xA;   and cl.clFechaFin is null&#xA;   --and cc.ccCodigoMoneda='USD'&#xA;   group by isnull(po.poTasaNominal,0),&#xA;   ca.caCodigoCanal,&#xA;   cl.clCodigoCliente,&#xA;   cl.clNombreCompleto,&#xA;   mo.moCodigoMoneda,&#xA;   ago.agCodigoAgencia,&#xA;   ag.agCodigoAgencia,&#xA;   coc.cocCodigoCalificacionOperacionCliente,&#xA;   po.poFechaVencimiento,&#xA;   prCodigoProducto,&#xA;   po.poNoOperacion,&#xA;   po.poPlazoOperacion,&#xA;   cc.ccOrdenAgrupacion,&#xA;   cc.ccOrdenAgrupacionN2,&#xA;   ca.caOrdenCanal,&#xA;   ca.caAgrupacion,&#xA;   cc.ccFamiliaProducto,&#xA;   ca.caDescripcionAgrupacionCanal,&#xA;   cc.ccGrupo,&#xA;   po.poIdFecha&#xA;&#xA;&#xA;   union all&#xA;&#xA;   /* ------------------------------------------------------------------------ */&#xA;   /*                          CARTERA                                         */&#xA;   /* ------------------------------------------------------------------------ */&#xA;&#xA;&#xA;   select&#xA;   CodCliente,&#xA;   NombreCliente,&#xA;   CodigoMoneda,&#xA;   CodigoAgenciaOper,&#xA;   CodigoAgenciaCli,&#xA;   CodProducto,&#xA;   FechaVencimiento,&#xA;   FechaApertura,&#xA;   NumeroOperacion,&#xA;   Plazo,&#xA;   OperacionCliente,&#xA;   CodCanal,&#xA;   OrdenN1,&#xA;   OrdenN2,&#xA;   OrdenN3,&#xA;   Canal,&#xA;   Nivel1,&#xA;   Nivel2=left(Nivel2+space(70),70)+'X'+right('0'+cast(OrdenN1 as varchar(10)),2)+right('0'+ cast(OrdenN2 as varchar(10)),2)+'X',&#xA;   Nivel3,&#xA;   TasaHoy,&#xA;   TasaAyer,&#xA;   TasaMesAnt,&#xA;   TasaAnioAnt,&#xA;   RealHoy,&#xA;   RealAyer,&#xA;   RealMesAnt,&#xA;   RealAnioAnt&#xA;   from #Cartera&#xA;&#xA;   Union all&#xA;&#xA;   --&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#xA;---&gt;&gt;&gt;&gt;&gt;&gt;&gt;     CARTERA EN DIFICULTADES       &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;select &#xA;CodCliente,&#xA;NombreCliente,&#xA;CodigoMoneda,&#xA;CodigoAgenciaOper,&#xA;CodigoAgenciaCli,&#xA;CodProducto,&#xA;FechaVencimiento,&#xA;FechaApertura,&#xA;NumeroOperacion,&#xA;Plazo,&#xA;OperacionCliente,&#xA;CodCanal,&#xA;OrdenN1,&#xA;OrdenN2,&#xA;OrdenN3,&#xA;Canal,&#xA;Nivel1,&#xA;Nivel2=left('Cartera en Dificultades'+space(70),70)+'X'+right('0'+cast(OrdenN1 as varchar(10)),2)+'13X',&#xA;Nivel3,&#xA;TasaHoy,&#xA;TasaAyer,&#xA;TasaMesAnt,&#xA;TasaAnioAnt,&#xA;RealHoy,&#xA;RealAyer,&#xA;RealMesAnt,&#xA;RealAnioAnt&#xA;from #Cartera&#xA;where Estado='Dif'&#xA;&#xA;union all&#xA;&#xA;--&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#xA;---&gt;&gt;&gt;&gt;&gt;&gt;      VIGENTE      &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;      DIFICULTADES  &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#xA;--&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#xA;&#xA;&#xA;   select&#xA;   CodCliente,&#xA;   NombreCliente,&#xA;   CodigoMoneda,&#xA;   CodigoAgenciaOper,&#xA;   CodigoAgenciaCli,&#xA;   CodProducto,&#xA;   FechaVencimiento,&#xA;   FechaApertura,&#xA;   NumeroOperacion,&#xA;   Plazo,&#xA;   OperacionCliente,&#xA;   CodCanal,&#xA;   OrdenN1,&#xA;   OrdenN2,&#xA;   OrdenN3,&#xA;   Canal,&#xA;   Nivel1,&#xA;   Nivel2=&#xA;   case&#xA;   when Estado='Vig' then  left((Estado+'. '+Nivel2+SPACE(70)),70)+'X'+right('0'+cast(OrdenN1 as varchar(10)),2)+right('0'+ cast(OrdenN2+20 as varchar(10)),2)+'X'&#xA;   else left((Estado+'. '+Nivel2+SPACE(70)),70)+'X'+right('0'+cast(OrdenN1 as varchar(10)),2)+right('0'+ cast(OrdenN2+40 as varchar(10)),2)+'X'&#xA;   end,&#xA;   Nivel3,&#xA;   TasaHoy,&#xA;   TasaAyer,&#xA;   TasaMesAnt,&#xA;   TasaAnioAnt,&#xA;   RealHoy,&#xA;   RealAyer,&#xA;   RealMesAnt,&#xA;   RealAnioAnt&#xA;   from #Cartera&#xA;   where Estado in ('Dif','Vig')&#xA;&#xA;&#xA;   ----------------------&#xA;   -- Consolidado final&#xA;   ----------------------&#xA;&#xA;   if object_id('[tempdb]..#Consolidado_final') is not null&#xA;   begin&#xA;   drop table #Consolidado_final&#xA;   end&#xA;&#xA;   select&#xA;   CodCliente,&#xA;   NombreCliente,&#xA;   CodigoMoneda,&#xA;   CodigoAgenciaOper,&#xA;   CodigoAgenciaCli,&#xA;   CodProducto,&#xA;   FechaVencimiento,&#xA;   FechaApertura,&#xA;   NumeroOperacion,&#xA;   Plazo,&#xA;   OperacionCliente,&#xA;   CodCanal,&#xA;   OrdenN1,&#xA;   OrdenN2,&#xA;   Canal,&#xA;   Nivel1,&#xA;   Nivel2,&#xA;   Nivel3,&#xA;   TasaHoy=max(isnull(TasaHoy,0)),&#xA;   TasaAyer=max(isnull(TasaAyer,0)),&#xA;   TasaMesAnt=max(isnull(TasaMesAnt,0)),&#xA;   TasaAnioAnt=max(isnull(TasaAnioAnt,0)),&#xA;   RealHoy=sum(RealHoy),&#xA;   RealAyer=sum(RealAyer),&#xA;   RealMesAnt=sum(RealMesAnt),&#xA;   RealAnioAnt=sum(RealAnioAnt)&#xA;&#xA;   --select *&#xA;   into #Consolidado_final&#xA;&#xA;   from #Consolidados&#xA;   group by&#xA;   CodCliente,&#xA;   NombreCliente,&#xA;   CodigoMoneda,&#xA;   CodigoAgenciaOper,&#xA;   CodigoAgenciaCli,&#xA;   CodProducto,&#xA;   FechaVencimiento,&#xA;   FechaApertura,&#xA;   NumeroOperacion,&#xA;   Plazo,&#xA;   OperacionCliente,&#xA;   CodCanal,&#xA;   OrdenN1,&#xA;   OrdenN2,&#xA;   Canal,&#xA;   Nivel1,&#xA;   Nivel2,&#xA;   Nivel3&#xA;&#xA;&#xA;   ---------------------------------&#xA;   -- Asignar clientes a menor 5000&#xA;   ---------------------------------&#xA;&#xA;   update a&#xA;   set&#xA;   CodCliente=-5000,&#xA;   CodigoAgenciaOper=-1,&#xA;   NumeroOperacion=-1,&#xA;   NombreCliente='Menor a 5000',&#xA;   CodCanal=-1,&#xA;   CodigoMoneda=-1,&#xA;   CodProducto=-1,&#xA;   FechaVencimiento=null,&#xA;   Plazo=-1,&#xA;   CodigoAgenciaCli=-1,&#xA;   OperacionCliente=-1,&#xA;   FechaApertura=null&#xA;&#xA;   --select a.*&#xA;&#xA;   from #Consolidado_final a inner join&#xA;   (&#xA;   select&#xA;   CodCliente,&#xA;   NumeroOperacion,&#xA;   Nivel1,&#xA;   Nivel2,&#xA;   Realhoy=sum(RealHoy),&#xA;   RealAyer=sum(RealAyer),&#xA;   RealMesAnt=sum(RealMesAnt),&#xA;   RealAnioAnt=sum(RealAnioAnt)&#xA;   from #Consolidado_final&#xA;   group by CodCliente,&#xA;   Nivel1,&#xA;   Nivel2,&#xA;   NumeroOperacion&#xA;   having  sum(RealHoy)&lt;5&#xA; and abs(sum(RealHoy)-sum(RealAyer))&lt;5&#xA; and abs(sum(RealHoy)-sum(RealMesAnt))&lt;5&#xA; and abs(sum(RealHoy)-sum(RealAnioAnt))&lt;5&#xA;&#xA;) b on&#xA;a.CodCliente=b.CodCliente&#xA;and isnull(a.NumeroOperacion,'')=isnull(b.NumeroOperacion,'')&#xA;and a.Nivel1=b.Nivel1&#xA;and a.Nivel2=b.Nivel2&#xA;&#xA;&#xA;&#xA;&#xA;--------------------------------------&#xA;--&gt;&gt;&gt;  Actualiza Operacion Cliente&#xA;   --------------------------------------&#xA;&#xA;   update a&#xA;   set a.OperacionCliente=b.OperacionCliente&#xA;   from #Consolidado_final a inner join&#xA;   (&#xA;   select distinct&#xA;   CodCliente,&#xA;   OperacionCliente=max(OperacionCliente)&#xA;   from #Consolidado_final&#xA;   where OperacionCliente  is not null&#xA;   group by CodCliente&#xA;   ) as b&#xA;   on a.CodCliente=b.CodCliente&#xA;   where a.OperacionCliente is null&#xA;&#xA;&#xA;   update #Consolidado_final&#xA;   set OperacionCliente=-1&#xA;   where OperacionCliente  is null&#xA;&#xA;&#xA;&#xA;   ------------------------------------&#xA;   ---      CONSOLIDADO&#xA;   ------------------------------------&#xA;&#xA;   select&#xA;   CodCliente,&#xA;   NombreCliente,&#xA;   CodigoMoneda,&#xA;   CodigoAgenciaOper,&#xA;   CodigoAgenciaCli,&#xA;   CodProducto,&#xA;   FechaVencimiento=max(FechaVencimiento),&#xA;   FechaApertura,&#xA;   NumeroOperacion,&#xA;   Plazo,&#xA;   OperacionCliente,&#xA;   CodCanal,&#xA;   OrdenN1,&#xA;   OrdenN2,&#xA;   Canal,&#xA;   Nivel1,&#xA;   Nivel2,&#xA;   Nivel3,&#xA;   TasaHoy=max(TasaHoy),&#xA;   TasaAyer=max(TasaAyer),&#xA;   TasaMesAnt=max(TasaMesAnt),&#xA;   TasaAnioAnt=max(TasaAnioAnt),&#xA;   RealHoy=sum(RealHoy),&#xA;   RealAyer=sum(RealAyer),&#xA;   RealMesAnt=sum(RealMesAnt),&#xA;   RealAnioAnt=sum(RealAnioAnt)&#xA;&#xA;   from #Consolidado_final&#xA;   group by CodCliente,&#xA;   NombreCliente,&#xA;   CodigoMoneda,&#xA;   CodigoAgenciaOper,&#xA;   CodigoAgenciaCli,&#xA;   CodProducto,&#xA;   --FechaVencimiento,&#xA;   FechaApertura,&#xA;   NumeroOperacion,&#xA;   Plazo,&#xA;   OperacionCliente,&#xA;   CodCanal,&#xA;   OrdenN1,&#xA;   OrdenN2,&#xA;   Canal,&#xA;   Nivel1,&#xA;   Nivel2,&#xA;   Nivel3&#xA;   having sum(abs(TasaHoy))+sum(abs(TasaAyer))+sum(abs(TasaMesAnt))+sum(abs(TasaAnioAnt))+&#xA;   sum(abs(RealHoy))+sum(abs(RealAyer))+sum(abs(RealMesAnt))+sum(abs(RealAnioAnt))&gt;0">
                      <xs:complexType>
                        <xs:sequence>
                          <xs:element name="CodCliente" msprop:DbColumnName="CodCliente" msprop:FriendlyName="CodCliente" type="xs:int" minOccurs="0" />
                          <xs:element name="NombreCliente" msprop:DbColumnName="NombreCliente" msprop:FriendlyName="NombreCliente" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="CodigoMoneda" msprop:DbColumnName="CodigoMoneda" msprop:FriendlyName="CodigoMoneda" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="CodigoAgenciaOper" msprop:DbColumnName="CodigoAgenciaOper" msprop:FriendlyName="CodigoAgenciaOper" type="xs:int" minOccurs="0" />
                          <xs:element name="CodigoAgenciaCli" msprop:DbColumnName="CodigoAgenciaCli" msprop:FriendlyName="CodigoAgenciaCli" type="xs:int" minOccurs="0" />
                          <xs:element name="CodProducto" msprop:DbColumnName="CodProducto" msprop:FriendlyName="CodProducto" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="FechaVencimiento" msprop:DbColumnName="FechaVencimiento" msprop:FriendlyName="FechaVencimiento" type="xs:int" minOccurs="0" />
                          <xs:element name="FechaApertura" msprop:DbColumnName="FechaApertura" msprop:FriendlyName="FechaApertura" type="xs:int" minOccurs="0" />
                          <xs:element name="NumeroOperacion" msprop:DbColumnName="NumeroOperacion" msprop:FriendlyName="NumeroOperacion" type="xs:double" minOccurs="0" />
                          <xs:element name="Plazo" msprop:DbColumnName="Plazo" msprop:FriendlyName="Plazo" type="xs:int" minOccurs="0" />
                          <xs:element name="OperacionCliente" msprop:DbColumnName="OperacionCliente" msprop:FriendlyName="OperacionCliente" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="CodCanal" msprop:DbColumnName="CodCanal" msprop:FriendlyName="CodCanal" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="OrdenN1" msprop:DbColumnName="OrdenN1" msprop:FriendlyName="OrdenN1" type="xs:int" minOccurs="0" />
                          <xs:element name="OrdenN2" msprop:DbColumnName="OrdenN2" msprop:FriendlyName="OrdenN2" type="xs:int" minOccurs="0" />
                          <xs:element name="Canal" msprop:DbColumnName="Canal" msprop:FriendlyName="Canal" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="Nivel1" msprop:DbColumnName="Nivel1" msprop:FriendlyName="Nivel1" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="Nivel2" msprop:DbColumnName="Nivel2" msprop:FriendlyName="Nivel2" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="Nivel3" msprop:DbColumnName="Nivel3" msprop:FriendlyName="Nivel3" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="TasaHoy" msprop:DbColumnName="TasaHoy" msprop:FriendlyName="TasaHoy" type="xs:double" minOccurs="0" />
                          <xs:element name="TasaAyer" msprop:DbColumnName="TasaAyer" msprop:FriendlyName="TasaAyer" type="xs:double" minOccurs="0" />
                          <xs:element name="TasaMesAnt" msprop:DbColumnName="TasaMesAnt" msprop:FriendlyName="TasaMesAnt" type="xs:double" minOccurs="0" />
                          <xs:element name="TasaAnioAnt" msprop:DbColumnName="TasaAnioAnt" msprop:FriendlyName="TasaAnioAnt" type="xs:double" minOccurs="0" />
                          <xs:element name="RealHoy" msprop:DbColumnName="RealHoy" msprop:FriendlyName="RealHoy" type="xs:double" minOccurs="0" />
                          <xs:element name="RealAyer" msprop:DbColumnName="RealAyer" msprop:FriendlyName="RealAyer" type="xs:double" minOccurs="0" />
                          <xs:element name="RealMesAnt" msprop:DbColumnName="RealMesAnt" msprop:FriendlyName="RealMesAnt" type="xs:double" minOccurs="0" />
                          <xs:element name="RealAnioAnt" msprop:DbColumnName="RealAnioAnt" msprop:FriendlyName="RealAnioAnt" type="xs:double" minOccurs="0" />
                        </xs:sequence>
                      </xs:complexType>
                    </xs:element>
                    <xs:element name="DWDRangos_0a366f4d-93a5-4c58-9791-19f144a1394f" msdata:Locale="" msprop:IsLogical="True" msprop:FriendlyName="Rangos" msprop:DbSchemaName="dbo" msprop:DbTableName="DWDRangos" msprop:TableType="View" msprop:Description="DWDRangos" msprop:QueryDefinition=" SELECT [dbo].[DWDRangos].* FROM [dbo].[DWDRangos] ">
                      <xs:complexType>
                        <xs:sequence>
                          <xs:element name="Valor" msprop:DbColumnName="Valor" msprop:FriendlyName="Valor" type="xs:long" minOccurs="0" />
                          <xs:element name="Descripcion" msprop:DbColumnName="Descripcion" msprop:FriendlyName="Descripcion" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="Orden" msprop:DbColumnName="Orden" msprop:FriendlyName="Orden" type="xs:long" minOccurs="0" />
                        </xs:sequence>
                      </xs:complexType>
                    </xs:element>
                    <xs:element name="Canal_aa566168-7ef4-4c19-b8db-fe162403657a" msdata:Locale="" msprop:IsLogical="True" msprop:FriendlyName="Canal" msprop:DbTableName="Canal" msprop:TableType="View" msprop:Description="Canal" msprop:QueryDefinition="set nocount on&#xD;&#xA;&#xD;&#xA;declare @id int&#xD;&#xA;&#xD;&#xA;if object_id('tempdb..#DWDCanal') is not null&#xD;&#xA;begin &#xD;&#xA; drop table #DWDCanal&#xD;&#xA;end&#xD;&#xA;&#xD;&#xA;select distinct&#xD;&#xA; caCodigoAgrupacionCanal&#xD;&#xA;,Orden=caOrdenCanal&#xD;&#xA;,caDescripcionAgrupacionCanal&#xD;&#xA;into #DWDCanal&#xD;&#xA;from DWDCanal&#xD;&#xA;where caEstado=1&#xD;&#xA;order by caOrdenCanal&#xD;&#xA;,caCodigoAgrupacionCanal&#xD;&#xA;,caDescripcionAgrupacionCanal&#xD;&#xA;&#xD;&#xA;select @id=max(Orden) from #DWDCanal&#xD;&#xA;&#xD;&#xA;select &#xD;&#xA; caCodigoAgrupacionCanal&#xD;&#xA;,Orden&#xD;&#xA;,caDescripcionAgrupacionCanal&#xD;&#xA;&#xD;&#xA;from #DWDCanal&#xD;&#xA;&#xD;&#xA;union all&#xD;&#xA;&#xD;&#xA;select&#xD;&#xA;caCodigoAgrupacionCanal='NA',&#xD;&#xA;Orden=@id+1,&#xD;&#xA;'Otr.Dep y Obl.Fin'&#xD;&#xA;&#xD;&#xA;union all&#xD;&#xA;&#xD;&#xA;select &#xD;&#xA;caCodigoAgrupacionCanal,&#xD;&#xA;Orden=@id+2,&#xD;&#xA;caDescripcionAgrupacionCanal&#xD;&#xA;from dwdcanal&#xD;&#xA;where caCodigoCanal='TIT'">
                      <xs:complexType>
                        <xs:sequence>
                          <xs:element name="Orden" msprop:DbColumnName="Orden" msprop:FriendlyName="Orden" type="xs:long" minOccurs="0" />
                          <xs:element name="caDescripcionAgrupacionCanal" msprop:DbColumnName="caDescripcionAgrupacionCanal" msprop:FriendlyName="caDescripcionAgrupacionCanal" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                          <xs:element name="caCodigoAgrupacionCanal" msprop:DbColumnName="caCodigoAgrupacionCanal" msprop:FriendlyName="caCodigoAgrupacionCanal" minOccurs="0">
                            <xs:simpleType>
                              <xs:restriction base="xs:string">
                                <xs:maxLength value="32766" />
                              </xs:restriction>
                            </xs:simpleType>
                          </xs:element>
                        </xs:sequence>
                      </xs:complexType>
                    </xs:element>
                  </xs:choice>
                </xs:complexType>
                <xs:unique name="Constraint1" msdata:PrimaryKey="true">
                  <xs:selector xpath=".//DWDFecha_c1749855-feed-4ef0-9306-d52374a937e2" />
                  <xs:field xpath="feIdFecha" />
                </xs:unique>
              </xs:element>
            </xs:schema>
            <NewDataSet xmlns="" />
          </Schema>
        </DataSourceView>
      </DataSourceViews>
      <Roles>
        <Role>
          <ID>Role</ID>
          <Name>Read</Name>
          <Members>
            <Member>
              <Name>BANINTERN\ggs_MIS_MonitorHojaPosicion</Name>
              <Sid>S-1-5-21-3084530191-2796110714-333732663-35939</Sid>
            </Member>
            <Member>
              <Name>BANINTERN\bingoyej</Name>
              <Sid>S-1-5-21-3084530191-2796110714-333732663-35645</Sid>
            </Member>
            <Member>
              <Name>S-1-5-21-3084530191-2796110714-333732663-5143</Name>
              <Sid>S-1-5-21-3084530191-2796110714-333732663-5143</Sid>
            </Member>
          </Members>
        </Role>
        <Role>
          <ID>Role 1</ID>
          <Name>Role</Name>
          <Members>
            <Member>
              <Name>BANINTERN\bincarro</Name>
              <Sid>S-1-5-21-3084530191-2796110714-333732663-34750</Sid>
            </Member>
            <Member>
              <Name>S-1-5-21-3084530191-2796110714-333732663-5143</Name>
              <Sid>S-1-5-21-3084530191-2796110714-333732663-5143</Sid>
            </Member>
          </Members>
        </Role>
      </Roles>
      <DatabasePermissions>
        <DatabasePermission>
          <ID>DatabasePermission</ID>
          <Name>DatabasePermission</Name>
          <RoleID>Role</RoleID>
          <Read>Allowed</Read>
        </DatabasePermission>
        <DatabasePermission>
          <ID>DatabasePermission 1</ID>
          <Name>DatabasePermission 1</Name>
          <RoleID>Role 1</RoleID>
          <ReadDefinition>Allowed</ReadDefinition>
          <Administer>true</Administer>
        </DatabasePermission>
      </DatabasePermissions>
    </Database>
  </ObjectDefinition>
</Alter>